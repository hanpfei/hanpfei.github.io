<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









  
  
  <link rel="stylesheet" media="all" href="/lib/Han/dist/han.min.css?v=3.3">




<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.0.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/freesoft.jpg?v=6.0.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/freesoft.jpg?v=6.0.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/freesoft.jpg?v=6.0.3">


  <link rel="mask-icon" href="/images/freesoft.jpg?v=6.0.3" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '6.0.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  
  <meta name="keywords" content="翻译,ROS," />


<meta name="description" content="简介上一课，我们编写了 TwoWheelVehicle 类，一个 EV3 的子类。它的方法是 move 和 stop，但它不仅仅是围绕操作 opOutput_Speed，opOutput_Start 和 opOutput_Stop 的薄薄的封装。本节课的最后，类 TwoWheelVehicle 将具有实质的内容。如大多数软件那样，它一步步增长，本节课不会是最后一次，我们将继续使用这个类。">
<meta property="og:type" content="article">
<meta property="og:title" content="EV3 直接命令 - 第 4 课 用两个驱动轮精确地移动小车">
<meta property="og:url" content="https://www.wolfcstech.com/2018/10/31/lego_ev3_direct_command_004/index.html">
<meta property="og:site_name" content="WolfcsTech">
<meta property="og:description" content="简介上一课，我们编写了 TwoWheelVehicle 类，一个 EV3 的子类。它的方法是 move 和 stop，但它不仅仅是围绕操作 opOutput_Speed，opOutput_Start 和 opOutput_Stop 的薄薄的封装。本节课的最后，类 TwoWheelVehicle 将具有实质的内容。如大多数软件那样，它一步步增长，本节课不会是最后一次，我们将继续使用这个类。">
<meta property="og:updated_time" content="2018-11-01T01:21:31.741Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="EV3 直接命令 - 第 4 课 用两个驱动轮精确地移动小车">
<meta name="twitter:description" content="简介上一课，我们编写了 TwoWheelVehicle 类，一个 EV3 的子类。它的方法是 move 和 stop，但它不仅仅是围绕操作 opOutput_Speed，opOutput_Start 和 opOutput_Stop 的薄薄的封装。本节课的最后，类 TwoWheelVehicle 将具有实质的内容。如大多数软件那样，它一步步增长，本节课不会是最后一次，我们将继续使用这个类。">






  <link rel="canonical" href="https://www.wolfcstech.com/2018/10/31/lego_ev3_direct_command_004/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>
  <title>EV3 直接命令 - 第 4 课 用两个驱动轮精确地移动小车 | WolfcsTech</title>
  




<script async src="https://www.googletagmanager.com/gtag/js?id=UA-109419024-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-109419024-1');
</script>



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?3c736b12c32c019fd9ff6c825b6b9b44";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"> <div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">WolfcsTech</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            <i class="menu-item-icon fa fa-fw fa-home"></i> <br />首页</a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            <i class="menu-item-icon fa fa-fw fa-th"></i> <br />分类</a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />归档</a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />标签</a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            <i class="menu-item-icon fa fa-fw fa-user"></i> <br />关于</a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="http://www.ixirong.com/404.html" rel="section">
            <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />公益 404</a>
        </li>
      

      
    </ul>
  

  
</nav>


  



 </div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://www.wolfcstech.com/2018/10/31/lego_ev3_direct_command_004/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Han Pengfei">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/freesoft.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WolfcsTech">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">EV3 直接命令 - 第 4 课 用两个驱动轮精确地移动小车</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-10-31T20:15:49+08:00">2018-10-31</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/ROS/" itemprop="url" rel="index"><span itemprop="name">ROS</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/10/31/lego_ev3_direct_command_004/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2018/10/31/lego_ev3_direct_command_004/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2018/10/31/lego_ev3_direct_command_004/" class="leancloud_visitors" data-flag-title="EV3 直接命令 - 第 4 课 用两个驱动轮精确地移动小车">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        <h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>上一课，我们编写了 <code>TwoWheelVehicle</code> 类，一个 EV3 的子类。它的方法是 <code>move</code> 和 <code>stop</code>，但它不仅仅是围绕操作 <code>opOutput_Speed</code>，<code>opOutput_Start</code> 和 <code>opOutput_Stop</code> 的薄薄的封装。本节课的最后，类 <code>TwoWheelVehicle</code> 将具有实质的内容。如大多数软件那样，它一步步增长，本节课不会是最后一次，我们将继续使用这个类。<br><a id="more"></a><br>上一课的主题是一个遥控小车。我们编写了无限移动的代码，它们由新命令中断。我们已经看到了这一设计理念的好处，它不阻塞 EV3 设备。精确移动的第一个版本（本节课的结果）将阻塞 EV3 设备，且它将耗费我们进一步的工作来找到一个不阻塞的方案。</p>
<h1 id="同步的电机移动"><a href="#同步的电机移动" class="headerlink" title="同步的电机移动"></a>同步的电机移动</h1><p>希望上一节课的车辆仍然存在。我们再次需要它。你还记得，右轮连接到端口 A，左边连接到端口 D。我们的遥控解决方案存在缺陷：移动越慢，转向的精度越差。我们需要的是一个操作，两个电机的速度可以被设置为定义的比率。如你可能期待的那样，这种操作是存在的。请给你的小车发送如下的直接命令：<br><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">-------------------------------------------------------------                   </div><div class="line"> <span class="symbol">\ </span>len <span class="symbol">\ </span>cnt <span class="symbol">\t</span>y<span class="symbol">\ </span>hd  <span class="symbol">\o</span>p<span class="symbol">\l</span>a<span class="symbol">\n</span>o<span class="symbol">\s</span>p<span class="symbol">\ </span>tu  <span class="symbol">\ </span>step   <span class="symbol">\b</span>r<span class="symbol">\o</span>p<span class="symbol">\l</span>a<span class="symbol">\n</span>o<span class="symbol">\ </span>                 </div><div class="line">  -------------------------------------------------------------                 </div><div class="line">0x|12:00|2A:00|80|00:00|B0|00|09|3B|81:32|82:D0:02|00|A6|00|09|                 </div><div class="line">  -------------------------------------------------------------                 </div><div class="line">   <span class="symbol">\ </span>18  <span class="symbol">\ </span>42  <span class="symbol">\n</span>o<span class="symbol">\ </span>0,0 <span class="symbol">\O</span> <span class="symbol">\0</span> <span class="symbol">\A</span> <span class="symbol">\-</span>5<span class="symbol">\ </span>50  <span class="symbol">\ </span>720    <span class="symbol">\0</span> <span class="symbol">\O</span> <span class="symbol">\0</span> <span class="symbol">\A</span> <span class="symbol">\ </span>                </div><div class="line">    <span class="symbol">\ </span>    <span class="symbol">\ </span>    <span class="symbol">\ </span> <span class="symbol">\ </span>    <span class="symbol">\u</span> <span class="symbol">\ </span> <span class="symbol">\+</span> <span class="symbol">\ </span> <span class="symbol">\ </span>    <span class="symbol">\ </span>       <span class="symbol">\ </span> <span class="symbol">\u</span> <span class="symbol">\ </span> <span class="symbol">\+</span> <span class="symbol">\ </span>               </div><div class="line">     <span class="symbol">\ </span>    <span class="symbol">\ </span>    <span class="symbol">\ </span> <span class="symbol">\ </span>    <span class="symbol">\t</span> <span class="symbol">\ </span> <span class="symbol">\D</span> <span class="symbol">\ </span> <span class="symbol">\ </span>    <span class="symbol">\ </span>       <span class="symbol">\ </span> <span class="symbol">\t</span> <span class="symbol">\ </span> <span class="symbol">\D</span> <span class="symbol">\ </span>              </div><div class="line">      <span class="symbol">\ </span>    <span class="symbol">\ </span>    <span class="symbol">\ </span> <span class="symbol">\ </span>    <span class="symbol">\p</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>    <span class="symbol">\ </span>       <span class="symbol">\ </span> <span class="symbol">\p</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>             </div><div class="line">       <span class="symbol">\ </span>    <span class="symbol">\ </span>    <span class="symbol">\ </span> <span class="symbol">\ </span>    <span class="symbol">\u</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>    <span class="symbol">\ </span>       <span class="symbol">\ </span> <span class="symbol">\u</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>            </div><div class="line">        <span class="symbol">\ </span>    <span class="symbol">\ </span>    <span class="symbol">\ </span> <span class="symbol">\ </span>    <span class="symbol">\t</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>    <span class="symbol">\ </span>       <span class="symbol">\ </span> <span class="symbol">\t</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>           </div><div class="line">         <span class="symbol">\ </span>    <span class="symbol">\ </span>    <span class="symbol">\ </span> <span class="symbol">\ </span>    <span class="symbol">\_</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>    <span class="symbol">\ </span>       <span class="symbol">\ </span> <span class="symbol">\_</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>          </div><div class="line">          <span class="symbol">\ </span>    <span class="symbol">\ </span>    <span class="symbol">\ </span> <span class="symbol">\ </span>    <span class="symbol">\S</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>    <span class="symbol">\ </span>       <span class="symbol">\ </span> <span class="symbol">\S</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>         </div><div class="line">           <span class="symbol">\ </span>    <span class="symbol">\ </span>    <span class="symbol">\ </span> <span class="symbol">\ </span>    <span class="symbol">\t</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>    <span class="symbol">\ </span>       <span class="symbol">\ </span> <span class="symbol">\t</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>        </div><div class="line">            <span class="symbol">\ </span>    <span class="symbol">\ </span>    <span class="symbol">\ </span> <span class="symbol">\ </span>    <span class="symbol">\e</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>    <span class="symbol">\ </span>       <span class="symbol">\ </span> <span class="symbol">\a</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>       </div><div class="line">             <span class="symbol">\ </span>    <span class="symbol">\ </span>    <span class="symbol">\ </span> <span class="symbol">\ </span>    <span class="symbol">\p</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>    <span class="symbol">\ </span>       <span class="symbol">\ </span> <span class="symbol">\r</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>      </div><div class="line">              <span class="symbol">\ </span>    <span class="symbol">\ </span>    <span class="symbol">\ </span> <span class="symbol">\ </span>    <span class="symbol">\_</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>    <span class="symbol">\ </span>       <span class="symbol">\ </span> <span class="symbol">\t</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>     </div><div class="line">               <span class="symbol">\ </span>    <span class="symbol">\ </span>    <span class="symbol">\ </span> <span class="symbol">\ </span>    <span class="symbol">\S</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>    <span class="symbol">\ </span>       <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>    </div><div class="line">                <span class="symbol">\ </span>    <span class="symbol">\ </span>    <span class="symbol">\ </span> <span class="symbol">\ </span>    <span class="symbol">\y</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>    <span class="symbol">\ </span>       <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>   </div><div class="line">                 <span class="symbol">\ </span>    <span class="symbol">\ </span>    <span class="symbol">\ </span> <span class="symbol">\ </span>    <span class="symbol">\n</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>    <span class="symbol">\ </span>       <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>  </div><div class="line">                  <span class="symbol">\ </span>    <span class="symbol">\ </span>    <span class="symbol">\ </span> <span class="symbol">\ </span>    <span class="symbol">\c</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>    <span class="symbol">\ </span>       <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> </div><div class="line">                   -------------------------------------------------------------</div></pre></td></tr></table></figure></p>
<p>点击 A 旋转 720°，点击 D 移动 360°。小车左转，两个电机都以低速转动且良好的同步。新的操作是：</p>
<ul>
<li>opOutput_Step_Sync = 0xB0，参数是：<ul>
<li>LAYER</li>
<li>NOS：两个输出端口，命令不是对称的，它区别了低端口和高端口。在我们的情况中，低端口是 PORT_A，右轮，高端口是 PORT_D，左轮。</li>
<li>SPEED</li>
<li>TURN：转向比率，[-200 - 200]</li>
<li>STEP：转速脉冲以度为单位，值 0 代表无限运动（如果TURN &gt; 0，则 STEP 限制低端口，如果 TURN &lt; 0，则限制较高端口）。正值，参数 SPEED 的符号确定方向。</li>
<li>BRAKE</li>
</ul>
</li>
</ul>
<p>参数 TURN 需要一些解释。但你处在一个很好的位置，你已经知道了它的含义，因为我们在第 3 课的远程控制程序中使用了它。如你可能记得的那样，我们计算两轮的速度：<br><figure class="highlight sqf"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> turn &gt; <span class="number">0</span>:</div><div class="line">    speed_right  = <span class="built_in">speed</span></div><div class="line">    speed_left = <span class="built_in">round</span>(<span class="built_in">speed</span> * (<span class="number">1</span> - turn / <span class="number">100</span>))</div><div class="line"><span class="keyword">else</span>:</div><div class="line">    speed_right  = <span class="built_in">round</span>(<span class="built_in">speed</span> * (<span class="number">1</span> + turn / <span class="number">100</span>))</div><div class="line">    speed_left = <span class="built_in">speed</span></div></pre></td></tr></table></figure></p>
<p>到整数值的舍入是低速下糟糕的精度的原因！但现在我们很高兴，操作 <code>opOutput_Step_Sync</code> 计算时不执行舍入：<br><figure class="highlight nix"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> turn &gt; <span class="number">0</span>:</div><div class="line">    <span class="attr">speed_right</span>  = speed</div><div class="line">    <span class="attr">speed_left</span> = speed * (<span class="number">1</span> - turn / <span class="number">100</span>)</div><div class="line"><span class="keyword">else</span>:</div><div class="line">    <span class="attr">speed_right</span>  = speed * (<span class="number">1</span> + turn / <span class="number">100</span>)</div><div class="line">    <span class="attr">speed_left</span> = speed</div></pre></td></tr></table></figure></p>
<p>速度和步数是成比例的，我们也可以写为：<br><figure class="highlight sqf"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> turn &gt; <span class="number">0</span>:</div><div class="line">    step_right  = math.copysign(<span class="number">1</span>, <span class="built_in">speed</span>) * <span class="built_in">step</span></div><div class="line">    step_left = math.copysign(<span class="number">1</span>, <span class="built_in">speed</span>) * <span class="built_in">step</span> * (<span class="number">1</span> - turn / <span class="number">100</span>)</div><div class="line"><span class="keyword">else</span>:</div><div class="line">    step_right  = math.copysign(<span class="number">1</span>, <span class="built_in">speed</span>) * <span class="built_in">step</span> * (<span class="number">1</span> + turn / <span class="number">100</span>)</div><div class="line">    step_left = math.copysign(<span class="number">1</span>, <span class="built_in">speed</span>) * <span class="built_in">step</span></div></pre></td></tr></table></figure></p>
<p>操作 <code>opOutput_Step_Sync</code> 对于具有两个驱动轮的小车是完美的！就像是专门为它设计的一样。请通过把两个 <code>opOutput_Speed</code> 操作替换为一个 <code>opOutput_Step_Sync</code> 来提升你的远程控制程序。你将看到，它工作的更好，特别是低速下。我把我的 <code>move</code> 函数的代码修改为了：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">move</span><span class="params">(self, speed: int, turn: int)</span> -&gt; <span class="keyword">None</span>:</span></div><div class="line">    <span class="keyword">assert</span> self._sync_mode != ev3.SYNC, <span class="string">'no unlimited operations allowed in sync_mode SYNC'</span></div><div class="line">    <span class="keyword">assert</span> isinstance(speed, int), <span class="string">"speed needs to be an integer value"</span></div><div class="line">    <span class="keyword">assert</span> <span class="number">-100</span> &lt;= speed <span class="keyword">and</span> speed &lt;= <span class="number">100</span>, <span class="string">"speed needs to be in range [-100 - 100]"</span></div><div class="line">    <span class="keyword">assert</span> isinstance(turn, int), <span class="string">"turn needs to be an integer value"</span></div><div class="line">    <span class="keyword">assert</span> <span class="number">-200</span> &lt;= turn <span class="keyword">and</span> turn &lt;= <span class="number">200</span>, <span class="string">"turn needs to be in range [-200 - 200]"</span></div><div class="line">    <span class="keyword">if</span> self._polarity == <span class="number">-1</span>:</div><div class="line">        speed *= <span class="number">-1</span></div><div class="line">    <span class="keyword">if</span> self._port_left &lt; self._port_right:</div><div class="line">        turn *= <span class="number">-1</span></div><div class="line">    ops = <span class="string">b''</span>.join([</div><div class="line">        ev3.opOutput_Step_Sync,</div><div class="line">        ev3.LCX(<span class="number">0</span>),                                  <span class="comment"># LAYER</span></div><div class="line">        ev3.LCX(self._port_left + self._port_right), <span class="comment"># NOS</span></div><div class="line">        ev3.LCX(speed),</div><div class="line">        ev3.LCX(turn),</div><div class="line">        ev3.LCX(<span class="number">0</span>),                                  <span class="comment"># STEPS</span></div><div class="line">        ev3.LCX(<span class="number">0</span>),                                  <span class="comment"># BRAKE</span></div><div class="line">        ev3.opOutput_Start,</div><div class="line">        ev3.LCX(<span class="number">0</span>),                                  <span class="comment"># LAYER</span></div><div class="line">        ev3.LCX(self._port_left + self._port_right)  <span class="comment"># NOS</span></div><div class="line">    ])</div><div class="line">    self.send_direct_cmd(ops)</div></pre></td></tr></table></figure></p>
<p>一些说明：</p>
<ul>
<li>车辆遵从相同的转弯，与速度无关。这是 <code>opOutput_Step_Sync</code> 相对于使用两个 <code>opOutput_Speed</code> 操作的主要提升。</li>
<li>如果你使用了 <code>opOutput_Polarity</code>，你将发现 ，你无法把它和 <code>opOutput_Step_Sync</code> 结合。你不得不手动完成。修改两个电机的极性很简单，只是反转参数 SPEED 即可。</li>
<li>如果你交换了电机的连接，以使你的左边电机连接在较低端口上，它也很简单，反转 TURN。</li>
<li>仅更改一个电机的极性非常棘手。</li>
</ul>
<p>下表可能有助于理清你已经看到的移动。当给出以下条件时，它描述了依赖于 TURN 的运动类型：</p>
<ul>
<li>两个电机具有相同的极性，</li>
<li>右轮连接到更低的端口，左边的更高。</li>
</ul>
<table>
<thead>
<tr>
<th>TURN</th>
<th>移动</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>直行</td>
<td>两个电机以相同的速度朝相同的方向移动</td>
</tr>
<tr>
<td>[0 - 100]</td>
<td>左转</td>
<td>两个电机朝相同的方向旋转，左边的以更低的速度</td>
</tr>
<tr>
<td>100</td>
<td>绕左轮左转</td>
<td>只有右边的电机移动</td>
</tr>
<tr>
<td>[100 - 200]</td>
<td>向左转弯</td>
<td>两个电机朝相反的方向旋转，左边的以更低的速度旋转</td>
</tr>
<tr>
<td>200</td>
<td>向左转圈</td>
<td>两个电机朝相同的方向旋转，但速度相同</td>
</tr>
<tr>
<td>[0 - -100]</td>
<td>右转</td>
<td>两个电机朝相同的方向旋转，右边的以更低的速度</td>
</tr>
<tr>
<td>-100</td>
<td>绕右轮右转</td>
<td>只有左边的电机移动</td>
</tr>
<tr>
<td>[-100 - -200]</td>
<td>向右转弯</td>
<td>两个电机朝相反的方向旋转，右边的以更低的速度旋转</td>
</tr>
<tr>
<td>-200</td>
<td>向右转圈</td>
<td>两个电机朝相同的方向旋转，但速度相同</td>
</tr>
</tbody>
</table>
<p>当端口连接不同时，左轮为较低端口，右轮为较高端口时，请反映情况。</p>
<p>欢迎你进一步提升远程控制工程。你可以使用游戏杆而不是你的键盘的方向键。或者你可以使用智能手机的陀螺仪传感器。但这是你的项目，我们将远程控制留在了后面（至少目前为止）。</p>
<h1 id="具有两个驱动轮的车辆的定义明确且可预测的运动"><a href="#具有两个驱动轮的车辆的定义明确且可预测的运动" class="headerlink" title="具有两个驱动轮的车辆的定义明确且可预测的运动"></a>具有两个驱动轮的车辆的定义明确且可预测的运动</h1><p>我们仍然专注于具有两个驱动轮的车辆及其运动的准确性。远程控制是一种非常特殊的情况，如果需要，人类的头脑会监督车辆的运动并立即进行一些修正。这种情况不需要像转弯半径那样的单位。这就像驾驶汽车一样，没有必要确切知道转弯半径是如何从方向盘的位置决定的。修正是相对和直观的。机器人在没有外部控制的情况下移动，它们的算法需要知道参数的确切依赖性。我们将编写控制车辆运动的程序。我们从最难的变体开始，不存在任何校正机制。这意味着，我们需要能够预测和精确描述车辆运动的函数。我想到以下几点：</p>
<ul>
<li><p>drive_straight(speed:int, distance: float=None)，其中</p>
<ul>
<li>speed 的符号描述了方向（向前或向后）</li>
<li>speed 的绝对值描述了速度。我们更喜欢每秒 SI 单位计，但它是百分比。</li>
<li>distance 为 None 或正的，它以 SI 单位 meter 给出。如果它是 None，则运动是无限的。</li>
</ul>
</li>
<li><p>drive_turn(speed:int, radius_turn:float, angle:float=None, right_turn:bool=False)，其中</p>
<ul>
<li>speed 的符号描述了方向（向前或向后）</li>
<li>speed 的绝对值描述了速度。</li>
<li>radius_turn 是转弯的半径，单位为 <code>meter</code>。我们取两个驱动轮的中间作为我们的参考点。</li>
<li><code>radius_turn</code> 的符号描述了转弯的方向。正值表示左转，正转向，负值代表顺时针转动。</li>
<li><code>angle</code> 为 None 或正的，它是以度为单位的圆弧段 (90° 为四分之一圆，720° 为两个完整的圆)。如果它是 None，则表示无限移动。</li>
<li><code>right_turn</code> 是一个用于特殊情景的标记。如果我们打开 place，属性<code>radius_turn</code> 为零并且没有符号。在这种情况下，左转是默认值，属性<code>right_turn</code> 是相反方向的标志。</li>
</ul>
</li>
</ul>
<p>正如你可能想象的那样，我们并没有走太远。我们将使用操作 <code>opOutput_Ready</code>，<code>opOutput_Start</code> 和 <code>opOutput_Speed_Sync</code>。这是说我们将不使用中断。从这个角度来看，我们可以回到第二课的知识。</p>
<h2 id="确定车辆的尺寸"><a href="#确定车辆的尺寸" class="headerlink" title="确定车辆的尺寸"></a>确定车辆的尺寸</h2><p>们需要车辆的某些尺寸来将上述功能的 SI 单位转换为参数 <code>turn</code> 和操作<code>opOutput_Speed_Sync</code> 的步骤。 车辆的尺寸为：</p>
<ul>
<li>驱动轮的半径：<code>radius_wheel</code>。</li>
<li>车辆 <code>tread</code>。</li>
</ul>
<p>使用尺子量出（对于我的车辆）：</p>
<ul>
<li>radius_wheel = 0.021 m</li>
<li>tread = 0.16 m</li>
</ul>
<p>具有更高精度的替代方案是测量车辆的运动。要获得驱动轮的半径，可以使用以下直接命令：<br><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">----------------------------------------------------------                   </div><div class="line"> <span class="symbol">\ </span>len <span class="symbol">\ </span>cnt <span class="symbol">\t</span>y<span class="symbol">\ </span>hd  <span class="symbol">\o</span>p<span class="symbol">\l</span>a<span class="symbol">\n</span>o<span class="symbol">\s</span>p<span class="symbol">\t</span>u<span class="symbol">\ </span>step   <span class="symbol">\b</span>r<span class="symbol">\o</span>p<span class="symbol">\l</span>a<span class="symbol">\n</span>o<span class="symbol">\ </span>                 </div><div class="line">  ----------------------------------------------------------                 </div><div class="line">0x|11:00|2A:00|80|00:00|B0|00|09|14|00|82:10:0E|01|A6|00|09|                 </div><div class="line">  ----------------------------------------------------------                 </div><div class="line">   <span class="symbol">\ </span>17  <span class="symbol">\ </span>42  <span class="symbol">\n</span>o<span class="symbol">\ </span>0,0 <span class="symbol">\O</span> <span class="symbol">\0</span> <span class="symbol">\A</span> <span class="symbol">\2</span>0<span class="symbol">\0</span> <span class="symbol">\ </span>3600   <span class="symbol">\1</span> <span class="symbol">\O</span> <span class="symbol">\0</span> <span class="symbol">\A</span> <span class="symbol">\ </span>                </div><div class="line">    <span class="symbol">\ </span>    <span class="symbol">\ </span>    <span class="symbol">\ </span> <span class="symbol">\ </span>    <span class="symbol">\u</span> <span class="symbol">\ </span> <span class="symbol">\+</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>       <span class="symbol">\ </span> <span class="symbol">\u</span> <span class="symbol">\ </span> <span class="symbol">\+</span> <span class="symbol">\ </span>               </div><div class="line">     <span class="symbol">\ </span>    <span class="symbol">\ </span>    <span class="symbol">\ </span> <span class="symbol">\ </span>    <span class="symbol">\t</span> <span class="symbol">\ </span> <span class="symbol">\D</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>       <span class="symbol">\ </span> <span class="symbol">\t</span> <span class="symbol">\ </span> <span class="symbol">\D</span> <span class="symbol">\ </span>              </div><div class="line">      <span class="symbol">\ </span>    <span class="symbol">\ </span>    <span class="symbol">\ </span> <span class="symbol">\ </span>    <span class="symbol">\p</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>       <span class="symbol">\ </span> <span class="symbol">\p</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>             </div><div class="line">       <span class="symbol">\ </span>    <span class="symbol">\ </span>    <span class="symbol">\ </span> <span class="symbol">\ </span>    <span class="symbol">\u</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>       <span class="symbol">\ </span> <span class="symbol">\u</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>            </div><div class="line">        <span class="symbol">\ </span>    <span class="symbol">\ </span>    <span class="symbol">\ </span> <span class="symbol">\ </span>    <span class="symbol">\t</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>       <span class="symbol">\ </span> <span class="symbol">\t</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>           </div><div class="line">         <span class="symbol">\ </span>    <span class="symbol">\ </span>    <span class="symbol">\ </span> <span class="symbol">\ </span>    <span class="symbol">\_</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>       <span class="symbol">\ </span> <span class="symbol">\_</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>          </div><div class="line">          <span class="symbol">\ </span>    <span class="symbol">\ </span>    <span class="symbol">\ </span> <span class="symbol">\ </span>    <span class="symbol">\S</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>       <span class="symbol">\ </span> <span class="symbol">\S</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>         </div><div class="line">           <span class="symbol">\ </span>    <span class="symbol">\ </span>    <span class="symbol">\ </span> <span class="symbol">\ </span>    <span class="symbol">\t</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>       <span class="symbol">\ </span> <span class="symbol">\t</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>        </div><div class="line">            <span class="symbol">\ </span>    <span class="symbol">\ </span>    <span class="symbol">\ </span> <span class="symbol">\ </span>    <span class="symbol">\e</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>       <span class="symbol">\ </span> <span class="symbol">\a</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>       </div><div class="line">             <span class="symbol">\ </span>    <span class="symbol">\ </span>    <span class="symbol">\ </span> <span class="symbol">\ </span>    <span class="symbol">\p</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>       <span class="symbol">\ </span> <span class="symbol">\r</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>      </div><div class="line">              <span class="symbol">\ </span>    <span class="symbol">\ </span>    <span class="symbol">\ </span> <span class="symbol">\ </span>    <span class="symbol">\_</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>       <span class="symbol">\ </span> <span class="symbol">\t</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>     </div><div class="line">               <span class="symbol">\ </span>    <span class="symbol">\ </span>    <span class="symbol">\ </span> <span class="symbol">\ </span>    <span class="symbol">\S</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>       <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>    </div><div class="line">                <span class="symbol">\ </span>    <span class="symbol">\ </span>    <span class="symbol">\ </span> <span class="symbol">\ </span>    <span class="symbol">\y</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>       <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>   </div><div class="line">                 <span class="symbol">\ </span>    <span class="symbol">\ </span>    <span class="symbol">\ </span> <span class="symbol">\ </span>    <span class="symbol">\n</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>       <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>  </div><div class="line">                  <span class="symbol">\ </span>    <span class="symbol">\ </span>    <span class="symbol">\ </span> <span class="symbol">\ </span>    <span class="symbol">\c</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>       <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> </div><div class="line">                   ----------------------------------------------------------</div></pre></td></tr></table></figure></p>
<p>拿出尺子并测量你的小车移动的距离（如果你的小车没有直行，寻找轮子的最佳结合，而不是外观，这似乎是相同的尺寸，真的是）。轮子的一个完整旋转的距离计算公式为 2 <em> pi </em> radius_wheel。3,600 度为 10 个完整旋转，因此下面的计算给出了你的轮子的 <code>radius_wheel</code>：<br><figure class="highlight ini"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attr">radius_wheel</span> = distance / (<span class="number">20</span> * pi)</div></pre></td></tr></table></figure></p>
<p>这将我的轮子的半径修正为 radius_wheel = 0.02128 m。接下来，我们让车辆旋转，并计数 N，车辆转数。为此，我们发送直接命令：<br><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">----------------------------------------------------------------                   </div><div class="line"> <span class="symbol">\ </span>len <span class="symbol">\ </span>cnt <span class="symbol">\t</span>y<span class="symbol">\ </span>hd  <span class="symbol">\o</span>p<span class="symbol">\l</span>a<span class="symbol">\n</span>o<span class="symbol">\s</span>p<span class="symbol">\ </span>tu     <span class="symbol">\ </span>step   <span class="symbol">\b</span>r<span class="symbol">\o</span>p<span class="symbol">\l</span>a<span class="symbol">\n</span>o<span class="symbol">\ </span>                 </div><div class="line">  ----------------------------------------------------------------                 </div><div class="line">0x|13:00|2A:00|80|00:00|B0|00|09|14|82:C8:00|82:50:46|01|A6|00|09|                 </div><div class="line">  ----------------------------------------------------------------                 </div><div class="line">   <span class="symbol">\ </span>19  <span class="symbol">\ </span>42  <span class="symbol">\n</span>o<span class="symbol">\ </span>0,0 <span class="symbol">\O</span> <span class="symbol">\0</span> <span class="symbol">\A</span> <span class="symbol">\2</span>0<span class="symbol">\ </span>200    <span class="symbol">\ </span>18000  <span class="symbol">\1</span> <span class="symbol">\O</span> <span class="symbol">\0</span> <span class="symbol">\A</span> <span class="symbol">\ </span>                </div><div class="line">    <span class="symbol">\ </span>    <span class="symbol">\ </span>    <span class="symbol">\ </span> <span class="symbol">\ </span>    <span class="symbol">\u</span> <span class="symbol">\ </span> <span class="symbol">\+</span> <span class="symbol">\ </span> <span class="symbol">\ </span>       <span class="symbol">\ </span>       <span class="symbol">\ </span> <span class="symbol">\u</span> <span class="symbol">\ </span> <span class="symbol">\+</span> <span class="symbol">\ </span>               </div><div class="line">     <span class="symbol">\ </span>    <span class="symbol">\ </span>    <span class="symbol">\ </span> <span class="symbol">\ </span>    <span class="symbol">\t</span> <span class="symbol">\ </span> <span class="symbol">\D</span> <span class="symbol">\ </span> <span class="symbol">\ </span>       <span class="symbol">\ </span>       <span class="symbol">\ </span> <span class="symbol">\t</span> <span class="symbol">\ </span> <span class="symbol">\D</span> <span class="symbol">\ </span>              </div><div class="line">      <span class="symbol">\ </span>    <span class="symbol">\ </span>    <span class="symbol">\ </span> <span class="symbol">\ </span>    <span class="symbol">\p</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>       <span class="symbol">\ </span>       <span class="symbol">\ </span> <span class="symbol">\p</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>             </div><div class="line">       <span class="symbol">\ </span>    <span class="symbol">\ </span>    <span class="symbol">\ </span> <span class="symbol">\ </span>    <span class="symbol">\u</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>       <span class="symbol">\ </span>       <span class="symbol">\ </span> <span class="symbol">\u</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>            </div><div class="line">        <span class="symbol">\ </span>    <span class="symbol">\ </span>    <span class="symbol">\ </span> <span class="symbol">\ </span>    <span class="symbol">\t</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>       <span class="symbol">\ </span>       <span class="symbol">\ </span> <span class="symbol">\t</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>           </div><div class="line">         <span class="symbol">\ </span>    <span class="symbol">\ </span>    <span class="symbol">\ </span> <span class="symbol">\ </span>    <span class="symbol">\_</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>       <span class="symbol">\ </span>       <span class="symbol">\ </span> <span class="symbol">\_</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>          </div><div class="line">          <span class="symbol">\ </span>    <span class="symbol">\ </span>    <span class="symbol">\ </span> <span class="symbol">\ </span>    <span class="symbol">\S</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>       <span class="symbol">\ </span>       <span class="symbol">\ </span> <span class="symbol">\S</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>         </div><div class="line">           <span class="symbol">\ </span>    <span class="symbol">\ </span>    <span class="symbol">\ </span> <span class="symbol">\ </span>    <span class="symbol">\t</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>       <span class="symbol">\ </span>       <span class="symbol">\ </span> <span class="symbol">\t</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>        </div><div class="line">            <span class="symbol">\ </span>    <span class="symbol">\ </span>    <span class="symbol">\ </span> <span class="symbol">\ </span>    <span class="symbol">\e</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>       <span class="symbol">\ </span>       <span class="symbol">\ </span> <span class="symbol">\a</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>       </div><div class="line">             <span class="symbol">\ </span>    <span class="symbol">\ </span>    <span class="symbol">\ </span> <span class="symbol">\ </span>    <span class="symbol">\p</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>       <span class="symbol">\ </span>       <span class="symbol">\ </span> <span class="symbol">\r</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>      </div><div class="line">              <span class="symbol">\ </span>    <span class="symbol">\ </span>    <span class="symbol">\ </span> <span class="symbol">\ </span>    <span class="symbol">\_</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>       <span class="symbol">\ </span>       <span class="symbol">\ </span> <span class="symbol">\t</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>     </div><div class="line">               <span class="symbol">\ </span>    <span class="symbol">\ </span>    <span class="symbol">\ </span> <span class="symbol">\ </span>    <span class="symbol">\S</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>       <span class="symbol">\ </span>       <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>    </div><div class="line">                <span class="symbol">\ </span>    <span class="symbol">\ </span>    <span class="symbol">\ </span> <span class="symbol">\ </span>    <span class="symbol">\y</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>       <span class="symbol">\ </span>       <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>   </div><div class="line">                 <span class="symbol">\ </span>    <span class="symbol">\ </span>    <span class="symbol">\ </span> <span class="symbol">\ </span>    <span class="symbol">\n</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>       <span class="symbol">\ </span>       <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>  </div><div class="line">                  <span class="symbol">\ </span>    <span class="symbol">\ </span>    <span class="symbol">\ </span> <span class="symbol">\ </span>    <span class="symbol">\c</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>       <span class="symbol">\ </span>       <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> </div><div class="line">                   ----------------------------------------------------------------</div></pre></td></tr></table></figure></p>
<p>我计算了我的车辆 N = 15.2 完整旋转。两个轮子都旋转了 18, 000°，这是50 个完整的旋转，或者距离 50 <em> 2 </em> pi <em> <code>radius_wheel</code>。旋转的半径为 0.5 </em> tread（我们定义轮子的中间为我们的参考点）。这就是说 N <em> 2 </em> pi <em> 0.5 </em> tread = 50 <em> 2 </em> pi * radius_wheel 或者：<br><figure class="highlight ini"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attr">tread</span> = radius_wheel * <span class="number">100</span> / N</div></pre></td></tr></table></figure></p>
<p>这修正了 <code>tread</code> 的尺寸（在我的情况中：tread = 0.1346 m）。稍后我们将执行一些额外的运动，也许这将再次修正 <code>tread</code> 的尺寸。</p>
<h2 id="获取参数-STEP-和-TURN-的数学转换"><a href="#获取参数-STEP-和-TURN-的数学转换" class="headerlink" title="获取参数 STEP 和 TURN 的数学转换"></a>获取参数 STEP 和 TURN 的数学转换</h2><p>OK，我们知道了车的尺寸。接下来我们需要把我们的方法 <code>drive_straight</code> 和 <code>drive_turn</code> 的参数转为操作 <code>opOutput_Step_Sync</code> 的参数 STEP 和 TURN。这需要一些数学的东西。如果你对细节不感兴趣，你可以只看本小节最后的结果。但是大多数人都想知道细节，细节在这里。</p>
<p>给定我们的小车需要旋转的 <code>angle</code> 和 <code>radius_turn</code>。在转弯中，两个轮子移动不同的距离。外面的轮子的距离为：2 <em> pi </em> radius_wheel <em> STEP / 360。可以根据转弯的几何形状和车辆踏板的知识计算相同的距离：2 </em> pi <em> (radius_turn + 0.5 </em> tread) * angle / 360。这两个相同距离的描述给出了以下等式：<br><figure class="highlight ini"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attr">STEP</span> = angle * (radius_turn + <span class="number">0.5</span> * tread) / radius_wheel</div></pre></td></tr></table></figure></p>
<p>OK，第一个参数计算出来了，但是我们仍然需要计算 TURN。关键的方法来自转弯的几何学，是说，两个车轮之间的速度比 speed_right / speed_left 与外面和里面的车轮的距离比相同：<br><figure class="highlight lisp"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">speed_right / speed_left = (<span class="name">radius_turn</span> + <span class="number">0.5</span> * tread) / (radius_turn - 0.5 * tread)</div></pre></td></tr></table></figure></p>
<p>你可能还记得，我们已经知道了两个轮子的速度：speed_right = SPEED 和 speed_left = SPEED * (1 - TURN / 100)。这给出等式：<br><figure class="highlight basic"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="symbol">1 </span>/ (<span class="number">1</span> - TURN / <span class="number">100</span>) = (radius_turn + <span class="number">0.5</span> * tread) / (radius_turn - <span class="number">0.5</span> * tread)</div></pre></td></tr></table></figure></p>
<p>转换这个等式得到：<br><figure class="highlight lisp"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">TURN  = <span class="number">100</span> * (<span class="number">1</span> - (<span class="name">radius_turn</span> - <span class="number">0.5</span> * tread) / (radius_turn + 0.5 * tread))</div></pre></td></tr></table></figure></p>
<p>就是这样，果给出转弯运动的尺寸 (angle, radius_turn) 和车辆的尺寸 (tread, radius_wheel)：</p>
<ol>
<li><p>变量 STEP 的计算方法为：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attr">STEP</span> = angle * (radius_turn + <span class="number">0.5</span> * tread) / radius_wheel</div></pre></td></tr></table></figure>
</li>
<li><p>变量 TURN 的计算方法为：</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">TURN = <span class="number">100</span> * (<span class="number">1</span> - (<span class="name">radius_turn</span> - <span class="number">0.5</span> * tread) / (radius_turn + 0.5 * tread))</div></pre></td></tr></table></figure>
</li>
</ol>
<p>在 Python 中，这可以写作：<br><figure class="highlight monkey"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">rad_outer = radius_turn + <span class="number">0.5</span> * <span class="built_in">self</span>._tread</div><div class="line">rad_inner = radius_turn - <span class="number">0.5</span> * <span class="built_in">self</span>._tread</div><div class="line"><span class="keyword">step</span> = round(angle*rad_outer / <span class="built_in">self</span>._radius_wheel)</div><div class="line">turn = round(<span class="number">100</span>*(<span class="number">1</span> - rad_inner / rad_outer))</div><div class="line"><span class="keyword">if</span> angle &lt; <span class="number">0</span>:</div><div class="line">    <span class="keyword">step</span> *= -<span class="number">1</span></div><div class="line">    turn *= -<span class="number">1</span></div><div class="line"><span class="keyword">if</span> <span class="built_in">self</span>._polarity == -<span class="number">1</span>:</div><div class="line">    speed *= -<span class="number">1</span></div></pre></td></tr></table></figure></p>
<h2 id="数学转换的控制"><a href="#数学转换的控制" class="headerlink" title="数学转换的控制"></a>数学转换的控制</h2><p>我们做一些合理性检查：</p>
<ul>
<li>以半径 radius_turn = 0.5 * tread 旋转得到 TURN = 100 或 TURN = -100，这是对的。</li>
<li>以半径 radius_turn = 0 旋转得到 TURN = 200 或 TURN = -200，这也是OK 的。</li>
</ul>
<p>现在，我们回到真正的测试。以 angle = 90° 和 radius_turn = 0.5 m 旋转。在我的情况中，由上面的计算给出 STEP = 2358 和 TURN = 23，这将得到命令：<br><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">----------------------------------------------------------                   </div><div class="line"> <span class="symbol">\ </span>len <span class="symbol">\ </span>cnt <span class="symbol">\t</span>y<span class="symbol">\ </span>hd  <span class="symbol">\o</span>p<span class="symbol">\l</span>a<span class="symbol">\n</span>o<span class="symbol">\s</span>p<span class="symbol">\t</span>u<span class="symbol">\ </span>step   <span class="symbol">\b</span>r<span class="symbol">\o</span>p<span class="symbol">\l</span>a<span class="symbol">\n</span>o<span class="symbol">\ </span>                 </div><div class="line">  ----------------------------------------------------------                 </div><div class="line">0x|11:00|2A:00|80|00:00|B0|00|09|14|17|82:36:09|01|A6|00|09|                 </div><div class="line">  ----------------------------------------------------------                 </div><div class="line">   <span class="symbol">\ </span>17  <span class="symbol">\ </span>42  <span class="symbol">\n</span>o<span class="symbol">\ </span>0,0 <span class="symbol">\O</span> <span class="symbol">\0</span> <span class="symbol">\A</span> <span class="symbol">\2</span>0<span class="symbol">\2</span>3<span class="symbol">\ </span>2358   <span class="symbol">\1</span> <span class="symbol">\O</span> <span class="symbol">\0</span> <span class="symbol">\A</span> <span class="symbol">\ </span>                </div><div class="line">    <span class="symbol">\ </span>    <span class="symbol">\ </span>    <span class="symbol">\ </span> <span class="symbol">\ </span>    <span class="symbol">\u</span> <span class="symbol">\ </span> <span class="symbol">\+</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>       <span class="symbol">\ </span> <span class="symbol">\u</span> <span class="symbol">\ </span> <span class="symbol">\+</span> <span class="symbol">\ </span>               </div><div class="line">     <span class="symbol">\ </span>    <span class="symbol">\ </span>    <span class="symbol">\ </span> <span class="symbol">\ </span>    <span class="symbol">\t</span> <span class="symbol">\ </span> <span class="symbol">\D</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>       <span class="symbol">\ </span> <span class="symbol">\t</span> <span class="symbol">\ </span> <span class="symbol">\D</span> <span class="symbol">\ </span>              </div><div class="line">      <span class="symbol">\ </span>    <span class="symbol">\ </span>    <span class="symbol">\ </span> <span class="symbol">\ </span>    <span class="symbol">\p</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>       <span class="symbol">\ </span> <span class="symbol">\p</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>             </div><div class="line">       <span class="symbol">\ </span>    <span class="symbol">\ </span>    <span class="symbol">\ </span> <span class="symbol">\ </span>    <span class="symbol">\u</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>       <span class="symbol">\ </span> <span class="symbol">\u</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>            </div><div class="line">        <span class="symbol">\ </span>    <span class="symbol">\ </span>    <span class="symbol">\ </span> <span class="symbol">\ </span>    <span class="symbol">\t</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>       <span class="symbol">\ </span> <span class="symbol">\t</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>           </div><div class="line">         <span class="symbol">\ </span>    <span class="symbol">\ </span>    <span class="symbol">\ </span> <span class="symbol">\ </span>    <span class="symbol">\_</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>       <span class="symbol">\ </span> <span class="symbol">\_</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>          </div><div class="line">          <span class="symbol">\ </span>    <span class="symbol">\ </span>    <span class="symbol">\ </span> <span class="symbol">\ </span>    <span class="symbol">\S</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>       <span class="symbol">\ </span> <span class="symbol">\S</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>         </div><div class="line">           <span class="symbol">\ </span>    <span class="symbol">\ </span>    <span class="symbol">\ </span> <span class="symbol">\ </span>    <span class="symbol">\t</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>       <span class="symbol">\ </span> <span class="symbol">\t</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>        </div><div class="line">            <span class="symbol">\ </span>    <span class="symbol">\ </span>    <span class="symbol">\ </span> <span class="symbol">\ </span>    <span class="symbol">\e</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>       <span class="symbol">\ </span> <span class="symbol">\a</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>       </div><div class="line">             <span class="symbol">\ </span>    <span class="symbol">\ </span>    <span class="symbol">\ </span> <span class="symbol">\ </span>    <span class="symbol">\p</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>       <span class="symbol">\ </span> <span class="symbol">\r</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>      </div><div class="line">              <span class="symbol">\ </span>    <span class="symbol">\ </span>    <span class="symbol">\ </span> <span class="symbol">\ </span>    <span class="symbol">\_</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>       <span class="symbol">\ </span> <span class="symbol">\t</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>     </div><div class="line">               <span class="symbol">\ </span>    <span class="symbol">\ </span>    <span class="symbol">\ </span> <span class="symbol">\ </span>    <span class="symbol">\S</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>       <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>    </div><div class="line">                <span class="symbol">\ </span>    <span class="symbol">\ </span>    <span class="symbol">\ </span> <span class="symbol">\ </span>    <span class="symbol">\y</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>       <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>   </div><div class="line">                 <span class="symbol">\ </span>    <span class="symbol">\ </span>    <span class="symbol">\ </span> <span class="symbol">\ </span>    <span class="symbol">\n</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>       <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>  </div><div class="line">                  <span class="symbol">\ </span>    <span class="symbol">\ </span>    <span class="symbol">\ </span> <span class="symbol">\ </span>    <span class="symbol">\c</span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span>       <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> <span class="symbol">\ </span> </div><div class="line">                   ----------------------------------------------------------</div></pre></td></tr></table></figure></p>
<p>确实，我的小车几乎以半径 0.5 m 移动了完美的四分之圆。</p>
<h1 id="增强类-TwoWheelVehicle"><a href="#增强类-TwoWheelVehicle" class="headerlink" title="增强类 TwoWheelVehicle"></a>增强类 TwoWheelVehicle</h1><p>数学已经足够了，至少在目前，让我们的编码吧！作为我们的第一个任务，我们修改类 <code>TwoWheelVehicle</code> 的构造函数。我们添加两个尺寸 <code>radius_wheel</code> 和 <code>tread</code>，它们被确定为必要的：<br><figure class="highlight rust"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">def __init__(</div><div class="line">        <span class="keyword">self</span>,</div><div class="line">        radius_wheel: <span class="keyword">float</span>,</div><div class="line">        tread: <span class="keyword">float</span>,</div><div class="line">        protocol: <span class="keyword">str</span>=<span class="literal">None</span>,</div><div class="line">        host: <span class="keyword">str</span>=<span class="literal">None</span>,</div><div class="line">        ev3_obj: ev3.EV3=<span class="literal">None</span></div><div class="line">):</div><div class="line">    <span class="keyword">super</span>().__init__(protocol=protocol, host=host, ev3_obj=ev3_obj)</div><div class="line">    <span class="keyword">self</span>._radius_wheel = radius_wheel</div><div class="line">    <span class="keyword">self</span>._tread = tread</div><div class="line">    <span class="keyword">self</span>._polarity = <span class="number">1</span></div><div class="line">    <span class="keyword">self</span>._port_left = ev3.PORT_D</div><div class="line">    <span class="keyword">self</span>._port_right = ev3.PORT_A</div></pre></td></tr></table></figure></p>
<p>接下来我们编写方法 <code>_drive</code>，它与方法 <code>move</code> 非常接近。调用者传入参数 <code>speed</code>，<code>turn</code> 和 <code>step</code> 调用它。外部的世界用 <code>radius_turn</code> 和 <code>angle</code> 来思考，但它们必须被转为内部的参数 <code>turn</code> 和 <code>step</code>。这是说，方法 <code>drive_straight</code> 和 <code>drive_turn</code> 执行转换，然后它们调用内部的方法 <code>_drive</code>：<br><figure class="highlight zephir"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">def _drive(<span class="keyword">self</span>, speed: <span class="keyword">int</span>, turn: <span class="keyword">int</span>, step: <span class="keyword">int</span>) -&gt; bytes:</div><div class="line">    assert isinstance(speed, <span class="keyword">int</span>), <span class="string">"speed needs to be an integer value"</span></div><div class="line">    assert <span class="number">-100</span> &lt;= speed <span class="keyword">and</span> speed &lt;= <span class="number">100</span>, <span class="string">"speed needs to be in range [-100 - 100]"</span></div><div class="line">    <span class="keyword">if</span> <span class="keyword">self</span>._polarity == <span class="number">-1</span>:</div><div class="line">        speed *= <span class="number">-1</span></div><div class="line">    <span class="keyword">if</span> <span class="keyword">self</span>._port_left &lt; <span class="keyword">self</span>._port_right:</div><div class="line">        turn *= <span class="number">-1</span></div><div class="line">    ops_ready = <span class="string">b''</span>.join([</div><div class="line">        ev3.opOutput_Ready,</div><div class="line">        ev3.LCX(<span class="number">0</span>),                                  <span class="comment"># LAYER</span></div><div class="line">        ev3.LCX(<span class="keyword">self</span>._port_left + <span class="keyword">self</span>._port_right)  <span class="comment"># NOS</span></div><div class="line">    ])</div><div class="line">    ops_start = <span class="string">b''</span>.join([</div><div class="line">        ev3.opOutput_Step_Sync,</div><div class="line">        ev3.LCX(<span class="number">0</span>),                                  <span class="comment"># LAYER</span></div><div class="line">        ev3.LCX(<span class="keyword">self</span>._port_left + <span class="keyword">self</span>._port_right), <span class="comment"># NOS</span></div><div class="line">        ev3.LCX(speed),</div><div class="line">        ev3.LCX(turn),</div><div class="line">        ev3.LCX(step),</div><div class="line">        ev3.LCX(<span class="number">0</span>),                                  <span class="comment"># BRAKE</span></div><div class="line">        ev3.opOutput_Start,</div><div class="line">        ev3.LCX(<span class="number">0</span>),                                  <span class="comment"># LAYER</span></div><div class="line">        ev3.LCX(<span class="keyword">self</span>._port_left + <span class="keyword">self</span>._port_right)  <span class="comment"># NOS</span></div><div class="line">    ])</div><div class="line">    <span class="keyword">if</span> <span class="keyword">self</span>._sync_mode == ev3.SYNC:</div><div class="line">        <span class="keyword">return</span> <span class="keyword">self</span>.send_direct_cmd(ops_start + ops_ready)</div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        <span class="keyword">return</span> <span class="keyword">self</span>.send_direct_cmd(ops_ready + ops_start)</div></pre></td></tr></table></figure></p>
<p>我们区分 SYNC 和 ASYNC 或 STD。在 ASYNC 或 STD 的情况中，我们在移动开始前等待，在 SYNC 的情况中直到它结束。如果你从 <a href="https://github.com/ChristophGaukel/ev3-python3" target="_blank" rel="external">ev3-python3</a> 下载了模块 <code>ev3_vehicle.py</code>，你将找不到方法 <code>_drive</code>。这是一个提示，我们将回到类 <code>TwoWheelVehicle</code> 实现中断。我们编写方法 <code>drive_turn</code> 的代码：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">drive_turn</span><span class="params">(</span></span></div><div class="line">        self,</div><div class="line">        speed: int,</div><div class="line">        radius_turn: float,</div><div class="line">        angle: float=None,</div><div class="line">        right_turn: bool=False</div><div class="line">) -&gt; <span class="keyword">None</span>:</div><div class="line">    <span class="keyword">assert</span> isinstance(radius_turn, numbers.Number), <span class="string">"radius_turn needs to be a number"</span></div><div class="line">    <span class="keyword">assert</span> angle <span class="keyword">is</span> <span class="keyword">None</span> <span class="keyword">or</span> isinstance(angle, numbers.Number), <span class="string">"angle needs to be a number"</span></div><div class="line">    <span class="keyword">assert</span> angle <span class="keyword">is</span> <span class="keyword">None</span> <span class="keyword">or</span> angle &gt; <span class="number">0</span>, <span class="string">"angle needs to be positive"</span></div><div class="line">    <span class="keyword">assert</span> isinstance(right_turn, bool), <span class="string">"right_turn needs to be a boolean"</span></div><div class="line">    rad_right = radius_turn + <span class="number">0.5</span> * self._tread</div><div class="line">    rad_left = radius_turn - <span class="number">0.5</span> * self._tread</div><div class="line">    <span class="keyword">if</span> radius_turn &gt;= <span class="number">0</span> <span class="keyword">and</span> <span class="keyword">not</span> right_turn:</div><div class="line">        turn = round(<span class="number">100</span>*(<span class="number">1</span> - rad_left / rad_right))</div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        turn = - round(<span class="number">100</span>*(<span class="number">1</span> - rad_right / rad_left))</div><div class="line">    <span class="keyword">if</span> turn == <span class="number">0</span>:</div><div class="line">        <span class="keyword">raise</span> ValueError(<span class="string">"radius_turn is too large"</span>)</div><div class="line">    <span class="keyword">if</span> angle <span class="keyword">is</span> <span class="keyword">None</span>:</div><div class="line">        self.move(speed, turn)</div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        <span class="keyword">if</span> turn &gt; <span class="number">0</span>:</div><div class="line">            step = round(angle*rad_right / self._radius_wheel)</div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            step = - round(angle*rad_left / self._radius_wheel)</div><div class="line">        self._drive(speed, turn, step)</div></pre></td></tr></table></figure></p>
<p>非常大的 <code>radius_turn</code> 值将导致一些问题。舍入到整数之后，它们导致直行。在这种情况下我们抛出一个错误。</p>
<p>方法 <code>drive_straight</code>：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">drive_straight</span><span class="params">(self, speed: int, distance: float=None)</span> -&gt; <span class="keyword">None</span>:</span></div><div class="line">    <span class="keyword">assert</span> distance <span class="keyword">is</span> <span class="keyword">None</span> <span class="keyword">or</span> isinstance(distance, numbers.Number), \</div><div class="line">        <span class="string">"distance needs to be a number"</span></div><div class="line">    <span class="keyword">assert</span> distance <span class="keyword">is</span> <span class="keyword">None</span> <span class="keyword">or</span> distance &gt; <span class="number">0</span>, \</div><div class="line">        <span class="string">"distance needs to be positive"</span></div><div class="line">    <span class="keyword">if</span> distance <span class="keyword">is</span> <span class="keyword">None</span>:</div><div class="line">        self.move(speed, <span class="number">0</span>)</div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        step = round(distance * <span class="number">360</span> / (<span class="number">2</span> * math.pi * self._radius_wheel))</div><div class="line">        self._drive(speed, <span class="number">0</span>, step)</div></pre></td></tr></table></figure></p>
<p>放松，我们已经实现了一种可以预测车辆的工具。 请做一些测试！</p>
<h2 id="了解车辆的位置和方向"><a href="#了解车辆的位置和方向" class="headerlink" title="了解车辆的位置和方向"></a>了解车辆的位置和方向</h2><p>抱歉，之前的一些内容我写了 <em>足够的数学知识</em>，但现在我来到了三角学。但我们处于一种真的值得努力的情境。想象一下，你驾驶你的车并经过了一系列的移动，你需要知道它的位置和方向。我们无需使用传感器就可以做到。相反，我们使用纯数学而不是魔法。</p>
<p>让我们做一些假设：</p>
<ul>
<li>当你创建类 TwoWheelVehicle 时你的车放置的位置将是你的坐标系统的原点 (0, 0)。</li>
<li>此时指向正前方的方向是 x 轴的方向。</li>
<li>y 轴指向你的车的左手边。</li>
<li>你的车的位置由 x 和 y 坐标描述。以米为单位。</li>
<li>你的车的 <code>orientation</code> 是车的原始方向和它的实际方向的差值。以度数为单位。左转增加 <code>orientation</code>，右转减小它。</li>
</ul>
<p>这次，我不会介绍数学。把它当作原样，或者把它作为一个谜语，你必须解决。但是请把如下的逻辑添加到你的类 <code>TwoWheelVehicle</code> 中：</p>
<ul>
<li><p>构造函数：</p>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">self._orientation </span>= <span class="number">0</span>.<span class="number">0</span></div><div class="line"><span class="keyword">self._pos_x </span>= <span class="number">0</span>.<span class="number">0</span></div><div class="line"><span class="keyword">self._pos_y </span>= <span class="number">0</span>.<span class="number">0</span></div></pre></td></tr></table></figure>
</li>
<li><p><code>drive_straight(speed, distance)</code></p>
<figure class="highlight monkey"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">diff_x = distance * math.<span class="built_in">cos</span>(math.radians(<span class="built_in">self</span>._orientation))</div><div class="line">diff_y = distance * math.<span class="built_in">sin</span>(math.radians(<span class="built_in">self</span>._orientation))</div><div class="line"><span class="keyword">if</span> speed &gt; <span class="number">0</span>:</div><div class="line">    <span class="built_in">self</span>._pos_x += diff_x</div><div class="line">    <span class="built_in">self</span>._pos_y += diff_y</div><div class="line"><span class="keyword">else</span>:</div><div class="line">    <span class="built_in">self</span>._pos_x -= diff_x</div><div class="line">    <span class="built_in">self</span>._pos_y -= diff_y</div></pre></td></tr></table></figure>
</li>
<li><p><code>drive_turn(speed, radius_turn, angle)</code></p>
<figure class="highlight monkey"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">angle += <span class="number">180</span></div><div class="line">angle %= <span class="number">360</span></div><div class="line">angle -= <span class="number">180</span></div><div class="line">fact = <span class="number">2.0</span> * radius_turn * math.<span class="built_in">sin</span>(math.radians(<span class="number">0.5</span> * angle))</div><div class="line"><span class="built_in">self</span>._orientation += <span class="number">0.5</span> * angle</div><div class="line"><span class="built_in">self</span>._pos_x += fact * math.<span class="built_in">cos</span>(math.radians(<span class="built_in">self</span>._orientation))</div><div class="line"><span class="built_in">self</span>._pos_y += fact * math.<span class="built_in">sin</span>(math.radians(<span class="built_in">self</span>._orientation))</div><div class="line"><span class="built_in">self</span>._orientation += <span class="number">0.5</span> * angle</div><div class="line"><span class="built_in">self</span>._orientation += <span class="number">180</span></div><div class="line"><span class="built_in">self</span>._orientation %= <span class="number">360</span></div><div class="line"><span class="built_in">self</span>._orientation -= <span class="number">180</span></div></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="完成类-TwoWheelVehicle"><a href="#完成类-TwoWheelVehicle" class="headerlink" title="完成类 TwoWheelVehicle"></a>完成类 TwoWheelVehicle</h1><p>我们通过添加更多的功能来完成类 <code>TwoWheelVehicle</code>：</p>
<ul>
<li><p>我们添加一个方法 <code>rotate_to(speed: int, o: float)</code>，它做如下的事情：</p>
<ul>
<li>计算实际的和新的方向的距离</li>
<li>以 <code>radius_turn</code> = 0 调用 <code>drive_turn</code> 旋转小车，以使其获得新方向。</li>
</ul>
</li>
<li><p>我们添加一个方法 <code>drive_to(self, speed: int, x: float, y: float)</code>，它做如下的事情：</p>
<ul>
<li>计算实际的位置和新位置的距离：<figure class="highlight ini"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="attr">diff_x</span> = pos_x - self._pos_x</div><div class="line"><span class="attr">diff_y</span> = pos_y - self._pos_y</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<p>我们需要坐标和绝对值：<br><figure class="highlight glsl"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">distance</span> = math.<span class="built_in">sqrt</span>(diff_x**<span class="number">2</span> + diff_y**<span class="number">2</span>)</div></pre></td></tr></table></figure></p>
<pre><code>- 计算新位置的方向。这很棘手，你需要彻底了解三角学，因为你必须使用 `atan`，`tan` 的反函数。我给你一个提示：
</code></pre><figure class="highlight glsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> <span class="built_in">abs</span>(diff_x) &gt; <span class="built_in">abs</span>(diff_y):</div><div class="line">    direction = math.<span class="built_in">degrees</span>(math.<span class="built_in">atan</span>(diff_y/diff_x))</div><div class="line"><span class="keyword">else</span>:</div><div class="line">    <span class="built_in">fract</span> = diff_x / diff_y</div><div class="line">    <span class="built_in">sign</span> = math.copysign(<span class="number">1.0</span>, <span class="built_in">fract</span>)</div><div class="line">    direction = <span class="built_in">sign</span> * <span class="number">90</span> - math.<span class="built_in">degrees</span>(math.<span class="built_in">atan</span>(<span class="built_in">fract</span>))</div><div class="line"><span class="keyword">if</span> diff_x &lt; <span class="number">0</span>:</div><div class="line">    direction += <span class="number">180</span></div><div class="line">direction %= <span class="number">360</span></div></pre></td></tr></table></figure>
<pre><code>- 调用 `rotate_to`，以使 `orientation` 指向 `direction`。
- 调用 `drive_straight` 移动小车到新的位置。
</code></pre><p>我们做一些测试：</p>
<ul>
<li>我们把小车发送到一些循环行程中，并编码一系列 <code>drive_to</code>，最终在 position = (0,0) 结束。我们最后添加一个以 orientation = 0 对 <code>rotate_to</code> 的调用。请评估，小车是否真的回到了它最初的位置和方向。</li>
<li>我们给循环行程添加一些 <code>drive_turn</code> 并评估，<code>drive_turn</code> 的错误是大于还是小于 <code>drive_to</code> 的。</li>
</ul>
<p>以大 <code>radius_turn</code> 旋转将有一个糟糕的精度。这也是舍入的结果。在这种情况中，将 TURN 舍入为整数值创造了错误。</p>
<p>如果你从 <a href="https://github.com/ChristophGaukel/ev3-python3" target="_blank" rel="external">ev3-python3</a> 下载了 <code>ev3_vehicle</code> 模块，当你调用它的方法 <code>drive_straight</code>，<code>drive_turn</code>，<code>rotate_to</code> 或 <code>drive_to</code> 时，你最后需要添加一个对 <code>stop</code> 的方法调用！</p>
<h1 id="异步和同步运动"><a href="#异步和同步运动" class="headerlink" title="异步和同步运动"></a>异步和同步运动</h1><p>让我们仔细看看我们的车辆驾驶情况。这是我的循环行程的程序：<br><figure class="highlight nix"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python3</span></div><div class="line"></div><div class="line"><span class="built_in">import</span> ev3, ev3_vehicle</div><div class="line"></div><div class="line"><span class="attr">my_vehicle</span> = ev3_vehicle.TwoWheelVehicle(<span class="number">0.02128</span>, <span class="number">0.1346</span>, <span class="attr">protocol=ev3.BLUETOOTH,</span> <span class="attr">host='00:16:53:42:2B:99')</span></div><div class="line">my_vehicle.<span class="attr">verbosity</span> = <span class="number">1</span></div><div class="line"><span class="attr">speed</span> = <span class="number">25</span></div><div class="line">my_vehicle.drive_straight(speed, <span class="number">0.05</span>)</div><div class="line">my_vehicle.drive_turn(speed, -<span class="number">0.07</span>, <span class="number">65</span>)</div><div class="line">my_vehicle.drive_straight(speed, <span class="number">0.35</span>)</div><div class="line">my_vehicle.drive_turn(speed, <span class="number">0.20</span>, <span class="number">140</span>)</div><div class="line">my_vehicle.drive_straight(speed, <span class="number">0.15</span>)</div><div class="line">my_vehicle.drive_turn(speed, -<span class="number">1.10</span>, <span class="number">55</span>)</div><div class="line">my_vehicle.drive_turn(speed, <span class="number">0.35</span>, <span class="number">160</span>)</div><div class="line">my_vehicle.drive_to(speed, <span class="number">0.0</span>, <span class="number">0.0</span>)</div><div class="line">my_vehicle.rotate_to(speed, <span class="number">0.0</span>)</div></pre></td></tr></table></figure></p>
<p>这个程序的输出：<br><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">15:42:05.989592 Sent 0x|<span class="string">14:00</span>|<span class="string">2A:00</span>|<span class="string">80</span>|<span class="string">00:00</span>|<span class="string">AA:00:09:B0:00:09:19:00:82:87:00:00:A6:00:09</span>|</div><div class="line">15:42:05.990443 Sent 0x|<span class="string">15:00</span>|<span class="string">2B:00</span>|<span class="string">80</span>|<span class="string">00:00</span>|<span class="string">AA:00:09:B0:00:09:19:81:9E:82:A3:01:00:A6:00:09</span>|</div><div class="line">15:42:05.990925 Sent 0x|<span class="string">14:00</span>|<span class="string">2C:00</span>|<span class="string">80</span>|<span class="string">00:00</span>|<span class="string">AA:00:09:B0:00:09:19:00:82:AE:03:00:A6:00:09</span>|</div><div class="line">15:42:05.991453 Sent 0x|<span class="string">15:00</span>|<span class="string">2D:00</span>|<span class="string">80</span>|<span class="string">00:00</span>|<span class="string">AA:00:09:B0:00:09:19:81:32:82:DF:06:00:A6:00:09</span>|</div><div class="line">15:42:05.991882 Sent 0x|<span class="string">14:00</span>|<span class="string">2E:00</span>|<span class="string">80</span>|<span class="string">00:00</span>|<span class="string">AA:00:09:B0:00:09:19:00:82:94:01:00:A6:00:09</span>|</div><div class="line">15:42:05.992330 Sent 0x|<span class="string">14:00</span>|<span class="string">2F:00</span>|<span class="string">80</span>|<span class="string">00:00</span>|<span class="string">AA:00:09:B0:00:09:19:34:82:C9:0B:00:A6:00:09</span>|</div><div class="line">15:42:05.992766 Sent 0x|<span class="string">15:00</span>|<span class="string">30:00</span>|<span class="string">80</span>|<span class="string">00:00</span>|<span class="string">AA:00:09:B0:00:09:19:81:20:82:42:0C:00:A6:00:09</span>|</div><div class="line">15:42:05.993306 Sent 0x|<span class="string">16:00</span>|<span class="string">31:00</span>|<span class="string">80</span>|<span class="string">00:00</span>|<span class="string">AA:00:09:B0:00:09:19:82:38:FF:82:D0:01:00:A6:00:09</span>|</div><div class="line">15:42:05.993714 Sent 0x|<span class="string">14:00</span>|<span class="string">32:00</span>|<span class="string">80</span>|<span class="string">00:00</span>|<span class="string">AA:00:09:B0:00:09:19:00:82:3F:03:00:A6:00:09</span>|</div><div class="line">15:42:05.994202 Sent 0x|<span class="string">15:00</span>|<span class="string">33:00</span>|<span class="string">80</span>|<span class="string">00:00</span>|<span class="string">AA:00:09:B0:00:09:19:82:38:FF:81:69:00:A6:00:09</span>|</div></pre></td></tr></table></figure></p>
<p>在五毫秒内这个程序给 EV3 设备发送了所有的直接命令，它们被放入队列并等待执行。这个代码很简单，但是会阻塞 EV3 设备直到开始执行最后的命令。请遵循代码并反映出属性 pos_x，pos_y 和 orientation 的值，以及它们是否与我们车辆的实际位置和方向相对应。</p>
<p>这是异步行为！ 程序和 EV3 设备在不同的时间尺度上运行。</p>
<p>现在我们改为同步模式并比较行为：<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">#!/usr/bin/env python3</div><div class="line"></div><div class="line">import ev3, ev3_vehicle</div><div class="line"></div><div class="line">my_vehicle = ev3_vehicle.TwoWheelVehicle(<span class="number">0.02128</span>, <span class="number">0.1346</span>, protocol=ev3<span class="selector-class">.BLUETOOTH</span>, host=<span class="string">'00:16:53:42:2B:99'</span>)</div><div class="line">my_vehicle<span class="selector-class">.verbosity</span> = <span class="number">1</span></div><div class="line">speed = <span class="number">25</span></div><div class="line">my_vehicle<span class="selector-class">.sync_mode</span> = ev3<span class="selector-class">.SYNC</span></div><div class="line">my_vehicle.drive_straight(speed, <span class="number">0.05</span>)</div><div class="line">my_vehicle.drive_turn(speed, -<span class="number">0.07</span>, <span class="number">65</span>)</div><div class="line">my_vehicle.drive_straight(speed, <span class="number">0.35</span>)</div><div class="line">my_vehicle.drive_turn(speed, <span class="number">0.20</span>, <span class="number">140</span>)</div><div class="line">my_vehicle.drive_straight(speed, <span class="number">0.15</span>)</div><div class="line">my_vehicle.drive_turn(speed, -<span class="number">1.10</span>, <span class="number">55</span>)</div><div class="line">my_vehicle.drive_turn(speed, <span class="number">0.35</span>, <span class="number">160</span>)</div><div class="line">my_vehicle.drive_to(speed, <span class="number">0.0</span>, <span class="number">0.0</span>)</div><div class="line">my_vehicle.rotate_to(speed, <span class="number">0.0</span>)</div></pre></td></tr></table></figure></p>
<p>此版本产生以下输出：<br><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">15:46:19.859532 Sent 0x|<span class="string">14:00</span>|<span class="string">2A:00</span>|<span class="string">00</span>|<span class="string">00:00</span>|<span class="string">B0:00:09:19:00:82:87:00:00:A6:00:09:AA:00:09</span>|</div><div class="line">15:46:20.307045 Recv 0x|<span class="string">03:00</span>|<span class="string">2A:00</span>|<span class="string">02</span>|</div><div class="line">15:46:20.307760 Sent 0x|<span class="string">15:00</span>|<span class="string">2B:00</span>|<span class="string">00</span>|<span class="string">00:00</span>|<span class="string">B0:00:09:19:81:9E:82:A3:01:00:A6:00:09:AA:00:09</span>|</div><div class="line">15:46:22.100007 Recv 0x|<span class="string">03:00</span>|<span class="string">2B:00</span>|<span class="string">02</span>|</div><div class="line">15:46:22.100612 Sent 0x|<span class="string">14:00</span>|<span class="string">2C:00</span>|<span class="string">00</span>|<span class="string">00:00</span>|<span class="string">B0:00:09:19:00:82:AE:03:00:A6:00:09:AA:00:09</span>|</div><div class="line">15:46:24.597018 Recv 0x|<span class="string">03:00</span>|<span class="string">2C:00</span>|<span class="string">02</span>|</div><div class="line">15:46:24.597646 Sent 0x|<span class="string">15:00</span>|<span class="string">2D:00</span>|<span class="string">00</span>|<span class="string">00:00</span>|<span class="string">B0:00:09:19:81:32:82:DF:06:00:A6:00:09:AA:00:09</span>|</div><div class="line">15:46:29.141999 Recv 0x|<span class="string">03:00</span>|<span class="string">2D:00</span>|<span class="string">02</span>|</div><div class="line">15:46:29.142609 Sent 0x|<span class="string">14:00</span>|<span class="string">2E:00</span>|<span class="string">00</span>|<span class="string">00:00</span>|<span class="string">B0:00:09:19:00:82:94:01:00:A6:00:09:AA:00:09</span>|</div><div class="line">15:46:30.221994 Recv 0x|<span class="string">03:00</span>|<span class="string">2E:00</span>|<span class="string">02</span>|</div><div class="line">15:46:30.222626 Sent 0x|<span class="string">14:00</span>|<span class="string">2F:00</span>|<span class="string">00</span>|<span class="string">00:00</span>|<span class="string">B0:00:09:19:34:82:C9:0B:00:A6:00:09:AA:00:09</span>|</div><div class="line">15:46:44.779922 Recv 0x|<span class="string">03:00</span>|<span class="string">2F:00</span>|<span class="string">02</span>|</div><div class="line">15:46:44.780364 Sent 0x|<span class="string">15:00</span>|<span class="string">30:00</span>|<span class="string">00</span>|<span class="string">00:00</span>|<span class="string">B0:00:09:19:81:20:82:42:0C:00:A6:00:09:AA:00:09</span>|</div><div class="line">15:46:46.938901 Recv 0x|<span class="string">03:00</span>|<span class="string">30:00</span>|<span class="string">02</span>|</div><div class="line">15:46:46.939701 Sent 0x|<span class="string">16:00</span>|<span class="string">31:00</span>|<span class="string">00</span>|<span class="string">00:00</span>|<span class="string">B0:00:09:19:82:38:FF:82:D0:01:00:A6:00:09:AA:00:09</span>|</div><div class="line">15:46:55.695901 Recv 0x|<span class="string">03:00</span>|<span class="string">31:00</span>|<span class="string">02</span>|</div><div class="line">15:46:55.696508 Sent 0x|<span class="string">14:00</span>|<span class="string">32:00</span>|<span class="string">00</span>|<span class="string">00:00</span>|<span class="string">B0:00:09:19:00:82:3F:03:00:A6:00:09:AA:00:09</span>|</div><div class="line">15:47:05.061856 Recv 0x|<span class="string">03:00</span>|<span class="string">32:00</span>|<span class="string">02</span>|</div><div class="line">15:47:05.062504 Sent 0x|<span class="string">15:00</span>|<span class="string">33:00</span>|<span class="string">00</span>|<span class="string">00:00</span>|<span class="string">B0:00:09:19:82:38:FF:81:69:00:A6:00:09:AA:00:09</span>|</div><div class="line">15:47:05.097692 Recv 0x|<span class="string">03:00</span>|<span class="string">33:00</span>|<span class="string">02</span>|</div></pre></td></tr></table></figure></p>
<p>车辆的运动是相同的，但现在程序发送一个直接命令并等待它完成，然后它发送下一个。sync_mode = SYNC 如它设计那样工作，它同步程序和EV3 设备的时间尺度。另一个好处是，它控制每个直接命令的成功并直接作出反应，如果出现意外情况。</p>
<p>这两个版本（异步和同步）都会阻塞 EV3 设备。</p>
<h1 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h1><p>类 <code>TwoWheelVehicle</code> 通过两个驱动轮控制小车的运动。如果我们知道课程的几何形状，我们就可以编写一个程序，通过它来驱动我们的车辆。</p>
<p>我们已经看到了同步和异步模式之间的区别。目前，我们更倾向于 SYNC。但我们的目标是一个解决方案，它可以同步驱动车辆并且不会阻塞EV3 设备。这将打开多任务的大门。</p>
<p>我的 <code>EV3TwoWheelVehicle</code> 类实际上有以下状态：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">Help</span> <span class="keyword">on</span> <span class="keyword">module</span> ev3_vehicle:</div><div class="line"></div><div class="line"><span class="keyword">NAME</span></div><div class="line">    ev3_vehicle - EV3 vehicle</div><div class="line"></div><div class="line">CLASSES</div><div class="line">    ev3.EV3(builtins.object)</div><div class="line">        TwoWheelVehicle</div><div class="line">    </div><div class="line">    <span class="keyword">class</span> TwoWheelVehicle(ev3.EV3)</div><div class="line">     |  ev3.EV3 vehicle <span class="keyword">with</span> two drived Wheels</div><div class="line">     |  </div><div class="line">     |  Method resolution <span class="keyword">order</span>:</div><div class="line">     |      TwoWheelVehicle</div><div class="line">     |      ev3.EV3</div><div class="line">     |      builtins.object</div><div class="line">     |  </div><div class="line">     |  Methods defined here:</div><div class="line">     |  </div><div class="line">     |  __init__(<span class="keyword">self</span>, radius_wheel:<span class="built_in">float</span>, tread:<span class="built_in">float</span>, protocol:<span class="keyword">str</span>=<span class="keyword">None</span>, host:<span class="keyword">str</span>=<span class="keyword">None</span>, ev3_obj:ev3.EV3=<span class="keyword">None</span>)</div><div class="line">     |      Establish a <span class="keyword">connection</span> <span class="keyword">to</span> a LEGO EV3 device</div><div class="line">     |      </div><div class="line">     |      Arguments:</div><div class="line">     |      radius_wheel: radius <span class="keyword">of</span> the wheels im meter</div><div class="line">     |      tread: the vehicles tread <span class="keyword">in</span> meter</div><div class="line">     |      </div><div class="line">     |      Keyword Arguments (either protocol <span class="keyword">and</span> host <span class="keyword">or</span> ev3_obj):</div><div class="line">     |      protocol</div><div class="line">     |        BLUETOOTH == <span class="string">'Bluetooth'</span></div><div class="line">     |        USB == <span class="string">'Usb'</span></div><div class="line">     |        WIFI == <span class="string">'Wifi'</span></div><div class="line">     |      host: mac-address <span class="keyword">of</span> the LEGO EV3 (f.i. <span class="string">'00:16:53:42:2B:99'</span>)</div><div class="line">     |      ev3_obj: an existing EV3 <span class="keyword">object</span> (its connections will be used)</div><div class="line">     |  </div><div class="line">     |  drive_straight(<span class="keyword">self</span>, speed:<span class="built_in">int</span>, distance:<span class="built_in">float</span>=<span class="keyword">None</span>) -&gt; <span class="keyword">None</span></div><div class="line">     |      Drive the vehicle straight forward <span class="keyword">or</span> backward.</div><div class="line">     |      </div><div class="line">     |      <span class="keyword">Attributes</span>:</div><div class="line">     |      speed: <span class="keyword">in</span> <span class="keyword">percent</span> [<span class="number">-100</span> - <span class="number">100</span>] (direction depends <span class="keyword">on</span> its <span class="keyword">sign</span>)</div><div class="line">     |          positive <span class="keyword">sign</span>: forwards</div><div class="line">     |          negative <span class="keyword">sign</span>: backwards</div><div class="line">     |      </div><div class="line">     |      Keyword <span class="keyword">Attributes</span>:</div><div class="line">     |      distance: <span class="keyword">in</span> meter, needs <span class="keyword">to</span> be positive</div><div class="line">     |                <span class="keyword">if</span> <span class="keyword">None</span>, <span class="keyword">unlimited</span> <span class="keyword">movement</span></div><div class="line">     |  </div><div class="line">     |  drive_to(<span class="keyword">self</span>, speed:<span class="built_in">int</span>, pos_x:<span class="built_in">float</span>, pos_y:<span class="built_in">float</span>) -&gt; <span class="keyword">None</span></div><div class="line">     |      Drive the vehicle <span class="keyword">to</span> the given position.</div><div class="line">     |      </div><div class="line">     |      <span class="keyword">Attributes</span>:</div><div class="line">     |      speed: <span class="keyword">in</span> <span class="keyword">percent</span> [<span class="number">-100</span> - <span class="number">100</span>] (direction depends <span class="keyword">on</span> its <span class="keyword">sign</span>)</div><div class="line">     |          positive <span class="keyword">sign</span>: forwards</div><div class="line">     |          negative <span class="keyword">sign</span>: backwards</div><div class="line">     |      x: x-coordinate <span class="keyword">of</span> target <span class="keyword">position</span></div><div class="line">     |      y: y-coordinate <span class="keyword">of</span> target <span class="keyword">position</span></div><div class="line">     |  </div><div class="line">     |  drive_turn(<span class="keyword">self</span>, speed:<span class="built_in">int</span>, radius_turn:<span class="built_in">float</span>, angle:<span class="built_in">float</span>=<span class="keyword">None</span>, right_turn:bool=<span class="literal">False</span>) -&gt; <span class="keyword">None</span></div><div class="line">     |      Drive the vehicle a turn <span class="keyword">with</span> given radius.</div><div class="line">     |      </div><div class="line">     |      <span class="keyword">Attributes</span>:</div><div class="line">     |      speed: <span class="keyword">in</span> <span class="keyword">percent</span> [<span class="number">-100</span> - <span class="number">100</span>] (direction depends <span class="keyword">on</span> its <span class="keyword">sign</span>)</div><div class="line">     |          positive <span class="keyword">sign</span>: forwards</div><div class="line">     |          negative <span class="keyword">sign</span>: backwards</div><div class="line">     |      radius_turn: <span class="keyword">in</span> meter</div><div class="line">     |          positive <span class="keyword">sign</span>: turn <span class="keyword">to</span> the <span class="keyword">left</span> side</div><div class="line">     |          negative <span class="keyword">sign</span>: turn <span class="keyword">to</span> the <span class="keyword">right</span> side</div><div class="line">     |      </div><div class="line">     |      Keyword <span class="keyword">Attributes</span>:</div><div class="line">     |      angle: <span class="keyword">absolute</span> angle (needs <span class="keyword">to</span> be positive)</div><div class="line">     |             <span class="keyword">if</span> <span class="keyword">None</span>, <span class="keyword">unlimited</span> <span class="keyword">movement</span></div><div class="line">     |      right_turn: flag <span class="keyword">of</span> turn <span class="keyword">right</span> (<span class="keyword">only</span> <span class="keyword">in</span> <span class="keyword">case</span> <span class="keyword">of</span> radius_turn == <span class="number">0</span>)</div><div class="line">     |  </div><div class="line">     |  <span class="keyword">move</span>(<span class="keyword">self</span>, speed:<span class="built_in">int</span>, turn:<span class="built_in">int</span>) -&gt; <span class="keyword">None</span></div><div class="line">     |      <span class="keyword">Start</span> <span class="keyword">unlimited</span> <span class="keyword">movement</span> <span class="keyword">of</span> the vehicle</div><div class="line">     |      </div><div class="line">     |      Arguments:</div><div class="line">     |      speed: speed <span class="keyword">in</span> <span class="keyword">percent</span> [<span class="number">-100</span> - <span class="number">100</span>]</div><div class="line">     |        &gt; <span class="number">0</span>: forward</div><div class="line">     |        &lt; <span class="number">0</span>: backward</div><div class="line">     |      turn: <span class="keyword">type</span> <span class="keyword">of</span> turn [<span class="number">-200</span> - <span class="number">200</span>]</div><div class="line">     |        <span class="number">-200</span>: circle <span class="keyword">right</span> <span class="keyword">on</span> place</div><div class="line">     |        <span class="number">-100</span>: turn <span class="keyword">right</span> <span class="keyword">with</span> unmoved <span class="keyword">right</span> wheel</div><div class="line">     |         <span class="number">0</span>  : straight</div><div class="line">     |         <span class="number">100</span>: turn <span class="keyword">left</span> <span class="keyword">with</span> unmoved <span class="keyword">left</span> wheel</div><div class="line">     |         <span class="number">200</span>: circle <span class="keyword">left</span> <span class="keyword">on</span> place</div><div class="line">     |  </div><div class="line">     |  rotate_to(<span class="keyword">self</span>, speed:<span class="built_in">int</span>, orientation:<span class="built_in">float</span>) -&gt; <span class="keyword">None</span></div><div class="line">     |      Rotate the vehicle <span class="keyword">to</span> the given orientation.</div><div class="line">     |      Chooses the direction <span class="keyword">with</span> the smaller movement.</div><div class="line">     |      </div><div class="line">     |      <span class="keyword">Attributes</span>:</div><div class="line">     |      speed: <span class="keyword">in</span> <span class="keyword">percent</span> [<span class="number">-100</span> - <span class="number">100</span>] (direction depends <span class="keyword">on</span> its <span class="keyword">sign</span>)</div><div class="line">     |      orientation: <span class="keyword">in</span> <span class="keyword">degrees</span> [<span class="number">-180</span> - <span class="number">180</span>]</div><div class="line">     |  </div><div class="line">     |  <span class="keyword">stop</span>(<span class="keyword">self</span>, brake:bool=<span class="literal">False</span>) -&gt; <span class="keyword">None</span></div><div class="line">     |      <span class="keyword">Stop</span> <span class="keyword">movement</span> <span class="keyword">of</span> the vehicle</div><div class="line">     |      </div><div class="line">     |      Arguments:</div><div class="line">     |      brake: flag <span class="keyword">if</span> activating brake</div><div class="line">     |  </div><div class="line">     |  <span class="comment">----------------------------------------------------------------------</span></div><div class="line">     |  <span class="keyword">Data</span> descriptors defined here:</div><div class="line">     |  </div><div class="line">     |  orientation</div><div class="line">     |      actual orientation <span class="keyword">of</span> the vehicle <span class="keyword">in</span> degree, <span class="keyword">range</span> [<span class="number">-180</span> - <span class="number">180</span>]</div><div class="line">     |  </div><div class="line">     |  polarity</div><div class="line">     |      polarity <span class="keyword">of</span> motor rotation (<span class="keyword">values</span>: <span class="number">-1</span>, <span class="number">1</span>, <span class="keyword">default</span>: <span class="number">1</span>)</div><div class="line">     |  </div><div class="line">     |  port_left</div><div class="line">     |      port <span class="keyword">of</span> <span class="keyword">left</span> wheel (<span class="keyword">default</span>: PORT_D)</div><div class="line">     |  </div><div class="line">     |  port_right</div><div class="line">     |      port <span class="keyword">of</span> <span class="keyword">right</span> wheel (<span class="keyword">default</span>: PORT_A)</div><div class="line">     |  </div><div class="line">     |  pos_x</div><div class="line">     |      actual x-component <span class="keyword">of</span> the <span class="keyword">position</span> <span class="keyword">in</span> meter</div><div class="line">     |  </div><div class="line">     |  pos_y</div><div class="line">     |      actual y-component <span class="keyword">of</span> the <span class="keyword">position</span> <span class="keyword">in</span> meter</div><div class="line">     |  </div><div class="line">     |  <span class="comment">----------------------------------------------------------------------</span></div><div class="line">     |  Methods inherited <span class="keyword">from</span> ev3.EV3:</div><div class="line">     |  </div><div class="line">     |  __del__(<span class="keyword">self</span>)</div><div class="line">     |      closes the <span class="keyword">connection</span> <span class="keyword">to</span> the LEGO EV3</div><div class="line">     |  </div><div class="line">     |  send_direct_cmd(<span class="keyword">self</span>, ops:<span class="keyword">bytes</span>, local_mem:<span class="built_in">int</span>=<span class="number">0</span>, global_mem:<span class="built_in">int</span>=<span class="number">0</span>) -&gt; <span class="keyword">bytes</span></div><div class="line">     |      Send a direct command <span class="keyword">to</span> the LEGO EV3</div><div class="line">     |      </div><div class="line">     |      Arguments:</div><div class="line">     |      ops: holds netto <span class="keyword">data</span> <span class="keyword">only</span> (<span class="keyword">operations</span>), the <span class="keyword">following</span> <span class="keyword">fields</span> <span class="keyword">are</span> added:</div><div class="line">     |        <span class="keyword">length</span>: <span class="number">2</span> <span class="keyword">bytes</span>, <span class="keyword">little</span> <span class="keyword">endian</span></div><div class="line">     |        counter: <span class="number">2</span> <span class="keyword">bytes</span>, <span class="keyword">little</span> <span class="keyword">endian</span></div><div class="line">     |        <span class="keyword">type</span>: <span class="number">1</span> <span class="keyword">byte</span>, DIRECT_COMMAND_REPLY <span class="keyword">or</span> DIRECT_COMMAND_NO_REPLY</div><div class="line">     |        header: <span class="number">2</span> <span class="keyword">bytes</span>, holds <span class="keyword">sizes</span> <span class="keyword">of</span> <span class="keyword">local</span> <span class="keyword">and</span> <span class="keyword">global</span> <span class="keyword">memory</span></div><div class="line">     |      </div><div class="line">     |      Keyword Arguments:</div><div class="line">     |      local_mem: <span class="keyword">size</span> <span class="keyword">of</span> the <span class="keyword">local</span> <span class="keyword">memory</span></div><div class="line">     |      global_mem: <span class="keyword">size</span> <span class="keyword">of</span> the <span class="keyword">global</span> <span class="keyword">memory</span></div><div class="line">     |      </div><div class="line">     |      <span class="keyword">Returns</span>: </div><div class="line">     |        sync_mode <span class="keyword">is</span> <span class="keyword">STD</span>: reply (<span class="keyword">if</span> global_mem &gt; <span class="number">0</span>) <span class="keyword">or</span> message counter</div><div class="line">     |        sync_mode <span class="keyword">is</span> ASYNC: message counter</div><div class="line">     |        sync_mode <span class="keyword">is</span> <span class="keyword">SYNC</span>: reply <span class="keyword">of</span> the LEGO EV3</div><div class="line">     |  </div><div class="line">     |  wait_for_reply(<span class="keyword">self</span>, counter:<span class="keyword">bytes</span>) -&gt; <span class="keyword">bytes</span></div><div class="line">     |      Ask the LEGO EV3 <span class="keyword">for</span> a reply <span class="keyword">and</span> <span class="keyword">wait</span> <span class="keyword">until</span> it <span class="keyword">is</span> received</div><div class="line">     |      </div><div class="line">     |      Arguments:</div><div class="line">     |      counter: <span class="keyword">is</span> the message counter <span class="keyword">of</span> the <span class="keyword">corresponding</span> send_direct_cmd</div><div class="line">     |      </div><div class="line">     |      <span class="keyword">Returns</span>:</div><div class="line">     |      reply <span class="keyword">to</span> the direct command</div><div class="line">     |  </div><div class="line">     |  <span class="comment">----------------------------------------------------------------------</span></div><div class="line">     |  <span class="keyword">Data</span> descriptors inherited <span class="keyword">from</span> ev3.EV3:</div><div class="line">     |  </div><div class="line">     |  __dict__</div><div class="line">     |      dictionary <span class="keyword">for</span> <span class="keyword">instance</span> <span class="keyword">variables</span> (<span class="keyword">if</span> defined)</div><div class="line">     |  </div><div class="line">     |  __weakref__</div><div class="line">     |      <span class="keyword">list</span> <span class="keyword">of</span> weak <span class="keyword">references</span> <span class="keyword">to</span> the <span class="keyword">object</span> (<span class="keyword">if</span> defined)</div><div class="line">     |  </div><div class="line">     |  sync_mode</div><div class="line">     |      <span class="keyword">sync</span> <span class="keyword">mode</span> (standard, <span class="keyword">asynchronous</span>, <span class="keyword">synchronous</span>)</div><div class="line">     |      </div><div class="line">     |      <span class="keyword">STD</span>:   <span class="keyword">Use</span> DIRECT_COMMAND_REPLY <span class="keyword">if</span> global_mem &gt; <span class="number">0</span>,</div><div class="line">     |             <span class="keyword">wait</span> <span class="keyword">for</span> reply <span class="keyword">if</span> there <span class="keyword">is</span> one.</div><div class="line">     |      ASYNC: <span class="keyword">Use</span> DIRECT_COMMAND_REPLY <span class="keyword">if</span> global_mem &gt; <span class="number">0</span>,</div><div class="line">     |             <span class="keyword">never</span> <span class="keyword">wait</span> <span class="keyword">for</span> reply (it<span class="string">'s the task of the calling program).</span></div><div class="line">     |      SYNC:  Always use DIRECT_COMMAND_REPLY and wait for reply.</div><div class="line">     |      </div><div class="line">     |      The general idea is:</div><div class="line">     |      ASYNC: Interruption or EV3 device queues direct commands,</div><div class="line">     |             control directly comes back.</div><div class="line">     |      SYNC:  EV3 device is blocked until direct command is finished,</div><div class="line">     |             control comes back, when direct command is finished.               </div><div class="line">     |      STD:   NO_REPLY like ASYNC with interruption or EV3 queuing,</div><div class="line">     |             REPLY like SYNC, synchronicity of program and EV3 device.</div><div class="line">     |  </div><div class="line">     |  verbosity</div><div class="line">     |      level of verbosity (prints on stdout).</div></pre></td></tr></table></figure></p>
<p>我希望，你感觉到，我们现在正在做实际的事情。 对我来说，这是一个亮点。 只有在极少数情况下，人们才能用这么少的努力获得这么多。</p>
<p><a href="http://ev3directcommands.blogspot.com/2016/01/ev3-direct-commands-lesson-04-pre.html" target="_blank" rel="external">原文</a></p>

      
    </div>
    
    
    

    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>坚持原创技术分享，您的支持将鼓励我继续创作！</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>打赏</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/wxpay.png" alt="Han Pengfei 微信支付"/>
        <p>微信支付</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/images/alipay.jpg" alt="Han Pengfei 支付宝"/>
        <p>支付宝</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/翻译/" rel="tag"># 翻译</a>
          
            <a href="/tags/ROS/" rel="tag"># ROS</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/10/30/lego_ev3_direct_command_003/" rel="next" title="EV3 直接命令 - 第 3 课 遥控车辆">
                <i class="fa fa-chevron-left"></i> EV3 直接命令 - 第 3 课 遥控车辆
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/10/31/lego_ev3_direct_command_005/" rel="prev" title="EV3 直接命令 - 第 5 课 从 EV3 的传感器读取数据">
                EV3 直接命令 - 第 5 课 从 EV3 的传感器读取数据 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          

  
    <div class="comments" id="comments">
    </div>
  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/freesoft.jpg"
                alt="Han Pengfei" />
            
              <p class="site-author-name" itemprop="name">Han Pengfei</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">207</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">19</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">30</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  <a href="https://github.com/hanpfei" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i>GitHub</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="https://www.douban.com/people/3681478/" target="_blank" title="豆瓣"><i class="fa fa-fw fa-globe"></i>豆瓣</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="https://www.zhihu.com/people/han-peng-fei-49" target="_blank" title="知乎"><i class="fa fa-fw fa-globe"></i>知乎</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="mailto:hanpfei@gmail.com" target="_blank" title="E-Mail"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  
                </span>
              
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://developer.android.com/index.html" title="Android Developers" target="_blank">Android Developers</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://source.android.com/" title="Android Open Source Project" target="_blank">Android Open Source Project</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.vants.org/" title="蚂蚁网" target="_blank">蚂蚁网</a>
                  </li>
                
              </ul>
            </div>
          

          
            
          
          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#简介"><span class="nav-number">1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#同步的电机移动"><span class="nav-number">2.</span> <span class="nav-text">同步的电机移动</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#具有两个驱动轮的车辆的定义明确且可预测的运动"><span class="nav-number">3.</span> <span class="nav-text">具有两个驱动轮的车辆的定义明确且可预测的运动</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#确定车辆的尺寸"><span class="nav-number">3.1.</span> <span class="nav-text">确定车辆的尺寸</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#获取参数-STEP-和-TURN-的数学转换"><span class="nav-number">3.2.</span> <span class="nav-text">获取参数 STEP 和 TURN 的数学转换</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#数学转换的控制"><span class="nav-number">3.3.</span> <span class="nav-text">数学转换的控制</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#增强类-TwoWheelVehicle"><span class="nav-number">4.</span> <span class="nav-text">增强类 TwoWheelVehicle</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#了解车辆的位置和方向"><span class="nav-number">4.1.</span> <span class="nav-text">了解车辆的位置和方向</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#完成类-TwoWheelVehicle"><span class="nav-number">5.</span> <span class="nav-text">完成类 TwoWheelVehicle</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#异步和同步运动"><span class="nav-number">6.</span> <span class="nav-text">异步和同步运动</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#结论"><span class="nav-number">7.</span> <span class="nav-text">结论</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2016.09.16 &mdash; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Han Pengfei</span>

  

  
</div>




  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/theme-next/hexo-theme-next">NexT.Mist</a> v6.0.3</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.0.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.0.3"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.0.3"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.0.3"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.0.3"></script>



  



	





  





  









<script src="//cdn1.lncld.net/static/js/3.11.1/av-min.js"></script>



<script src="//unpkg.com/valine/dist/Valine.min.js"></script>

<script>
  var GUEST = ['nick', 'mail', 'link'];
  var guest = 'nick,mail,link';
  guest = guest.split(',').filter(function(item) {
    return GUEST.indexOf(item) > -1;
  });
  new Valine({
    el: '#comments',
    verify: false,
    notify: false,
    appId: 's9sbM9ODdusCzKcm5JcIj6t8-gzGzoHsz',
    appKey: 'UoO9ia1DLNwOXRUsTBQ6QXxm',
    placeholder: 'ヾﾉ≧∀≦)o来啊，快活啊!',
    avatar: 'mm',
    meta: guest,
    pageSize: '10' || 10,
    visitor: true,
    lang: '' || 'zh-cn'
  });
</script>


  





  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  

  
  

  

  

  

  

</body>
</html>
