<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









  
  
  <link rel="stylesheet" media="all" href="/lib/Han/dist/han.min.css?v=3.3">




<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.0.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/freesoft.jpg?v=6.0.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/freesoft.jpg?v=6.0.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/freesoft.jpg?v=6.0.3">


  <link rel="mask-icon" href="/images/freesoft.jpg?v=6.0.3" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '6.0.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  
  <meta name="keywords" content="翻译,ROS," />


<meta name="description" content="1 MINDSTORMS EV3 可编程 brick 的硬件规格LEGO MINDSTORMS EV3 可编程 brick 是新 LEGO MINDSTORMS 平台内的中央处理单元。可编程 brick 由各种先进的电子设备组成，以实现其广泛的功能。">
<meta property="og:type" content="article">
<meta property="og:title" content="LEGO EV3 通信 开发者套件">
<meta property="og:url" content="https://www.wolfcstech.com/2018/10/26/lego_ev3_communication_dev_kit/index.html">
<meta property="og:site_name" content="WolfcsTech">
<meta property="og:description" content="1 MINDSTORMS EV3 可编程 brick 的硬件规格LEGO MINDSTORMS EV3 可编程 brick 是新 LEGO MINDSTORMS 平台内的中央处理单元。可编程 brick 由各种先进的电子设备组成，以实现其广泛的功能。">
<meta property="og:image" content="https://www.wolfcstech.com/images/1315506-aa6f55bd5dc9af28.png">
<meta property="og:image" content="https://www.wolfcstech.com/images/1315506-ce930be5ecb43fc0.png">
<meta property="og:image" content="https://www.wolfcstech.com/images/1315506-22619ea04685b8f3.png">
<meta property="og:image" content="https://www.wolfcstech.com/images/1315506-abe01a3233a4c289.png">
<meta property="og:image" content="https://www.wolfcstech.com/images/1315506-14588e96314e7c3c.png">
<meta property="og:updated_time" content="2018-10-26T10:54:18.537Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="LEGO EV3 通信 开发者套件">
<meta name="twitter:description" content="1 MINDSTORMS EV3 可编程 brick 的硬件规格LEGO MINDSTORMS EV3 可编程 brick 是新 LEGO MINDSTORMS 平台内的中央处理单元。可编程 brick 由各种先进的电子设备组成，以实现其广泛的功能。">
<meta name="twitter:image" content="https://www.wolfcstech.com/images/1315506-aa6f55bd5dc9af28.png">






  <link rel="canonical" href="https://www.wolfcstech.com/2018/10/26/lego_ev3_communication_dev_kit/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>
  <title>LEGO EV3 通信 开发者套件 | WolfcsTech</title>
  




<script async src="https://www.googletagmanager.com/gtag/js?id=UA-109419024-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-109419024-1');
</script>



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?3c736b12c32c019fd9ff6c825b6b9b44";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"> <div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">WolfcsTech</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            <i class="menu-item-icon fa fa-fw fa-home"></i> <br />首页</a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            <i class="menu-item-icon fa fa-fw fa-th"></i> <br />分类</a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />归档</a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />标签</a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            <i class="menu-item-icon fa fa-fw fa-user"></i> <br />关于</a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="http://www.ixirong.com/404.html" rel="section">
            <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />公益 404</a>
        </li>
      

      
    </ul>
  

  
</nav>


  



 </div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://www.wolfcstech.com/2018/10/26/lego_ev3_communication_dev_kit/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Han Pengfei">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/freesoft.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="WolfcsTech">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">LEGO EV3 通信 开发者套件</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-10-26T20:05:49+08:00">2018-10-26</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/ROS/" itemprop="url" rel="index"><span itemprop="name">ROS</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/10/26/lego_ev3_communication_dev_kit/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2018/10/26/lego_ev3_communication_dev_kit/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2018/10/26/lego_ev3_communication_dev_kit/" class="leancloud_visitors" data-flag-title="LEGO EV3 通信 开发者套件">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        <h1 id="1-MINDSTORMS-EV3-可编程-brick-的硬件规格"><a href="#1-MINDSTORMS-EV3-可编程-brick-的硬件规格" class="headerlink" title="1 MINDSTORMS EV3 可编程 brick 的硬件规格"></a>1 MINDSTORMS EV3 可编程 brick 的硬件规格</h1><p>LEGO MINDSTORMS EV3 可编程 brick 是新 LEGO MINDSTORMS 平台内的中央处理单元。可编程 brick 由各种先进的电子设备组成，以实现其广泛的功能。<br><a id="more"></a><br>下面的列表是 EV3 可编程 brick 硬件规格总结。</p>
<table>
<thead>
<tr>
<th>硬件</th>
<th>规格</th>
</tr>
</thead>
<tbody>
<tr>
<td>主处理器</td>
<td>32-bit ARM9 processor, Texas Instrument AM1808<br>   - 300 MHz <br>    - OS: LINUX</td>
</tr>
<tr>
<td>存储器</td>
<td>64 MB DDR RAM <br> 16 MB FLASH <br> 256 KB EEPROM</td>
</tr>
<tr>
<td>Micro SD卡接口</td>
<td>SDHC standard, 2 – 32 GB</td>
</tr>
<tr>
<td>Bluetooth 无线通信</td>
<td>Bluetooth V2.1 EDR, Panasonic PAN1325 模块 <br>  - Texas Instrument CC2550 芯片 <br>  - BlueZ Bluetooth 栈 <br>  - Primary usage, Serial Port Profile (SPP)</td>
</tr>
<tr>
<td>USB 2.0 通信，客户端接口</td>
<td>高速端口 (480 MBit/s)</td>
</tr>
<tr>
<td>USB 1.1 通信，客户端接口</td>
<td>全速端口 (12 MBit/s)</td>
</tr>
<tr>
<td>4 个输入端口</td>
<td>6 个接口同时支持数字和模拟接口 <br>  - 模拟输入  0 – 5 V <br>  - 支持  Auto-ID 扩展设备 <br>      - UART 通信 <br>    <em>  Up to 460 Kbit/s (Port 1 and 2) <br>    </em>  Up to 230 Kbit/s (Port 3 and 4)</td>
</tr>
<tr>
<td>4 个输出端口</td>
<td>6 个有线接口，支持电机编码器输入</td>
</tr>
<tr>
<td>显示</td>
<td>178x128 像素黑白点阵显示器 <br> - 可视区域： 29.9 x 41.1 mm</td>
</tr>
<tr>
<td>扩音器</td>
<td>直径，23 mm</td>
</tr>
<tr>
<td>6 个按钮用户接口</td>
<td>环绕 UI 灯</td>
</tr>
<tr>
<td>电源</td>
<td>6 AA 电池 <br> - 建议使用碱性电池 <br> -  可充电锂离子电池，2000 mAH</td>
</tr>
<tr>
<td>链接器</td>
<td>6 线工业标准连接器，RJ-12右侧调节</td>
</tr>
</tbody>
</table>
<h1 id="2-通信接口"><a href="#2-通信接口" class="headerlink" title="2 通信接口"></a>2 通信接口</h1><p>这部分将描述不同类型 masters（主机）与 LEGO MINDSTORMS EV3 brick 通信所用的协议。EV3 支持多种通信接口 Bluetooth，USB 和 WiFi。EV3 协议对于所有 3 种传输技术都是相同的。</p>
<p>除了运行用户程序外，VM（虚拟机）还能执行通过上述技术之一发送的直接命令。直接命令由构成常规字节码的小程序组成，有关各字节码的更多详细信息，请参考 <em>LEGO MINDSTORMS EV3 固件开发者套件</em>。这些直接命令（代码片段）与运行的用户程序并行执行。</p>
<p>在组合这些直接命令时要特别小心。在使用危险的代码和结构时没有任何限制（例如，允许直接命令中出现死锁循环）。然而 “普通的” 运行中的程序将继续正常工作 - 只有 VM 的直接命令部分将被这样的死锁循环 “锁死”。</p>
<p>由于头部只为变量分配包含 2 个字节，直接命令仅限于一个 VMTHREAD - 即SUBCALLs 和 BLOCKs 当然是不可能的。</p>
<p>具有数据响应的直接命令可以把返回数据放在全局变量空间中。全局变量空间 “等于” 通信响应缓冲区。直接命令的组成定义了放置结果的偏移量位置（全局变量 0 放在返回缓冲区中偏移量为 0 的位置）。</p>
<p>响应缓冲区（全局变量）中的偏移量必须对齐（第一个对齐到 float/32 位，最后一个对齐到 8 位）。</p>
<p>除了直接命令，EV3 还支持系统命令，这是更通用的术语命令，它们被用于向/从嵌入式 EV3 系统下载和上传数据。</p>
<h1 id="3-系统命令"><a href="#3-系统命令" class="headerlink" title="3 系统命令"></a>3 系统命令</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">define</span> SYSTEM_COMMAND_REPLY 0x01 <span class="comment">// 系统命令，需要应答</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> SYSTEM_COMMAND_NO_REPLY 0x81 <span class="comment">// 系统命令，无需应答</span></span></div></pre></td></tr></table></figure>
<p><strong>系统命令字节：</strong></p>
<p><img src="https://www.wolfcstech.com/images/1315506-aa6f55bd5dc9af28.png" alt=""></p>
<p>字节 0 - 1：命令大小，小尾端。命令大小不包含这 2 个字节<br>字节 2 - 3：消息计数器，小尾端。Forth running counter<br>字节 4：命令类型。参考上面的定义<br>字节 5：系统命令。参考下面的定义<br>字节 6 - n：依赖于字节 5 中给出的系统命令</p>
<p><strong>系统命令：</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">define</span> BEGIN_DOWNLOAD 0x92 <span class="comment">// 开始文件下载</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> CONTINUE_DOWNLOAD 0x93 <span class="comment">// 继续文件下载</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> BEGIN_UPLOAD 0x94 <span class="comment">// 开始文件上传</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> CONTINUE_UPLOAD 0x95 <span class="comment">// 继续文件上传</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> BEGIN_GETFILE 0x96 <span class="comment">// 开始从文件获取字节（在写入文件时）</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> CONTINUE_GETFILE 0x97 <span class="comment">// 继续从文件获取字节（在写入文件时）</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> CLOSE_FILEHANDLE 0x98 <span class="comment">// 关闭文件句柄</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> LIST_FILES 0x99 <span class="comment">// 列出文件</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> CONTINUE_LIST_FILES 0x9A <span class="comment">// 继续列出文件</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> CREATE_DIR 0x9B <span class="comment">// 创建目录</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> DELETE_FILE 0x9C <span class="comment">// 删除</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> LIST_OPEN_HANDLES 0x9D <span class="comment">// 列出句柄</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> WRITEMAILBOX 0x9E <span class="comment">// 写邮箱</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> BLUETOOTHPIN 0x9F <span class="comment">// 把可信的 pin 码传入 brick </span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> ENTERFWUPDATE 0xA0 <span class="comment">// 重启 brick 进入 Firmware 更新模式</span></span></div></pre></td></tr></table></figure></p>
<h2 id="3-1-系统命令应答"><a href="#3-1-系统命令应答" class="headerlink" title="3.1 系统命令应答"></a>3.1 系统命令应答</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">define</span> SYSTEM_REPLY 0x03 <span class="comment">// 系统命令应答 OK</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> SYSTEM_REPLY_ERROR 0x05 <span class="comment">// 系统命令应答 ERROR</span></span></div></pre></td></tr></table></figure>
<p><strong>系统应答字节：</strong></p>
<p><img src="https://www.wolfcstech.com/images/1315506-ce930be5ecb43fc0.png" alt=""></p>
<p>字节 0 - 1：应答大小，小尾端。应答大小不包含这 2 个字节<br>字节 2 - 3：消息计数器，小尾端。等于直接命令<br>字节 4：应答类型。参考上面的定义<br>字节 5：这个应答响应的系统命令<br>字节 6：系统应答状态 - 错误，信息或成功。参考下面的定义<br>字节 7 - n：进一步的系统应答字节依赖于系统命令和系统应答状态</p>
<p><strong>系统命令应答状态码：</strong><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">define</span> SUCCESS 0x00</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> UNKNOWN_HANDLE 0x01</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> HANDLE_NOT_READY 0x02</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> CORRUPT_FILE 0x03</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> NO_HANDLES_AVAILABLE 0x04</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> NO_PERMISSION 0x05</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> ILLEGAL_PATH 0x06</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> FILE_EXITS 0x07</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> END_OF_FILE 0x08</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> SIZE_ERROR 0x09</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> UNKNOWN_ERROR 0x0A</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> ILLEGAL_FILENAME 0x0B</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> ILLEGAL_CONNECTION 0x0C</span></div></pre></td></tr></table></figure></p>
<h2 id="3-2-向-EV3-可编程-brick-下载数据"><a href="#3-2-向-EV3-可编程-brick-下载数据" class="headerlink" title="3.2 向 EV3 可编程 brick 下载数据"></a>3.2 向 EV3 可编程 brick 下载数据</h2><p>下载大文件可能非常耗时，因此文件下载可以以 2 种不同的方式完成。</p>
<ol>
<li><p>以最大可能块下载文件，即尽可能使用最大的数据包大小（总命令大小不包括在内。 Length 字节= 65534字节）。如果总消息大小可以保持在 65534 字节以下，则所有的数据可以放进 <strong><em>开始下载</em></strong> 命令，这将是下载文件最快的方式。这是最快的下载方式，但在这段时间内系统也会被锁定。</p>
</li>
<li><p>把文件下载分为更小的部分，即一个 <strong><em>开始下载</em></strong> 后面跟着大量的 <strong><em>继续下载</em></strong> 命令，这将增加总的下载时间，但在持续的 <strong><em>继续下载</em></strong> 命令交错间也将给其它命令（更高优先级的）留下空间（时间片）。<br>这是下载文件最慢的方式，但可以在 <strong><em>继续下载</em></strong> 消息间交错其他命令。</p>
</li>
</ol>
<p>由于包中没有停止或其它同步字节 - 一个消息一定不能被其它消息打断。即当 brick 已经接收了命令大小（消息的头 2 个字节）时，所有剩余的字节必须无中断地被传送和接收。这个特定消息的应答（来自于 brick）也应该在任何新消息被发送和由 brick 处理前被传送和接收。</p>
<p><strong>下面的例子基于想要给 P-Brick 发送一个文件的主机应用（X3 software）构建：</strong></p>
<p><img src="https://www.wolfcstech.com/images/1315506-22619ea04685b8f3.png" alt=""></p>
<p>命令大小，命令类型，开始 D/L，文件大小，文件名 ——&gt;<br>&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&lt;—— 命令大小，命令类型，句柄<br>命令大小，命令类型，继续 D/L，句柄，载荷           ——&gt;<br>&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&lt;—— 命令大小，命令类型<br>命令大小，命令类型，继续 D/L，句柄，载荷           ——&gt;<br>&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&lt;—— 命令大小，命令类型<br>命令大小，命令类型，继续 D/L，句柄，载荷           ——&gt;</p>
<h3 id="3-2-1-文件下载"><a href="#3-2-1-文件下载" class="headerlink" title="3.2.1 文件下载"></a>3.2.1 文件下载</h3><ul>
<li>目的文件名路径相对于 <strong><em>“lms2012/sys”</em></strong> 定位</li>
<li>目的目录自动从文件名路径创建</li>
<li>第一个目录名必须是：<strong><em>“apps”</em></strong>，<strong><em>“prjs”</em></strong> 或 <strong><em>“tools”</em></strong> （参考 \ref UIdesign）</li>
<li>文件名路径中的第二个文件夹名称必须等于字节码可执行名称</li>
</ul>
<h3 id="3-2-2-文件上传（文件读取）"><a href="#3-2-2-文件上传（文件读取）" class="headerlink" title="3.2.2 文件上传（文件读取）"></a>3.2.2 文件上传（文件读取）</h3><ul>
<li><strong>BEGIN_UPLOAD</strong> 和 <strong>CONTINUE_UPLOAD</strong> 在文件上传结束时自动关闭文件句柄。</li>
<li><strong>BEGIN_GETFILE</strong> 和 <strong>CONTINUE_GETFILE</strong> 当到达 EOF 时不关闭文件句柄</li>
<li><strong>CONTINUE_GETFILE</strong> 也返回完整的文件大小</li>
</ul>
<h3 id="3-2-3-目录上传"><a href="#3-2-3-目录上传" class="headerlink" title="3.2.3 目录上传"></a>3.2.3 目录上传</h3><ul>
<li><strong>LIST_FILES</strong> 只要列表不超过 1014 字节，就可以工作。</li>
</ul>
<h2 id="3-3-系统命令，通信例子"><a href="#3-3-系统命令，通信例子" class="headerlink" title="3.3 系统命令，通信例子"></a>3.3 系统命令，通信例子</h2><p>在下文中，系统命令通信示例的例子将帮助说明接口。</p>
<h3 id="3-3-1-文件下载"><a href="#3-3-1-文件下载" class="headerlink" title="3.3.1 文件下载"></a>3.3.1 文件下载</h3><p>下载文件 “../apps/tst/tst.rbf”</p>
<p>&emsp;&emsp;&emsp;<strong>BEGIN_DOWNLOAD:</strong></p>
<p>&emsp;&emsp;&emsp;&emsp;&emsp;向 brick 发送的字节：<br>&emsp;&emsp;&emsp;&emsp;&emsp;<strong>1C00xxxx0192xxxxxxxx2E2E2F617070732F7473742F7473742E72626600&emsp;&emsp;(Hex)</strong><br>&emsp;&emsp;&emsp;&emsp;&emsp;<strong>bbbbmmmmttssllllllllnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnnn</strong></p>
<p>&emsp;&emsp;&emsp;&emsp;&emsp;bbbb = 消息中的字节数<br>&emsp;&emsp;&emsp;&emsp;&emsp;mm = 消息计数器<br>&emsp;&emsp;&emsp;&emsp;&emsp;tt = 命令类型<br>&emsp;&emsp;&emsp;&emsp;&emsp;ss = 系统命令<br>&emsp;&emsp;&emsp;&emsp;&emsp;llllllll = 文件长度<br>&emsp;&emsp;&emsp;&emsp;&emsp;nn.. = 以 0 结束的文件名</p>
<p>&emsp;&emsp;&emsp;&emsp;&emsp;从 brick 接收的字节：<br>&emsp;&emsp;&emsp;&emsp;&emsp;<strong>0600xxxx03920000&emsp;&emsp;(Hex)</strong><br>&emsp;&emsp;&emsp;&emsp;&emsp;<strong>bbbbmmmmttssrrhh</strong></p>
<p>&emsp;&emsp;&emsp;&emsp;&emsp;bbbb = 消息中的字节数<br>&emsp;&emsp;&emsp;&emsp;&emsp;mm = 消息计数器<br>&emsp;&emsp;&emsp;&emsp;&emsp;tt = 命令类型<br>&emsp;&emsp;&emsp;&emsp;&emsp;ss = 系统命令<br>&emsp;&emsp;&emsp;&emsp;&emsp;rr = 返回状态<br>&emsp;&emsp;&emsp;&emsp;&emsp;hh = 文件句柄</p>
<p>&emsp;&emsp;&emsp;<strong>CONTINUE_DOWNLOAD:</strong><br>&emsp;&emsp;&emsp;&emsp;&emsp;向 brick 发送的字节：<br>&emsp;&emsp;&emsp;&emsp;&emsp;<strong>xxxxxxxx819300xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&emsp;&emsp;(Hex)</strong><br>&emsp;&emsp;&emsp;&emsp;&emsp;<strong>bbbbmmmmttsshhpppppppppppppppppppppppppppppppppppppppp</strong></p>
<p>&emsp;&emsp;&emsp;&emsp;&emsp;bbbb = 消息中的字节数<br>&emsp;&emsp;&emsp;&emsp;&emsp;mm = 消息计数器<br>&emsp;&emsp;&emsp;&emsp;&emsp;tt = 命令类型<br>&emsp;&emsp;&emsp;&emsp;&emsp;ss = 系统命令<br>&emsp;&emsp;&emsp;&emsp;&emsp;hh = 文件句柄（在 BEGIN_DOWNLOAD 中返回）<br>&emsp;&emsp;&emsp;&emsp;&emsp;pp.. = 载荷</p>
<p>&emsp;&emsp;&emsp;&emsp;&emsp;从 brick 接收的字节：<br>&emsp;&emsp;&emsp;&emsp;&emsp;<strong>0600xxxx03930000&emsp;&emsp;(Hex)</strong><br>&emsp;&emsp;&emsp;&emsp;&emsp;<strong>bbbbmmmmttssrrhh</strong></p>
<p>&emsp;&emsp;&emsp;&emsp;&emsp;bbbb = 消息中的字节数<br>&emsp;&emsp;&emsp;&emsp;&emsp;mm = 消息计数器<br>&emsp;&emsp;&emsp;&emsp;&emsp;tt = 命令类型<br>&emsp;&emsp;&emsp;&emsp;&emsp;ss = 系统命令<br>&emsp;&emsp;&emsp;&emsp;&emsp;rr = 返回状态<br>&emsp;&emsp;&emsp;&emsp;&emsp;hh = 文件句柄</p>
<h3 id="3-3-2-文件上传"><a href="#3-3-2-文件上传" class="headerlink" title="3.3.2 文件上传"></a>3.3.2 文件上传</h3><p>&emsp;&emsp;&emsp;<strong>BEGIN_UPLOAD:</strong><br>&emsp;&emsp;&emsp;&emsp;&emsp;向 brick 发送的字节：<br>&emsp;&emsp;&emsp;&emsp;&emsp;<strong>xxxxxxxx0194xxxxxxx</strong><br>&emsp;&emsp;&emsp;&emsp;&emsp;<strong>bbbbmmmmttssllllnnn…</strong></p>
<p>&emsp;&emsp;&emsp;&emsp;&emsp;bbbb = 消息中的字节数<br>&emsp;&emsp;&emsp;&emsp;&emsp;mmmm = 消息计数器<br>&emsp;&emsp;&emsp;&emsp;&emsp;tt = 命令类型<br>&emsp;&emsp;&emsp;&emsp;&emsp;ss = 系统命令<br>&emsp;&emsp;&emsp;&emsp;&emsp;llll = 要读取的字节<br>&emsp;&emsp;&emsp;&emsp;&emsp;nnn… = 文件名，包含路径</p>
<p>&emsp;&emsp;&emsp;&emsp;&emsp;从 brick 接收的字节：<br>&emsp;&emsp;&emsp;&emsp;&emsp;<strong>xxxxxxxx039400xxxxxxxx00xxx</strong><br>&emsp;&emsp;&emsp;&emsp;&emsp;<strong>bbbbmmmmttssrrllllllllhhppp…</strong></p>
<p>&emsp;&emsp;&emsp;&emsp;&emsp;bbbb = 消息中的字节数<br>&emsp;&emsp;&emsp;&emsp;&emsp;mmmm = 消息计数器<br>&emsp;&emsp;&emsp;&emsp;&emsp;tt = 命令类型<br>&emsp;&emsp;&emsp;&emsp;&emsp;ss = 系统命令<br>&emsp;&emsp;&emsp;&emsp;&emsp;rr = 返回状态<br>&emsp;&emsp;&emsp;&emsp;&emsp;llllllll = 文件大小<br>&emsp;&emsp;&emsp;&emsp;&emsp;hh = 文件句柄<br>&emsp;&emsp;&emsp;&emsp;&emsp;ppp… = 载荷</p>
<p>&emsp;&emsp;&emsp;<strong>CONTINUE_UPLOAD:</strong><br>&emsp;&emsp;&emsp;&emsp;&emsp;向 brick 发送的字节：<br>&emsp;&emsp;&emsp;&emsp;&emsp;<strong>0700xxxx019500xxxx</strong><br>&emsp;&emsp;&emsp;&emsp;&emsp;<strong>bbbbmmmmttsshhllll…</strong></p>
<p>&emsp;&emsp;&emsp;&emsp;&emsp;bbbb = 消息中的字节数<br>&emsp;&emsp;&emsp;&emsp;&emsp;mmmm = 消息计数器<br>&emsp;&emsp;&emsp;&emsp;&emsp;tt = 命令类型<br>&emsp;&emsp;&emsp;&emsp;&emsp;ss = 系统命令<br>&emsp;&emsp;&emsp;&emsp;&emsp;hh = 文件句柄<br>&emsp;&emsp;&emsp;&emsp;&emsp;llll = 要读取的字节</p>
<p>&emsp;&emsp;&emsp;&emsp;&emsp;向 PC 发送的字节：<br>&emsp;&emsp;&emsp;&emsp;&emsp;<strong>xxxxxxxx03950000xxx</strong><br>&emsp;&emsp;&emsp;&emsp;&emsp;<strong>bbbbmmmmttssrrhhppp…</strong></p>
<p>&emsp;&emsp;&emsp;&emsp;&emsp;bbbb = 消息中的字节数<br>&emsp;&emsp;&emsp;&emsp;&emsp;mmmm = 消息计数器<br>&emsp;&emsp;&emsp;&emsp;&emsp;tt = 命令类型<br>&emsp;&emsp;&emsp;&emsp;&emsp;ss = 系统命令<br>&emsp;&emsp;&emsp;&emsp;&emsp;rr = 返回状态<br>&emsp;&emsp;&emsp;&emsp;&emsp;hh = 句柄<br>&emsp;&emsp;&emsp;&emsp;&emsp;pppp.. = 载荷</p>
<h3 id="3-3-3-获取文件内容"><a href="#3-3-3-获取文件内容" class="headerlink" title="3.3.3 获取文件内容"></a>3.3.3 获取文件内容</h3><p>用于上传数据记录文件 - 文件句柄只在文件指针到达 EOF 时关闭，且文件不以写模式打开。</p>
<p>&emsp;&emsp;&emsp;<strong>BEGIN_GETFILE:</strong><br>&emsp;&emsp;&emsp;&emsp;&emsp;向 brick 发送的字节：<br>&emsp;&emsp;&emsp;&emsp;&emsp;<strong>xxxxxxxx0196xxxxxxx</strong><br>&emsp;&emsp;&emsp;&emsp;&emsp;<strong>bbbbmmmmttssllllnnn…</strong></p>
<p>&emsp;&emsp;&emsp;&emsp;&emsp;bbbb = 消息中的字节数<br>&emsp;&emsp;&emsp;&emsp;&emsp;mmmm = 消息计数器<br>&emsp;&emsp;&emsp;&emsp;&emsp;tt = 命令类型<br>&emsp;&emsp;&emsp;&emsp;&emsp;ss = 系统命令<br>&emsp;&emsp;&emsp;&emsp;&emsp;llll = 最大读取字节数<br>&emsp;&emsp;&emsp;&emsp;&emsp;nnnn…. = 路径</p>
<p>&emsp;&emsp;&emsp;&emsp;&emsp;向 PC 发送的字节：<br>&emsp;&emsp;&emsp;&emsp;&emsp;<strong>xxxxxxxx039600xxxxxxxx00xxx</strong><br>&emsp;&emsp;&emsp;&emsp;&emsp;<strong>bbbbmmmmttssrrllllllllhhppp…</strong></p>
<p>&emsp;&emsp;&emsp;&emsp;&emsp;bbbb = 消息中的字节数<br>&emsp;&emsp;&emsp;&emsp;&emsp;mmmm = 消息计数器<br>&emsp;&emsp;&emsp;&emsp;&emsp;tt = 命令类型<br>&emsp;&emsp;&emsp;&emsp;&emsp;ss = 系统命令<br>&emsp;&emsp;&emsp;&emsp;&emsp;rr = 返回状态<br>&emsp;&emsp;&emsp;&emsp;&emsp;llllllll = 文件大小<br>&emsp;&emsp;&emsp;&emsp;&emsp;hh = 句柄<br>&emsp;&emsp;&emsp;&emsp;&emsp;ppp… = 载荷</p>
<p>&emsp;&emsp;&emsp;<strong>CONTINUE_GETFILE:</strong><br>&emsp;&emsp;&emsp;&emsp;&emsp;向 brick 发送的字节：<br>&emsp;&emsp;&emsp;&emsp;&emsp;<strong>0700xxxx019700xxxx</strong><br>&emsp;&emsp;&emsp;&emsp;&emsp;<strong>bbbbmmmmttsshhllll</strong></p>
<p>&emsp;&emsp;&emsp;&emsp;&emsp;bbbb = 消息中的字节数<br>&emsp;&emsp;&emsp;&emsp;&emsp;mmmm = 消息计数器<br>&emsp;&emsp;&emsp;&emsp;&emsp;tt = 命令类型<br>&emsp;&emsp;&emsp;&emsp;&emsp;ss = 系统命令<br>&emsp;&emsp;&emsp;&emsp;&emsp;hh = 句柄<br>&emsp;&emsp;&emsp;&emsp;&emsp;llll = 最大读取字节数</p>
<p>&emsp;&emsp;&emsp;&emsp;&emsp;向 PC 发送的字节：<br>&emsp;&emsp;&emsp;&emsp;&emsp;<strong>xxxxxxxx039700xxxxxxxx00xxx</strong><br>&emsp;&emsp;&emsp;&emsp;&emsp;<strong>bbbbmmmmttssrrllllllllhhppp…</strong></p>
<p>&emsp;&emsp;&emsp;&emsp;&emsp;bbbb = 消息中的字节数<br>&emsp;&emsp;&emsp;&emsp;&emsp;mmmm = 消息计数器<br>&emsp;&emsp;&emsp;&emsp;&emsp;tt = 命令类型<br>&emsp;&emsp;&emsp;&emsp;&emsp;ss = 系统命令<br>&emsp;&emsp;&emsp;&emsp;&emsp;rr = 返回状态<br>&emsp;&emsp;&emsp;&emsp;&emsp;llllllll = 文件大小<br>&emsp;&emsp;&emsp;&emsp;&emsp;hh = 句柄<br>&emsp;&emsp;&emsp;&emsp;&emsp;ppp… = 载荷</p>
<h3 id="3-3-4-列出文件和目录"><a href="#3-3-4-列出文件和目录" class="headerlink" title="3.3.4 列出文件和目录"></a>3.3.4 列出文件和目录</h3><p>&emsp;&emsp;&emsp;<strong>LIST_FILES:</strong></p>
<p>&emsp;&emsp;&emsp;新行分隔列表的格式为：</p>
<p>&emsp;&emsp;&emsp;如果是文件：<br>&emsp;&emsp;&emsp;MD5SUM 的 32 chars (hex) + space +  8 chars (hex) 的文件大小 + space + 文件名 + 新行</p>
<p>&emsp;&emsp;&emsp;如果是目录：<br>&emsp;&emsp;&emsp;目录名 + / + 新行</p>
<p>&emsp;&emsp;&emsp;&emsp;&emsp;向 brick 发送的字节：<br>&emsp;&emsp;&emsp;&emsp;&emsp;<strong>xxxxxxxx0199xxxxxxx</strong><br>&emsp;&emsp;&emsp;&emsp;&emsp;<strong>bbbbmmmmttssllllnnn…</strong></p>
<p>&emsp;&emsp;&emsp;&emsp;&emsp;bbbb = 消息中的字节数<br>&emsp;&emsp;&emsp;&emsp;&emsp;mmmm = 消息计数器<br>&emsp;&emsp;&emsp;&emsp;&emsp;tt = 消息类型<br>&emsp;&emsp;&emsp;&emsp;&emsp;ss = 系统命令<br>&emsp;&emsp;&emsp;&emsp;&emsp;llll = 最大读取字节数<br>&emsp;&emsp;&emsp;&emsp;&emsp;nnn…. = 路径名</p>
<p>&emsp;&emsp;&emsp;&emsp;&emsp;向 PC 发送的字节：<br>&emsp;&emsp;&emsp;&emsp;&emsp;<strong>xxxxxxxx0399xxxxxxxxxxxxxxx</strong><br>&emsp;&emsp;&emsp;&emsp;&emsp;<strong>bbbbmmmmttssrrllllllllhhnnn…</strong></p>
<p>&emsp;&emsp;&emsp;&emsp;&emsp;bbbb = 消息中的字节数<br>&emsp;&emsp;&emsp;&emsp;&emsp;mmmm = 消息计数器<br>&emsp;&emsp;&emsp;&emsp;&emsp;tt = 消息类型<br>&emsp;&emsp;&emsp;&emsp;&emsp;ss = 系统命令<br>&emsp;&emsp;&emsp;&emsp;&emsp;rr = 返回状态<br>&emsp;&emsp;&emsp;&emsp;&emsp;llllllll = 列表大小<br>&emsp;&emsp;&emsp;&emsp;&emsp;hh = 句柄<br>&emsp;&emsp;&emsp;&emsp;&emsp;nnn.. = 新行分隔列表</p>
<p>&emsp;&emsp;&emsp;<strong>CONTINUE_LIST_FILES:</strong><br>&emsp;&emsp;&emsp;&emsp;&emsp;向 brick 发送的字节：<br>&emsp;&emsp;&emsp;&emsp;&emsp;<strong>0700xxxx019Axxxxxx</strong><br>&emsp;&emsp;&emsp;&emsp;&emsp;<strong>bbbbmmmmttsshhllll</strong></p>
<p>&emsp;&emsp;&emsp;&emsp;&emsp;bbbb = 消息中的字节数<br>&emsp;&emsp;&emsp;&emsp;&emsp;mmmm = 消息计数器<br>&emsp;&emsp;&emsp;&emsp;&emsp;tt = 命令类型<br>&emsp;&emsp;&emsp;&emsp;&emsp;ss = 系统命令<br>&emsp;&emsp;&emsp;&emsp;&emsp;hh = 句柄<br>&emsp;&emsp;&emsp;&emsp;&emsp;llll = 最大读取字节数</p>
<p>&emsp;&emsp;&emsp;&emsp;&emsp;向 PC 发送的字节：<br>&emsp;&emsp;&emsp;&emsp;&emsp;<strong>xxxxxxxx039Axxxxxxx</strong><br>&emsp;&emsp;&emsp;&emsp;&emsp;<strong>bbbbmmmmttssrrhhppp…</strong></p>
<p>&emsp;&emsp;&emsp;&emsp;&emsp;bbbb = 消息中的字节数<br>&emsp;&emsp;&emsp;&emsp;&emsp;mmmm = 消息计数器<br>&emsp;&emsp;&emsp;&emsp;&emsp;tt = 命令类型<br>&emsp;&emsp;&emsp;&emsp;&emsp;ss = 系统命令<br>&emsp;&emsp;&emsp;&emsp;&emsp;rr = 返回状态<br>&emsp;&emsp;&emsp;&emsp;&emsp;hh = 句柄<br>&emsp;&emsp;&emsp;&emsp;&emsp;ppp… = 载荷</p>
<h3 id="3-3-5-关闭文件句柄"><a href="#3-3-5-关闭文件句柄" class="headerlink" title="3.3.5 关闭文件句柄"></a>3.3.5 关闭文件句柄</h3><p>&emsp;&emsp;&emsp;<strong>CLOSE_FILEHANDLE:</strong><br>&emsp;&emsp;&emsp;&emsp;&emsp;向 brick 发送的字节：<br>&emsp;&emsp;&emsp;&emsp;&emsp;<strong>xxxxxxxx019800xxxxxxxxxxxxxxxx</strong><br>&emsp;&emsp;&emsp;&emsp;&emsp;<strong>bbbbmmmmttsshhpppppppppppppppp</strong></p>
<p>&emsp;&emsp;&emsp;&emsp;&emsp;bbbb = 消息中的字节数<br>&emsp;&emsp;&emsp;&emsp;&emsp;mmmm = 消息计数器<br>&emsp;&emsp;&emsp;&emsp;&emsp;tt = 消息类型<br>&emsp;&emsp;&emsp;&emsp;&emsp;ss = 系统命令<br>&emsp;&emsp;&emsp;&emsp;&emsp;hh = 句柄<br>&emsp;&emsp;&emsp;&emsp;&emsp;ppp… = 哈希</p>
<p>&emsp;&emsp;&emsp;&emsp;&emsp;向 PC 发送的字节：<br>&emsp;&emsp;&emsp;&emsp;&emsp;<strong>0500xxxx039800</strong><br>&emsp;&emsp;&emsp;&emsp;&emsp;<strong>bbbbmmmmttssrr</strong></p>
<p>&emsp;&emsp;&emsp;&emsp;&emsp;bbbb = 消息中的字节数<br>&emsp;&emsp;&emsp;&emsp;&emsp;mmmm = 消息计数器<br>&emsp;&emsp;&emsp;&emsp;&emsp;tt = 消息类型<br>&emsp;&emsp;&emsp;&emsp;&emsp;ss = 系统命令<br>&emsp;&emsp;&emsp;&emsp;&emsp;rr = 返回状态</p>
<h3 id="3-3-6-创建目录"><a href="#3-3-6-创建目录" class="headerlink" title="3.3.6 创建目录"></a>3.3.6 创建目录</h3><p>&emsp;&emsp;&emsp;<strong>CREATE_DIR:</strong><br>&emsp;&emsp;&emsp;&emsp;&emsp;向 brick 发送的字节：<br>&emsp;&emsp;&emsp;&emsp;&emsp;<strong>xxxxxxxx019Bxxxxxx…</strong><br>&emsp;&emsp;&emsp;&emsp;&emsp;<strong>bbbbmmmmttsspppppp…</strong></p>
<p>&emsp;&emsp;&emsp;&emsp;&emsp;bbbb = 消息中的字节数<br>&emsp;&emsp;&emsp;&emsp;&emsp;mmmm = 消息计数器<br>&emsp;&emsp;&emsp;&emsp;&emsp;tt = 消息类型<br>&emsp;&emsp;&emsp;&emsp;&emsp;ss = 系统命令<br>&emsp;&emsp;&emsp;&emsp;&emsp;pp = 以 null 结尾的字符串，其中包含了要创建的目录的完整路径</p>
<p>&emsp;&emsp;&emsp;&emsp;&emsp;向 PC 发送的字节：<br>&emsp;&emsp;&emsp;&emsp;&emsp;<strong>0500xxxx039Bxx</strong><br>&emsp;&emsp;&emsp;&emsp;&emsp;<strong>bbbbmmmmttssrr</strong></p>
<p>&emsp;&emsp;&emsp;&emsp;&emsp;bbbb = 消息中的字节数<br>&emsp;&emsp;&emsp;&emsp;&emsp;mmmm = 消息计数器<br>&emsp;&emsp;&emsp;&emsp;&emsp;tt = 消息类型<br>&emsp;&emsp;&emsp;&emsp;&emsp;ss = 系统命令<br>&emsp;&emsp;&emsp;&emsp;&emsp;rr = 返回状态</p>
<h3 id="3-3-7-删除一个文件"><a href="#3-3-7-删除一个文件" class="headerlink" title="3.3.7 删除一个文件"></a>3.3.7 删除一个文件</h3><p>&emsp;&emsp;&emsp;<strong>DELETE_FILE:</strong><br>&emsp;&emsp;&emsp;&emsp;&emsp;向 brick 发送的字节：<br>&emsp;&emsp;&emsp;&emsp;&emsp;<strong>xxxxxxxx019Cxxxxxx…</strong><br>&emsp;&emsp;&emsp;&emsp;&emsp;<strong>bbbbmmmmttsspppppp…</strong></p>
<p>&emsp;&emsp;&emsp;&emsp;&emsp;bbbb = 消息中的字节数<br>&emsp;&emsp;&emsp;&emsp;&emsp;mmmm = 消息计数器<br>&emsp;&emsp;&emsp;&emsp;&emsp;tt = 消息类型<br>&emsp;&emsp;&emsp;&emsp;&emsp;ss = 系统命令<br>&emsp;&emsp;&emsp;&emsp;&emsp;pp = 以 null 结尾的字符串，其中包含了要删除的文件的完整路径</p>
<p>&emsp;&emsp;&emsp;&emsp;&emsp;向 PC 发送的字节：<br>&emsp;&emsp;&emsp;&emsp;&emsp;<strong>0500xxxx039Cxx</strong><br>&emsp;&emsp;&emsp;&emsp;&emsp;<strong>bbbbmmmmttssrr</strong></p>
<p>&emsp;&emsp;&emsp;&emsp;&emsp;bbbb = 消息中的字节数<br>&emsp;&emsp;&emsp;&emsp;&emsp;mmmm = 消息计数器<br>&emsp;&emsp;&emsp;&emsp;&emsp;tt = 消息类型<br>&emsp;&emsp;&emsp;&emsp;&emsp;ss = 系统命令<br>&emsp;&emsp;&emsp;&emsp;&emsp;rr = 返回状态</p>
<h3 id="3-3-8-获取打开句柄的列表"><a href="#3-3-8-获取打开句柄的列表" class="headerlink" title="3.3.8 获取打开句柄的列表"></a>3.3.8 获取打开句柄的列表</h3><p>&emsp;&emsp;&emsp;<strong>LIST_OPEN_HANDLES:</strong><br>&emsp;&emsp;&emsp;&emsp;&emsp;向 brick 发送的字节：<br>&emsp;&emsp;&emsp;&emsp;&emsp;<strong>xxxxxxxx019D</strong><br>&emsp;&emsp;&emsp;&emsp;&emsp;<strong>bbbbmmmmttss</strong></p>
<p>&emsp;&emsp;&emsp;&emsp;&emsp;bbbb = 消息中的字节数<br>&emsp;&emsp;&emsp;&emsp;&emsp;mmmm = 消息计数器<br>&emsp;&emsp;&emsp;&emsp;&emsp;tt = 消息类型<br>&emsp;&emsp;&emsp;&emsp;&emsp;ss = 系统命令</p>
<p>&emsp;&emsp;&emsp;&emsp;&emsp;向 PC 发送的字节：<br>&emsp;&emsp;&emsp;&emsp;&emsp;<strong>xxxxxxxx039Dxxxxxx….</strong><br>&emsp;&emsp;&emsp;&emsp;&emsp;<strong>bbbbmmmmttssrrpppp….</strong></p>
<p>&emsp;&emsp;&emsp;&emsp;&emsp;bbbb = 消息中的字节数<br>&emsp;&emsp;&emsp;&emsp;&emsp;mmmm = 消息计数器<br>&emsp;&emsp;&emsp;&emsp;&emsp;tt = 消息类型<br>&emsp;&emsp;&emsp;&emsp;&emsp;ss = 系统命令<br>&emsp;&emsp;&emsp;&emsp;&emsp;rr = 返回状态<br>&emsp;&emsp;&emsp;&emsp;&emsp;pppp = 用于指示句柄是否处于 busy 状态的位</p>
<h3 id="3-3-9-写邮箱"><a href="#3-3-9-写邮箱" class="headerlink" title="3.3.9 写邮箱"></a>3.3.9 写邮箱</h3><p>&emsp;&emsp;&emsp;<strong>WRITEMAILBOX:</strong><br>&emsp;&emsp;&emsp;&emsp;&emsp;向另一个 brick 发送的字节：</p>
<p>&emsp;&emsp;&emsp;&emsp;&emsp;邮箱名称必须以 0 结尾，同时名称长度必须是剔除结尾的 0 的字符数！</p>
<p>&emsp;&emsp;&emsp;&emsp;&emsp;<strong>xxxxxxxx819Exxxxxxxxxxxxxxxxxxxx</strong><br>&emsp;&emsp;&emsp;&emsp;&emsp;<strong>bbbbmmmmttssllaaaaa…LLLLppp…</strong></p>
<p>&emsp;&emsp;&emsp;&emsp;&emsp;bbbb = 消息中的字节数<br>&emsp;&emsp;&emsp;&emsp;&emsp;mmmm = 消息计数器<br>&emsp;&emsp;&emsp;&emsp;&emsp;tt = 消息类型<br>&emsp;&emsp;&emsp;&emsp;&emsp;ss = 系统命令<br>&emsp;&emsp;&emsp;&emsp;&emsp;ll = 名称长度<br>&emsp;&emsp;&emsp;&emsp;&emsp;aaa… = 名称<br>&emsp;&emsp;&emsp;&emsp;&emsp;LLLL = 载荷长度<br>&emsp;&emsp;&emsp;&emsp;&emsp;ppp… = 载荷</p>
<p>&emsp;&emsp;&emsp;&emsp;&emsp;从另一个 brick 接收的应答：<br>&emsp;&emsp;&emsp;&emsp;&emsp;无效</p>
<h3 id="3-3-10-设置-Bluetooth-PIN-码"><a href="#3-3-10-设置-Bluetooth-PIN-码" class="headerlink" title="3.3.10 设置 Bluetooth PIN 码"></a>3.3.10 设置 Bluetooth PIN 码</h3><p>&emsp;&emsp;&emsp;<strong>BLUETOOTHPIN:</strong></p>
<p>&emsp;&emsp;&emsp;&emsp;&emsp;出于安全的原因，这个命令只能通过 USB 发送，且应该被格式化为：</p>
<p>&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<em> Bluetooth 地址一定不能包含冒号<br>&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;</em> Bluetooth MAC 地址是 0 结尾的字符串类型<br>&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;* Bluetooth pin 码是 0 结尾的字符串类型</p>
<p>&emsp;&emsp;&emsp;&emsp;&emsp;向 brick 发送的字节：<br>&emsp;&emsp;&emsp;&emsp;&emsp;<strong>0E00xxxx019F06xxxxxxxxxxxx04xxxx</strong><br>&emsp;&emsp;&emsp;&emsp;&emsp;<strong>bbbbmmmmttssllaaaaaaaaaaaaLLpppp</strong></p>
<p>&emsp;&emsp;&emsp;&emsp;&emsp;bbbb = 消息中的字节数<br>&emsp;&emsp;&emsp;&emsp;&emsp;mmmm = 消息计数器<br>&emsp;&emsp;&emsp;&emsp;&emsp;tt = 消息类型<br>&emsp;&emsp;&emsp;&emsp;&emsp;ss = 系统命令<br>&emsp;&emsp;&emsp;&emsp;&emsp;ll = MAC 长度<br>&emsp;&emsp;&emsp;&emsp;&emsp;aaa… = PC 的 MAC 地址<br>&emsp;&emsp;&emsp;&emsp;&emsp;LL = pin 长度<br>&emsp;&emsp;&emsp;&emsp;&emsp;ppp… = pin 码</p>
<p>&emsp;&emsp;&emsp;&emsp;&emsp;向 PC 发送的字节：<br>&emsp;&emsp;&emsp;&emsp;&emsp;<strong>0F00xxxx039Fxx06xxxxxxxxxxxx04xxxx</strong><br>&emsp;&emsp;&emsp;&emsp;&emsp;<strong>bbbbmmmmttssrrllaaaaaaaaaaaaLLpppp</strong></p>
<p>&emsp;&emsp;&emsp;&emsp;&emsp;bbbb = 消息中的字节<br>&emsp;&emsp;&emsp;&emsp;&emsp;mmmm = 消息计数器<br>&emsp;&emsp;&emsp;&emsp;&emsp;tt = 消息类型<br>&emsp;&emsp;&emsp;&emsp;&emsp;ss = 系统命令<br>&emsp;&emsp;&emsp;&emsp;&emsp;rr = 返回状态<br>&emsp;&emsp;&emsp;&emsp;&emsp;ll = MAC 长度<br>&emsp;&emsp;&emsp;&emsp;&emsp;aaa… = PC 的 MAC 地址<br>&emsp;&emsp;&emsp;&emsp;&emsp;LL = pin 长度<br>&emsp;&emsp;&emsp;&emsp;&emsp;ppp… = pin 码</p>
<h3 id="3-3-11-强制-EV3-可编程-brick-进入-Firmware-升级模式"><a href="#3-3-11-强制-EV3-可编程-brick-进入-Firmware-升级模式" class="headerlink" title="3.3.11 强制 EV3 可编程 brick 进入 Firmware 升级模式"></a>3.3.11 强制 EV3 可编程 brick 进入 Firmware 升级模式</h3><p>这个命令用于强制 brick 进入 Firmware 升级模式。这个命令将不发送任何响应回主机。关闭（关机）Linux OS 时，不会更新文件系统。</p>
<p>&emsp;&emsp;&emsp;<strong>ENTERFWUPDATE:</strong></p>
<p>&emsp;&emsp;&emsp;&emsp;&emsp;向 brick 发送的字节：<br>&emsp;&emsp;&emsp;&emsp;&emsp;<strong>0400xxxx81A0</strong><br>&emsp;&emsp;&emsp;&emsp;&emsp;<strong>bbbbmmmmttss</strong></p>
<p>&emsp;&emsp;&emsp;&emsp;&emsp;bbbb = 消息中的字节数<br>&emsp;&emsp;&emsp;&emsp;&emsp;mmmm = 消息计数器<br>&emsp;&emsp;&emsp;&emsp;&emsp;tt = 消息类型<br>&emsp;&emsp;&emsp;&emsp;&emsp;ss = 系统命令</p>
<h1 id="4-直接命令"><a href="#4-直接命令" class="headerlink" title="4. 直接命令"></a>4. 直接命令</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">define</span> DIRECT_COMMAND_REPLY 0x00 <span class="comment">// 直接命令，需要应答</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> DIRECT_COMMAND_NO_REPLY 0x80 <span class="comment">// 直接命令，无需应答</span></span></div></pre></td></tr></table></figure>
<p><strong>直接命令字节：</strong></p>
<p><img src="https://www.wolfcstech.com/images/1315506-abe01a3233a4c289.png" alt=""></p>
<p>字节 0 - 1：命令大小，小尾端。命令大小不包含这 2 个字节<br>字节 2 - 3：消息计数器，小尾端。Forth running counter<br>字节 4：命令类型。参考上面的定义<br>字节 5 - 6：使用压缩格式保留（分配）全局变量和局部变量（在字节 5 和字节 6 的 2 个 lsb 中保留全局变量，在字节 6 的高 6 位中保留本地变量） - 见下文：<br>字节 7 - n：单个命令或复合命令的字节代码（即多个命令组合为一个小程序）</p>
<p>局部的 = “l”， 全局的 = “g”</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">              <span class="keyword">Byte </span><span class="number">6</span>: <span class="keyword">Byte </span><span class="number">5</span>:</div><div class="line">位号:        <span class="number">76543210</span> <span class="number">76543210</span></div><div class="line">变量大小：    <span class="keyword">llllllgg </span>gggggggg</div></pre></td></tr></table></figure>
<p><strong>gg gggggggg</strong> 全局变量保留 0 – (2^10 – 1) 0..1023 字节<br><strong>llllllxx</strong> 局部变量保留 0 – (2^6 – 1) 0….63 字节</p>
<h2 id="4-1-直接应答"><a href="#4-1-直接应答" class="headerlink" title="4.1 直接应答"></a>4.1 直接应答</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">define</span> DIRECT_REPLY 0x02 <span class="comment">// 直接命令应答 OK</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> DIRECT_REPLY_ERROR 0x04 <span class="comment">// 直接命令应答 ERROR</span></span></div></pre></td></tr></table></figure>
<p><strong>直接应答字节：</strong></p>
<p><img src="https://www.wolfcstech.com/images/1315506-14588e96314e7c3c.png" alt=""></p>
<p>字节 0 - 1：应答大小，小尾端。应答大小不包含这 2 个字节<br>字节 2 - 3：消息计数器，小尾端。与直接命令相同<br>字节 4：应答类型。参考上面的定义<br>字节 5 - n：响应缓冲区，即命令为全局变量保留的字节内容。即如果命令保留 64 字节，这些字节将被放在应答包的字节 5 到 68。</p>
<h2 id="4-2-直接命令，通信示例"><a href="#4-2-直接命令，通信示例" class="headerlink" title="4.2 直接命令，通信示例"></a>4.2 直接命令，通信示例</h2><p>下面的直接命令通信的例子将帮助更详细地说明接口。使用的高层的宏说明如下。</p>
<p>更高层的参数编码：</p>
<p>为了使使用参数编码更简单，而使用了 <strong><em>“bytecodes.h”</em></strong> 中定义的一些宏（关于参数编码也可以参考  <em>“LEGO MINDSTORMS EV3 - Firmware Developer Kit”</em> 文档中第 9 页 - <em>3.4 参数编码</em>），所示的范围被编码为有符号数。</p>
<table>
<thead>
<tr>
<th>LCS</th>
<th>Long variable type</th>
<th>Length bytes</th>
<th>STRING zero terminated</th>
</tr>
</thead>
<tbody>
<tr>
<td>LC0(v)</td>
<td>Short constant(value)</td>
<td>single byte</td>
<td>+/- 31</td>
</tr>
<tr>
<td>LC1(v)</td>
<td>Long constant(value)</td>
<td>one byte to follow (2 bytes)</td>
<td>+/- 127</td>
</tr>
<tr>
<td>LC2(v)</td>
<td>Long constant(value)</td>
<td>two bytes to follow (3 bytes)</td>
<td>+/- 32767</td>
</tr>
<tr>
<td>LC4(v)</td>
<td>Long constant(value)</td>
<td>four bytes to follow (5 bytes)</td>
<td>+/- 2147483647</td>
</tr>
<tr>
<td>LV0(i)</td>
<td>Short LOCAL variable(adr)</td>
<td>single byte at adr</td>
<td>+/- 31</td>
</tr>
<tr>
<td>LV1(i)</td>
<td>Long LOCAL variable(adr)</td>
<td>one byte to follow at adr (2 bytes)</td>
<td>+/- 127</td>
</tr>
<tr>
<td>LV2(i)</td>
<td>Long LOCAL variable(adr)</td>
<td>two bytes to follow at adr (3 bytes)</td>
<td>+/- 32767</td>
</tr>
<tr>
<td>LV4(i)</td>
<td>Long LOCAL variable(adr)</td>
<td>four bytes to follow at adr (5 bytes)</td>
<td>+/- 2147483647</td>
</tr>
<tr>
<td>GV0(i)</td>
<td>Short GLOBAL variable(adr)</td>
<td>single byte at adr</td>
<td>+/- 31</td>
</tr>
<tr>
<td>GV0(i)</td>
<td>Long GLOBAL variable(adr)</td>
<td>one byte to follow at adr (2 bytes)</td>
<td>+/- 127</td>
</tr>
<tr>
<td>GV0(i)</td>
<td>Long GLOBAL variable(adr)</td>
<td>two bytes to follow at adr (3 bytes)</td>
<td>+/- 32767</td>
</tr>
<tr>
<td>GV0(i)</td>
<td>Long GLOBAL variable(adr)</td>
<td>four bytes to follow at adr (5 bytes)</td>
<td>+/- 2147483647</td>
</tr>
</tbody>
</table>
<h3 id="4-2-1-在-EV3-brick-上启动程序-“Demo”"><a href="#4-2-1-在-EV3-brick-上启动程序-“Demo”" class="headerlink" title="4.2.1 在 EV3 brick 上启动程序 “Demo”"></a>4.2.1 在 EV3 brick 上启动程序 “Demo”</h3><p>加载并运行一个应用字节码文件。这个示例也展示了复合的直接命令 - 即在一个单独的包中的两个或更多直接命令。这里我们加载字节码镜像：<strong><em>“../prjs/BrkProg_SAVE/Demo.rpf”</em></strong> 进 slot 1 - 用户 slot。后面紧接着是启动slot 1 中的程序的命令。记住这是一个组合命令，且不能交错。<strong>备注：</strong> 文件扩展名是 “rpf” 而<strong>不是</strong> “rbf”。文件是内建的 “on-brick program file”。</p>
<p>向 brick 发送的字节：</p>
<p><strong>opFILE,LC0(LOAD_IMAGE),LC2(USER<em>SLOT),LCS,’.’,’.’,’/‘,’p’,’r’,’j’,’s’,’/‘,<br>‘B’,’r’,’k’,’P’,’r’,’o’,’g’,<br>‘</em>‘,’S’,’A’,’V’,’E’/‘,’D’,’e’,’m’,’o’,’.’,’r’,’p’,’f’,0,GV0(0),GV0(4),opPROGRAM_START,<br>LC0(USER_SLOT),GV0(0),GV0(4),LC0(0)</strong></p>
<table>
<thead>
<tr>
<th>指令</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>opFILE</td>
<td>文件有关的操作码</td>
</tr>
<tr>
<td>LC0(LOAD_IMAGE)</td>
<td>命令被编码为单字节常数</td>
</tr>
<tr>
<td>LC2(USER_SLOT)</td>
<td>用户 slot（1 = 程序 slot）被编码为单个常量字节</td>
</tr>
<tr>
<td>LCS</td>
<td>编码：后面是字符串（以 0 结尾）</td>
</tr>
<tr>
<td>“../prjs/BrkProg_SAVE/Demo.rpf”</td>
<td>文件路径和名称。“..” 是 “从当前目录移到上一级目录”</td>
</tr>
<tr>
<td>0x00</td>
<td>上面的字符串的结尾 0</td>
</tr>
<tr>
<td>GV0(0)</td>
<td>在全局变量偏移 0 处返回镜像大小。偏移量被编码为单个字节。</td>
</tr>
<tr>
<td>GV0(4)</td>
<td>在全局变量偏移 4 处返回镜像地址。偏移量被编码为单个字节。</td>
</tr>
<tr>
<td>opPROGRAM_START</td>
<td>操作码</td>
</tr>
<tr>
<td>LC0(USER_SLOT)</td>
<td>用户 slot（1 = 程序 slot）被编码为单个字节常量</td>
</tr>
<tr>
<td>GV0(0)</td>
<td>镜像大小位于全局变量偏移 0 处。</td>
</tr>
<tr>
<td>GV0(4)</td>
<td>镜像地址位于全局变量偏移 4 处。</td>
</tr>
<tr>
<td>LC0(0)</td>
<td>调试模式（0 = 普通）被编码为单个字节常量</td>
</tr>
</tbody>
</table>
<p><strong>30000000800800C008820100842E2E2F70726A732F42726B50726F675F534156452F44656D6F2E7270660060640301606400<br>bbbbmmmmtthhhhccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccCCCCCCCCCC</strong></p>
<p>bbbb = 消息中的字节数为 48，不包含包长度字节<br>mmmm = 消息计数器<br>tt = 命令类型 - 直接命令无需应答<br>hhhh = 头部 – 变量分配。<br>cc/CC = 字节码<br>hhhh = 10 个最低有效位是全局变量的个数，6 个最高有效位是局部变量的</p>
<h3 id="4-2-2-以电源-50-向前启动电动机-B＆C-3-转，并在目的地制动"><a href="#4-2-2-以电源-50-向前启动电动机-B＆C-3-转，并在目的地制动" class="headerlink" title="4.2.2 以电源 50 向前启动电动机 B＆C 3 转，并在目的地制动"></a>4.2.2 以电源 50 向前启动电动机 B＆C 3 转，并在目的地制动</h3><p>这个例子使用了特殊的 OUTPUT_STEP_SPEED 电动机命令。这个命令在电动机列表中为电动机设置了速度（(setpoint)）。命令包含加速和减速部分。特别是减速对于更精确地到达最终目的地非常有用。电动机在 3 转（3 * 360 度）结束后制动。</p>
<p><strong>opOUTPUT_STEP_SPEED,LC0(LAYER_0),LC0(MOTOR_A + MOTOR_B),LC1(SPEED_50),LC0(0),LC2(900),LC2(180),LC0(BRAKE)</strong></p>
<table>
<thead>
<tr>
<th>指令</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>opOUTPUT_STEP_SPEED</td>
<td>操作码</td>
</tr>
<tr>
<td>LC0(0)</td>
<td>Layer 0 - 被编码为单个字节常量</td>
</tr>
<tr>
<td>LC0(MOTOR_A + MOTOR_B)</td>
<td>电动机 B &amp; C （电动机列表）被编码为单个字节常量</td>
</tr>
<tr>
<td>LC1(SPEED_50)</td>
<td>速度 50% 被编码为单个字节常量</td>
</tr>
<tr>
<td>LC0(0)</td>
<td>没有 STEP1，即从开始全速 - 编码为单个字节常量</td>
</tr>
<tr>
<td>LC2(900)</td>
<td>2.5 周（900 度） STEP2 - 被编码为两个字节</td>
</tr>
<tr>
<td>LC2(180)</td>
<td>0.5 周（180 度） STEP3 为了更精确的到达目的地 -  被编码为两个字节</td>
</tr>
<tr>
<td>LC0(BRAKE)</td>
<td>制动（1）- 被编码为单个字节常量</td>
</tr>
</tbody>
</table>
<p>向 brick 发送的字节：</p>
<p><strong>1200xxxx800000AE000681320082840382B40001<br>Bbbbmmmmtthhhhcccccccccccccccccccccccccc</strong></p>
<p>bbbb = 消息中的字节数为 21，不包含包长度字节<br>mmmm = 消息计数器<br>tt = 命令类型 - 直接命令无需应答<br>hhhh = 头部 – 变量分配。<br>cc/CC = 字节码<br>hhhh = 10 个最低有效位是全局变量的个数，6 个最高有效位是局部变量的</p>
<h3 id="4-2-3-读取传感器端口-3-上的光传感器值"><a href="#4-2-3-读取传感器端口-3-上的光传感器值" class="headerlink" title="4.2.3 读取传感器端口 3 上的光传感器值"></a>4.2.3 读取传感器端口 3 上的光传感器值</h3><p>这个直接命令将读取连接在 brick 的输入端口 3 上的光传感器。模式被显式地设为模式 0（零）即光传感器（0 – 100 pct.）的本地模式 0。返回值是一个32 位 float，编码为 SI 0-100 pct。</p>
<p>默认的 32 位浮点数（SI 0-100 pct）。</p>
<p><strong>opINPUT_DEVICE,LC0(READY_SI),LC0(LAYER_0),LC0(SENSOR_PORT_3),LC0(DO_NOT_CHANGE_TYPE),LC0(MODE_0),LC0(ONE_DATA_SET),LCO(GLOBAL_VAR_INDEX0)</strong></p>
<table>
<thead>
<tr>
<th>指令</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>opINPUT_DEVICE</td>
<td>输入相关的操作码</td>
</tr>
<tr>
<td>LC0(READY_SI)</td>
<td>命令（READY_SI）被编码为单个字节常量</td>
</tr>
<tr>
<td>LC0(LAYER_0)</td>
<td>Layer number (0 = 这个特定 brick) 被编码为单个字节常量</td>
</tr>
<tr>
<td>LC0(SENSOR_PORT_3)</td>
<td>连接到端口 3 （(1-4 / 0-3 内部的）上的传感器被编码为单个字节常量</td>
</tr>
<tr>
<td>LC0(DO_NOT_CHANGE_TYPE)</td>
<td>如果设置为 0 （零） - 不改变类型 - 被编码为单个字节常量</td>
</tr>
<tr>
<td>LC0(MODE_0)</td>
<td>模式 0 - 被编码为单个字节常量</td>
</tr>
<tr>
<td>LC0(ONE_DATA _SET)</td>
<td>数据集的个数（模式 0 只有 1 个（pct））- 被编码为单个字节常量</td>
</tr>
<tr>
<td>LC0(GLOBAL_VAR_INDEX0)</td>
<td>把返回值放在全局变量的索引 0 （零）处 - 被编码为单个字节常量</td>
</tr>
</tbody>
</table>
<p>向 brick 发送的字节：</p>
<p><strong>0D00xxxx000400991D000200000160<br>BbbbmmmmtthhhhCCCCCCCCCCCCCCCC</strong></p>
<p>bbbb = 消息中的字节数为 13，不包含包长度字节<br>mmmm = 消息计数器<br>tt = 命令类型 - 直接命令需要应答<br>hhhh = 头部 – 变量分配。这 4 个字节在全局变量中保留<br>CC/cc/CC/cc = 字节码<br>hhhh = 10 个最低有效位是全局变量的个数，6 个最高有效位是局部变量的</p>
<h3 id="4-2-4-读取连接到端口-1-的光传感器为-COLOR"><a href="#4-2-4-读取连接到端口-1-的光传感器为-COLOR" class="headerlink" title="4.2.4 读取连接到端口 1 的光传感器为 COLOR"></a>4.2.4 读取连接到端口 1 的光传感器为 COLOR</h3><p>这个直接命令将读取连接在 brick 的输入端口 1 上的光传感器。模式被显式地设为模式 2 “COLOR 模式”。传感器将返回一个 0 - 8（包含）之间的值，即传感器前的物体的颜色。返回值是 32 位浮点数，编码为 0-8。</p>
<p><strong>opINPUT_DEVICE,LC0(READY_SI),LC0(LAYER_0),LC0(SENSOR_PORT_1),LC0(DO_NOT_CHANGE_TYPE),LC0(MODE_2),LC0(ONE_DATA_SET),LCO(GLOBAL_VAR_INDEX0)</strong></p>
<table>
<thead>
<tr>
<th>指令</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>opINPUT_DEVICE</td>
<td>输入相关的操作码</td>
</tr>
<tr>
<td>LC0(READY_SI)</td>
<td>命令（READY_SI）被编码为单个字节常量</td>
</tr>
<tr>
<td>LC0(LAYER_0)</td>
<td>Layer number (0 = 这个特定 brick) 被编码为单个字节常量</td>
</tr>
<tr>
<td>LC0(SENSOR_PORT_1)</td>
<td>连接到端口 1 （(1-4 / 0-3 内部的）上的传感器被编码为单个字节常量</td>
</tr>
<tr>
<td>LC0(DO_NOT_CHANGE_TYPE)</td>
<td>如果设置为 0 （零） - 不改变类型 - 被编码为单个字节常量</td>
</tr>
<tr>
<td>LC0(MODE_2)</td>
<td>模式 2 - 被编码为单个字节常量</td>
</tr>
<tr>
<td>LC0(ONE_DATA _SET)</td>
<td>数据集的个数（模式 0 只有 1 个（pct））- 被编码为单个字节常量</td>
</tr>
<tr>
<td>LC0(GLOBAL_VAR_INDEX0)</td>
<td>把返回值放在全局变量的索引 0 （零）处 - 被编码为单个字节常量</td>
</tr>
</tbody>
</table>
<p>向 brick 发送的字节：</p>
<p><strong>0D00xxxx000400991D000000020160<br>BbbbmmmmtthhhhCCCCCCCCCCCCCCCC</strong></p>
<p>bbbb = 消息中的字节数为 13，不包含包长度字节<br>mmmm = 消息计数器<br>tt = 命令类型 - 直接命令需要应答<br>hhhh = 头部 – 变量分配。这 1 个字节在全局变量中保留<br>CC/cc/CC/cc = 字节码<br>hhhh = 10 个最低有效位是全局变量的个数，6 个最高有效位是局部变量的</p>
<h3 id="4-2-5-在-level-2-播放-1-Kz-音调-1-秒"><a href="#4-2-5-在-level-2-播放-1-Kz-音调-1-秒" class="headerlink" title="4.2.5 在 level 2 播放 1 Kz 音调 1 秒"></a>4.2.5 在 level 2 播放 1 Kz 音调 1 秒</h3><p><strong>opSOUND,LC0(TONE),LC1(2),LC2(1000),LC2(1000)</strong></p>
<table>
<thead>
<tr>
<th>指令</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>opSOUND</td>
<td>声音相关的操作码</td>
</tr>
<tr>
<td>LC0(TONE)</td>
<td>命令（TONE）被编码为单个字节常量</td>
</tr>
<tr>
<td>LC1(2)</td>
<td>声音 leve2 被编码为 1 个常量字节</td>
</tr>
<tr>
<td>LC2(1000)</td>
<td>频率 1000 Hz 被编码为 2 个常量字节</td>
</tr>
<tr>
<td>LC2(1000)</td>
<td>持续时长 1000 ms 被编码为 2 个常量字节</td>
</tr>
</tbody>
</table>
<p>向 brick 发送的字节：</p>
<p><strong>0F00xxxx8000009401810282E80382E803<br>Bbbbmmmmtthhhhcccccccccccccccccccc</strong></p>
<p>bbbb = 消息中的字节数为 15，不包含包长度字节<br>mmmm = 消息计数器<br>tt = 命令类型 - 直接命令无需应答<br>hhhh = 头部 – 变量分配。<br>cc/CC = 字节码<br>hhhh = 10 个最低有效位是全局变量的个数，6 个最高有效位是局部变量的</p>
<h3 id="4-2-6-在屏幕上展示一幅图片"><a href="#4-2-6-在屏幕上展示一幅图片" class="headerlink" title="4.2.6 在屏幕上展示一幅图片"></a>4.2.6 在屏幕上展示一幅图片</h3><p>清除屏幕，并在屏幕上的坐标 (x = 0, y= 50) 处绘制 bmp 图片 “mindstorms.rgf”。首先屏幕由 FILLWINDOW 子命令清除，然后 bmp 图片文件由子命令 BMPFILE 加载。在 UPDATE 子命令发出之前屏幕上什么都不会发送。</p>
<p><strong>opUI_DRAW,LC0(FILLWINDOW),LC0(BG_COLOR),LC2(0),LC2(0),opUI_DRAW,LC0(BMPFILE),LCO(FG_COLOR),LC2(0),LC2(50),LCS,’u’,’i’,’/‘,’m’,’i’,’n’,’d’, ‘s’,’t’,’o’,’r’,’m’,’s’,’.’,’r’,’g’,’f’,0,opUI_DRAW,LC0(UPDATE)</strong></p>
<table>
<thead>
<tr>
<th>指令</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>opUI_DRAW</td>
<td>绘制相关的操作码</td>
</tr>
<tr>
<td>LC0(FILLWINDOW)</td>
<td>命令（FILLWINDOW）被编码为单个字节常量</td>
</tr>
<tr>
<td>LC0(BG_COLOR)</td>
<td>颜色设置背景颜色 - 即清除屏幕被编码为单个字节常量</td>
</tr>
<tr>
<td>LC2(0)</td>
<td>起始 y（0 表示整个屏幕）被编码为单个字节常量</td>
</tr>
<tr>
<td>LC2(0)</td>
<td>结束 y（0 表示整个屏幕）被编码为单个字节常量</td>
</tr>
<tr>
<td>opUI_DRAW</td>
<td>绘制相关的操作码</td>
</tr>
<tr>
<td>LC0(BMPFILE)</td>
<td>命令（BMPFILE）被编码为单个字节常量</td>
</tr>
<tr>
<td>LC0(FG_COLOR)</td>
<td>颜色设置前景颜色被编码为单个字节常量</td>
</tr>
<tr>
<td>LC2(50)</td>
<td>起始 y 坐标 50 被编码为 2 个字节</td>
</tr>
<tr>
<td>LC2(0)</td>
<td>起始 x 坐标 0 被编码为 2 个字节</td>
</tr>
<tr>
<td>LCS</td>
<td>编码：字符串（以 0 结尾）</td>
</tr>
<tr>
<td>“ui/mindstorms.rgf”</td>
<td>文件路径和名称</td>
</tr>
<tr>
<td>0</td>
<td>字符串的 0 结尾</td>
</tr>
<tr>
<td>opUI_DRAW</td>
<td>绘制相关的操作码</td>
</tr>
<tr>
<td>LC0(UPDATE)</td>
<td>命令（UPDATE）“执行所有的图形操作” 被编码为单个字节常量</td>
</tr>
</tbody>
</table>
<p>向 brick 发送的字节：</p>
<p><strong>2C000000800000841300820000820000841C018200008232008475692F6D696E6473746F726D732E726766008400<br>BbbbmmmmtthhhhCCCCCCCCCCCCCCCCCCccccccccccccccccccccccccccccccccccccccccccccccccccccccccCCCC</strong></p>
<p>bbbb = 消息中的字节数为 44，不包含包长度字节<br>mmmm = 消息计数器<br>tt = 命令类型 - 直接命令无需应答<br>hhhh = 头部 – 变量分配。<br>CC/cc/CC/cc = 字节码</p>
<p>hhhh = 10 个最低有效位是全局变量的个数，6 个最高有效位是局部变量的</p>
<p><a href="https://www.lego.com/r/www/r/mindstorms/-/media/franchises/mindstorms%202014/downloads/firmware%20and%20software/advanced/lego%20mindstorms%20ev3%20communication%20developer%20kit.pdf?l.r2=1239680513" target="_blank" rel="external">原文</a></p>

      
    </div>
    
    
    

    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>坚持原创技术分享，您的支持将鼓励我继续创作！</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>打赏</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/wxpay.png" alt="Han Pengfei 微信支付"/>
        <p>微信支付</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/images/alipay.jpg" alt="Han Pengfei 支付宝"/>
        <p>支付宝</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/翻译/" rel="tag"># 翻译</a>
          
            <a href="/tags/ROS/" rel="tag"># ROS</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/10/25/lego_execute_vscode_python/" rel="next" title="LEGO EV3 中执行 VSCode Python 代码过程分析">
                <i class="fa fa-chevron-left"></i> LEGO EV3 中执行 VSCode Python 代码过程分析
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/10/29/lego_ev3_direct_command_001/" rel="prev" title="EV3 直接命令 - 第一课 无为的艺术">
                EV3 直接命令 - 第一课 无为的艺术 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          

  
    <div class="comments" id="comments">
    </div>
  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/freesoft.jpg"
                alt="Han Pengfei" />
            
              <p class="site-author-name" itemprop="name">Han Pengfei</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">207</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">19</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">30</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  <a href="https://github.com/hanpfei" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i>GitHub</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="https://www.douban.com/people/3681478/" target="_blank" title="豆瓣"><i class="fa fa-fw fa-globe"></i>豆瓣</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="https://www.zhihu.com/people/han-peng-fei-49" target="_blank" title="知乎"><i class="fa fa-fw fa-globe"></i>知乎</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="mailto:hanpfei@gmail.com" target="_blank" title="E-Mail"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  
                </span>
              
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://developer.android.com/index.html" title="Android Developers" target="_blank">Android Developers</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://source.android.com/" title="Android Open Source Project" target="_blank">Android Open Source Project</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.vants.org/" title="蚂蚁网" target="_blank">蚂蚁网</a>
                  </li>
                
              </ul>
            </div>
          

          
            
          
          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#1-MINDSTORMS-EV3-可编程-brick-的硬件规格"><span class="nav-number">1.</span> <span class="nav-text">1 MINDSTORMS EV3 可编程 brick 的硬件规格</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-通信接口"><span class="nav-number">2.</span> <span class="nav-text">2 通信接口</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-系统命令"><span class="nav-number">3.</span> <span class="nav-text">3 系统命令</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#3-1-系统命令应答"><span class="nav-number">3.1.</span> <span class="nav-text">3.1 系统命令应答</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-2-向-EV3-可编程-brick-下载数据"><span class="nav-number">3.2.</span> <span class="nav-text">3.2 向 EV3 可编程 brick 下载数据</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-1-文件下载"><span class="nav-number">3.2.1.</span> <span class="nav-text">3.2.1 文件下载</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-2-文件上传（文件读取）"><span class="nav-number">3.2.2.</span> <span class="nav-text">3.2.2 文件上传（文件读取）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-3-目录上传"><span class="nav-number">3.2.3.</span> <span class="nav-text">3.2.3 目录上传</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-3-系统命令，通信例子"><span class="nav-number">3.3.</span> <span class="nav-text">3.3 系统命令，通信例子</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-1-文件下载"><span class="nav-number">3.3.1.</span> <span class="nav-text">3.3.1 文件下载</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-2-文件上传"><span class="nav-number">3.3.2.</span> <span class="nav-text">3.3.2 文件上传</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-3-获取文件内容"><span class="nav-number">3.3.3.</span> <span class="nav-text">3.3.3 获取文件内容</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-4-列出文件和目录"><span class="nav-number">3.3.4.</span> <span class="nav-text">3.3.4 列出文件和目录</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-5-关闭文件句柄"><span class="nav-number">3.3.5.</span> <span class="nav-text">3.3.5 关闭文件句柄</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-6-创建目录"><span class="nav-number">3.3.6.</span> <span class="nav-text">3.3.6 创建目录</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-7-删除一个文件"><span class="nav-number">3.3.7.</span> <span class="nav-text">3.3.7 删除一个文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-8-获取打开句柄的列表"><span class="nav-number">3.3.8.</span> <span class="nav-text">3.3.8 获取打开句柄的列表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-9-写邮箱"><span class="nav-number">3.3.9.</span> <span class="nav-text">3.3.9 写邮箱</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-10-设置-Bluetooth-PIN-码"><span class="nav-number">3.3.10.</span> <span class="nav-text">3.3.10 设置 Bluetooth PIN 码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-11-强制-EV3-可编程-brick-进入-Firmware-升级模式"><span class="nav-number">3.3.11.</span> <span class="nav-text">3.3.11 强制 EV3 可编程 brick 进入 Firmware 升级模式</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4-直接命令"><span class="nav-number">4.</span> <span class="nav-text">4. 直接命令</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#4-1-直接应答"><span class="nav-number">4.1.</span> <span class="nav-text">4.1 直接应答</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-2-直接命令，通信示例"><span class="nav-number">4.2.</span> <span class="nav-text">4.2 直接命令，通信示例</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-1-在-EV3-brick-上启动程序-“Demo”"><span class="nav-number">4.2.1.</span> <span class="nav-text">4.2.1 在 EV3 brick 上启动程序 “Demo”</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-2-以电源-50-向前启动电动机-B＆C-3-转，并在目的地制动"><span class="nav-number">4.2.2.</span> <span class="nav-text">4.2.2 以电源 50 向前启动电动机 B＆C 3 转，并在目的地制动</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-3-读取传感器端口-3-上的光传感器值"><span class="nav-number">4.2.3.</span> <span class="nav-text">4.2.3 读取传感器端口 3 上的光传感器值</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-4-读取连接到端口-1-的光传感器为-COLOR"><span class="nav-number">4.2.4.</span> <span class="nav-text">4.2.4 读取连接到端口 1 的光传感器为 COLOR</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-5-在-level-2-播放-1-Kz-音调-1-秒"><span class="nav-number">4.2.5.</span> <span class="nav-text">4.2.5 在 level 2 播放 1 Kz 音调 1 秒</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-6-在屏幕上展示一幅图片"><span class="nav-number">4.2.6.</span> <span class="nav-text">4.2.6 在屏幕上展示一幅图片</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2016.09.16 &mdash; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Han Pengfei</span>

  

  
</div>




  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/theme-next/hexo-theme-next">NexT.Mist</a> v6.0.3</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.0.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.0.3"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.0.3"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.0.3"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.0.3"></script>



  



	





  





  









<script src="//cdn1.lncld.net/static/js/3.11.1/av-min.js"></script>



<script src="//unpkg.com/valine/dist/Valine.min.js"></script>

<script>
  var GUEST = ['nick', 'mail', 'link'];
  var guest = 'nick,mail,link';
  guest = guest.split(',').filter(function(item) {
    return GUEST.indexOf(item) > -1;
  });
  new Valine({
    el: '#comments',
    verify: false,
    notify: false,
    appId: 's9sbM9ODdusCzKcm5JcIj6t8-gzGzoHsz',
    appKey: 'UoO9ia1DLNwOXRUsTBQ6QXxm',
    placeholder: 'ヾﾉ≧∀≦)o来啊，快活啊!',
    avatar: 'mm',
    meta: guest,
    pageSize: '10' || 10,
    visitor: true,
    lang: '' || 'zh-cn'
  });
</script>


  





  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  

  
  

  

  

  

  

</body>
</html>
