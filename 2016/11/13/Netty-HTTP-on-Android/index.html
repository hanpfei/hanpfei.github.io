<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>Netty HTTP on Android | WolfcsTech</title><link rel="stylesheet" type="text/css" href="//fonts.css.network/css?family=Source+Code+Pro"><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.2.0"><link rel="stylesheet" type="text/css" href="/css/highlight.css?v=1.2.0"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Netty HTTP on Android</h1><a id="logo" href="/.">WolfcsTech</a><p class="description"></p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">Netty HTTP on Android</h1><div class="post-meta">Nov 13, 2016<span> | </span><span class="category"><a href="/categories/Android开发/">Android开发</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a data-disqus-identifier="2016/11/13/Netty-HTTP-on-Android/" href="/2016/11/13/Netty-HTTP-on-Android/#disqus_thread" class="disqus-comment-count"></a><div class="post-content"><p>Netty是一个NIO的客户端服务器框架，它使我们可以快速而简单地开发网络应用程序，比如协议服务器和客户端。它大大简化了网络编程，比如TCP和UDP socket服务器。</p>
<a id="more"></a>
<p>“快速而简单”并不意味着开发出来的应用可维护性或性能不好。Netty已经实现了大量的协议，比如FTP，SMTP，HTTP，以及各种基于二进制和文本的传统协议。可以说Netty已经找到了一种方法来实现简单的开发，高性能，稳定性，灵活性而不需要做妥协。</p>
<p>Netty的结构大体如下图这样：</p>
<p><img src="https://www.wolfcstech.com/images/1315506-317c8abe3082b0bb.png" alt="Netty Structure"></p>
<p>就设计而言，Netty给不同的传输类型，不管是阻塞的还是非阻塞的，提供了统一的接口。它基于一个灵活的和可扩展的事件模型，这使得处理不同逻辑的部分可以有效的隔离开来。它具有高度可定制的线程模型 - 单线程，一个或多个线程池，比如SEDA。它还提供无连接的datagram socket支持。</p>
<p>如Netty这般，功能如此强大，性能如此优良的网络库，不用在Android上真是可惜了。这里我们就尝试将Netty用在Android上。</p>
<h1 id="下载Netty"><a href="#下载Netty" class="headerlink" title="下载Netty"></a>下载Netty</h1><p>首先是下载Netty。<a href="http://netty.io/" target="_blank" rel="external">Netty的官网地址</a>，我们可以在这里找到下载Netty的地址，当然还有许许多多的文档。这里使用了当前4.1.x最新版的Netty 4.1.4，下载地址：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">http:<span class="regexp">//</span>dl.bintray.com<span class="regexp">/netty/</span>downloads<span class="regexp">/netty-4.1.4.Final.tar.bz2</span></div></pre></td></tr></table></figure>
<p>解压之后，为了省事，直接将netty-4.1.4.Final/jar/all-in-one/下的netty-all-4.1.4.Final.jar拷贝进了工程下app module的libs目录下。</p>
<h1 id="Netty的简单使用"><a href="#Netty的简单使用" class="headerlink" title="Netty的简单使用"></a>Netty的简单使用</h1><p>不出意外，直接通过编译。接着我们就参考<code>netty/example/src/main/java/io/netty/example/http/snoop</code>中client部分的代码，将Netty用起来，这主要有如下几个类：<br><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> io.netty.example.http.snoop;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.net.URI;</div><div class="line"><span class="keyword">import</span> java.net.URISyntaxException;</div><div class="line"></div><div class="line"><span class="keyword">import</span> javax.net.ssl.SSLException;</div><div class="line"></div><div class="line"><span class="keyword">import</span> io.netty.bootstrap.Bootstrap;</div><div class="line"><span class="keyword">import</span> io.netty.channel.Channel;</div><div class="line"><span class="keyword">import</span> io.netty.channel.EventLoopGroup;</div><div class="line"><span class="keyword">import</span> io.netty.channel.nio.NioEventLoopGroup;</div><div class="line"><span class="keyword">import</span> io.netty.channel.socket.nio.NioSocketChannel;</div><div class="line"><span class="keyword">import</span> io.netty.<span class="keyword">handler</span>.codec.http.DefaultFullHttpRequest;</div><div class="line"><span class="keyword">import</span> io.netty.<span class="keyword">handler</span>.codec.http.HttpHeaderNames;</div><div class="line"><span class="keyword">import</span> io.netty.<span class="keyword">handler</span>.codec.http.HttpHeaderValues;</div><div class="line"><span class="keyword">import</span> io.netty.<span class="keyword">handler</span>.codec.http.HttpMethod;</div><div class="line"><span class="keyword">import</span> io.netty.<span class="keyword">handler</span>.codec.http.HttpVersion;</div><div class="line"><span class="keyword">import</span> io.netty.<span class="keyword">handler</span>.ssl.SslContext;</div><div class="line"><span class="keyword">import</span> io.netty.<span class="keyword">handler</span>.ssl.SslContextBuilder;</div><div class="line"><span class="keyword">import</span> io.netty.<span class="keyword">handler</span>.ssl.util.InsecureTrustManagerFactory;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HttpClient</span> </span>&#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"NettyClient"</span>;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">void</span> <span class="title">getResponse</span><span class="params">(<span class="keyword">final</span> String url)</span> </span>&#123;</div><div class="line">        <span class="keyword">new</span> Thread() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">                <span class="keyword">try</span> &#123;</div><div class="line">                    URI uri = <span class="keyword">new</span> URI(url);</div><div class="line">                    String scheme = uri.getScheme() == <span class="keyword">null</span> ? <span class="string">"http"</span> : uri.getScheme();</div><div class="line">                    String host = uri.getHost();</div><div class="line">                    <span class="keyword">int</span> port = uri.getPort();</div><div class="line"></div><div class="line">                    <span class="keyword">if</span> (port == <span class="number">-1</span>) &#123;</div><div class="line">                        <span class="keyword">if</span> (<span class="string">"http"</span>.equalsIgnoreCase(scheme)) &#123;</div><div class="line">                            port = <span class="number">80</span>;</div><div class="line">                        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">"https"</span>.equalsIgnoreCase(scheme)) &#123;</div><div class="line">                            port = <span class="number">443</span>;</div><div class="line">                        &#125;</div><div class="line">                    &#125;</div><div class="line">                    <span class="keyword">if</span> (!<span class="string">"http"</span>.equalsIgnoreCase(scheme) &amp;&amp; !<span class="string">"https"</span>.equalsIgnoreCase(scheme)) &#123;</div><div class="line">                        System.err.println(<span class="string">"Only HTTP(S) is supported."</span>);</div><div class="line">                        <span class="keyword">return</span>;</div><div class="line">                    &#125;</div><div class="line"></div><div class="line">                    <span class="keyword">final</span> <span class="keyword">boolean</span> ssl = <span class="string">"https"</span>.equalsIgnoreCase(scheme);</div><div class="line">                    <span class="keyword">final</span> SslContext sslCtx;</div><div class="line">                    <span class="keyword">if</span> (ssl) &#123;</div><div class="line">                        sslCtx = SslContextBuilder.forClient().trustManager(InsecureTrustManagerFactory.INSTANCE).build();</div><div class="line">                    &#125; <span class="keyword">else</span> &#123;</div><div class="line">                        sslCtx = <span class="keyword">null</span>;</div><div class="line">                    &#125;</div><div class="line"></div><div class="line">                    EventLoopGroup group = <span class="keyword">new</span> NioEventLoopGroup();</div><div class="line">                    <span class="keyword">try</span> &#123;</div><div class="line">                        Bootstrap bootstrap = <span class="keyword">new</span> Bootstrap();</div><div class="line">                        bootstrap.group(group).channel(NioSocketChannel.class)</div><div class="line">                                .<span class="keyword">handler</span>(<span class="keyword">new</span> HttpClientInitializer(sslCtx));</div><div class="line"></div><div class="line">                        <span class="comment">// Make the connection attempt.</span></div><div class="line">                        Channel channel = bootstrap.connect(host, port).sync().channel();</div><div class="line"></div><div class="line">                        <span class="comment">// Prepare the HTTP request.</span></div><div class="line">                        DefaultFullHttpRequest request = <span class="keyword">new</span> DefaultFullHttpRequest(HttpVersion.HTTP_1_1,</div><div class="line">                                HttpMethod.GET, url);</div><div class="line">                        request.headers().set(HttpHeaderNames.HOST, host);</div><div class="line">                        request.headers().set(HttpHeaderNames.CONNECTION, HttpHeaderNames.KEEP_ALIVE);</div><div class="line">                        request.headers().set(HttpHeaderNames.ACCEPT_ENCODING, HttpHeaderValues.GZIP);</div><div class="line"></div><div class="line">                        <span class="comment">// Send the HTTP request.</span></div><div class="line">                        channel.writeAndFlush(request);</div><div class="line"></div><div class="line">                        <span class="comment">// Wait for the server to close the connection.</span></div><div class="line">                        channel.closeFuture().sync();</div><div class="line">                    &#125; <span class="keyword">finally</span> &#123;</div><div class="line">                        group.shutdownGracefully();</div><div class="line">                    &#125;</div><div class="line">                &#125; <span class="keyword">catch</span> (URISyntaxException e) &#123;</div><div class="line">                &#125; <span class="keyword">catch</span> (SSLException e) &#123;</div><div class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;.start();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这个class提供给外部调用的接口。使用者可以传入URL，将借由这个类，通过Netty来访问网络并获取响应。然后来看HttpClientInitializer：<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> io.netty.example.http.snoop;</div><div class="line"></div><div class="line"><span class="keyword">import</span> io.netty.channel.<span class="type">ChannelInitializer</span>;</div><div class="line"><span class="keyword">import</span> io.netty.channel.<span class="type">ChannelPipeline</span>;</div><div class="line"><span class="keyword">import</span> io.netty.channel.socket.<span class="type">SocketChannel</span>;</div><div class="line"><span class="keyword">import</span> io.netty.handler.codec.http.<span class="type">HttpClientCodec</span>;</div><div class="line"><span class="keyword">import</span> io.netty.handler.codec.http.<span class="type">HttpContentDecompressor</span>;</div><div class="line"><span class="keyword">import</span> io.netty.handler.ssl.<span class="type">SslContext</span>;</div><div class="line"></div><div class="line">public <span class="class"><span class="keyword">class</span> <span class="title">HttpClientInitializer</span> <span class="keyword">extends</span> <span class="title">ChannelInitializer&lt;SocketChannel&gt;</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">SslContext</span> sslCtx;</div><div class="line"></div><div class="line">    public <span class="type">HttpClientInitializer</span>(<span class="type">SslContext</span> sslCtx) &#123;</div><div class="line">        <span class="keyword">this</span>.sslCtx = sslCtx;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    public void initChannel(<span class="type">SocketChannel</span> ch) &#123;</div><div class="line">        <span class="type">ChannelPipeline</span> p = ch.pipeline();</div><div class="line"></div><div class="line">        <span class="comment">// Enable HTTPS if necessary.</span></div><div class="line">        <span class="keyword">if</span> (sslCtx != <span class="literal">null</span>) &#123;</div><div class="line">            p.addLast(sslCtx.newHandler(ch.alloc()));</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        p.addLast(<span class="keyword">new</span> <span class="type">HttpClientCodec</span>());</div><div class="line"></div><div class="line">        <span class="comment">// Remove the following line if you don't want automatic content decompression.</span></div><div class="line">        p.addLast(<span class="keyword">new</span> <span class="type">HttpContentDecompressor</span>());</div><div class="line"></div><div class="line">        <span class="comment">// Uncomment the following line if you don't want to handle HttpContents.</span></div><div class="line">        <span class="comment">//p.addLast(new HttpObjectAggregator(1048576));</span></div><div class="line"></div><div class="line">        p.addLast(<span class="keyword">new</span> <span class="type">HttpClientHandler</span>());</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这个class负责对Channel的Pipeline进行初始化，这其中最关键的是HttpClientHandler：<br><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> io.netty.example.http.snoop;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.util.Log;</div><div class="line"></div><div class="line"><span class="keyword">import</span> io.netty.channel.ChannelHandlerContext;</div><div class="line"><span class="keyword">import</span> io.netty.channel.SimpleChannelInboundHandler;</div><div class="line"><span class="keyword">import</span> io.netty.<span class="keyword">handler</span>.codec.http.HttpContent;</div><div class="line"><span class="keyword">import</span> io.netty.<span class="keyword">handler</span>.codec.http.HttpObject;</div><div class="line"><span class="keyword">import</span> io.netty.<span class="keyword">handler</span>.codec.http.HttpResponse;</div><div class="line"><span class="keyword">import</span> io.netty.<span class="keyword">handler</span>.codec.http.LastHttpContent;</div><div class="line"><span class="keyword">import</span> io.netty.util.CharsetUtil;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HttpClientHandler</span> <span class="keyword">extends</span> <span class="title">SimpleChannelInboundHandler</span>&lt;<span class="title">HttpObject</span>&gt; </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">channelRead0</span><span class="params">(ChannelHandlerContext ctx, HttpObject msg)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (msg <span class="keyword">instanceof</span> HttpResponse) &#123;</div><div class="line">            HttpResponse response = (HttpResponse) msg;</div><div class="line"></div><div class="line">            Log.i(HttpClient.TAG, <span class="string">"STATUS: "</span> + response.status());</div><div class="line">            Log.i(HttpClient.TAG, <span class="string">"VERSION: "</span> + response.protocolVersion());</div><div class="line"></div><div class="line">            <span class="keyword">if</span> (!response.headers().isEmpty()) &#123;</div><div class="line">                <span class="keyword">for</span> (CharSequence name: response.headers().names()) &#123;</div><div class="line">                    <span class="keyword">for</span> (CharSequence value: response.headers().getAll(name)) &#123;</div><div class="line">                        Log.i(HttpClient.TAG, <span class="string">"HEADER: "</span> + name + <span class="string">" = "</span> + value);</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (msg <span class="keyword">instanceof</span> HttpContent) &#123;</div><div class="line">            HttpContent content = (HttpContent) msg;</div><div class="line">            String responseContent = content.content().toString(CharsetUtil.UTF_8);</div><div class="line">            Log.i(HttpClient.TAG, responseContent);</div><div class="line"></div><div class="line">            <span class="keyword">if</span> (content <span class="keyword">instanceof</span> LastHttpContent) &#123;</div><div class="line">                ctx.close();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">exceptionCaught</span><span class="params">(ChannelHandlerContext ctx, Throwable cause)</span> </span>&#123;</div><div class="line">        cause.printStackTrace();</div><div class="line">        ctx.close();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>我们正是通过实现HttpClientHandler，而获取到Netty返回给我们的响应的。</p>
<p>在我们的Android应用代码中调用<code>HttpClient</code>来通过Netty从网络获取响应：<br><figure class="highlight scala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> io.netty.example.http.snoop;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.support.v7.app.<span class="type">AppCompatActivity</span>;</div><div class="line"><span class="keyword">import</span> android.os.<span class="type">Bundle</span>;</div><div class="line"><span class="keyword">import</span> android.util.<span class="type">Log</span>;</div><div class="line"><span class="keyword">import</span> android.view.<span class="type">View</span>;</div><div class="line"><span class="keyword">import</span> android.widget.<span class="type">Button</span>;</div><div class="line"><span class="keyword">import</span> android.widget.<span class="type">TextView</span>;</div><div class="line"></div><div class="line">public <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> static <span class="keyword">final</span> <span class="type">String</span> <span class="type">TAG</span> = <span class="string">"MainActivity"</span>;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="type">TextView</span> mTextScreen;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">protected</span> void onCreate(<span class="type">Bundle</span> savedInstanceState) &#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(<span class="type">R</span>.layout.activity_main);</div><div class="line"></div><div class="line">        <span class="type">Button</span> btnGetIpInfo = (<span class="type">Button</span>) findViewById(<span class="type">R</span>.id.btn_get_ip_info_with_netty);</div><div class="line">        btnGetIpInfo.setOnClickListener(mBtnClickListener);</div><div class="line"></div><div class="line">        mTextScreen = (<span class="type">TextView</span>) findViewById(<span class="type">R</span>.id.text_screen);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="type">View</span>.<span class="type">OnClickListener</span> mBtnClickListener = <span class="keyword">new</span> <span class="type">View</span>.<span class="type">OnClickListener</span>() &#123;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        public void onClick(<span class="type">View</span> v) &#123;</div><div class="line">            <span class="type">String</span> url = <span class="string">"http://ip.taobao.com/service/getIpInfo.php?ip=123.58.191.68"</span>;</div><div class="line">            mTextScreen.setText(<span class="string">"To access "</span> + url);</div><div class="line">            <span class="type">Log</span>.i(<span class="type">TAG</span>, <span class="string">"To access "</span> + url);</div><div class="line">            <span class="keyword">if</span> (<span class="type">R</span>.id.btn_get_ip_info_with_netty == v.getId()) &#123;</div><div class="line">                <span class="type">HttpClient</span>.getResponse(url);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>当然不能忘记了在AndroidManifest.xml中添加对INTERNET权限的请求：<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;uses-permission android:<span class="built_in">name</span>=<span class="string">"android.permission.INTERNET"</span>/&gt;</div></pre></td></tr></table></figure></p>
<p>做完了所有这些之后，Netty基本上就可以跑起来了。不过意外还是发生了：<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="number">08</span>-<span class="number">10</span> <span class="number">10</span>:<span class="number">13</span>:<span class="number">33.670</span> <span class="number">17720</span>-<span class="number">17720</span>/io<span class="selector-class">.netty</span><span class="selector-class">.example</span><span class="selector-class">.http</span><span class="selector-class">.snoop6</span><span class="selector-class">.myapplication</span> I/MainActivity: To access http:<span class="comment">//ip.taobao.com/service/getIpInfo.php?ip=123.58.191.68</span></div><div class="line"><span class="number">08</span>-<span class="number">10</span> <span class="number">10</span>:<span class="number">13</span>:<span class="number">33.818</span> <span class="number">17720</span>-<span class="number">18708</span>/io<span class="selector-class">.netty</span><span class="selector-class">.example</span><span class="selector-class">.http</span><span class="selector-class">.snoop6</span><span class="selector-class">.myapplication</span> W/System<span class="selector-class">.err</span>: java<span class="selector-class">.lang</span><span class="selector-class">.NoClassDefFoundError</span>: com<span class="selector-class">.jcraft</span><span class="selector-class">.jzlib</span><span class="selector-class">.Inflater</span></div><div class="line"><span class="number">08</span>-<span class="number">10</span> <span class="number">10</span>:<span class="number">13</span>:<span class="number">33.818</span> <span class="number">17720</span>-<span class="number">18708</span>/io<span class="selector-class">.netty</span><span class="selector-class">.example</span><span class="selector-class">.http</span><span class="selector-class">.snoop6</span><span class="selector-class">.myapplication</span> W/System<span class="selector-class">.err</span>:     at io<span class="selector-class">.netty</span><span class="selector-class">.handler</span><span class="selector-class">.codec</span><span class="selector-class">.compression</span><span class="selector-class">.JZlibDecoder</span>.&lt;init&gt;(JZlibDecoder<span class="selector-class">.java</span>:<span class="number">27</span>)</div><div class="line"><span class="number">08</span>-<span class="number">10</span> <span class="number">10</span>:<span class="number">13</span>:<span class="number">33.826</span> <span class="number">17720</span>-<span class="number">18708</span>/io<span class="selector-class">.netty</span><span class="selector-class">.example</span><span class="selector-class">.http</span><span class="selector-class">.snoop6</span><span class="selector-class">.myapplication</span> W/System<span class="selector-class">.err</span>:     at io<span class="selector-class">.netty</span><span class="selector-class">.handler</span><span class="selector-class">.codec</span><span class="selector-class">.compression</span><span class="selector-class">.ZlibCodecFactory</span><span class="selector-class">.newZlibDecoder</span>(ZlibCodecFactory<span class="selector-class">.java</span>:<span class="number">122</span>)</div><div class="line"><span class="number">08</span>-<span class="number">10</span> <span class="number">10</span>:<span class="number">13</span>:<span class="number">33.826</span> <span class="number">17720</span>-<span class="number">18708</span>/io<span class="selector-class">.netty</span><span class="selector-class">.example</span><span class="selector-class">.http</span><span class="selector-class">.snoop6</span><span class="selector-class">.myapplication</span> W/System<span class="selector-class">.err</span>:     at io<span class="selector-class">.netty</span><span class="selector-class">.handler</span><span class="selector-class">.codec</span><span class="selector-class">.http</span><span class="selector-class">.HttpContentDecompressor</span><span class="selector-class">.newContentDecoder</span>(HttpContentDecompressor<span class="selector-class">.java</span>:<span class="number">57</span>)</div><div class="line"><span class="number">08</span>-<span class="number">10</span> <span class="number">10</span>:<span class="number">13</span>:<span class="number">33.826</span> <span class="number">17720</span>-<span class="number">18708</span>/io<span class="selector-class">.netty</span><span class="selector-class">.example</span><span class="selector-class">.http</span><span class="selector-class">.snoop6</span><span class="selector-class">.myapplication</span> W/System<span class="selector-class">.err</span>:     at io<span class="selector-class">.netty</span><span class="selector-class">.handler</span><span class="selector-class">.codec</span><span class="selector-class">.http</span><span class="selector-class">.HttpContentDecoder</span><span class="selector-class">.decode</span>(HttpContentDecoder<span class="selector-class">.java</span>:<span class="number">87</span>)</div><div class="line"><span class="number">08</span>-<span class="number">10</span> <span class="number">10</span>:<span class="number">13</span>:<span class="number">33.826</span> <span class="number">17720</span>-<span class="number">18708</span>/io<span class="selector-class">.netty</span><span class="selector-class">.example</span><span class="selector-class">.http</span><span class="selector-class">.snoop6</span><span class="selector-class">.myapplication</span> W/System<span class="selector-class">.err</span>:     at io<span class="selector-class">.netty</span><span class="selector-class">.handler</span><span class="selector-class">.codec</span><span class="selector-class">.http</span><span class="selector-class">.HttpContentDecoder</span><span class="selector-class">.decode</span>(HttpContentDecoder<span class="selector-class">.java</span>:<span class="number">46</span>)</div><div class="line"><span class="number">08</span>-<span class="number">10</span> <span class="number">10</span>:<span class="number">13</span>:<span class="number">33.826</span> <span class="number">17720</span>-<span class="number">18708</span>/io<span class="selector-class">.netty</span><span class="selector-class">.example</span><span class="selector-class">.http</span><span class="selector-class">.snoop6</span><span class="selector-class">.myapplication</span> W/System<span class="selector-class">.err</span>:     at io<span class="selector-class">.netty</span><span class="selector-class">.handler</span><span class="selector-class">.codec</span><span class="selector-class">.MessageToMessageDecoder</span><span class="selector-class">.channelRead</span>(MessageToMessageDecoder<span class="selector-class">.java</span>:<span class="number">88</span>)</div><div class="line"><span class="number">08</span>-<span class="number">10</span> <span class="number">10</span>:<span class="number">13</span>:<span class="number">33.826</span> <span class="number">17720</span>-<span class="number">18708</span>/io<span class="selector-class">.netty</span><span class="selector-class">.example</span><span class="selector-class">.http</span><span class="selector-class">.snoop6</span><span class="selector-class">.myapplication</span> W/System<span class="selector-class">.err</span>:     at io<span class="selector-class">.netty</span><span class="selector-class">.channel</span><span class="selector-class">.AbstractChannelHandlerContext</span><span class="selector-class">.invokeChannelRead</span>(AbstractChannelHandlerContext<span class="selector-class">.java</span>:<span class="number">372</span>)</div><div class="line"><span class="number">08</span>-<span class="number">10</span> <span class="number">10</span>:<span class="number">13</span>:<span class="number">33.826</span> <span class="number">17720</span>-<span class="number">18708</span>/io<span class="selector-class">.netty</span><span class="selector-class">.example</span><span class="selector-class">.http</span><span class="selector-class">.snoop6</span><span class="selector-class">.myapplication</span> W/System<span class="selector-class">.err</span>:     at io<span class="selector-class">.netty</span><span class="selector-class">.channel</span><span class="selector-class">.AbstractChannelHandlerContext</span><span class="selector-class">.invokeChannelRead</span>(AbstractChannelHandlerContext<span class="selector-class">.java</span>:<span class="number">358</span>)</div><div class="line"><span class="number">08</span>-<span class="number">10</span> <span class="number">10</span>:<span class="number">13</span>:<span class="number">33.826</span> <span class="number">17720</span>-<span class="number">18708</span>/io<span class="selector-class">.netty</span><span class="selector-class">.example</span><span class="selector-class">.http</span><span class="selector-class">.snoop6</span><span class="selector-class">.myapplication</span> W/System<span class="selector-class">.err</span>:     at io<span class="selector-class">.netty</span><span class="selector-class">.channel</span><span class="selector-class">.AbstractChannelHandlerContext</span><span class="selector-class">.fireChannelRead</span>(AbstractChannelHandlerContext<span class="selector-class">.java</span>:<span class="number">350</span>)</div><div class="line"><span class="number">08</span>-<span class="number">10</span> <span class="number">10</span>:<span class="number">13</span>:<span class="number">33.826</span> <span class="number">17720</span>-<span class="number">18708</span>/io<span class="selector-class">.netty</span><span class="selector-class">.example</span><span class="selector-class">.http</span><span class="selector-class">.snoop6</span><span class="selector-class">.myapplication</span> W/System<span class="selector-class">.err</span>:     at io<span class="selector-class">.netty</span><span class="selector-class">.channel</span><span class="selector-class">.CombinedChannelDuplexHandler</span><span class="variable">$DelegatingChannelHandlerContext</span>.fireChannelRead(CombinedChannelDuplexHandler<span class="selector-class">.java</span>:<span class="number">435</span>)</div><div class="line"><span class="number">08</span>-<span class="number">10</span> <span class="number">10</span>:<span class="number">13</span>:<span class="number">33.826</span> <span class="number">17720</span>-<span class="number">18708</span>/io<span class="selector-class">.netty</span><span class="selector-class">.example</span><span class="selector-class">.http</span><span class="selector-class">.snoop6</span><span class="selector-class">.myapplication</span> W/System<span class="selector-class">.err</span>:     at io<span class="selector-class">.netty</span><span class="selector-class">.handler</span><span class="selector-class">.codec</span><span class="selector-class">.ByteToMessageDecoder</span><span class="selector-class">.fireChannelRead</span>(ByteToMessageDecoder<span class="selector-class">.java</span>:<span class="number">293</span>)</div><div class="line"><span class="number">08</span>-<span class="number">10</span> <span class="number">10</span>:<span class="number">13</span>:<span class="number">33.826</span> <span class="number">17720</span>-<span class="number">18708</span>/io<span class="selector-class">.netty</span><span class="selector-class">.example</span><span class="selector-class">.http</span><span class="selector-class">.snoop6</span><span class="selector-class">.myapplication</span> W/System<span class="selector-class">.err</span>:     at io<span class="selector-class">.netty</span><span class="selector-class">.handler</span><span class="selector-class">.codec</span><span class="selector-class">.ByteToMessageDecoder</span><span class="selector-class">.fireChannelRead</span>(ByteToMessageDecoder<span class="selector-class">.java</span>:<span class="number">280</span>)</div><div class="line"><span class="number">08</span>-<span class="number">10</span> <span class="number">10</span>:<span class="number">13</span>:<span class="number">33.826</span> <span class="number">17720</span>-<span class="number">18708</span>/io<span class="selector-class">.netty</span><span class="selector-class">.example</span><span class="selector-class">.http</span><span class="selector-class">.snoop6</span><span class="selector-class">.myapplication</span> W/System<span class="selector-class">.err</span>:     at io<span class="selector-class">.netty</span><span class="selector-class">.handler</span><span class="selector-class">.codec</span><span class="selector-class">.ByteToMessageDecoder</span><span class="selector-class">.callDecode</span>(ByteToMessageDecoder<span class="selector-class">.java</span>:<span class="number">396</span>)</div><div class="line"><span class="number">08</span>-<span class="number">10</span> <span class="number">10</span>:<span class="number">13</span>:<span class="number">33.826</span> <span class="number">17720</span>-<span class="number">18708</span>/io<span class="selector-class">.netty</span><span class="selector-class">.example</span><span class="selector-class">.http</span><span class="selector-class">.snoop6</span><span class="selector-class">.myapplication</span> W/System<span class="selector-class">.err</span>:     at io<span class="selector-class">.netty</span><span class="selector-class">.handler</span><span class="selector-class">.codec</span><span class="selector-class">.ByteToMessageDecoder</span><span class="selector-class">.channelRead</span>(ByteToMessageDecoder<span class="selector-class">.java</span>:<span class="number">248</span>)</div><div class="line"><span class="number">08</span>-<span class="number">10</span> <span class="number">10</span>:<span class="number">13</span>:<span class="number">33.826</span> <span class="number">17720</span>-<span class="number">18708</span>/io<span class="selector-class">.netty</span><span class="selector-class">.example</span><span class="selector-class">.http</span><span class="selector-class">.snoop6</span><span class="selector-class">.myapplication</span> W/System<span class="selector-class">.err</span>:     at io<span class="selector-class">.netty</span><span class="selector-class">.channel</span><span class="selector-class">.CombinedChannelDuplexHandler</span><span class="selector-class">.channelRead</span>(CombinedChannelDuplexHandler<span class="selector-class">.java</span>:<span class="number">250</span>)</div><div class="line"><span class="number">08</span>-<span class="number">10</span> <span class="number">10</span>:<span class="number">13</span>:<span class="number">33.834</span> <span class="number">17720</span>-<span class="number">18708</span>/io<span class="selector-class">.netty</span><span class="selector-class">.example</span><span class="selector-class">.http</span><span class="selector-class">.snoop6</span><span class="selector-class">.myapplication</span> W/System<span class="selector-class">.err</span>:     at io<span class="selector-class">.netty</span><span class="selector-class">.channel</span><span class="selector-class">.AbstractChannelHandlerContext</span><span class="selector-class">.invokeChannelRead</span>(AbstractChannelHandlerContext<span class="selector-class">.java</span>:<span class="number">372</span>)</div><div class="line"><span class="number">08</span>-<span class="number">10</span> <span class="number">10</span>:<span class="number">13</span>:<span class="number">33.834</span> <span class="number">17720</span>-<span class="number">18708</span>/io<span class="selector-class">.netty</span><span class="selector-class">.example</span><span class="selector-class">.http</span><span class="selector-class">.snoop6</span><span class="selector-class">.myapplication</span> W/System<span class="selector-class">.err</span>:     at io<span class="selector-class">.netty</span><span class="selector-class">.channel</span><span class="selector-class">.AbstractChannelHandlerContext</span><span class="selector-class">.invokeChannelRead</span>(AbstractChannelHandlerContext<span class="selector-class">.java</span>:<span class="number">358</span>)</div><div class="line"><span class="number">08</span>-<span class="number">10</span> <span class="number">10</span>:<span class="number">13</span>:<span class="number">33.834</span> <span class="number">17720</span>-<span class="number">18708</span>/io<span class="selector-class">.netty</span><span class="selector-class">.example</span><span class="selector-class">.http</span><span class="selector-class">.snoop6</span><span class="selector-class">.myapplication</span> W/System<span class="selector-class">.err</span>:     at io<span class="selector-class">.netty</span><span class="selector-class">.channel</span><span class="selector-class">.AbstractChannelHandlerContext</span><span class="selector-class">.fireChannelRead</span>(AbstractChannelHandlerContext<span class="selector-class">.java</span>:<span class="number">350</span>)</div><div class="line"><span class="number">08</span>-<span class="number">10</span> <span class="number">10</span>:<span class="number">13</span>:<span class="number">33.834</span> <span class="number">17720</span>-<span class="number">18708</span>/io<span class="selector-class">.netty</span><span class="selector-class">.example</span><span class="selector-class">.http</span><span class="selector-class">.snoop6</span><span class="selector-class">.myapplication</span> W/System<span class="selector-class">.err</span>:     at io<span class="selector-class">.netty</span><span class="selector-class">.channel</span><span class="selector-class">.DefaultChannelPipeline</span><span class="variable">$HeadContext</span>.channelRead(DefaultChannelPipeline<span class="selector-class">.java</span>:<span class="number">1334</span>)</div><div class="line"><span class="number">08</span>-<span class="number">10</span> <span class="number">10</span>:<span class="number">13</span>:<span class="number">33.834</span> <span class="number">17720</span>-<span class="number">18708</span>/io<span class="selector-class">.netty</span><span class="selector-class">.example</span><span class="selector-class">.http</span><span class="selector-class">.snoop6</span><span class="selector-class">.myapplication</span> W/System<span class="selector-class">.err</span>:     at io<span class="selector-class">.netty</span><span class="selector-class">.channel</span><span class="selector-class">.AbstractChannelHandlerContext</span><span class="selector-class">.invokeChannelRead</span>(AbstractChannelHandlerContext<span class="selector-class">.java</span>:<span class="number">372</span>)</div><div class="line"><span class="number">08</span>-<span class="number">10</span> <span class="number">10</span>:<span class="number">13</span>:<span class="number">33.834</span> <span class="number">17720</span>-<span class="number">18708</span>/io<span class="selector-class">.netty</span><span class="selector-class">.example</span><span class="selector-class">.http</span><span class="selector-class">.snoop6</span><span class="selector-class">.myapplication</span> W/System<span class="selector-class">.err</span>:     at io<span class="selector-class">.netty</span><span class="selector-class">.channel</span><span class="selector-class">.AbstractChannelHandlerContext</span><span class="selector-class">.invokeChannelRead</span>(AbstractChannelHandlerContext<span class="selector-class">.java</span>:<span class="number">358</span>)</div><div class="line"><span class="number">08</span>-<span class="number">10</span> <span class="number">10</span>:<span class="number">13</span>:<span class="number">33.834</span> <span class="number">17720</span>-<span class="number">18708</span>/io<span class="selector-class">.netty</span><span class="selector-class">.example</span><span class="selector-class">.http</span><span class="selector-class">.snoop6</span><span class="selector-class">.myapplication</span> W/System<span class="selector-class">.err</span>:     at io<span class="selector-class">.netty</span><span class="selector-class">.channel</span><span class="selector-class">.DefaultChannelPipeline</span><span class="selector-class">.fireChannelRead</span>(DefaultChannelPipeline<span class="selector-class">.java</span>:<span class="number">926</span>)</div><div class="line"><span class="number">08</span>-<span class="number">10</span> <span class="number">10</span>:<span class="number">13</span>:<span class="number">33.834</span> <span class="number">17720</span>-<span class="number">18708</span>/io<span class="selector-class">.netty</span><span class="selector-class">.example</span><span class="selector-class">.http</span><span class="selector-class">.snoop6</span><span class="selector-class">.myapplication</span> W/System<span class="selector-class">.err</span>:     at io<span class="selector-class">.netty</span><span class="selector-class">.channel</span><span class="selector-class">.nio</span><span class="selector-class">.AbstractNioByteChannel</span><span class="variable">$NioByteUnsafe</span>.read(AbstractNioByteChannel<span class="selector-class">.java</span>:<span class="number">129</span>)</div><div class="line"><span class="number">08</span>-<span class="number">10</span> <span class="number">10</span>:<span class="number">13</span>:<span class="number">33.834</span> <span class="number">17720</span>-<span class="number">18708</span>/io<span class="selector-class">.netty</span><span class="selector-class">.example</span><span class="selector-class">.http</span><span class="selector-class">.snoop6</span><span class="selector-class">.myapplication</span> W/System<span class="selector-class">.err</span>:     at io<span class="selector-class">.netty</span><span class="selector-class">.channel</span><span class="selector-class">.nio</span><span class="selector-class">.NioEventLoop</span><span class="selector-class">.processSelectedKey</span>(NioEventLoop<span class="selector-class">.java</span>:<span class="number">571</span>)</div><div class="line"><span class="number">08</span>-<span class="number">10</span> <span class="number">10</span>:<span class="number">13</span>:<span class="number">33.834</span> <span class="number">17720</span>-<span class="number">18708</span>/io<span class="selector-class">.netty</span><span class="selector-class">.example</span><span class="selector-class">.http</span><span class="selector-class">.snoop6</span><span class="selector-class">.myapplication</span> W/System<span class="selector-class">.err</span>:     at io<span class="selector-class">.netty</span><span class="selector-class">.channel</span><span class="selector-class">.nio</span><span class="selector-class">.NioEventLoop</span><span class="selector-class">.processSelectedKeysPlain</span>(NioEventLoop<span class="selector-class">.java</span>:<span class="number">474</span>)</div><div class="line"><span class="number">08</span>-<span class="number">10</span> <span class="number">10</span>:<span class="number">13</span>:<span class="number">33.834</span> <span class="number">17720</span>-<span class="number">18708</span>/io<span class="selector-class">.netty</span><span class="selector-class">.example</span><span class="selector-class">.http</span><span class="selector-class">.snoop6</span><span class="selector-class">.myapplication</span> W/System<span class="selector-class">.err</span>:     at io<span class="selector-class">.netty</span><span class="selector-class">.channel</span><span class="selector-class">.nio</span><span class="selector-class">.NioEventLoop</span><span class="selector-class">.processSelectedKeys</span>(NioEventLoop<span class="selector-class">.java</span>:<span class="number">428</span>)</div><div class="line"><span class="number">08</span>-<span class="number">10</span> <span class="number">10</span>:<span class="number">13</span>:<span class="number">33.834</span> <span class="number">17720</span>-<span class="number">18708</span>/io<span class="selector-class">.netty</span><span class="selector-class">.example</span><span class="selector-class">.http</span><span class="selector-class">.snoop6</span><span class="selector-class">.myapplication</span> W/System<span class="selector-class">.err</span>:     at io<span class="selector-class">.netty</span><span class="selector-class">.channel</span><span class="selector-class">.nio</span><span class="selector-class">.NioEventLoop</span><span class="selector-class">.run</span>(NioEventLoop<span class="selector-class">.java</span>:<span class="number">398</span>)</div><div class="line"><span class="number">08</span>-<span class="number">10</span> <span class="number">10</span>:<span class="number">13</span>:<span class="number">33.834</span> <span class="number">17720</span>-<span class="number">18708</span>/io<span class="selector-class">.netty</span><span class="selector-class">.example</span><span class="selector-class">.http</span><span class="selector-class">.snoop6</span><span class="selector-class">.myapplication</span> W/System<span class="selector-class">.err</span>:     at io<span class="selector-class">.netty</span><span class="selector-class">.util</span><span class="selector-class">.concurrent</span><span class="selector-class">.SingleThreadEventExecutor</span>$<span class="number">5</span>.run(SingleThreadEventExecutor<span class="selector-class">.java</span>:<span class="number">877</span>)</div><div class="line"><span class="number">08</span>-<span class="number">10</span> <span class="number">10</span>:<span class="number">13</span>:<span class="number">33.841</span> <span class="number">17720</span>-<span class="number">18708</span>/io<span class="selector-class">.netty</span><span class="selector-class">.example</span><span class="selector-class">.http</span><span class="selector-class">.snoop6</span><span class="selector-class">.myapplication</span> W/System<span class="selector-class">.err</span>:     at io<span class="selector-class">.netty</span><span class="selector-class">.util</span><span class="selector-class">.concurrent</span><span class="selector-class">.DefaultThreadFactory</span><span class="variable">$DefaultRunnableDecorator</span>.run(DefaultThreadFactory<span class="selector-class">.java</span>:<span class="number">144</span>)</div><div class="line"><span class="number">08</span>-<span class="number">10</span> <span class="number">10</span>:<span class="number">13</span>:<span class="number">33.841</span> <span class="number">17720</span>-<span class="number">18708</span>/io<span class="selector-class">.netty</span><span class="selector-class">.example</span><span class="selector-class">.http</span><span class="selector-class">.snoop6</span><span class="selector-class">.myapplication</span> W/System<span class="selector-class">.err</span>:     at java<span class="selector-class">.lang</span><span class="selector-class">.Thread</span><span class="selector-class">.run</span>(Thread<span class="selector-class">.java</span>:<span class="number">841</span>)</div><div class="line"><span class="number">08</span>-<span class="number">10</span> <span class="number">10</span>:<span class="number">13</span>:<span class="number">33.841</span> <span class="number">17720</span>-<span class="number">18708</span>/io<span class="selector-class">.netty</span><span class="selector-class">.example</span><span class="selector-class">.http</span><span class="selector-class">.snoop6</span><span class="selector-class">.myapplication</span> I/NettyClient: --------- beginning of /dev/log/system</div><div class="line"><span class="number">08</span>-<span class="number">10</span> <span class="number">10</span>:<span class="number">35</span>:<span class="number">02.162</span> <span class="number">17720</span>-<span class="number">17720</span>/io<span class="selector-class">.netty</span><span class="selector-class">.example</span><span class="selector-class">.http</span><span class="selector-class">.snoop6</span><span class="selector-class">.myapplication</span> I/Timeline: Timeline: Activity_idle id: android<span class="selector-class">.os</span><span class="selector-class">.BinderProxy</span>@<span class="number">41</span>c10f28 <span class="selector-tag">time</span>:<span class="number">1282964865</span></div></pre></td></tr></table></figure></p>
<p>有一个class <code>com.jcraft.jzlib.Inflater</code>找不到。这还需要添加对jzlib的依赖：<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">compile</span> <span class="string">'com.jcraft:jzlib:1.1.2'</span></div></pre></td></tr></table></figure></p>
<p>至此顺利地将Netty跑起来：<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="attr">"code"</span>:<span class="number">0</span>,</div><div class="line">    <span class="attr">"data"</span>:&#123;</div><div class="line">        <span class="attr">"country"</span>:<span class="string">"中国"</span>,</div><div class="line">        <span class="attr">"country_id"</span>:<span class="string">"CN"</span>,</div><div class="line">        <span class="attr">"area"</span>:<span class="string">"华东"</span>,</div><div class="line">        <span class="attr">"area_id"</span>:<span class="string">"300000"</span>,</div><div class="line">        <span class="attr">"region"</span>:<span class="string">"浙江省"</span>,</div><div class="line">        <span class="attr">"region_id"</span>:<span class="string">"330000"</span>,</div><div class="line">        <span class="attr">"city"</span>:<span class="string">"杭州市"</span>,</div><div class="line">        <span class="attr">"city_id"</span>:<span class="string">"330100"</span>,</div><div class="line">        <span class="attr">"county"</span>:<span class="string">""</span>,</div><div class="line">        <span class="attr">"county_id"</span>:<span class="string">"-1"</span>,</div><div class="line">        <span class="attr">"isp"</span>:<span class="string">"网易网络"</span>,</div><div class="line">        <span class="attr">"isp_id"</span>:<span class="string">"1000119"</span>,</div><div class="line">        <span class="attr">"ip"</span>:<span class="string">"123.58.191.68"</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h1 id="Netty的裁剪"><a href="#Netty的裁剪" class="headerlink" title="Netty的裁剪"></a>Netty的裁剪</h1><p>Netty很强大，all-in-one jar用起来很方便，这很不错。但all-in-one jar有点大，其中包含的一些诸如对memcache，redis，stomp，sctp和udt等的支持，我们在移动端并不会用掉。因而需要对它做一点裁剪。</p>
<p>既然不能用all-in-one包，那就把需要的几个jar文件单独copy进我们的工程好了。对于android而言，目测netty-4.1.4.Final/jar/下我们需要拷贝的jar文件主要有下面这些：<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">netty-codec-4</span><span class="selector-class">.1</span><span class="selector-class">.4</span><span class="selector-class">.Final</span><span class="selector-class">.jar</span></div><div class="line"><span class="selector-tag">netty-codec-http-4</span><span class="selector-class">.1</span><span class="selector-class">.4</span><span class="selector-class">.Final</span><span class="selector-class">.jar</span></div><div class="line"><span class="selector-tag">netty-codec-http2-4</span><span class="selector-class">.1</span><span class="selector-class">.4</span><span class="selector-class">.Final</span><span class="selector-class">.jar</span></div><div class="line"><span class="selector-tag">netty-codec-socks-4</span><span class="selector-class">.1</span><span class="selector-class">.4</span><span class="selector-class">.Final</span><span class="selector-class">.jar</span></div><div class="line"><span class="selector-tag">netty-common-4</span><span class="selector-class">.1</span><span class="selector-class">.4</span><span class="selector-class">.Final</span><span class="selector-class">.jar</span></div><div class="line"><span class="selector-tag">netty-handler-4</span><span class="selector-class">.1</span><span class="selector-class">.4</span><span class="selector-class">.Final</span><span class="selector-class">.jar</span></div><div class="line"><span class="selector-tag">netty-transport-4</span><span class="selector-class">.1</span><span class="selector-class">.4</span><span class="selector-class">.Final</span><span class="selector-class">.jar</span></div></pre></td></tr></table></figure></p>
<p>用这些文件来替换之前的netty-all-4.1.4.Final.jar。遇到了编译错误：<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">:<span class="string">app:</span>compileDebugJavaWithJavac</div><div class="line">Full recompilation is required because at least one of the classes of removed jar <span class="string">'netty-all-4.1.4.Final.jar'</span> requires it. Analysis took <span class="number">0.364</span> secs.</div><div class="line"><span class="regexp">/media/</span>data<span class="regexp">/MyProjects/</span>MyApplication<span class="regexp">/app/</span>src<span class="regexp">/main/</span>java<span class="regexp">/io/</span>netty<span class="regexp">/example/</span>http<span class="regexp">/snoop/</span>myapplication/HttpClient.<span class="string">java:</span><span class="number">67</span>: 错误: 无法访问ByteBufHolder</div><div class="line">                        request.headers().set(HttpHeaderNames.HOST, host);</div><div class="line">                               ^</div><div class="line">  找不到io.netty.buffer.ByteBufHolder的类文件</div><div class="line"><span class="regexp">/media/</span>data<span class="regexp">/MyProjects/</span>MyApplication<span class="regexp">/app/</span>src<span class="regexp">/main/</span>java<span class="regexp">/io/</span>netty<span class="regexp">/example/</span>http<span class="regexp">/snoop/</span>myapplication/HttpClientInitializer.<span class="string">java:</span><span class="number">39</span>: 错误: 无法访问ByteBufAllocator</div><div class="line">            p.addLast(sslCtx.newHandler(ch.alloc()));</div><div class="line">                                                ^</div><div class="line">  找不到io.netty.buffer.ByteBufAllocator的类文件</div><div class="line"><span class="regexp">/media/</span>data<span class="regexp">/MyProjects/</span>MyApplication<span class="regexp">/app/</span>src<span class="regexp">/main/</span>java<span class="regexp">/io/</span>netty<span class="regexp">/example/</span>http<span class="regexp">/snoop/</span>myapplication/HttpClientHandler.<span class="string">java:</span><span class="number">48</span>: 错误: 找不到符号</div><div class="line">            String responseContent = content.content().toString(CharsetUtil.UTF_8);</div><div class="line">                                            ^</div><div class="line">  符号:   方法 content()</div><div class="line">  位置: 类型为HttpContent的变量 content</div><div class="line">注: <span class="regexp">/media/</span>data<span class="regexp">/MyProjects/</span>MyApplication<span class="regexp">/app/</span>src<span class="regexp">/main/</span>java<span class="regexp">/io/</span>netty<span class="regexp">/example/</span>http<span class="regexp">/snoop/</span>myapplication/HttpClient.java使用或覆盖了已过时的 API。</div><div class="line">注: 有关详细信息, 请使用 -<span class="string">Xlint:</span>deprecation 重新编译。</div><div class="line"><span class="number">3</span> 个错误</div><div class="line">:<span class="string">app:</span>compileDebugJavaWithJavac FAILED</div><div class="line"><span class="symbol"></span></div><div class="line">FAILURE: Build failed with an exception.</div><div class="line"></div><div class="line">* What went <span class="string">wrong:</span></div><div class="line">Execution failed <span class="keyword">for</span> task <span class="string">':app:compileDebugJavaWithJavac'</span>.</div><div class="line">&gt; Compilation failed; see the compiler error output <span class="keyword">for</span> details.</div><div class="line"></div><div class="line">* <span class="string">Try:</span></div><div class="line">Run with --stacktrace option to get the stack trace. Run with --info or --debug option to get more log output.</div><div class="line"></div><div class="line">BUILD FAILED</div></pre></td></tr></table></figure></p>
<p>看来是少了一些东西了，<code>ByteBufHolder</code>。那就把<code>netty-buffer-4.1.4.Final.jar</code>也加进工程里。再次编译，继续出错，这是在产生APK时遇到了麻烦：<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">:<span class="string">app:</span>transformResourcesWithMergeJavaResForDebug FAILED</div><div class="line"><span class="symbol"></span></div><div class="line">FAILURE: Build failed with an exception.</div><div class="line"></div><div class="line">* What went <span class="string">wrong:</span></div><div class="line">Execution failed <span class="keyword">for</span> task <span class="string">':app:transformResourcesWithMergeJavaResForDebug'</span>.</div><div class="line">&gt; com.android.build.api.transform.<span class="string">TransformException:</span> com.android.builder.packaging.<span class="string">DuplicateFileException:</span> Duplicate files copied <span class="keyword">in</span> APK META-INF/INDEX.LIST</div><div class="line"><span class="symbol">  	File1:</span> <span class="regexp">/media/</span>data<span class="regexp">/MyProjects/</span>MyApplication<span class="regexp">/app/</span>libs/netty-codec<span class="number">-4.1</span><span class="number">.4</span>.Final.jar</div><div class="line"><span class="symbol">  	File2:</span> <span class="regexp">/media/</span>data<span class="regexp">/MyProjects/</span>MyApplication<span class="regexp">/app/</span>libs/netty-transport<span class="number">-4.1</span><span class="number">.4</span>.Final.jar</div><div class="line"><span class="symbol">  	File3:</span> <span class="regexp">/media/</span>data<span class="regexp">/MyProjects/</span>MyApplication<span class="regexp">/app/</span>libs/netty-buffer<span class="number">-4.1</span><span class="number">.4</span>.Final.jar</div><div class="line"><span class="symbol">  	File4:</span> <span class="regexp">/media/</span>data<span class="regexp">/MyProjects/</span>MyApplication<span class="regexp">/app/</span>libs/netty-codec-socks<span class="number">-4.1</span><span class="number">.4</span>.Final.jar</div><div class="line"><span class="symbol">  	File5:</span> <span class="regexp">/media/</span>data<span class="regexp">/MyProjects/</span>MyApplication<span class="regexp">/app/</span>libs/netty-handler<span class="number">-4.1</span><span class="number">.4</span>.Final.jar</div><div class="line"><span class="symbol">  	File6:</span> <span class="regexp">/media/</span>data<span class="regexp">/MyProjects/</span>MyApplication<span class="regexp">/app/</span>libs/netty-codec-http2<span class="number">-4.1</span><span class="number">.4</span>.Final.jar</div><div class="line"><span class="symbol">  	File7:</span> <span class="regexp">/media/</span>data<span class="regexp">/MyProjects/</span>MyApplication<span class="regexp">/app/</span>libs/netty-codec-http<span class="number">-4.1</span><span class="number">.4</span>.Final.jar</div><div class="line"></div><div class="line"></div><div class="line">* <span class="string">Try:</span></div><div class="line">Run with --stacktrace option to get the stack trace. Run with --info or --debug option to get more log output.</div><div class="line"></div><div class="line">BUILD FAILED</div><div class="line"></div><div class="line">Total <span class="string">time:</span> <span class="number">15.352</span> secs</div><div class="line">Duplicate files copied <span class="keyword">in</span> APK META-INF/INDEX.LIST</div><div class="line"><span class="symbol">	File1:</span> <span class="regexp">/media/</span>data<span class="regexp">/MyProjects/</span>MyApplication<span class="regexp">/app/</span>libs/netty-codec<span class="number">-4.1</span><span class="number">.4</span>.Final.jar</div><div class="line"><span class="symbol">	File2:</span> <span class="regexp">/media/</span>data<span class="regexp">/MyProjects/</span>MyApplication<span class="regexp">/app/</span>libs/netty-transport<span class="number">-4.1</span><span class="number">.4</span>.Final.jar</div><div class="line"><span class="symbol">	File3:</span> <span class="regexp">/media/</span>data<span class="regexp">/MyProjects/</span>MyApplication<span class="regexp">/app/</span>libs/netty-buffer<span class="number">-4.1</span><span class="number">.4</span>.Final.jar</div><div class="line"><span class="symbol">	File4:</span> <span class="regexp">/media/</span>data<span class="regexp">/MyProjects/</span>MyApplication<span class="regexp">/app/</span>libs/netty-codec-socks<span class="number">-4.1</span><span class="number">.4</span>.Final.jar</div><div class="line"><span class="symbol">	File5:</span> <span class="regexp">/media/</span>data<span class="regexp">/MyProjects/</span>MyApplication<span class="regexp">/app/</span>libs/netty-handler<span class="number">-4.1</span><span class="number">.4</span>.Final.jar</div><div class="line"><span class="symbol">	File6:</span> <span class="regexp">/media/</span>data<span class="regexp">/MyProjects/</span>MyApplication<span class="regexp">/app/</span>libs/netty-codec-http2<span class="number">-4.1</span><span class="number">.4</span>.Final.jar</div><div class="line"><span class="symbol">	File7:</span> <span class="regexp">/media/</span>data<span class="regexp">/MyProjects/</span>MyApplication<span class="regexp">/app/</span>libs/netty-codec-http<span class="number">-4.1</span><span class="number">.4</span>.Final.jar</div><div class="line"><span class="symbol"></span></div><div class="line">11:<span class="number">03</span>:<span class="number">39</span>: External task execution finished <span class="string">'assembleDebug'</span>.</div></pre></td></tr></table></figure></p>
<p>总是报<code>Duplicate files copied in APK META-INF/INDEX.LIST</code>的错误。这主要是因为这些jar文件里，不同的jar文件中的<code>META-INF/INDEX.LIST</code>包含了相同的内容所致。这需要在<code>build.gradle</code>中的android元素里添加如下的配置：<br><figure class="highlight nginx"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="section">packagingOptions</span> &#123;</div><div class="line">    <span class="attribute">exclude</span> <span class="string">'META-INF/INDEX.LIST'</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>再次编译，这次则是包<code>Duplicate files copied in APK META-INF/io.netty.versions.properties</code>。这证明了前面的方法是行之有效的，于是把<code>META-INF/io.netty.versions.properties</code>也加进<code>packagingOptions</code>的exclude列表：<br><figure class="highlight puppet"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">packagingOptions</span> &#123;</div><div class="line">    <span class="literal">exclude</span> <span class="string">'META-INF/INDEX.LIST'</span></div><div class="line">    <span class="literal">exclude</span> <span class="string">'META-INF/io.netty.versions.properties'</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>再次编译，编译通过。但是在运行的时候遇到了一点小麻烦：<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="number">11</span>:<span class="number">29</span>:<span class="number">59.685</span> <span class="number">9005</span>-<span class="number">9050</span>/com<span class="selector-class">.example</span><span class="selector-class">.hanpfei0306</span><span class="selector-class">.myapplication</span> W/dalvikvm: threadid=<span class="number">11</span>: thread exiting with uncaught exception (group=<span class="number">0</span>x41959ce0)</div><div class="line"><span class="number">08</span>-<span class="number">11</span> <span class="number">11</span>:<span class="number">29</span>:<span class="number">59.685</span> <span class="number">9005</span>-<span class="number">9050</span>/com<span class="selector-class">.example</span><span class="selector-class">.hanpfei0306</span><span class="selector-class">.myapplication</span> E/AndroidRuntime: FATAL EXCEPTION: Thread-<span class="number">1197</span></div><div class="line">                                                                                     Process: com<span class="selector-class">.example</span><span class="selector-class">.hanpfei0306</span><span class="selector-class">.myapplication</span>, PID: <span class="number">9005</span></div><div class="line">                                                                                     java<span class="selector-class">.lang</span><span class="selector-class">.NoClassDefFoundError</span>: io<span class="selector-class">.netty</span><span class="selector-class">.resolver</span><span class="selector-class">.DefaultAddressResolverGroup</span></div><div class="line">                                                                                         at io<span class="selector-class">.netty</span><span class="selector-class">.bootstrap</span><span class="selector-class">.Bootstrap</span>.&lt;clinit&gt;(Bootstrap<span class="selector-class">.java</span>:<span class="number">53</span>)</div><div class="line">                                                                                         at com<span class="selector-class">.example</span><span class="selector-class">.hanpfei0306</span><span class="selector-class">.myapplication</span><span class="selector-class">.HttpClient</span>$<span class="number">1</span>.run(HttpClient<span class="selector-class">.java</span>:<span class="number">57</span>)</div></pre></td></tr></table></figure></p>
<p>提示找不到class io.netty.resolver.DefaultAddressResolverGroup，看来我们的jar文件是加少了，把<code>netty-resolver-4.1.4.Final.jar</code>也加进来。终于，我们前面编写的HttpClient能够正常地跑起来了。经过一番裁剪，Netty的大小大概从3.4MB减小到2.9MB。</p>
<p>总结一下，若不用体型巨大的<code>netty-all</code> jar文件，则我们需要导入如下的这些jar文件以编译和运行Netty：<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">netty-buffer-4</span><span class="selector-class">.1</span><span class="selector-class">.4</span><span class="selector-class">.Final</span><span class="selector-class">.jar</span></div><div class="line"><span class="selector-tag">netty-codec-4</span><span class="selector-class">.1</span><span class="selector-class">.4</span><span class="selector-class">.Final</span><span class="selector-class">.jar</span></div><div class="line"><span class="selector-tag">netty-codec-http-4</span><span class="selector-class">.1</span><span class="selector-class">.4</span><span class="selector-class">.Final</span><span class="selector-class">.jar</span></div><div class="line"><span class="selector-tag">netty-codec-http2-4</span><span class="selector-class">.1</span><span class="selector-class">.4</span><span class="selector-class">.Final</span><span class="selector-class">.jar</span></div><div class="line"><span class="selector-tag">netty-codec-socks-4</span><span class="selector-class">.1</span><span class="selector-class">.4</span><span class="selector-class">.Final</span><span class="selector-class">.jar</span></div><div class="line"><span class="selector-tag">netty-common-4</span><span class="selector-class">.1</span><span class="selector-class">.4</span><span class="selector-class">.Final</span><span class="selector-class">.jar</span></div><div class="line"><span class="selector-tag">netty-handler-4</span><span class="selector-class">.1</span><span class="selector-class">.4</span><span class="selector-class">.Final</span><span class="selector-class">.jar</span></div><div class="line"><span class="selector-tag">netty-resolver-4</span><span class="selector-class">.1</span><span class="selector-class">.4</span><span class="selector-class">.Final</span><span class="selector-class">.jar</span></div><div class="line"><span class="selector-tag">netty-transport-4</span><span class="selector-class">.1</span><span class="selector-class">.4</span><span class="selector-class">.Final</span><span class="selector-class">.jar</span></div></pre></td></tr></table></figure></p>
<h1 id="TODO"><a href="#TODO" class="headerlink" title="TODO"></a>TODO</h1><p>Netty的诸多抽象，比如Bootstrap，Channel，EventLoopGroup，Handler，codec，Buffer等诸多高级特性，以及它的NIO接口，这里都没有涉及，线程模型也没有仔细厘清。这里只是最最简单的一个使用范例，要把Netty很好地应用在实际的项目中，还需要对Netty本身更深入的研究。</p>
<p>同时，对Netty的裁剪可能也过于粗糙，或许还有更多的东西可以裁剪掉，以减小最终的APP的大小。</p>
<p>要使用Netty来支持HTTP/2也还需要做更多的事情。</p>
<p>但窥探到Netty的灵活强大，还是让我们对这个库充满期待。</p>
<h1 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h1><p><a href="http://www.cnblogs.com/029zz010buct/p/4882568.html" target="_blank" rel="external">多个jar包的合并</a></p>
<p><a href="http://www.cnblogs.com/zou90512/p/3492287.html" target="_blank" rel="external">Netty4.x中文教程系列</a></p>
<p><a href="https://github.com/waylau/netty-4-user-guide" target="_blank" rel="external">netty-4-user-guide</a></p>
</div><div class="tags"><a href="/tags/Android开发/">Android开发</a><a href="/tags/Java开发/">Java开发</a></div><div class="post-nav"><a href="/2016/11/14/nginx_uWSGI_deply_django_on_ubuntu/" class="pre">基于nginx和uWSGI在Ubuntu上部署Django</a><a href="/2016/11/11/lazy-chromium-net-android-porting-guide/" class="next">懒人chromium net android移植指南</a></div><div id="disqus_thread"></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="widget"><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="请输入关键字..."/></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-gui"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android-图形系统/">Android 图形系统</a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android开发/">Android开发</a><span class="category-list-count">26</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/C-C-开发/">C/C++开发</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java开发/">Java开发</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux内核/">Linux内核</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/live555/">live555</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/业界趣闻/">业界趣闻</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/后台开发/">后台开发</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/安全/">安全</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/网络协议/">网络协议</a><span class="category-list-count">39</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/网络调试/">网络调试</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/随想杂谈/">随想杂谈</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/音视频开发/">音视频开发</a><span class="category-list-count">3</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> 标签</i></div><div class="tagcloud"><a href="/tags/OpenGL/" style="font-size: 15px;">OpenGL</a> <a href="/tags/网络协议/" style="font-size: 15px;">网络协议</a> <a href="/tags/Android开发/" style="font-size: 15px;">Android开发</a> <a href="/tags/源码分析/" style="font-size: 15px;">源码分析</a> <a href="/tags/chromium/" style="font-size: 15px;">chromium</a> <a href="/tags/后台开发/" style="font-size: 15px;">后台开发</a> <a href="/tags/Java开发/" style="font-size: 15px;">Java开发</a> <a href="/tags/QUIC/" style="font-size: 15px;">QUIC</a> <a href="/tags/翻译/" style="font-size: 15px;">翻译</a> <a href="/tags/网络调试/" style="font-size: 15px;">网络调试</a> <a href="/tags/HTTP2/" style="font-size: 15px;">HTTP2</a> <a href="/tags/UDT/" style="font-size: 15px;">UDT</a> <a href="/tags/图形图像/" style="font-size: 15px;">图形图像</a> <a href="/tags/安全/" style="font-size: 15px;">安全</a> <a href="/tags/HTTPS/" style="font-size: 15px;">HTTPS</a> <a href="/tags/C-C-开发/" style="font-size: 15px;">C/C++开发</a> <a href="/tags/音视频开发/" style="font-size: 15px;">音视频开发</a> <a href="/tags/Linux内核/" style="font-size: 15px;">Linux内核</a> <a href="/tags/live555/" style="font-size: 15px;">live555</a> <a href="/tags/Django/" style="font-size: 15px;">Django</a> <a href="/tags/Go-语言/" style="font-size: 15px;">Go 语言</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-fei"> 归档</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">九月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">八月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">七月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">六月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">五月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">四月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">三月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">二月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">一月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">十二月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">十一月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">十月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">八月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">七月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">四月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">九月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/07/">七月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/09/">九月 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/07/">七月 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/05/">五月 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/02/">二月 2013</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/09/14/egl_init_drivers/">Android 图形驱动初始化</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/13/opengl_on_android_with_sv/">在 Android 中使用 OpenGL</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/12/android_debug_gdb/">使用 GDB 调试 Android 应用</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/11/android_emulator_dev/">Android 模拟器下载、编译及调试</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/08/live555_src_analysis_start_streaming/">live555 源码分析：播放启动</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/08/live555_src_analysis_subsession_setup/">live555 源码分析：子会话 SETUP</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/07/live555_src_analysis_subsession_sdp/">live555 源码分析：子会话 SDP 行生成</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/07/live555_src_analysis_servermediasession/">live555 源码分析：ServerMediaSession</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/06/live555_src_analysis_rtspserver_arch/">live555 源码分析：RTSPServer 组件结构</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/05/live555_src_analysis_play/">live555 源码分析： PLAY 的处理</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-you"> 友情链接</i></div><ul></ul><a href="https://developer.android.com/index.html" title="Android Developers" target="_blank">Android Developers</a><ul></ul><a href="https://source.android.com/" title="Android Open Source Project" target="_blank">Android Open Source Project</a><ul></ul><a href="http://www.vants.org/" title="蚂蚁网" target="_blank">蚂蚁网</a></div><div class="widget"><div class="widget-title"><i class="fa fa-commt"> 最近评论</i></div><script type="text/javascript" src="//wolfcstech.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=1&amp;avatar_size=32&amp;excerpt_length=20&amp;hide_mods=1"></script></div></div></div></div><a id="totop" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.2.0" async></script><div id="footer"><div class="footer-info"><p><a href="/baidusitemap.xml">网站地图</a> |<a href="/atom.xml">订阅本站</a> |<span>联系博主：<a href="mailto:hanpfei@gmail.com" target="_blank" class="fa fa-email"> </a><a href="undefined" target="_blank" class="fa fa-weibo"></a><a href="https://github.com/hanpfei" target="_blank" class="fa fa-github"> </a></span></p><p><span> Copyright &copy;<a href="/." rel="nofollow">Han Pengfei</a></span><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span><span><a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake"> Theme </a>by<a rel="nofollow" target="_blank" href="https://github.com/chaooo"> Charles.</a></span></p></div></div></div><script>var disqus_shortname = 'wolfcstech';
var disqus_identifier = '2016/11/13/Netty-HTTP-on-Android/';
var disqus_title = 'Netty HTTP on Android';
var disqus_url = 'https://www.wolfcstech.com/2016/11/13/Netty-HTTP-on-Android/';
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//wolfcstech.disqus.com/count.js" async></script><script type="text/javascript" src="/js/search.json.js?v=1.2.0"></script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?3c736b12c32c019fd9ff6c825b6b9b44";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();</script></body></html>