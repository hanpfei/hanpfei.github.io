<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>Gerrit代码审核服务器搭建全过程 | WolfcsTech</title><link rel="stylesheet" type="text/css" href="//fonts.css.network/css?family=Source+Code+Pro"><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.2.0"><link rel="stylesheet" type="text/css" href="/css/highlight.css?v=1.2.0"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Gerrit代码审核服务器搭建全过程</h1><a id="logo" href="/.">WolfcsTech</a><p class="description"></p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">Gerrit代码审核服务器搭建全过程</h1><div class="post-meta">Nov 24, 2017<span> | </span><span class="category"><a href="/categories/Java开发/">Java开发</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a data-disqus-identifier="2017/11/24/gerrit_codereview/" href="/2017/11/24/gerrit_codereview/#disqus_thread" class="disqus-comment-count"></a><div class="post-content"><p>1、建立专有帐户<br><figure class="highlight elixir"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$ </span>sudo useradd gerrit</div><div class="line"><span class="variable">$ </span>sudo passwd gerrit</div><div class="line"><span class="variable">$ </span>su gerrit</div></pre></td></tr></table></figure></p>
<a id="more"></a>
<p>2、配置 Java 环境</p>
<p>3、从官网下载gerrit</p>
<p><a href="https://www.gerritcodereview.com/" target="_blank" rel="external">https://www.gerritcodereview.com/</a></p>
<p>当前最新版本为 2.14。</p>
<p>4、安装gerrit</p>
<p>关于数据库的配置：</p>
<figure class="highlight vhdl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">*** SQL Database</div><div class="line">*** </div><div class="line"></div><div class="line">Database server <span class="keyword">type</span>           [h2]: mysql</div><div class="line"></div><div class="line">Gerrit Code Review <span class="keyword">is</span> <span class="keyword">not</span> shipped <span class="keyword">with</span> MySQL Connector/J <span class="number">5.1</span>.<span class="number">41</span></div><div class="line">**  This <span class="keyword">library</span> <span class="keyword">is</span> required <span class="keyword">for</span> your <span class="keyword">configuration</span>. **</div><div class="line">Download <span class="keyword">and</span> install it now [Y/n]? Y</div><div class="line">Downloading https://repo1.maven.org/maven2/mysql/mysql-connector-java/<span class="number">5.1</span>.<span class="number">41</span>/mysql-connector-java-<span class="number">5.1</span>.<span class="number">41</span>.jar ... OK</div><div class="line">Checksum mysql-connector-java-<span class="number">5.1</span>.<span class="number">41</span>.jar OK</div><div class="line">Server hostname                [localhost]: cloudgame-codereview.com</div><div class="line">Server <span class="keyword">port</span>                    [(mysql <span class="keyword">default</span>)]: </div><div class="line">Database name                  [reviewdb]: </div><div class="line">Database username              [gerrit]: </div><div class="line">gerrit<span class="symbol">'s</span> password              : </div><div class="line">              confirm password :</div></pre></td></tr></table></figure>
<p>这里选择 MySQL 作为 Gerrit 的数据库，其它选项全部采用默认配置。对于这种选择，需要连上 MySQL，为 Gerrit 创建相应的数据库，用户，并为用户授权：<br><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line">$ mysql -u root -p</div><div class="line">Enter password: </div><div class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</div><div class="line">Your MySQL connection id is 35</div><div class="line">Server version: 5.7.20-0ubuntu0.16.04.1 (Ubuntu)</div><div class="line"></div><div class="line">Copyright (c) 2000, 2017, Oracle and/or its affiliates. All rights reserved.</div><div class="line"></div><div class="line">Oracle is a registered trademark of Oracle Corporation and/or its</div><div class="line">affiliates. Other names may be trademarks of their respective</div><div class="line">owners.</div><div class="line"></div><div class="line">Type <span class="emphasis">'help;'</span> or <span class="emphasis">'\h'</span> for help. Type <span class="emphasis">'\c'</span> to clear the current input statement.</div><div class="line"></div><div class="line"><span class="section">mysql&gt; SELECT USER();</span></div><div class="line">+----------------+</div><div class="line"><span class="section">| USER()         |</span></div><div class="line">+----------------+</div><div class="line"><span class="section">| root@localhost |</span></div><div class="line">+----------------+</div><div class="line">1 row in set (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt; create database reviewdb;</div><div class="line">Query OK, 1 row affected (0.01 sec)</div><div class="line"></div><div class="line">mysql&gt; CREATE USER <span class="emphasis">'gerrit'</span>@<span class="emphasis">'localhost'</span> IDENTIFIED BY <span class="emphasis">'gerrit'</span>;</div><div class="line">Query OK, 0 rows affected (0.01 sec)</div><div class="line"></div><div class="line">mysql&gt; flush privileges;</div><div class="line">Query OK, 0 rows affected (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt; grant all privileges on reviewdb.* to gerrit@localhost identified by <span class="emphasis">'gerrit'</span>;</div><div class="line">Query OK, 0 rows affected, 1 warning (0.01 sec)</div><div class="line"></div><div class="line">mysql&gt; flush privileges;</div><div class="line">Query OK, 0 rows affected (0.00 sec)</div><div class="line"></div><div class="line"><span class="section">mysql&gt; show databases;</span></div><div class="line">+--------------------+</div><div class="line"><span class="section">| Database           |</span></div><div class="line">+--------------------+</div><div class="line">| information<span class="emphasis">_schema |</span></div><div class="line">| mysql              |</div><div class="line">| performance_schema |</div><div class="line">| reviewdb           |</div><div class="line"><span class="section">| sys                |</span></div><div class="line">+--------------------+</div><div class="line">8 rows in set (0.01 sec)</div><div class="line"></div><div class="line">mysql&gt;</div></pre></td></tr></table></figure></p>
<p>Gerrit 安装过程中，可能会报出如下的 Exception：<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line">Exception <span class="keyword">in</span> thread <span class="string">"main"</span> com<span class="selector-class">.google</span><span class="selector-class">.gwtorm</span><span class="selector-class">.server</span><span class="selector-class">.OrmException</span>: Cannot apply SQL</div><div class="line">CREATE TABLE account_group_members_audit (</div><div class="line">added_by INT DEFAULT <span class="number">0</span> NOT NULL,</div><div class="line">removed_by INT,</div><div class="line">removed_on TIMESTAMP NULL DEFAULT NULL,</div><div class="line">account_id INT DEFAULT <span class="number">0</span> NOT NULL,</div><div class="line">group_id INT DEFAULT <span class="number">0</span> NOT NULL,</div><div class="line">added_on TIMESTAMP NOT NULL</div><div class="line">,PRIMARY KEY(account_id,group_id,added_on)</div><div class="line">)</div><div class="line">	at com<span class="selector-class">.google</span><span class="selector-class">.gwtorm</span><span class="selector-class">.jdbc</span><span class="selector-class">.JdbcExecutor</span><span class="selector-class">.execute</span>(JdbcExecutor<span class="selector-class">.java</span>:<span class="number">44</span>)</div><div class="line">	at com<span class="selector-class">.google</span><span class="selector-class">.gwtorm</span><span class="selector-class">.jdbc</span><span class="selector-class">.JdbcSchema</span><span class="selector-class">.createRelations</span>(JdbcSchema<span class="selector-class">.java</span>:<span class="number">134</span>)</div><div class="line">	at com<span class="selector-class">.google</span><span class="selector-class">.gwtorm</span><span class="selector-class">.jdbc</span><span class="selector-class">.JdbcSchema</span><span class="selector-class">.updateSchema</span>(JdbcSchema<span class="selector-class">.java</span>:<span class="number">104</span>)</div><div class="line">	at com<span class="selector-class">.google</span><span class="selector-class">.gerrit</span><span class="selector-class">.server</span><span class="selector-class">.schema</span><span class="selector-class">.SchemaCreator</span><span class="selector-class">.create</span>(SchemaCreator<span class="selector-class">.java</span>:<span class="number">81</span>)</div><div class="line">	at com<span class="selector-class">.google</span><span class="selector-class">.gerrit</span><span class="selector-class">.server</span><span class="selector-class">.schema</span><span class="selector-class">.SchemaUpdater</span><span class="selector-class">.update</span>(SchemaUpdater<span class="selector-class">.java</span>:<span class="number">108</span>)</div><div class="line">	at com<span class="selector-class">.google</span><span class="selector-class">.gerrit</span><span class="selector-class">.pgm</span><span class="selector-class">.init</span><span class="selector-class">.BaseInit</span><span class="variable">$SiteRun</span>.upgradeSchema(BaseInit<span class="selector-class">.java</span>:<span class="number">386</span>)</div><div class="line">	at com<span class="selector-class">.google</span><span class="selector-class">.gerrit</span><span class="selector-class">.pgm</span><span class="selector-class">.init</span><span class="selector-class">.BaseInit</span><span class="selector-class">.run</span>(BaseInit<span class="selector-class">.java</span>:<span class="number">143</span>)</div><div class="line">	at com<span class="selector-class">.google</span><span class="selector-class">.gerrit</span><span class="selector-class">.pgm</span><span class="selector-class">.util</span><span class="selector-class">.AbstractProgram</span><span class="selector-class">.main</span>(AbstractProgram<span class="selector-class">.java</span>:<span class="number">61</span>)</div><div class="line">	at sun<span class="selector-class">.reflect</span><span class="selector-class">.NativeMethodAccessorImpl</span><span class="selector-class">.invoke0</span>(Native Method)</div><div class="line">	at sun<span class="selector-class">.reflect</span><span class="selector-class">.NativeMethodAccessorImpl</span><span class="selector-class">.invoke</span>(NativeMethodAccessorImpl<span class="selector-class">.java</span>:<span class="number">62</span>)</div><div class="line">	at sun<span class="selector-class">.reflect</span><span class="selector-class">.DelegatingMethodAccessorImpl</span><span class="selector-class">.invoke</span>(DelegatingMethodAccessorImpl<span class="selector-class">.java</span>:<span class="number">43</span>)</div><div class="line">	at java<span class="selector-class">.lang</span><span class="selector-class">.reflect</span><span class="selector-class">.Method</span><span class="selector-class">.invoke</span>(Method<span class="selector-class">.java</span>:<span class="number">498</span>)</div><div class="line">	at com<span class="selector-class">.google</span><span class="selector-class">.gerrit</span><span class="selector-class">.launcher</span><span class="selector-class">.GerritLauncher</span><span class="selector-class">.invokeProgram</span>(GerritLauncher<span class="selector-class">.java</span>:<span class="number">204</span>)</div><div class="line">	at com<span class="selector-class">.google</span><span class="selector-class">.gerrit</span><span class="selector-class">.launcher</span><span class="selector-class">.GerritLauncher</span><span class="selector-class">.mainImpl</span>(GerritLauncher<span class="selector-class">.java</span>:<span class="number">108</span>)</div><div class="line">	at com<span class="selector-class">.google</span><span class="selector-class">.gerrit</span><span class="selector-class">.launcher</span><span class="selector-class">.GerritLauncher</span><span class="selector-class">.main</span>(GerritLauncher<span class="selector-class">.java</span>:<span class="number">63</span>)</div><div class="line">	at Main.main(Main<span class="selector-class">.java</span>:<span class="number">24</span>)</div><div class="line">Caused by: com<span class="selector-class">.mysql</span><span class="selector-class">.jdbc</span><span class="selector-class">.exceptions</span><span class="selector-class">.jdbc4</span><span class="selector-class">.MySQLSyntaxErrorException</span>: Invalid default value <span class="keyword">for</span> <span class="string">'added_on'</span></div><div class="line">	at sun<span class="selector-class">.reflect</span><span class="selector-class">.NativeConstructorAccessorImpl</span><span class="selector-class">.newInstance0</span>(Native Method)</div><div class="line">	at sun<span class="selector-class">.reflect</span><span class="selector-class">.NativeConstructorAccessorImpl</span><span class="selector-class">.newInstance</span>(NativeConstructorAccessorImpl<span class="selector-class">.java</span>:<span class="number">62</span>)</div><div class="line">	at sun<span class="selector-class">.reflect</span><span class="selector-class">.DelegatingConstructorAccessorImpl</span><span class="selector-class">.newInstance</span>(DelegatingConstructorAccessorImpl<span class="selector-class">.java</span>:<span class="number">45</span>)</div><div class="line">	at java<span class="selector-class">.lang</span><span class="selector-class">.reflect</span><span class="selector-class">.Constructor</span><span class="selector-class">.newInstance</span>(Constructor<span class="selector-class">.java</span>:<span class="number">423</span>)</div><div class="line">	at com<span class="selector-class">.mysql</span><span class="selector-class">.jdbc</span><span class="selector-class">.Util</span><span class="selector-class">.handleNewInstance</span>(Util<span class="selector-class">.java</span>:<span class="number">425</span>)</div><div class="line">	at com<span class="selector-class">.mysql</span><span class="selector-class">.jdbc</span><span class="selector-class">.Util</span><span class="selector-class">.getInstance</span>(Util<span class="selector-class">.java</span>:<span class="number">408</span>)</div><div class="line">	at com<span class="selector-class">.mysql</span><span class="selector-class">.jdbc</span><span class="selector-class">.SQLError</span><span class="selector-class">.createSQLException</span>(SQLError<span class="selector-class">.java</span>:<span class="number">943</span>)</div><div class="line">	at com<span class="selector-class">.mysql</span><span class="selector-class">.jdbc</span><span class="selector-class">.MysqlIO</span><span class="selector-class">.checkErrorPacket</span>(MysqlIO<span class="selector-class">.java</span>:<span class="number">3973</span>)</div><div class="line">	at com<span class="selector-class">.mysql</span><span class="selector-class">.jdbc</span><span class="selector-class">.MysqlIO</span><span class="selector-class">.checkErrorPacket</span>(MysqlIO<span class="selector-class">.java</span>:<span class="number">3909</span>)</div><div class="line">	at com<span class="selector-class">.mysql</span><span class="selector-class">.jdbc</span><span class="selector-class">.MysqlIO</span><span class="selector-class">.sendCommand</span>(MysqlIO<span class="selector-class">.java</span>:<span class="number">2527</span>)</div><div class="line">	at com<span class="selector-class">.mysql</span><span class="selector-class">.jdbc</span><span class="selector-class">.MysqlIO</span><span class="selector-class">.sqlQueryDirect</span>(MysqlIO<span class="selector-class">.java</span>:<span class="number">2680</span>)</div><div class="line">	at com<span class="selector-class">.mysql</span><span class="selector-class">.jdbc</span><span class="selector-class">.ConnectionImpl</span><span class="selector-class">.execSQL</span>(ConnectionImpl<span class="selector-class">.java</span>:<span class="number">2497</span>)</div><div class="line">	at com<span class="selector-class">.mysql</span><span class="selector-class">.jdbc</span><span class="selector-class">.ConnectionImpl</span><span class="selector-class">.execSQL</span>(ConnectionImpl<span class="selector-class">.java</span>:<span class="number">2455</span>)</div><div class="line">	at com<span class="selector-class">.mysql</span><span class="selector-class">.jdbc</span><span class="selector-class">.StatementImpl</span><span class="selector-class">.executeInternal</span>(StatementImpl<span class="selector-class">.java</span>:<span class="number">839</span>)</div><div class="line">	at com<span class="selector-class">.mysql</span><span class="selector-class">.jdbc</span><span class="selector-class">.StatementImpl</span><span class="selector-class">.execute</span>(StatementImpl<span class="selector-class">.java</span>:<span class="number">739</span>)</div><div class="line">	at com<span class="selector-class">.google</span><span class="selector-class">.gwtorm</span><span class="selector-class">.jdbc</span><span class="selector-class">.JdbcExecutor</span><span class="selector-class">.execute</span>(JdbcExecutor<span class="selector-class">.java</span>:<span class="number">42</span>)</div><div class="line">	... <span class="number">15</span> more</div></pre></td></tr></table></figure></p>
<p>这个异常可通过如下方式解决：使用 MySQL root 用户登录，设置 <code>set global explicit_defaults_for_timestamp=1;</code>，像下面这样：<br><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">$ mysql -u root -p</div><div class="line">Enter password: </div><div class="line">Welcome <span class="keyword">to</span> the MySQL monitor.  Commands <span class="keyword">end</span> <span class="keyword">with</span> ; <span class="keyword">or</span> \g.</div><div class="line">Your MySQL connection id <span class="keyword">is</span> <span class="number">76</span></div><div class="line">Server version: <span class="number">5.7</span>.<span class="number">20</span>-<span class="number">0</span>ubuntu0.<span class="number">16.04</span>.<span class="number">1</span> (Ubuntu)</div><div class="line"></div><div class="line">Copyright (c) <span class="number">2000</span>, <span class="number">2017</span>, Oracle <span class="keyword">and</span>/<span class="keyword">or</span> its affiliates. All rights reserved.</div><div class="line"></div><div class="line">Oracle <span class="keyword">is</span> a registered trademark <span class="keyword">of</span> Oracle Corporation <span class="keyword">and</span>/<span class="keyword">or</span> its</div><div class="line">affiliates. Other names may be trademarks <span class="keyword">of</span> their respective</div><div class="line">owners.</div><div class="line"></div><div class="line"><span class="keyword">Type</span> <span class="string">'help;'</span> <span class="keyword">or</span> <span class="string">'\h'</span> <span class="keyword">for</span> help. <span class="keyword">Type</span> <span class="string">'\c'</span> <span class="keyword">to</span> clear the current input statement.</div><div class="line"></div><div class="line">mysql&gt; <span class="keyword">set</span> <span class="keyword">global</span> explicit_defaults_for_timestamp=<span class="number">1</span>;</div><div class="line">Query OK, <span class="number">0</span> rows affected (<span class="number">0.00</span> sec)</div><div class="line"></div><div class="line">mysql&gt; <span class="keyword">exit</span>;</div><div class="line">Bye</div></pre></td></tr></table></figure></p>
<p>然后重新安装 Gerrit 即可。（新版本的 MySQL TIMESTAMP 默认值的问题需要手动配置一下。）</p>
<p>5、建立存放代码的目录<br><figure class="highlight arduino"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ <span class="built_in">mkdir</span> /<span class="built_in">home</span>/gerrit/GerritResource</div></pre></td></tr></table></figure></p>
<p>6、配置gerrit<br><figure class="highlight arduino"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ vim review_site/etc/gerrit.<span class="built_in">config</span></div></pre></td></tr></table></figure></p>
<p>这个配置文件的内容如下：<br><figure class="highlight nix"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">[gerrit]</div><div class="line">	<span class="attr">basePath</span> = GerritResource</div><div class="line">	<span class="attr">serverId</span> = <span class="number">7</span>b8058ff-<span class="number">932</span>a-<span class="number">41</span>ed-a1fa-<span class="number">6</span>ea53dfba8e1</div><div class="line">	<span class="attr">canonicalWebUrl</span> = http://review.virtcloudgame.com:<span class="number">8080</span>/</div><div class="line">        <span class="attr">useSSL=false</span></div><div class="line">[database]</div><div class="line">	<span class="attr">type</span> = mysql</div><div class="line">	<span class="attr">hostname</span> = review.virtcloudgame.com</div><div class="line">	<span class="attr">database</span> = reviewdb</div><div class="line">	<span class="attr">username</span> = gerrit</div><div class="line">[index]</div><div class="line">	<span class="attr">type</span> = LUCENE</div><div class="line">[auth]</div><div class="line">	<span class="attr">type</span> = http</div><div class="line">[receive]</div><div class="line">	<span class="attr">enableSignedPush</span> = <span class="literal">false</span></div><div class="line">[sendemail]</div><div class="line">	<span class="attr">smtpServer</span> = localhost</div><div class="line">[container]</div><div class="line">	<span class="attr">user</span> = gerrit</div><div class="line">	<span class="attr">javaHome</span> = /usr/lib/jvm/java-<span class="number">8</span>-openjdk-amd64/jre</div><div class="line">[sshd]</div><div class="line">	<span class="attr">listenAddress</span> = *:<span class="number">29418</span></div><div class="line">[download]</div><div class="line">        <span class="attr">scheme</span> = ssh</div><div class="line">        <span class="attr">scheme</span> = http</div><div class="line">[httpd]</div><div class="line">        <span class="attr">listenUrl</span> = proxy-http://<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">8080</span>/</div><div class="line">[cache]</div><div class="line">        <span class="attr">directory</span> = cache</div><div class="line">[plugins]</div><div class="line">        <span class="attr">allowRemoteAdmin</span> = <span class="literal">true</span></div></pre></td></tr></table></figure></p>
<p>7、设置第一个 Gerrit 用户的帐号和密码<br><figure class="highlight armasm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ touch ./<span class="keyword">review_site/etc/passwd</span></div><div class="line">$ htpasswd -<span class="keyword">b </span>./<span class="keyword">review_site/etc/passwd </span>admin admin</div><div class="line"><span class="keyword">Adding </span>password for user admin</div></pre></td></tr></table></figure></p>
<p>(后续再添加 Gerrit 用户可使用 <code>htpasswd -b ./review_site/etc/passwd UserName PassWord</code>) </p>
<p>对于 Gerrit 来说，第一个成功登录的用户具有特殊意义 —— 它会直接被赋予管理员权限。对于第一个账户，需要特别注意一下。</p>
<p>8、开启 Gerrit 服务器<br><figure class="highlight armasm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ <span class="keyword">review_site/bin/gerrit.sh </span>start</div><div class="line"><span class="symbol">Starting</span> Gerrit <span class="meta">Code</span> <span class="keyword">Review: </span>FAILED</div></pre></td></tr></table></figure></p>
<p>上面的命令，通过 <code>review_site/bin/gerrit.sh start</code> 启动 Gerrit Server，但是失败了。Gerrit Server 启动，需要监听 8080 端口，如前面的配置文件 <code>review_site/etc/gerrit.config</code> 中的 <code>listenUrl</code> 行所显示的那样。通过如下的命令查看 8080 端口的使用情况：<br><figure class="highlight tap"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ sudo lsof -i -P | grep 8080</div><div class="line">java      <span class="number"> 9538 </span>         tomcat   53u  IPv6<span class="number"> 17098680 </span>     0t0  TCP *:8080 (LISTEN)</div></pre></td></tr></table></figure></p>
<p>可以看到 8080 端口被 tomcat 用户下的某个 Java 进程占用了。我们可以杀掉相应的应用来解决 Gerrit Server 启动失败的问题（Tomcat 的安装配置启动按照<a href="https://www.wolfcstech.com/2017/02/24/Install_Tomcat8_on_Ubuntu16.04/">Ubuntu 16.04 Tomcat 8安装指南</a> 一文的说明进行）：<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">$ sudo systemctl stop tomcat</div><div class="line">$ sudo systemctl status tomcat</div><div class="line">● tomcat.service - Apache Tomcat Web Application Container</div><div class="line"><span class="symbol">   Loaded:</span> loaded (<span class="regexp">/etc/</span>systemd<span class="regexp">/system/</span>tomcat.service; enabled; vendor <span class="string">preset:</span> enabled)</div><div class="line"><span class="symbol">   Active:</span> inactive (dead) since 四 <span class="number">2017</span><span class="number">-11</span><span class="number">-23</span> <span class="number">10</span>:<span class="number">23</span>:<span class="number">02</span> CST; <span class="number">4</span>s ago</div><div class="line"><span class="symbol">  Process:</span> <span class="number">9805</span> ExecStop=<span class="regexp">/opt/</span>tomcat<span class="regexp">/bin/</span>shutdown.sh (code=exited, status=<span class="number">0</span>/SUCCESS)</div><div class="line"><span class="symbol">  Process:</span> <span class="number">9527</span> ExecStart=<span class="regexp">/opt/</span>tomcat<span class="regexp">/bin/</span>startup.sh (code=exited, status=<span class="number">0</span>/SUCCESS)</div><div class="line"> Main <span class="string">PID:</span> <span class="number">9538</span> (code=exited, status=<span class="number">0</span>/SUCCESS)</div><div class="line"></div><div class="line"><span class="number">11</span>月 <span class="number">23</span> <span class="number">10</span>:<span class="number">20</span>:<span class="number">18</span> ThundeRobot startup.sh[<span class="number">9527</span>]: Removing/clearing stale PID file.</div><div class="line"><span class="number">11</span>月 <span class="number">23</span> <span class="number">10</span>:<span class="number">20</span>:<span class="number">18</span> ThundeRobot systemd[<span class="number">1</span>]: Started Apache Tomcat Web Application Container.</div><div class="line"><span class="number">11</span>月 <span class="number">23</span> <span class="number">10</span>:<span class="number">23</span>:<span class="number">01</span> ThundeRobot systemd[<span class="number">1</span>]: Stopping Apache Tomcat Web Application Container...</div><div class="line"><span class="number">11</span>月 <span class="number">23</span> <span class="number">10</span>:<span class="number">23</span>:<span class="number">01</span> ThundeRobot shutdown.sh[<span class="number">9805</span>]: Using <span class="string">CATALINA_BASE:</span>   <span class="regexp">/opt/</span>tomcat</div><div class="line"><span class="number">11</span>月 <span class="number">23</span> <span class="number">10</span>:<span class="number">23</span>:<span class="number">01</span> ThundeRobot shutdown.sh[<span class="number">9805</span>]: Using <span class="string">CATALINA_HOME:</span>   <span class="regexp">/opt/</span>tomcat</div><div class="line"><span class="number">11</span>月 <span class="number">23</span> <span class="number">10</span>:<span class="number">23</span>:<span class="number">01</span> ThundeRobot shutdown.sh[<span class="number">9805</span>]: Using <span class="string">CATALINA_TMPDIR:</span> <span class="regexp">/opt/</span>tomcat/temp</div><div class="line"><span class="number">11</span>月 <span class="number">23</span> <span class="number">10</span>:<span class="number">23</span>:<span class="number">01</span> ThundeRobot shutdown.sh[<span class="number">9805</span>]: Using <span class="string">JRE_HOME:</span>        <span class="regexp">/usr/</span>lib<span class="regexp">/jvm/</span>java<span class="number">-1.8</span><span class="number">.0</span>-openjdk-amd64/jre</div><div class="line"><span class="number">11</span>月 <span class="number">23</span> <span class="number">10</span>:<span class="number">23</span>:<span class="number">01</span> ThundeRobot shutdown.sh[<span class="number">9805</span>]: Using <span class="string">CLASSPATH:</span>       <span class="regexp">/opt/</span>tomcat<span class="regexp">/bin/</span>bootstrap.<span class="string">jar:</span><span class="regexp">/opt/</span>tomcat<span class="regexp">/bin/</span>tomcat-juli.jar</div><div class="line"><span class="number">11</span>月 <span class="number">23</span> <span class="number">10</span>:<span class="number">23</span>:<span class="number">01</span> ThundeRobot shutdown.sh[<span class="number">9805</span>]: Using <span class="string">CATALINA_PID:</span>    <span class="regexp">/opt/</span>tomcat<span class="regexp">/temp/</span>tomcat.pid</div><div class="line"><span class="number">11</span>月 <span class="number">23</span> <span class="number">10</span>:<span class="number">23</span>:<span class="number">02</span> ThundeRobot systemd[<span class="number">1</span>]: Stopped Apache Tomcat Web Application Container.</div></pre></td></tr></table></figure></p>
<p>当然也可以通过修改 Gerrit Server 监听的端口来解决问题。</p>
<p>再次启动 Gerrit Server：<br><figure class="highlight armasm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ <span class="keyword">review_site/bin/gerrit.sh </span>start</div><div class="line"><span class="symbol">Starting</span> Gerrit <span class="meta">Code</span> <span class="keyword">Review: </span>OK</div></pre></td></tr></table></figure></p>
<p>可以看到 Gerrit Server 成功启动了。此时通过浏览器，打开 <code>http://localhost:8080</code> 将可以看到如下这样的页面：</p>
<p><img src="https://www.wolfcstech.com/images/1315506-ce5314beafa42d40.png" alt="Gerrit CodeReview"></p>
<ol>
<li>修改认证方式和反向代理<br>为了通过更为强大的 Web 服务器来对外提供服务，同时方便 Gerrit Server 的 HTTP 用户认证方式可以正常工作，需要设置反向代理。这里使用 nginx 作为 Web 服务器。</li>
</ol>
<p>首先更改 Gerrit 配置，使能代理；另外，使用反向代理后就可以直接使用 nginx 的 80 端口访问了，需要把 <code>canonicalWebUrl</code> 中的 8080 去掉：<br><figure class="highlight nix"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">[gerrit]</div><div class="line">	<span class="attr">basePath</span> = GerritResource</div><div class="line">	<span class="attr">serverId</span> = <span class="number">7</span>b8058ff-<span class="number">932</span>a-<span class="number">41</span>ed-a1fa-<span class="number">6</span>ea53dfba8e1</div><div class="line">	<span class="attr">canonicalWebUrl</span> = http://review.virtcloudgame.com/</div><div class="line">        <span class="attr">useSSL=false</span></div><div class="line">. . . . . .</div><div class="line">[auth]</div><div class="line">	<span class="attr">type</span> = HTTP</div><div class="line">. . . . . .</div><div class="line">[httpd]</div><div class="line">        <span class="attr">listenUrl</span> = proxy-http://<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">8081</span>/</div></pre></td></tr></table></figure></p>
<p>修改之后，重启 Gerrit Server：<br><figure class="highlight armasm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ <span class="keyword">review_site/bin/gerrit.sh </span>restart</div><div class="line"><span class="symbol">Stopping</span> Gerrit <span class="meta">Code</span> <span class="keyword">Review: </span>OK</div><div class="line"><span class="symbol">Starting</span> Gerrit <span class="meta">Code</span> <span class="keyword">Review: </span>OK</div></pre></td></tr></table></figure></p>
<p>上面的修改将使 Gerrit Server 监听在 8081 端口上，同上，将认证方式修改为 HTTP。再次在浏览器中打开 <code>http://review.virtcloudgame.com:8081</code>，出现如下报错：</p>
<p><img src="https://www.wolfcstech.com/images/1315506-4e296f73e08be690.png" alt="2017-11-23 11-37-04屏幕截图.png"></p>
<p>这是由于对 HTTP 认证来说，Gerrit Server 强制要求使用反向代理，通过反向代理服务器提供的 <code>Authorization</code> 等 HTTP 头来获得用户认证信息。</p>
<p>修改 nginx 的配置文件 <code>/etc/nginx/nginx.conf</code>，在它的 <code>http</code> 块中加入如下内容：<br><figure class="highlight nginx"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">       <span class="section">server</span> &#123;</div><div class="line">  <span class="attribute">listen</span> <span class="number">80</span>;</div><div class="line">  <span class="attribute">server_name</span> review.virtcloudgame.com;</div><div class="line"></div><div class="line">  <span class="attribute">location</span><span class="regexp"> ^~</span> / &#123;</div><div class="line">           <span class="attribute">auth_basic</span> <span class="string">"Restricted"</span>;</div><div class="line">           <span class="attribute">auth_basic_user_file</span> /home/gerrit/review_site/etc/passwd;</div><div class="line">    <span class="attribute">proxy_pass</span>        http://127.0.0.1:8081;</div><div class="line">    <span class="attribute">proxy_set_header</span>  X-Forwarded-For <span class="variable">$remote_addr</span>;</div><div class="line">    <span class="attribute">proxy_set_header</span>  Host <span class="variable">$host</span>;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><code>auth_basic_user_file</code> 行用户配置用户名和密码文件的保存路径。<code>proxy_pass</code> 行用户设置 Gerrit Server 的地址。</p>
<p>修改之后，让 nginx 重新加载配置文件：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo nginx <span class="_">-s</span> reload</div></pre></td></tr></table></figure></p>
<p>这样就可以直接通过 nginx 监听的 80 端口访问 Gerrit Server 了。</p>
<p><img src="https://www.wolfcstech.com/images/1315506-c616dba14c5b09ea.png" alt="2017-11-23 11-41-07屏幕截图.png"></p>
<ol>
<li>Replication 配置</li>
</ol>
<p>所谓的 replication，是 Gerrit 的一个插件，它可以自动地将 Gerrit Code Review 对它所管理的 Git 仓库创建的任何 changes push 到另外一个系统里。Gerrit 本身提供了两大功能：一是 Code Review；二是 Git 仓库。Replication 插件通常用于提供 changes 的镜像，或热备份。</p>
<p>此外，许多现有的项目可能是用另外一套系统来管理 Git 代码仓库的，比如 GitLab，或者 GitHub。需要引入 Gerrit 做 Code Review，同时对接这些已有的 Git 仓库系统时，replication 插件比较有用。</p>
<p>配置 replication 将代码同步到 GitLab 的方法如下。</p>
<p>如果通过 SSH 来从 Gerrit 同步代码到 GitLab，需要确保远程系统，也就是 GitLab 服务器的主机密钥已经在 Gerrit 用户的 <code>~/.ssh/known_hosts</code> 文件中了。最简单的添加主机密钥的方法是，在命令行中手动地连接一次远程系统：<br><figure class="highlight elixir"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$ </span>sudo su -c <span class="string">'ssh -p 22222 g.hz.netease.com echo'</span> gerrit</div></pre></td></tr></table></figure></p>
<p>注意，如果 GitLab 的 SSH 服务不是在标准的 22 端口上提供的，需要通过 <code>-p</code> 参数给上面执行的 <code>ssh</code> 命令指定 SSH 服务的端口号。GitLab 的 SSH 服务监听的端口号，可以从项目的 URL 中看出来 —— SSH URL 中主机名后面的冒号之后的是端口号。</p>
<p>还有另外一种方法，同样可以用来添加主机密钥，即通过 <code>ssh-keyscan</code> 命令，像下面这样：<br><figure class="highlight elixir"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$ </span>ssh-keyscan -p <span class="number">22222</span> -t rsa g.hz.netease.com &gt;&gt; <span class="regexp">/home/gerrit</span><span class="regexp">/.ssh/known</span>_hosts</div><div class="line"><span class="comment"># g.hz.netease.com:22222 SSH-2.0-OpenSSH_6.0p1 Debian-4+deb7u6</span></div></pre></td></tr></table></figure></p>
<p>同样需要注意，GitLab 不是通过标准 SSH 端口 22 来提供 SSH 服务的话，通过参数 <code>-p</code> 为 <code>ssh-keyscan</code> 命令指定 GitLab 服务器提供 SSH 服务的正确端口号。</p>
<p>接下来，创建 <code>$site_path/etc/replication.config</code> 文件。这是一个 Git<br> 风格的配置文件，它用来控制 replication 插件的设置。这个文件由一个或多个 <code>remote</code> 段组成，每个 <code>remote</code> 段都为一个或多个目标 URIs 提供公共配置设置。如：<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[remote <span class="string">"g.hz.netease.com"</span>]</div><div class="line">    url = ssh:<span class="comment">//git@g.hz.netease.com:22222/cloudgame/$&#123;name&#125;.git</span></div><div class="line">    <span class="keyword">push</span> = +refs<span class="regexp">/heads/</span>*:refs<span class="regexp">/heads/</span>*</div><div class="line">    <span class="keyword">push</span> = +refs<span class="regexp">/tags/</span>*:refs<span class="regexp">/tags/</span>*</div><div class="line">    <span class="keyword">push</span> = +refs<span class="regexp">/changes/</span>*:refs<span class="regexp">/changes/</span>*</div><div class="line">    timtout = <span class="number">30</span></div><div class="line">    threads = <span class="number">3</span></div></pre></td></tr></table></figure></p>
<p>如果 <code>~/.ssh/config</code> 文件存在的话，Gerrit 将在启动的时读取并缓存它，并支持大部分 SSH 配置序啊想，比如：<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">Host g<span class="selector-class">.hz</span><span class="selector-class">.netease</span><span class="selector-class">.com</span></div><div class="line">    User git</div><div class="line">    Port <span class="number">22222</span></div><div class="line">    IdentityFile ~/.ssh/id_rsa</div><div class="line">    StrictHostKeyChecking no</div><div class="line">    UserKnownHostsFile /dev/null</div><div class="line">    PreferredAuthentications publickey</div></pre></td></tr></table></figure></p>
<p>这个配置文件支持的全部选项如下：</p>
<ul>
<li>Host</li>
<li>Hostname</li>
<li>User</li>
<li>Port</li>
<li>IdentityFile</li>
<li>PreferredAuthentications</li>
<li>StrictHostKeyChecking</li>
</ul>
<p>需要注意的是这个文件的权限，文件的 “其它” 用户访问权限，不能可读写。</p>
<p>然后重新启动 Gerrit Server：<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ review_site/bin/gerrit<span class="selector-class">.sh</span> restart</div></pre></td></tr></table></figure></p>
<p>还可以通过如下命令，重新加载 replication 插件来应用新的配置：<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ ssh -<span class="selector-tag">p</span> <span class="number">29418</span> localhost gerrit plugin reload replication</div></pre></td></tr></table></figure></p>
<p>要在运行时手动地触发 replication，可以参考 SSH 命令 <code>start</code>：<br><figure class="highlight nginx"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">ssh</span> -p <span class="variable">@SSH_PORT</span>@ <span class="variable">@SSH_HOST</span>@ <span class="variable">@PLUGIN</span>@ start</div></pre></td></tr></table></figure></p>
<p>比如：<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ ssh -<span class="selector-tag">p</span> <span class="number">29418</span> localhost replication start</div></pre></td></tr></table></figure></p>
<p>replication 插件在执行过程中，产生的日志文件位于 <code>~/review_site/logs/replication_log</code>。当 replication 失败时，可以从这个文件中找到一点线索。如果 这个日志中提供的信息不足，还可以修改 replication 的代码，让它输出更多日志，编译它的代码，然后将生成的 jar 文件，替换 <code>~/review_site/plugins/replication.jar</code>，并重启 Gerrit Server。</p>
<ol>
<li>Gerrit 工程的创建<br>用前面创建的 <code>admin</code> 用户登录，它将自动获得管理员权限，可以以这个用户创建工程。登录之后，选择 <code>Projects</code> -&gt; <code>Create New Project</code>：<br><img src="https://www.wolfcstech.com/images/1315506-f1a3fd848fab6968.png" alt=""></li>
</ol>
<p>在 <code>Project Name:</code> 一栏输入工程的名字，并点击 <code>Create Project</code> 按钮即可完成工程的创建。在 Gerrit 的配置文件 <code>review_site/etc/gerrit.config</code> 中，<code>basePath</code> 定义了这些工程的位置。</p>
<p>同时要注意，工程名字要与 GitLab 上对应的工程名字相同。</p>
<p>在 Gerrit 上创建了工程之后，还需要用 GitLab 上已有的代码替换 Gerrit 中的空工程：<br><figure class="highlight elixir"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$ </span>cd ~<span class="regexp">/review_site/</span>GerritResource/</div><div class="line"><span class="variable">$ </span>rm -rf cloudgame_tools.git/</div><div class="line"><span class="variable">$ </span>git clone --bare <span class="symbol">ssh:</span>/<span class="regexp">/git@g.hz.netease.com:22222/cloudgame</span><span class="regexp">/cloudgame_tools.git</span></div></pre></td></tr></table></figure></p>
<p>在工程的主页，可以找到 clone 工程的命令。直接复制命令，然后将工程 clone 到本地：<br><img src="https://www.wolfcstech.com/images/1315506-0105a12ab738c99a.png" alt=""></p>
<p>像下面这样 Clone Gerrit 上的工程：<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">$ git clone <span class="string">ssh:</span><span class="comment">//admin@review.virtcloudgame.com:29418/EventServer &amp;&amp; scp -p -P 29418 admin@review.virtcloudgame.com:hooks/commit-msg EventServer/.git/hooks/</span></div><div class="line">正克隆到 <span class="string">'EventServer'</span>...</div><div class="line"><span class="string">remote:</span> Counting <span class="string">objects:</span> <span class="number">255</span>, done</div><div class="line"><span class="string">remote:</span> Finding <span class="string">sources:</span> <span class="number">100</span>% (<span class="number">255</span>/<span class="number">255</span>)</div><div class="line"><span class="string">remote:</span> Total <span class="number">255</span> (delta <span class="number">156</span>), reused <span class="number">255</span> (delta <span class="number">156</span>)</div><div class="line">接收对象中: <span class="number">100</span>% (<span class="number">255</span><span class="regexp">/255), 412.77 KiB | 0 bytes/</span>s, 完成.</div><div class="line">处理 delta 中: <span class="number">100</span>% (<span class="number">156</span>/<span class="number">156</span>), 完成.</div><div class="line">检查连接... 完成。</div><div class="line">commit-msg</div></pre></td></tr></table></figure></p>
<p>根据需要，像使用普通的 Git 工程那样，修改代码，commit，然后通过如下命令 push 代码到 Gerrit 进行 Code Review：<br><figure class="highlight elixir"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git push 远程地址 本地分支<span class="symbol">:refs/for/</span>远程分支</div></pre></td></tr></table></figure></p>
<p>如：<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">$ git push origin <span class="string">master:</span>refs<span class="regexp">/for/</span>master</div><div class="line">对象计数中: <span class="number">3</span>, 完成.</div><div class="line">Delta compression using up to <span class="number">8</span> threads.</div><div class="line">压缩对象中: <span class="number">100</span>% (<span class="number">2</span>/<span class="number">2</span>), 完成.</div><div class="line">写入对象中: <span class="number">100</span>% (<span class="number">3</span><span class="regexp">/3), 329 bytes | 0 bytes/</span>s, 完成.</div><div class="line">Total <span class="number">3</span> (delta <span class="number">1</span>), reused <span class="number">0</span> (delta <span class="number">0</span>)</div><div class="line"><span class="string">remote:</span> Resolving <span class="string">deltas:</span> <span class="number">100</span>% (<span class="number">1</span>/<span class="number">1</span>)</div><div class="line"><span class="string">remote:</span> Processing <span class="string">changes:</span> <span class="string">new:</span> <span class="number">1</span>, <span class="string">refs:</span> <span class="number">1</span>, done    </div><div class="line"><span class="string">remote:</span> </div><div class="line"><span class="string">remote:</span> New <span class="string">Changes:</span></div><div class="line"><span class="string">remote:</span>   <span class="string">http:</span><span class="comment">//review.virtcloudgame.com/12 Just for test.</span></div><div class="line"><span class="string">remote:</span> </div><div class="line">To <span class="string">ssh:</span><span class="comment">//admin@review.virtcloudgame.com:29418/EventServer</span></div><div class="line"> * [<span class="keyword">new</span> branch]      master -&gt; refs<span class="regexp">/for/</span>master</div></pre></td></tr></table></figure></p>
<p>在 Gerrit 上将看到刚刚提交的代码：<br><img src="https://www.wolfcstech.com/images/1315506-74cf614902a345dc.png" alt="2017-11-24 19-03-56屏幕截图.png"></p>
<p>Code Review 结束之后，Submit 代码，代码将被提交到 Gerrit 的 Git 仓库，同时被复制到 GitLab 的对应仓库中。</p>
<h3 id="打赏"><a href="#打赏" class="headerlink" title="打赏"></a><a href="https://www.wolfcstech.com/about/donate.html">打赏</a></h3><p>参考文档：<br><a href="http://www.gerrit.com.cn/1568.html" target="_blank" rel="external">Gerrit代码审核服务器搭建全过程</a><br><a href="http://www.gerrit.com.cn/1609.html" target="_blank" rel="external">Gerrit2安装配置</a><br><a href="http://www.gerrit.com.cn/category/use" target="_blank" rel="external">gerrit使用总结</a><br><a href="http://www.hovercool.com/en/Gerrit%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA" target="_blank" rel="external">Gerrit服务器搭建</a><br><a href="http://blog.sina.com.cn/s/blog_75110cc50101hgbh.html" target="_blank" rel="external">gerrit2安装和用Nginx设置HTTP基本验证</a><br><a href="https://gerrit-documentation.storage.googleapis.com/Documentation/2.14.5.1/config-reverseproxy.html" target="_blank" rel="external">Gerrit Code Review - Reverse Proxy</a><br><a href="https://www.bbsmax.com/A/mo5kYQWzwR/" target="_blank" rel="external">Gerrit与Gitlab同步配置replication&amp;其他配置</a><br><a href="http://www.cnblogs.com/juandx/p/5372373.html" target="_blank" rel="external">CentOS安装gitlab，gerrit，jenkins并配置ci流程</a><br><a href="https://linux.die.net/man/1/ssh-keyscan" target="_blank" rel="external">ssh-keyscan(1) - Linux man page</a><br><a href="https://gerrit-documentation.storage.googleapis.com/Documentation/2.14.5.1/config-plugins.html#replication" target="_blank" rel="external">Gerrit Plugins</a><br><a href="https://review.gerrithub.io/plugins/replication/Documentation/config.md" target="_blank" rel="external">Replication Configuration</a><br><a href="https://gerrit.googlesource.com/plugins/replication/+doc/master/src/main/resources/Documentation/config.md" target="_blank" rel="external">Replication Configuration</a><br><a href="http://www.zhixing123.cn/android/use-git-push-to-push-to-gerrit.html" target="_blank" rel="external">使用git push命令提交到gerrit</a></p>
</div><div class="tags"><a href="/tags/后台开发/">后台开发</a><a href="/tags/Java开发/">Java开发</a></div><div class="post-nav"><a href="/2017/11/20/adb_overview/" class="next">关于 ADB 实现的说明</a></div><div id="disqus_thread"></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="widget"><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="请输入关键字..."/></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-gui"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android-图形系统/">Android 图形系统</a><span class="category-list-count">16</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android开发/">Android开发</a><span class="category-list-count">28</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/C-C-开发/">C/C++开发</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java开发/">Java开发</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux内核/">Linux内核</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/live555/">live555</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/业界趣闻/">业界趣闻</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/后台开发/">后台开发</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/安全/">安全</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/网络协议/">网络协议</a><span class="category-list-count">39</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/网络调试/">网络调试</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/随想杂谈/">随想杂谈</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/音视频开发/">音视频开发</a><span class="category-list-count">3</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> 标签</i></div><div class="tagcloud"><a href="/tags/UDT/" style="font-size: 15px;">UDT</a> <a href="/tags/网络协议/" style="font-size: 15px;">网络协议</a> <a href="/tags/Android开发/" style="font-size: 15px;">Android开发</a> <a href="/tags/源码分析/" style="font-size: 15px;">源码分析</a> <a href="/tags/chromium/" style="font-size: 15px;">chromium</a> <a href="/tags/后台开发/" style="font-size: 15px;">后台开发</a> <a href="/tags/Java开发/" style="font-size: 15px;">Java开发</a> <a href="/tags/QUIC/" style="font-size: 15px;">QUIC</a> <a href="/tags/翻译/" style="font-size: 15px;">翻译</a> <a href="/tags/网络调试/" style="font-size: 15px;">网络调试</a> <a href="/tags/OpenGL/" style="font-size: 15px;">OpenGL</a> <a href="/tags/HTTP2/" style="font-size: 15px;">HTTP2</a> <a href="/tags/图形图像/" style="font-size: 15px;">图形图像</a> <a href="/tags/安全/" style="font-size: 15px;">安全</a> <a href="/tags/HTTPS/" style="font-size: 15px;">HTTPS</a> <a href="/tags/C-C-开发/" style="font-size: 15px;">C/C++开发</a> <a href="/tags/音视频开发/" style="font-size: 15px;">音视频开发</a> <a href="/tags/Linux内核/" style="font-size: 15px;">Linux内核</a> <a href="/tags/live555/" style="font-size: 15px;">live555</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/Django/" style="font-size: 15px;">Django</a> <a href="/tags/Go-语言/" style="font-size: 15px;">Go 语言</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-fei"> 归档</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">十一月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">十月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">九月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">八月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">七月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">六月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">五月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">四月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">三月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">二月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">一月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">十二月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">十一月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">十月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">八月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">七月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">四月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">九月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/07/">七月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/09/">九月 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/07/">七月 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/05/">五月 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/02/">二月 2013</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/11/24/gerrit_codereview/">Gerrit代码审核服务器搭建全过程</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11/20/adb_overview/">关于 ADB 实现的说明</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11/19/adb-standalone/">adb standalone</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/31/qcow2_on_linux/">在 Linux 上如何挂载 qcow2 磁盘镜像</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/21/android_graphics_gralloc/">Android 图形系统之gralloc</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/20/android_graphics_bufferalloc/">Android 图形系统之图形缓冲区分配</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/16/opengles_android_emulation/">Android 硬件 OpenGL ES 模拟设计概述</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/15/egl_context_creation/">EGL Context 创建</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/14/egl_init_drivers/">Android 图形驱动初始化</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/13/opengl_on_android_with_sv/">在 Android 中使用 OpenGL</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-you"> 友情链接</i></div><ul></ul><a href="https://developer.android.com/index.html" title="Android Developers" target="_blank">Android Developers</a><ul></ul><a href="https://source.android.com/" title="Android Open Source Project" target="_blank">Android Open Source Project</a><ul></ul><a href="http://www.vants.org/" title="蚂蚁网" target="_blank">蚂蚁网</a></div><div class="widget"><div class="widget-title"><i class="fa fa-commt"> 最近评论</i></div><script type="text/javascript" src="//wolfcstech.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=1&amp;avatar_size=32&amp;excerpt_length=20&amp;hide_mods=1"></script></div></div></div></div><a id="totop" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.2.0" async></script><div id="footer"><div class="footer-info"><p><a href="/baidusitemap.xml">网站地图</a> |<a href="/atom.xml">订阅本站</a> |<span>联系博主：<a href="mailto:hanpfei@gmail.com" target="_blank" class="fa fa-email"> </a><a href="undefined" target="_blank" class="fa fa-weibo"></a><a href="https://github.com/hanpfei" target="_blank" class="fa fa-github"> </a></span></p><p><span> Copyright &copy;<a href="/." rel="nofollow">Han Pengfei</a></span><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span><span><a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake"> Theme </a>by<a rel="nofollow" target="_blank" href="https://github.com/chaooo"> Charles.</a></span></p></div></div></div><script>var disqus_shortname = 'wolfcstech';
var disqus_identifier = '2017/11/24/gerrit_codereview/';
var disqus_title = 'Gerrit代码审核服务器搭建全过程';
var disqus_url = 'https://www.wolfcstech.com/2017/11/24/gerrit_codereview/';
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//wolfcstech.disqus.com/count.js" async></script><script type="text/javascript" src="/js/search.json.js?v=1.2.0"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','UA-109419024-1','auto');ga('send','pageview');
</script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?3c736b12c32c019fd9ff6c825b6b9b44";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();</script></body></html>