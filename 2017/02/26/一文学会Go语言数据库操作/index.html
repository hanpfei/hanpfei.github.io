<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>一文学会Go语言数据库操作 | WolfcsTech</title><link rel="stylesheet" type="text/css" href="//fonts.css.network/css?family=Source+Code+Pro"><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.2.0"><link rel="stylesheet" type="text/css" href="/css/highlight.css?v=1.2.0"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">一文学会Go语言数据库操作</h1><a id="logo" href="/.">WolfcsTech</a><p class="description"></p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">一文学会Go语言数据库操作</h1><div class="post-meta">Feb 26, 2017<span> | </span><span class="category"><a href="/categories/后台开发/">后台开发</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a data-disqus-identifier="2017/02/26/一文学会Go语言数据库操作/" href="/2017/02/26/一文学会Go语言数据库操作/#disqus_thread" class="disqus-comment-count"></a><div class="post-content"><p>对许多 Web 应用程序而言，数据库都是其核心所在。数据库几乎可以用来存储想查询和修改的任何信息，比如用户信息、产品目录或者新闻列表等。<br><a id="more"></a><br>数据库是Web编程不可或缺的主题。这里我们就来看一下如何用 Go 语言操作不同的数据库。</p>
<h1 id="database-sql-接口"><a href="#database-sql-接口" class="headerlink" title="database/sql 接口"></a>database/sql 接口</h1><p>Go 语言不同于 PHP，它没有官方提供任何数据库驱动，而是为开发者定义了一组标准接口。提供数据库服务的开发者，可以实现这组接口，以为特定的数据提供驱动。而数据库的使用者，也可以通过这组接口方便地访问数据库，甚至在适当的时候，以非常小的代价迁移数据库。</p>
<p>通常我们在以类似如下的方式导入数据库驱动模块时：<br><figure class="highlight xl"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span>	_ <span class="string">"github.com/Go-SQL-Driver/MySQL"</span></div></pre></td></tr></table></figure></p>
<p>上面的 <code>import</code> 语句中的下划线表示，我们要导入这个模块，但不会直接使用其中的符号。但导入的时候，会执行模块的初始化代码，也就是其中定义的 <code>init()</code> 函数，在这个函数中数据库驱动会自动将其自身注册进 Go 的 <code>database/sql</code> 框架中，后面我们就可以方便地通过这个接口来访问对应得数据了。</p>
<p>关于这组接口的详细内容，可以参考<a href="http://go-database-sql.org/index.html" target="_blank" rel="external">官方文档</a>。</p>
<h1 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h1><p>目前网上流行的网站架构方式是 LAMP，其中的 M 即为 MySQL。作为数据库，MySQL 以免费、开源、使用方便为优势而成为了许多Web开发的后端数据库存储引擎。</p>
<h2 id="MySQL-安装"><a href="#MySQL-安装" class="headerlink" title="MySQL 安装"></a>MySQL 安装</h2><p>首先我们需要安装 MySQL，这可以通过如下的命令来完成：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ sudo apt <span class="keyword">install</span> mysql-<span class="keyword">server</span></div><div class="line">$ sudo apt-<span class="keyword">get</span> <span class="keyword">install</span> mysql-<span class="keyword">client</span></div><div class="line">$ mysql_secure_installation</div></pre></td></tr></table></figure></p>
<p>安装之后，通过如下命令可以查看 MySQL 服务器占用的端口：<br><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ sudo lsof -i -P</div><div class="line">COMMAND     PID        <span class="keyword">USER</span>   <span class="title">FD</span>   <span class="keyword">TYPE</span> DEVICE SIZE/OFF <span class="keyword">NODE</span> <span class="title">NAME</span></div><div class="line">. . . . . .</div><div class="line">mysqld    <span class="number">17860</span>       mysql   <span class="number">20</span>u  IPv4 <span class="number">136588</span>      <span class="number">0</span>t0  TCP localhost:<span class="number">3306</span> (LISTEN)</div></pre></td></tr></table></figure></p>
<p>可以看到 MySQL 服务器在 TCP 的 <strong><em>3306</em></strong> 端口监听请求。</p>
<h2 id="新MySQL建用户"><a href="#新MySQL建用户" class="headerlink" title="新MySQL建用户"></a>新MySQL建用户</h2><p>安装好了 MySQL 之后，我们还需要创建用户，以便于后面在代码里使用。创建用户的方法如下：<br><figure class="highlight vala"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">## 登录MYSQL</span></div><div class="line">$ mysql -u root -p</div><div class="line">Enter password:</div><div class="line"><span class="meta">## 创建用户</span></div><div class="line">mysql&gt; CREATE USER <span class="string">'hanpfei'</span>@<span class="string">'localhost'</span> IDENTIFIED BY <span class="string">'hanpfei'</span>;</div><div class="line"><span class="meta">## 刷新系统权限表</span></div><div class="line">mysql&gt;flush privileges;</div></pre></td></tr></table></figure></p>
<p>这样就创建了一个名为 <code>hanpfei</code>，密码为 <code>hanpfei</code> 的用户。</p>
<p>然后登录一下。<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">mysql&gt; <span class="keyword">exit</span>;</div><div class="line">$ mysql -u hanpfei -p</div><div class="line">Enter password: </div><div class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</div><div class="line">Your MySQL connection id is <span class="number">11</span></div><div class="line">Server version: <span class="number">5.7</span>.<span class="number">17</span>-<span class="number">0</span>ubuntu0.<span class="number">16.04</span>.<span class="number">1</span> (Ubuntu)</div><div class="line">. . . . . .</div><div class="line">mysql&gt;</div></pre></td></tr></table></figure></p>
<h2 id="创建数据库并为用户授权"><a href="#创建数据库并为用户授权" class="headerlink" title="创建数据库并为用户授权"></a>创建数据库并为用户授权</h2><p>登录MYSQL（有ROOT权限）。我里我以 ROOT 身份登录.<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$ mysql -u root -p</div><div class="line">Enter password: </div><div class="line">Welcome <span class="keyword">to</span> <span class="keyword">the</span> MySQL monitor.  Commands <span class="keyword">end</span> <span class="keyword">with</span> ; <span class="keyword">or</span> \g.</div><div class="line">Your MySQL connection <span class="built_in">id</span> <span class="keyword">is</span> <span class="number">12</span></div><div class="line">Server <span class="built_in">version</span>: <span class="number">5.7</span><span class="number">.17</span><span class="number">-0</span>ubuntu0<span class="number">.16</span><span class="number">.04</span><span class="number">.1</span> (Ubuntu)</div></pre></td></tr></table></figure></p>
<p>为用户创建一个数据库 (<code>staff_info_db</code>)<br><figure class="highlight abnf"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mysql&gt;create database staff_info_db<span class="comment">;</span></div></pre></td></tr></table></figure></p>
<p>授权 <code>hanpfei</code> 用户拥有 <code>staff_info_db</code> 数据库的所有权限。<br><figure class="highlight lasso"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mysql&gt;grant <span class="literal">all</span> privileges <span class="keyword">on</span> staff_info_db.* <span class="keyword">to</span> hanpfei@localhost identified <span class="keyword">by</span> <span class="string">'hanpfei'</span>;</div></pre></td></tr></table></figure></p>
<p>刷新系统权限表<br><figure class="highlight excel"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mysql&gt; flush privileges;</div><div class="line">Query OK, <span class="number">0</span> <span class="built_in">rows</span> affected (<span class="number">0.00</span> <span class="built_in">sec</span>)</div></pre></td></tr></table></figure></p>
<h2 id="创建表"><a href="#创建表" class="headerlink" title="创建表"></a>创建表</h2><p>有了数据库，接下来就是创建表了。建表语句如下：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`userinfo1`</span> (</div><div class="line">    <span class="string">`uid`</span> <span class="built_in">INT</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</div><div class="line">    <span class="string">`username`</span> <span class="built_in">VARCHAR</span>(<span class="number">64</span>) <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</div><div class="line">    <span class="string">`departname`</span> <span class="built_in">VARCHAR</span>(<span class="number">64</span>) <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</div><div class="line">    <span class="string">`created`</span> <span class="built_in">DATE</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</div><div class="line">    PRIMARY <span class="keyword">KEY</span> (<span class="string">`uid`</span>)</div><div class="line">);</div><div class="line"></div><div class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`userdetail`</span> (</div><div class="line">    <span class="string">`uid`</span> <span class="built_in">INT</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'0'</span>,</div><div class="line">    <span class="string">`intro`</span> <span class="built_in">TEXT</span> <span class="literal">NULL</span>,</div><div class="line">    <span class="string">`profile`</span> <span class="built_in">TEXT</span> <span class="literal">NULL</span>,</div><div class="line">    PRIMARY <span class="keyword">KEY</span> (<span class="string">`uid`</span>)</div><div class="line">);</div></pre></td></tr></table></figure></p>
<p>具体的建表可以通过如下得命令来完成：<br><figure class="highlight lasso"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">$ mysql <span class="params">-u</span> hanpfei <span class="params">-p</span></div><div class="line">Enter password: </div><div class="line">Welcome <span class="keyword">to</span> the MySQL monitor.  Commands end <span class="keyword">with</span> ; <span class="literal">or</span> \g.</div><div class="line">Your MySQL connection id is <span class="number">18</span></div><div class="line">Server version: <span class="number">5.7</span><span class="number">.17</span><span class="number">-0</span>ubuntu0<span class="number">.16</span><span class="number">.04</span><span class="number">.1</span> (Ubuntu)</div><div class="line"></div><div class="line">Copyright (c) <span class="number">2000</span>, <span class="number">2016</span>, Oracle <span class="literal">and</span>/<span class="literal">or</span> its affiliates. <span class="literal">All</span> rights reserved.</div><div class="line"></div><div class="line">Oracle is a registered trademark of Oracle Corporation <span class="literal">and</span>/<span class="literal">or</span> its</div><div class="line">affiliates. Other names may be trademarks of their respective</div><div class="line">owners.</div><div class="line"></div><div class="line"><span class="keyword">Type</span> <span class="string">'help;'</span> <span class="literal">or</span> <span class="string">'\h'</span> for help. <span class="keyword">Type</span> <span class="string">'\c'</span> <span class="keyword">to</span> clear the current input statement.</div><div class="line"></div><div class="line">mysql&gt; use staff_info_db;</div><div class="line">Reading table information for completion of table <span class="literal">and</span> column names</div><div class="line">You can turn off this feature <span class="keyword">to</span> get a quicker startup <span class="keyword">with</span> <span class="params">-A</span></div><div class="line"></div><div class="line">Database changed</div><div class="line">mysql&gt; CREATE TABLE <span class="string">`userinfo`</span> (</div><div class="line">    -&gt;     <span class="string">`uid`</span> INT(<span class="number">10</span>) <span class="literal">NOT</span> <span class="built_in">NULL</span> AUTO_INCREMENT,</div><div class="line">    -&gt;     <span class="string">`username`</span> VARCHAR(<span class="number">64</span>) <span class="built_in">NULL</span> DEFAULT <span class="built_in">NULL</span>,</div><div class="line">    -&gt;     <span class="string">`departname`</span> VARCHAR(<span class="number">64</span>) <span class="built_in">NULL</span> DEFAULT <span class="built_in">NULL</span>,</div><div class="line">    -&gt;     <span class="string">`created`</span> <span class="built_in">DATE</span> <span class="built_in">NULL</span> DEFAULT <span class="built_in">NULL</span>,</div><div class="line">    -&gt;     PRIMARY KEY (<span class="string">`uid`</span>)</div><div class="line">    -&gt; );</div><div class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.80</span> sec)</div><div class="line"></div><div class="line">mysql&gt; CREATE TABLE <span class="string">`userdetail`</span> (</div><div class="line">    -&gt;     <span class="string">`uid`</span> INT(<span class="number">10</span>) <span class="literal">NOT</span> <span class="built_in">NULL</span> DEFAULT <span class="string">'0'</span>,</div><div class="line">    -&gt;     <span class="string">`intro`</span> TEXT <span class="built_in">NULL</span>,</div><div class="line">    -&gt;     <span class="string">`profile`</span> TEXT <span class="built_in">NULL</span>,</div><div class="line">    -&gt;     PRIMARY KEY (<span class="string">`uid`</span>)</div><div class="line">    -&gt; );</div><div class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.80</span> sec)</div><div class="line">mysql&gt; exit</div><div class="line">Bye</div></pre></td></tr></table></figure></p>
<p>这样我们需要的表就建好了。</p>
<h2 id="用-Go-语言访问-MySQL"><a href="#用-Go-语言访问-MySQL" class="headerlink" title="用 Go 语言访问 MySQL"></a>用 Go 语言访问 MySQL</h2><p>安装好了数据库，并创建了适当的用户、数据库以及数据库表之后，我们就可以开始用 Go 语言访问 MySQL了。然而，在实际写代码之前，还要先下载对应的驱动。Go 语言中支持 MySQL 的驱动目前比较多，我们以支持 Go 语言标准 <code>database/sql</code> 接口的 <code>github.com/Go-SQL-Driver/MySQL</code> 为例来看。我们先要下载这个包：<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ <span class="keyword">go</span> <span class="built_in">get</span> github.<span class="keyword">com</span>/Go-SQL-Driver/MySQL</div></pre></td></tr></table></figure></p>
<p>然后来看如何使用 <code>database/sql</code> 接口对数据库表进行增删改查操作：<br><figure class="highlight stata"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div></pre></td><td class="code"><pre><div class="line">package main</div><div class="line"></div><div class="line">import (</div><div class="line">	_ <span class="string">"github.com/Go-SQL-Driver/MySQL"</span></div><div class="line">	<span class="string">"fmt"</span></div><div class="line">	<span class="string">"database/sql"</span></div><div class="line">)</div><div class="line"></div><div class="line">func checkErr(<span class="keyword">err</span> <span class="keyword">error</span>)  &#123;</div><div class="line">	<span class="keyword">if</span> <span class="keyword">err</span> != nil &#123;</div><div class="line">		panic(<span class="keyword">err</span>)</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">func mysqlTest()  &#123;</div><div class="line">	<span class="keyword">db</span>, <span class="keyword">err</span> := sql.<span class="keyword">Open</span>(<span class="string">"mysql"</span>, <span class="string">"hanpfei:hanpfei@/staff_info_db?charset=utf8"</span>)</div><div class="line">	checkErr(<span class="keyword">err</span>)</div><div class="line">	defer <span class="keyword">db</span>.<span class="keyword">Close</span>()</div><div class="line"></div><div class="line">	<span class="comment">// Insert</span></div><div class="line">	stmt, <span class="keyword">err</span> := <span class="keyword">db</span>.Prepare(<span class="string">"INSERT userinfo SET username=?,departname=?,created=?"</span>)</div><div class="line">	checkErr(<span class="keyword">err</span>)</div><div class="line"></div><div class="line">	res, <span class="keyword">err</span> := stmt.Exec(<span class="string">"hanpfei"</span>, <span class="string">"R&amp;D Department"</span>, <span class="string">"2016-05-23"</span>)</div><div class="line">	checkErr(<span class="keyword">err</span>)</div><div class="line"></div><div class="line">	id, <span class="keyword">err</span> := res.LastInsertId()</div><div class="line">	checkErr(<span class="keyword">err</span>)</div><div class="line"></div><div class="line">	fmt.Println(id)</div><div class="line"></div><div class="line">	<span class="comment">// Update</span></div><div class="line">	stmt, <span class="keyword">err</span> = <span class="keyword">db</span>.Prepare(<span class="string">"UPDATE userinfo SET username=? where uid=?"</span>)</div><div class="line">	checkErr(<span class="keyword">err</span>)</div><div class="line"></div><div class="line">	res, <span class="keyword">err</span> = stmt.Exec(<span class="string">"hanpfeiupdate"</span>, id)</div><div class="line">	checkErr(<span class="keyword">err</span>)</div><div class="line"></div><div class="line">	affect, <span class="keyword">err</span> := res.RowsAffected()</div><div class="line">	checkErr(<span class="keyword">err</span>)</div><div class="line"></div><div class="line">	fmt.Println(affect)</div><div class="line"></div><div class="line">	<span class="comment">// Query</span></div><div class="line">	rows, <span class="keyword">err</span> := <span class="keyword">db</span>.<span class="keyword">Query</span>(<span class="string">"SELECT * FROM userinfo"</span>)</div><div class="line">	checkErr(<span class="keyword">err</span>)</div><div class="line"></div><div class="line">	<span class="keyword">for</span> rows.Next() &#123;</div><div class="line">		<span class="keyword">var</span> uid int</div><div class="line">		<span class="keyword">var</span> username <span class="built_in">string</span></div><div class="line">		<span class="keyword">var</span> department <span class="built_in">string</span></div><div class="line">		<span class="keyword">var</span> created <span class="built_in">string</span></div><div class="line">		<span class="keyword">err</span> = rows.Scan(&amp;uid, &amp;username, &amp;department, &amp; created)</div><div class="line">		checkErr(<span class="keyword">err</span>)</div><div class="line">		fmt.Println(uid)</div><div class="line">		fmt.Println(username)</div><div class="line">		fmt.Println(department)</div><div class="line">		fmt.Println(created)</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">// Delete data</span></div><div class="line">	stmt, <span class="keyword">err</span> = <span class="keyword">db</span>.Prepare(<span class="string">"DELETE from userinfo where uid=?"</span>)</div><div class="line">	checkErr(<span class="keyword">err</span>)</div><div class="line"></div><div class="line">	res, <span class="keyword">err</span> = stmt.Exec(id)</div><div class="line">	checkErr(<span class="keyword">err</span>)</div><div class="line"></div><div class="line">	affect, <span class="keyword">err</span> = res.RowsAffected()</div><div class="line">	checkErr(<span class="keyword">err</span>)</div><div class="line"></div><div class="line">	fmt.Println(affect)</div><div class="line"></div><div class="line">	checkErr(<span class="keyword">err</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line">func main()  &#123;</div><div class="line">	mysqlTest()</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>通过以上代码，可以看出来 Go 语言操作 MySQL 数据库还是非常方便的。关于这个数据库驱动的用法更详细的信息，可以参考其 <a href="https://godoc.org/github.com/go-sql-driver/mysql" target="_blank" rel="external">官方文档</a>。</p>
<h1 id="SQLite3"><a href="#SQLite3" class="headerlink" title="SQLite3"></a>SQLite3</h1><p>SQLite 是一个开源的嵌入式系统的关系型数据库，它是实现自包容、零配置且支持事务的 SQL 数据库引擎。其特点是高度便携、结构紧凑、高效且可靠。与其它许多数据库相比，SQLite 的安装运行都非常简单。大多数情况下，只要确保 SQLite 的二进制文件存在，即可创建和访问数据库。</p>
<p>可以通过如下的命令来安装 SQLite：<br><figure class="highlight q"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo apt-<span class="built_in">get</span> install libsqlite3<span class="number">-0</span> libsqlite3-<span class="built_in">dev</span></div></pre></td></tr></table></figure></p>
<p>SQLite 的命令行工具可装可不装，不影响我们通过代码操作 SQLite 数据库。</p>
<p>同样我们需要选择一款 SQLite 驱动。Go 语言支持 SQLite 的驱动也比较多，但好多都不支持 <code>database/sql</code> 接口。这里我们选择支持 <code>database/sql</code> 接口的 <code>github.com/mattn/go-sqlite3</code>。</p>
<p>在开始写代码前，要先安装这个驱动：<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ <span class="keyword">go</span> <span class="built_in">get</span> github.<span class="keyword">com</span>/mattn/<span class="keyword">go</span>-sqlite3</div></pre></td></tr></table></figure></p>
<p>建表的语句如下：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`userinfo`</span> (</div><div class="line">    <span class="string">`uid`</span> <span class="built_in">INTEGER</span> PRIMARY <span class="keyword">KEY</span> AUTOINCREMENT,</div><div class="line">    <span class="string">`username`</span> <span class="built_in">VARCHAR</span>(<span class="number">64</span>) <span class="literal">NULL</span>,</div><div class="line">    <span class="string">`departname`</span> <span class="built_in">VARCHAR</span>(<span class="number">64</span>) <span class="literal">NULL</span>,</div><div class="line">    <span class="string">`created`</span> <span class="built_in">DATE</span> <span class="literal">NULL</span></div><div class="line">);</div><div class="line"></div><div class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`userdetail`</span> (</div><div class="line">    <span class="string">`uid`</span> <span class="built_in">INT</span>(<span class="number">10</span>) <span class="literal">NULL</span>,</div><div class="line">    <span class="string">`intro`</span> <span class="built_in">TEXT</span> <span class="literal">NULL</span>,</div><div class="line">    <span class="string">`profile`</span> <span class="built_in">TEXT</span> <span class="literal">NULL</span>,</div><div class="line">    PRIMARY <span class="keyword">KEY</span> (<span class="string">`uid`</span>)</div><div class="line">);</div></pre></td></tr></table></figure></p>
<p>不过我们同样通过代码来完成建表了。然后来看在 Go 语言中，具体如何操作 SQLite ：<br><figure class="highlight stata"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div></pre></td><td class="code"><pre><div class="line">package main</div><div class="line"></div><div class="line">import (</div><div class="line">	_ <span class="string">"github.com/mattn/go-sqlite3"</span></div><div class="line">	<span class="string">"database/sql"</span></div><div class="line">	<span class="string">"fmt"</span></div><div class="line">)</div><div class="line"></div><div class="line">func checkErr(<span class="keyword">err</span> <span class="keyword">error</span>)  &#123;</div><div class="line">	<span class="keyword">if</span> <span class="keyword">err</span> != nil &#123;</div><div class="line">		panic(<span class="keyword">err</span>)</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">func testOperationForSqlite3(<span class="keyword">db</span> *sql.<span class="keyword">DB</span>)  &#123;</div><div class="line">	<span class="comment">// Insert</span></div><div class="line">	stmt, <span class="keyword">err</span> := <span class="keyword">db</span>.Prepare(<span class="string">"INSERT INTO userinfo(username, departname, created) values(?,?,?)"</span>)</div><div class="line">	checkErr(<span class="keyword">err</span>)</div><div class="line"></div><div class="line">	res, <span class="keyword">err</span> := stmt.Exec(<span class="string">"hanpfei"</span>, <span class="string">"R&amp;D Department"</span>, <span class="string">"2016-05-23"</span>)</div><div class="line">	checkErr(<span class="keyword">err</span>)</div><div class="line"></div><div class="line">	id, <span class="keyword">err</span> := res.LastInsertId()</div><div class="line">	checkErr(<span class="keyword">err</span>)</div><div class="line"></div><div class="line">	fmt.Println(id)</div><div class="line"></div><div class="line">	<span class="comment">// Update</span></div><div class="line">	stmt, <span class="keyword">err</span> = <span class="keyword">db</span>.Prepare(<span class="string">"UPDATE userinfo SET username=? where uid=?"</span>)</div><div class="line">	checkErr(<span class="keyword">err</span>)</div><div class="line"></div><div class="line">	res, <span class="keyword">err</span> = stmt.Exec(<span class="string">"hanpfeiupdate"</span>, id)</div><div class="line">	checkErr(<span class="keyword">err</span>)</div><div class="line"></div><div class="line">	affect, <span class="keyword">err</span> := res.RowsAffected()</div><div class="line">	checkErr(<span class="keyword">err</span>)</div><div class="line"></div><div class="line">	fmt.Println(affect)</div><div class="line"></div><div class="line">	<span class="comment">// Query</span></div><div class="line">	rows, <span class="keyword">err</span> := <span class="keyword">db</span>.<span class="keyword">Query</span>(<span class="string">"SELECT * FROM userinfo"</span>)</div><div class="line">	checkErr(<span class="keyword">err</span>)</div><div class="line"></div><div class="line">	<span class="keyword">for</span> rows.Next() &#123;</div><div class="line">		<span class="keyword">var</span> uid int</div><div class="line">		<span class="keyword">var</span> username <span class="built_in">string</span></div><div class="line">		<span class="keyword">var</span> department <span class="built_in">string</span></div><div class="line">		<span class="keyword">var</span> created <span class="built_in">string</span></div><div class="line">		<span class="keyword">err</span> = rows.Scan(&amp;uid, &amp;username, &amp;department, &amp; created)</div><div class="line">		checkErr(<span class="keyword">err</span>)</div><div class="line">		fmt.Println(uid)</div><div class="line">		fmt.Println(username)</div><div class="line">		fmt.Println(department)</div><div class="line">		fmt.Println(created)</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">// Delete data</span></div><div class="line">	stmt, <span class="keyword">err</span> = <span class="keyword">db</span>.Prepare(<span class="string">"DELETE from userinfo where uid=?"</span>)</div><div class="line">	checkErr(<span class="keyword">err</span>)</div><div class="line"></div><div class="line">	res, <span class="keyword">err</span> = stmt.Exec(id)</div><div class="line">	checkErr(<span class="keyword">err</span>)</div><div class="line"></div><div class="line">	affect, <span class="keyword">err</span> = res.RowsAffected()</div><div class="line">	checkErr(<span class="keyword">err</span>)</div><div class="line"></div><div class="line">	fmt.Println(affect)</div><div class="line"></div><div class="line">	checkErr(<span class="keyword">err</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line">func createTableForSqlite3(<span class="keyword">db</span> *sql.<span class="keyword">DB</span>)  &#123;</div><div class="line">	createTableCommand := <span class="string">"CREATE TABLE userinfo (uid INTEGER PRIMARY KEY AUTOINCREMENT, username VARCHAR(64) NULL, "</span> +</div><div class="line">		<span class="string">"departname VARCHAR(64) NULL, created DATE NULL);"</span></div><div class="line"></div><div class="line">	stmt, <span class="keyword">err</span> := <span class="keyword">db</span>.Prepare(createTableCommand)</div><div class="line">	checkErr(<span class="keyword">err</span>)</div><div class="line"></div><div class="line">	_, <span class="keyword">err</span> = stmt.Exec()</div><div class="line">	checkErr(<span class="keyword">err</span>)</div><div class="line"></div><div class="line">	createTableCommand = <span class="string">"CREATE TABLE userdetail (uid INT(10) NULL, intro TEXT NULL, profile TEXT NULL, PRIMARY KEY (uid));"</span></div><div class="line"></div><div class="line">	stmt, <span class="keyword">err</span> = <span class="keyword">db</span>.Prepare(createTableCommand)</div><div class="line">	checkErr(<span class="keyword">err</span>)</div><div class="line"></div><div class="line">	_, <span class="keyword">err</span> = stmt.Exec()</div><div class="line">	checkErr(<span class="keyword">err</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line">func sqlite3Test()  &#123;</div><div class="line">	<span class="keyword">db</span>, <span class="keyword">err</span> := sql.<span class="keyword">Open</span>(<span class="string">"sqlite3"</span>, <span class="string">"./foo.db"</span>)</div><div class="line">	checkErr(<span class="keyword">err</span>)</div><div class="line">	defer <span class="keyword">db</span>.<span class="keyword">Close</span>()</div><div class="line"></div><div class="line">	createTableForSqlite3(<span class="keyword">db</span>)</div><div class="line">	testOperationForSqlite3(<span class="keyword">db</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line">func main()  &#123;</div><div class="line">	sqlite3Test()</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>执行上面的代码，将看到如下的输出：<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="regexp">/usr/</span>lib<span class="regexp">/go/</span>bin<span class="regexp">/go run /</span>home<span class="regexp">/hanpfei0306/</span>IdeaProjects<span class="regexp">/HelloGo/</span>Sqlite3.go</div><div class="line"><span class="number">1</span></div><div class="line"><span class="number">1</span></div><div class="line"><span class="number">1</span></div><div class="line">hanpfeiupdate</div><div class="line">R&amp;D Department</div><div class="line"><span class="number">2016</span>-<span class="number">05</span>-<span class="number">23</span>T00:<span class="number">00</span>:<span class="number">00</span>Z</div><div class="line"><span class="number">1</span></div><div class="line"></div><div class="line">Process finished with <span class="keyword">exit</span> code <span class="number">0</span></div></pre></td></tr></table></figure></p>
<p>我们可以看到，上面操作 SQLite 数据库的代码，和前面操作 MySQL 数据库的代码几乎一模一样。仅有的改变是导入的驱动变了，然后调用 <code>sql,Open()</code> 打开数据库驱动的方式不同。</p>
<h1 id="PostgreSQL"><a href="#PostgreSQL" class="headerlink" title="PostgreSQL"></a>PostgreSQL</h1><p>PostgreSQL 是一个开源的自由的对象-关系数据库服务器，它以灵活的 BSD-Style 许可发行。相对于其它许多的开源数据库系统（如 MySQL 和 Firebird）和商业数据库系统（如 Oracle 和 MS SQL Server），它为我们提供了另外的一种选择。</p>
<p>PostgreSQL 相对于 MySQL 而言更加庞大，因为它本是为替代 Oracle 而设计。</p>
<p>这里我们就来看一下如何用 Go 语言操作 PostgreSQL。</p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>我们首先要安装 PostgreSQL 服务器。使用如下命令，会自动安装最新版，这里为 <code>9.5</code>：<br><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo apt-<span class="keyword">get</span> install postgresql</div></pre></td></tr></table></figure></p>
<p>安装完成后，默认会：<br>（1）创建名为 “postgres” 的Linux用户<br>（2）创建名为 “postgres”、不带密码的默认数据库账号作为数据库管理员<br>（3）创建名为 “postgres” 的表</p>
<p>安装完成后的一些默认信息如下：<br><figure class="highlight crystal"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">config /etc/postgresql/<span class="number">9.5</span>/main </div><div class="line">data /var/<span class="class"><span class="keyword">lib</span>/<span class="title">postgresql</span>/9.5/<span class="title">main</span> </span></div><div class="line">locale en_US.UTF-<span class="number">8</span> </div><div class="line">socket /var/run/postgresql </div><div class="line">port <span class="number">5432</span></div></pre></td></tr></table></figure></p>
<p>通过 <code>lsof -i</code> 命令我们可以查看 PostgreSQL 服务器占用的端口，并确认其在正常运行：<br><figure class="highlight tap"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">$ sudo lsof -i -P</div><div class="line">. . . . . .</div><div class="line">postgres <span class="number"> 24581 </span>   postgres    6u  IPv6<span class="number"> 284716 </span>     0t0  TCP localhost:5432 (LISTEN)</div><div class="line">postgres <span class="number"> 24581 </span>   postgres    7u  IPv4<span class="number"> 284717 </span>     0t0  TCP localhost:5432 (LISTEN)</div><div class="line">postgres <span class="number"> 24581 </span>   postgres   11u  IPv6<span class="number"> 279448 </span>     0t0  UDP localhost:42368-&gt;localhost:42368 </div><div class="line">postgres <span class="number"> 24583 </span>   postgres   11u  IPv6<span class="number"> 279448 </span>     0t0  UDP localhost:42368-&gt;localhost:42368 </div><div class="line">postgres <span class="number"> 24584 </span>   postgres   11u  IPv6<span class="number"> 279448 </span>     0t0  UDP localhost:42368-&gt;localhost:42368 </div><div class="line">postgres <span class="number"> 24585 </span>   postgres   11u  IPv6<span class="number"> 279448 </span>     0t0  UDP localhost:42368-&gt;localhost:42368 </div><div class="line">postgres <span class="number"> 24586 </span>   postgres   11u  IPv6<span class="number"> 279448 </span>     0t0  UDP localhost:42368-&gt;localhost:42368 </div><div class="line">postgres <span class="number"> 24587 </span>   postgres   11u  IPv6<span class="number"> 279448 </span>     0t0  UDP localhost:42368-&gt;localhost:42368</div></pre></td></tr></table></figure></p>
<p>可以看到 PostgreSQL 服务器在 TCP 的 <strong><em>5432</em></strong> 端口上监听请求，并开启了多个进程来监听。</p>
<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><p>安装完后会有 PostgreSQL 的客户端 psql 可以用，通过 <code>sudo -u postgres psql</code> 进入，提示符变成 <code>postgres=#</code>：<br><figure class="highlight dos"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$ sudo -u postgres psql</div><div class="line">psql (<span class="number">9</span>.<span class="number">5</span>.<span class="number">6</span>)</div><div class="line"><span class="built_in">Type</span> "<span class="built_in">help</span>" <span class="keyword">for</span> <span class="built_in">help</span>.</div><div class="line"></div><div class="line">postgres=#</div></pre></td></tr></table></figure></p>
<p>在这里可以执行 SQL 语句和 psql 的基本命令。</p>
<h2 id="新建-PostgreSQL用户"><a href="#新建-PostgreSQL用户" class="headerlink" title="新建 PostgreSQL用户"></a>新建 PostgreSQL用户</h2><p>我们可以通过如下的命令<br><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">postgres</span>=# CREATE USER hanpfei PASSWORD <span class="string">'hanpfei'</span> CREATEDB;</div><div class="line"><span class="attribute">CREATE ROLE</span></div></pre></td></tr></table></figure></p>
<p>通过 <code>\du</code> 可以查看当前已经存在的用户列表：</p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">postgres=# \du</div><div class="line"><span class="code">                                   List of roles</span></div><div class="line"><span class="section"> Role name |                         Attributes                         | Member of </span></div><div class="line">-----------+------------------------------------------------------------+-----------</div><div class="line"><span class="code"> hanpfei   | Create DB                                                  | &#123;&#125;</span></div><div class="line"><span class="code"> postgres  | Superuser, Create role, Create DB, Replication, Bypass RLS | &#123;&#125;</span></div></pre></td></tr></table></figure>
<p>此时我们以新创建的用户登录PostgreSQL，会报出如下得error：<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ sudo -u postgres psql -U hanpfei</div><div class="line"><span class="string">psql:</span> <span class="string">FATAL:</span>  Peer authentication failed <span class="keyword">for</span> user <span class="string">"hanpfei"</span></div></pre></td></tr></table></figure></p>
<p>我们可以通过修改 <code>pg_hba.conf</code> 文件来解决这个问题：<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo gedit <span class="regexp">/etc/</span>postgresql<span class="regexp">/9.5/m</span>ain<span class="regexp">/pg_hba.conf</span></div></pre></td></tr></table></figure></p>
<p>将其中 <strong><em>除 <code>postgres</code> 用户外</em></strong> 的所有用户的 <code>METHOD</code> 都从 <code>peer</code> 或 <code>ident</code> 改为 <code>md5</code> 或 <code>trust</code>。</p>
<p>修改完毕，保存退出。</p>
<p>然后执行如下命令重新加载配置：<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ <span class="regexp">/etc/i</span>nit.d<span class="regexp">/postgresql reload</span></div></pre></td></tr></table></figure></p>
<p>再次尝试用新创建的用户的登录 PostgreSQL 时报出了新的 error：<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ sudo -u postgres psql -U hanpfei</div><div class="line">Password <span class="keyword">for</span> user <span class="string">hanpfei:</span> </div><div class="line"><span class="string">psql:</span> <span class="string">FATAL:</span>  database <span class="string">"hanpfei"</span> does not exist</div></pre></td></tr></table></figure></p>
<p>提示用户的数据库不存在。我们还需要再次登录 <code>postgres</code> 用户，为我们的新用户创建数据库：<br><figure class="highlight gauss"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">$ sudo -u postgres psql</div><div class="line">psql (<span class="number">9.5</span><span class="number">.6</span>)</div><div class="line"><span class="built_in">Type</span> <span class="string">"help"</span> <span class="keyword">for</span> help.</div><div class="line"></div><div class="line">postgres=<span class="meta"># create database hanpfei;</span></div><div class="line"><span class="keyword">CREATE</span> DATABASE</div><div class="line">postgres=<span class="meta"># \q</span></div></pre></td></tr></table></figure></p>
<p>然后就可以以新用户登录了：<br><figure class="highlight coq"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">$ sudo -u postgres psql -U hanpfei</div><div class="line">[sudo] hanpfei0306 的密码： </div><div class="line">Password <span class="keyword">for</span> user hanpfei: </div><div class="line">psql (<span class="number">9.5</span><span class="number">.6</span>)</div><div class="line"><span class="keyword">Type</span> <span class="string">"help"</span> <span class="keyword">for</span> help.</div><div class="line"></div><div class="line">hanpfei=&gt;</div></pre></td></tr></table></figure></p>
<p>这里我们需要输入两次密码，一次是当前 Linux 用户的用户密码，用来执行 sudo，另一次是数据库的用户的密码，用来登录数据库。</p>
<p>接着我们创建一个新的应用数据库，并选择它作为我们当前使用的数据库，这可以通过 <code>\c</code>命令来实现：<br><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">hanpfei=&gt; \l</div><div class="line">                                    List of databases</div><div class="line">     Name      |<span class="string">  Owner   </span>|<span class="string"> Encoding </span>|<span class="string">   Collate   </span>|<span class="string">    Ctype    </span>|<span class="string">   Access privileges   </span></div><div class="line">---------------+----------+----------+-------------+-------------+-----------------------</div><div class="line"> hanpfei       |<span class="string"> postgres </span>|<span class="string"> UTF8     </span>|<span class="string"> zh_CN.UTF-8 </span>|<span class="string"> zh_CN.UTF-8 </span>|<span class="string"> </span></div><div class="line"> postgres      |<span class="string"> postgres </span>|<span class="string"> UTF8     </span>|<span class="string"> zh_CN.UTF-8 </span>|<span class="string"> zh_CN.UTF-8 </span>|<span class="string"> </span></div><div class="line"> staff_info_db |<span class="string"> hanpfei  </span>|<span class="string"> UTF8     </span>|<span class="string"> zh_CN.UTF-8 </span>|<span class="string"> zh_CN.UTF-8 </span>|<span class="string"> </span></div><div class="line"> template0     |<span class="string"> postgres </span>|<span class="string"> UTF8     </span>|<span class="string"> zh_CN.UTF-8 </span>|<span class="string"> zh_CN.UTF-8 </span>|<span class="string"> =c/postgres          +</span></div><div class="line">               |<span class="string">          </span>|<span class="string">          </span>|<span class="string">             </span>|<span class="string">             </span>|<span class="string"> postgres=CTc/postgres</span></div><div class="line"> template1     |<span class="string"> postgres </span>|<span class="string"> UTF8     </span>|<span class="string"> zh_CN.UTF-8 </span>|<span class="string"> zh_CN.UTF-8 </span>|<span class="string"> =c/postgres          +</span></div><div class="line">               |<span class="string">          </span>|<span class="string">          </span>|<span class="string">             </span>|<span class="string">             </span>|<span class="string"> postgres=CTc/postgres</span></div><div class="line">(5 rows)</div><div class="line"></div><div class="line">hanpfei=&gt; create database staff_info_db;</div><div class="line"></div><div class="line">hanpfei=&gt; \c staff_info_db;</div><div class="line">You are now connected to database "staff_info_db" as user "hanpfei".</div><div class="line"></div><div class="line">staff_info_db=&gt;</div></pre></td></tr></table></figure></p>
<p>上面的 <code>\l</code> 是用来列出当前已创建的所有数据库的。注意我们切换了数据库之后，命令输入提示字符串也变为了新数据库的名字。</p>
<p>然后创建表。建表语句如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> userinfo (</div><div class="line">    uid <span class="built_in">serial</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</div><div class="line">    username <span class="built_in">character</span> <span class="built_in">varying</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</div><div class="line">    departname <span class="built_in">character</span> <span class="built_in">varying</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</div><div class="line">    created <span class="built_in">date</span>,</div><div class="line">    <span class="keyword">CONSTRAINT</span> userinfo_pkey PRIMARY <span class="keyword">KEY</span> (uid)</div><div class="line">)</div><div class="line"><span class="keyword">WITH</span> (OIDS=<span class="literal">FALSE</span>);</div><div class="line"></div><div class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> userdetail (</div><div class="line">    uid <span class="built_in">integer</span>,</div><div class="line">    intro <span class="built_in">character</span> <span class="built_in">varying</span>(<span class="number">100</span>),</div><div class="line">    profile <span class="built_in">character</span> <span class="built_in">varying</span>(<span class="number">100</span>)</div><div class="line">)</div><div class="line"><span class="keyword">WITH</span> (OIDS=<span class="literal">FALSE</span>);</div></pre></td></tr></table></figure>
<p>具体命令则是：<br><figure class="highlight lisp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">staff_info_db=&gt; CREATE TABLE userinfo (</div><div class="line"><span class="name">staff_info_db</span>(<span class="name">&gt;</span>     uid serial NOT NULL,</div><div class="line">staff_info_db(<span class="name">&gt;</span>     username character varying(<span class="number">100</span>) NOT NULL,</div><div class="line">staff_info_db(<span class="name">&gt;</span>     departname character varying(<span class="number">100</span>) NOT NULL,</div><div class="line">staff_info_db(<span class="name">&gt;</span>     created date,</div><div class="line">staff_info_db(<span class="name">&gt;</span>     CONSTRAINT userinfo_pkey PRIMARY KEY (<span class="name">uid</span>)</div><div class="line">staff_info_db(<span class="name">&gt;</span> )</div><div class="line">staff_info_db-&gt; WITH (<span class="name">OIDS=FALSE</span>)<span class="comment">;</span></div><div class="line">CREATE TABLE</div><div class="line">staff_info_db=&gt; CREATE TABLE userdetail (</div><div class="line"><span class="name">staff_info_db</span>(<span class="name">&gt;</span>     uid integer,</div><div class="line">staff_info_db(<span class="name">&gt;</span>     intro character varying(<span class="number">100</span>),</div><div class="line">staff_info_db(<span class="name">&gt;</span>     profile character varying(<span class="number">100</span>)</div><div class="line">staff_info_db(<span class="name">&gt;</span> )</div><div class="line">staff_info_db-&gt; WITH (<span class="name">OIDS=FALSE</span>)<span class="comment">;</span></div><div class="line">CREATE TABLE</div><div class="line">staff_info_db=&gt;</div></pre></td></tr></table></figure></p>
<h2 id="权限"><a href="#权限" class="headerlink" title="权限"></a>权限</h2><p>创建的表还可以赋予其它用户完全的权限，比如，以 <code>postgres</code> 用户创建的表的完全的权限赋予新用户：<br><figure class="highlight ini"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="attr">postgres</span>=# GRANT ALL <span class="literal">ON</span> userinfo TO hanpfei;</div><div class="line"><span class="attr">postgres</span>=# GRANT ALL <span class="literal">ON</span> userinfo TO userdetail;</div></pre></td></tr></table></figure></p>
<h2 id="使用-Go-语言操作-PostgreSQL"><a href="#使用-Go-语言操作-PostgreSQL" class="headerlink" title="使用 Go 语言操作 PostgreSQL"></a>使用 Go 语言操作 PostgreSQL</h2><p>同样我们需要先找个驱动。Go 语言的 PostgreSQL 驱动也很多。这里我们选用支持 <code>database/sql</code> 接口的驱动 <code>github.com/lib/pq</code>，这个项目由 <code>github.com/bmizerany/pq</code> 迁移而来，而后者目前已经废弃。我们还是要先安装：<br><figure class="highlight crystal"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ go get github.com/<span class="class"><span class="keyword">lib</span>/<span class="title">pq</span></span></div></pre></td></tr></table></figure></p>
<p>然后用 Go 语言访问 PostgreSQL：<br><figure class="highlight stata"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div></pre></td><td class="code"><pre><div class="line">package main</div><div class="line"></div><div class="line">import (</div><div class="line">	_ <span class="string">"github.com/lib/pq"</span></div><div class="line">	<span class="string">"fmt"</span></div><div class="line">	<span class="string">"database/sql"</span></div><div class="line">)</div><div class="line"></div><div class="line">func checkErr(<span class="keyword">err</span> <span class="keyword">error</span>)  &#123;</div><div class="line">	<span class="keyword">if</span> <span class="keyword">err</span> != nil &#123;</div><div class="line">		panic(<span class="keyword">err</span>)</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">func testOperationForPostgreSQL(<span class="keyword">db</span> *sql.<span class="keyword">DB</span>)  &#123;</div><div class="line">	<span class="comment">// Insert</span></div><div class="line">	stmt, <span class="keyword">err</span> := <span class="keyword">db</span>.Prepare(<span class="string">"INSERT INTO userinfo(username,departname,created) VALUES($1,$2,$3) RETURNING uid"</span>)</div><div class="line">	checkErr(<span class="keyword">err</span>)</div><div class="line"></div><div class="line">	res, <span class="keyword">err</span> := stmt.Exec(<span class="string">"hanpfei"</span>, <span class="string">"R_D_Department"</span>, <span class="string">"2016-05-23"</span>)</div><div class="line">	checkErr(<span class="keyword">err</span>)</div><div class="line"></div><div class="line">	<span class="comment">// id, err := res.LastInsertId()</span></div><div class="line">	<span class="comment">// checkErr(err)</span></div><div class="line"></div><div class="line">	fmt.Println(res)</div><div class="line"></div><div class="line">	<span class="comment">// Update</span></div><div class="line">	stmt, <span class="keyword">err</span> = <span class="keyword">db</span>.Prepare(<span class="string">"UPDATE userinfo SET username=$1 where uid=$2"</span>)</div><div class="line">	checkErr(<span class="keyword">err</span>)</div><div class="line"></div><div class="line">	res, <span class="keyword">err</span> = stmt.Exec(<span class="string">"hanpfeiupdate"</span>, 1)</div><div class="line">	checkErr(<span class="keyword">err</span>)</div><div class="line"></div><div class="line">	affect, <span class="keyword">err</span> := res.RowsAffected()</div><div class="line">	checkErr(<span class="keyword">err</span>)</div><div class="line"></div><div class="line">	fmt.Println(affect)</div><div class="line"></div><div class="line">	<span class="comment">// Query</span></div><div class="line">	rows, <span class="keyword">err</span> := <span class="keyword">db</span>.<span class="keyword">Query</span>(<span class="string">"SELECT * FROM userinfo"</span>)</div><div class="line">	checkErr(<span class="keyword">err</span>)</div><div class="line"></div><div class="line">	<span class="keyword">for</span> rows.Next() &#123;</div><div class="line">		<span class="keyword">var</span> uid int</div><div class="line">		<span class="keyword">var</span> username <span class="built_in">string</span></div><div class="line">		<span class="keyword">var</span> department <span class="built_in">string</span></div><div class="line">		<span class="keyword">var</span> created <span class="built_in">string</span></div><div class="line">		<span class="keyword">err</span> = rows.Scan(&amp;uid, &amp;username, &amp;department, &amp; created)</div><div class="line">		checkErr(<span class="keyword">err</span>)</div><div class="line">		fmt.Println(uid)</div><div class="line">		fmt.Println(username)</div><div class="line">		fmt.Println(department)</div><div class="line">		fmt.Println(created)</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">// Delete data</span></div><div class="line">	stmt, <span class="keyword">err</span> = <span class="keyword">db</span>.Prepare(<span class="string">"DELETE from userinfo where uid=$1"</span>)</div><div class="line">	checkErr(<span class="keyword">err</span>)</div><div class="line"></div><div class="line">	res, <span class="keyword">err</span> = stmt.Exec(1)</div><div class="line">	checkErr(<span class="keyword">err</span>)</div><div class="line"></div><div class="line">	affect, <span class="keyword">err</span> = res.RowsAffected()</div><div class="line">	checkErr(<span class="keyword">err</span>)</div><div class="line"></div><div class="line">	fmt.Println(affect)</div><div class="line"></div><div class="line">	checkErr(<span class="keyword">err</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line">func postgreSqlTest()  &#123;</div><div class="line">	<span class="keyword">db</span>, <span class="keyword">err</span> := sql.<span class="keyword">Open</span>(<span class="string">"postgres"</span>, <span class="string">"user=hanpfei password=hanpfei dbname=staff_info_db sslmode=disable"</span>)</div><div class="line">	checkErr(<span class="keyword">err</span>)</div><div class="line">	defer <span class="keyword">db</span>.<span class="keyword">Close</span>()</div><div class="line"></div><div class="line">	testOperationForPostgreSQL(<span class="keyword">db</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line">func main()  &#123;</div><div class="line">	postgreSqlTest()</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>从上面的代码中可以看到，PostgreSQL 是通过 “$1，$2”这种方式来占位要传入的参数的，而不是 MySQL 中的 “?” 另外在 <code>sql.Open()</code>中的 dsn 信息的格式也与 MySQL 不同，因而在使用时需要注意。<br>此外， PostgreSQL 不支持 <code>LastInsertId()</code> 函数，因为它内部没有实现类似 MySQL 的自增 ID 返回。其它的代码则几乎一模一样。</p>
<h1 id="NoSQL-数据库"><a href="#NoSQL-数据库" class="headerlink" title="NoSQL 数据库"></a>NoSQL 数据库</h1><p>NoSQL （Not only SQL），指的是非关系型数据库。随着 Web 2.0 的兴起，传统的关系型数据库在应付新应用，特别是超大规模和高并发得 SNS 型 Web 2.0 纯动态网站时已经显得力不从心，暴露了很多难以客服得问题，而非关系型数据库则由于其自身的有点，而得到迅速得发展。</p>
<p>在看了上面的几种 SQL 数据库之后，接下来我们将学习用 Go 语言操作几种 NoSQL 数据库，主要是 Redis 和 MongoDB。</p>
<h1 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h1><p>Redis 是一个开源的（BSD 许可），基于内存的数据结构存储产品，它可以被用作数据库，缓存和消息代理。它支持的数据结构非常多，如 string（字符串），hash（哈希），list（列表），set（集合），带有范围查询的sorted set（有序集合），bitmap（位图），超文本和具有半径查询的地理空间索引。Redis具有内置复制，Lua脚本，LRU驱逐，事务和不同级别的磁盘持久性，并通过Redis Sentinel提供高可用性，并通过Redis Cluster进行自动分区。</p>
<p>Redis 是一个超高性能的 key-value 数据库。Redis 的出现，很大程度补偿了memcached 这类 key-value 存储的不足，在部 分场合可以对关系数据库起到很好的补充作用。它提供了Python，Ruby，Erlang，PHP客户端，使用很方便。</p>
<p><a href="https://redis.io" target="_blank" rel="external">Redis 主页</a>。</p>
<p><a href="https://github.com/antirez/redis" target="_blank" rel="external">Redis GitHub主页</a>。</p>
<p>这里我们就来看一下如何用 Go 语言操作Redis。</p>
<h2 id="Redis-安装"><a href="#Redis-安装" class="headerlink" title="Redis 安装"></a>Redis 安装</h2><p>使用如下命令，会自动安装最新版<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo apt-get <span class="keyword">install</span> redis-<span class="keyword">server</span> redis-tools</div></pre></td></tr></table></figure></p>
<p>通过 <code>lsof -i</code> 命令我们可以查看 Redis 服务器占用的端口。<br><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ sudo lsof -i -P</div><div class="line">COMMAND     PID        <span class="keyword">USER</span>   <span class="title">FD</span>   <span class="keyword">TYPE</span> DEVICE SIZE/OFF <span class="keyword">NODE</span> <span class="title">NAME</span></div><div class="line">. . . . . .</div><div class="line">redis-ser  <span class="number">2977</span>       redis    <span class="number">4</span>u  IPv4 <span class="number">507101</span>      <span class="number">0</span>t0  TCP localhost:<span class="number">6379</span> (LISTEN)</div></pre></td></tr></table></figure></p>
<p>可以看到 Redis 服务器在 TCP 的 <strong><em>6379</em></strong> 端口监听请求。</p>
<p>Redis 还提供了功能强大的命令行工具<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">$ redis-cli</div><div class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; <span class="keyword">help</span></div><div class="line">redis-cli <span class="number">3.0</span>.<span class="number">6</span></div><div class="line">Type: <span class="string">"help @&lt;group&gt;"</span> <span class="keyword">to</span> <span class="built_in">get</span> <span class="keyword">a</span> <span class="keyword">list</span> of commands in <span class="symbol">&lt;group&gt;</span></div><div class="line">      <span class="string">"help &lt;command&gt;"</span> <span class="keyword">for</span> <span class="keyword">help</span> <span class="keyword">on</span> <span class="symbol">&lt;command&gt;</span></div><div class="line">      <span class="string">"help &lt;tab&gt;"</span> <span class="keyword">to</span> <span class="built_in">get</span> <span class="keyword">a</span> <span class="keyword">list</span> of possible <span class="keyword">help</span> topics</div><div class="line">      <span class="string">"quit"</span> <span class="keyword">to</span> <span class="keyword">exit</span></div></pre></td></tr></table></figure></p>
<h2 id="Go-程序访问-Redis"><a href="#Go-程序访问-Redis" class="headerlink" title="Go 程序访问 Redis"></a>Go 程序访问 Redis</h2><p>Go 语言的 Redis 客户端驱动还是很多的，具体可以通过 <a href="https://redis.io/clients#go" target="_blank" rel="external">Redis 的 Client 页</a> 找到它们。当前还处于比较活跃的状态，也就是近 6 个月官方 repo 有过更新的驱动如下：<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">http<span class="variable">s:</span>//github.<span class="keyword">com</span>/<span class="keyword">go</span>-redis/redis</div><div class="line">http<span class="variable">s:</span>//github.<span class="keyword">com</span>/keimoon/gore</div><div class="line">http<span class="variable">s:</span>//github.<span class="keyword">com</span>/gosexy/redis</div><div class="line">http<span class="variable">s:</span>//github.<span class="keyword">com</span>/tideland/golib</div><div class="line">http<span class="variable">s:</span>//github.<span class="keyword">com</span>/garyburd/redigo</div><div class="line">http<span class="variable">s:</span>//github.<span class="keyword">com</span>/mediocregopher/radix.v2</div></pre></td></tr></table></figure></p>
<p>其中最后两个，是目前 Redis 官方推荐使用的 Go 驱动。这里我们以最后一个为例，来看要如何在 Go 代码里操作 Redis。然而，在开始之前，我们还是要先安装相应的包：<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ <span class="keyword">go</span> <span class="built_in">get</span> github.<span class="keyword">com</span>/mediocregopher/radix.v2/redis</div></pre></td></tr></table></figure></p>
<p>接着来看具体如何通过 Go 语言访问 Redis：<br><figure class="highlight stata"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line">package main</div><div class="line"></div><div class="line">import (</div><div class="line">	<span class="string">"fmt"</span></div><div class="line">	<span class="string">"github.com/mediocregopher/radix.v2/redis"</span></div><div class="line">)</div><div class="line"></div><div class="line">func checkErr(<span class="keyword">err</span> <span class="keyword">error</span>)  &#123;</div><div class="line">	<span class="keyword">if</span> <span class="keyword">err</span> != nil &#123;</div><div class="line">		panic(<span class="keyword">err</span>)</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">func testRedisWithRadix()  &#123;</div><div class="line">	client, <span class="keyword">err</span> := redis.Dial(<span class="string">"tcp"</span>, <span class="string">"localhost:6379"</span>)</div><div class="line">	checkErr(<span class="keyword">err</span>)</div><div class="line"></div><div class="line">	<span class="keyword">err</span> = client.Cmd(<span class="string">"SET"</span>, <span class="string">"a"</span>, <span class="string">"hello"</span>).<span class="keyword">Err</span></div><div class="line">	checkErr(<span class="keyword">err</span>)</div><div class="line"></div><div class="line">	val, <span class="keyword">err</span> := client.Cmd(<span class="string">"GET"</span>, <span class="string">"a"</span>).Str()</div><div class="line">	checkErr(<span class="keyword">err</span>)</div><div class="line"></div><div class="line">	fmt.Println(<span class="string">"Redis val:"</span>)</div><div class="line">	fmt.Println(<span class="built_in">string</span>(val))</div><div class="line"></div><div class="line">	<span class="keyword">err</span> = client.Cmd(<span class="string">"DEL"</span>, <span class="string">"a"</span>).<span class="keyword">Err</span></div><div class="line">	checkErr(<span class="keyword">err</span>)</div><div class="line"></div><div class="line">	<span class="comment">// list operation</span></div><div class="line">	vals := []string&#123;<span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>, <span class="string">"d"</span>, <span class="string">"e"</span>&#125;</div><div class="line">	<span class="keyword">for</span> _, v := <span class="keyword">range</span> vals &#123;</div><div class="line">		<span class="keyword">err</span> = client.Cmd(<span class="string">"RPUSH"</span>, <span class="string">"l"</span>, v).<span class="keyword">Err</span></div><div class="line">		checkErr(<span class="keyword">err</span>)</div><div class="line">	&#125;</div><div class="line">	dbvals, <span class="keyword">err</span> := client.Cmd(<span class="string">"LRANGE"</span>, <span class="string">"l"</span>, 0, 4).<span class="keyword">List</span>()</div><div class="line">	checkErr(<span class="keyword">err</span>)</div><div class="line">	<span class="keyword">for</span> i, v := <span class="keyword">range</span> dbvals  &#123;</div><div class="line">		fmt.Println(i, <span class="string">":"</span>, <span class="built_in">string</span>(v))</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">err</span> = client.Cmd(<span class="string">"DEL"</span>, <span class="string">"l"</span>).<span class="keyword">Err</span></div><div class="line">	checkErr(<span class="keyword">err</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line">func main()  &#123;</div><div class="line">	testRedisWithRadix()</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>运行上面代码，可以看到如下的输出：<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">$ <span class="regexp">/usr/</span>lib<span class="regexp">/go/</span>bin<span class="regexp">/go run /</span>home<span class="regexp">/hanpfei0306/</span>IdeaProjects<span class="regexp">/HelloGo/</span>Redis.go</div><div class="line">Redis val:</div><div class="line">hello</div><div class="line"><span class="number">0</span> : a</div><div class="line"><span class="number">1</span> : b</div><div class="line"><span class="number">2</span> : c</div><div class="line"><span class="number">3</span> : d</div><div class="line"><span class="number">4</span> : e</div><div class="line"></div><div class="line">Process finished with <span class="keyword">exit</span> code <span class="number">0</span></div></pre></td></tr></table></figure></p>
<p>我们可以看到，操作 Redis 非常方便，大多只要用 <code>client</code> 命令即可。关于 <code>Radix</code> 用法的更多详细内容，可以参考其 <a href="https://godoc.org/github.com/mediocregopher/radix.v2/redis" target="_blank" rel="external">官方文档</a>。</p>
<h1 id="MongoDB"><a href="#MongoDB" class="headerlink" title="MongoDB"></a>MongoDB</h1><p>MongoDB 是一个高性能功能强大而流行的分布式文档存储 NoSQL (Not Only SQL) 数据库产品。它是一个介于关系数据库和非关系数据库之间的产品，是非关系数据库当中功能最丰富，最像关系数据库的。他支持的数据结构非常松散，是类似json的bjson格式，因此可以存储比较复杂的数据类型。Mongo最大的特点是他支持的查询语言非常强大，其语法有点类似于面向对象的查询语言，几乎可以实现类似关系数据库单表查询的绝大部分功能，而且还支持对数据建立索引。</p>
<p>下面我们来看一下如何通过 Go 语言操作 MongoDB。</p>
<h2 id="MongoDB-安装"><a href="#MongoDB-安装" class="headerlink" title="MongoDB 安装"></a>MongoDB 安装</h2><p>首先需要安装 MongoDB。使用如下命令，会自动安装最新版 MongoDB，这里是 <code>2.6.10</code> 版。<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo apt-get <span class="keyword">install</span> mongodb mongodb-clients mongodb-<span class="keyword">server</span></div></pre></td></tr></table></figure></p>
<p>通过 <code>lsof -i</code> 命令我们可以查看 MongoDB 服务器占用的端口，并确认 MongoDB 服务器的正常运行。<br><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"> sudo lsof -i -P</div><div class="line">COMMAND     PID        <span class="keyword">USER</span>   <span class="title">FD</span>   <span class="keyword">TYPE</span> DEVICE SIZE/OFF <span class="keyword">NODE</span> <span class="title">NAME</span></div><div class="line">. . . . . .</div><div class="line">mongod     <span class="number">7838</span>     mongodb    <span class="number">8</span>u  IPv4 <span class="number">536811</span>      <span class="number">0</span>t0  TCP localhost:<span class="number">27017</span> (LISTEN)</div></pre></td></tr></table></figure></p>
<p>可以看到 MongoDB 服务器在 TCP 的 <strong><em>27017</em></strong> 端口监听请求。</p>
<h2 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h2><p>安装了 MongoDB 服务器之后，我们还要创建数据库，以备后面在代码里面用。我们可以通过 MongoDB 的 shell 版本，使用 <code>use</code>命令创建数据库：<br><figure class="highlight stata"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">$ mongo</div><div class="line">MongoDB <span class="keyword">shell</span> <span class="keyword">version</span>: 2.6.10</div><div class="line">connecting to: <span class="keyword">test</span></div><div class="line">Welcome to the MongoDB <span class="keyword">shell</span>.</div><div class="line"><span class="keyword">For</span> interactive <span class="keyword">help</span>, <span class="keyword">type</span> <span class="string">"help"</span>.</div><div class="line"><span class="keyword">For</span> <span class="keyword">more</span> comprehensive documentation, see</div><div class="line">	http:<span class="comment">//docs.mongodb.org/</span></div><div class="line">Questions? Try the support <span class="built_in">group</span></div><div class="line">	http:<span class="comment">//groups.google.com/group/mongodb-user</span></div><div class="line">&gt; <span class="keyword">use</span> people_info</div><div class="line">switched to <span class="keyword">db</span> people_info</div></pre></td></tr></table></figure></p>
<p><code>use</code> 命令在 MySQL 中用于选择已经创建好的数据库，而在 MongoDB 中则会自动创建当前还不存在的数据库。</p>
<h2 id="Go-程序访问-MongoDB"><a href="#Go-程序访问-MongoDB" class="headerlink" title="Go 程序访问 MongoDB"></a>Go 程序访问 MongoDB</h2><p>在开始编写 Go 代码访问 MongoDB 数据库之前，我们还要先下载 MongoDB 的Go语言驱动。在 MongoDB 的 <a href="https://docs.mongodb.com/ecosystem/drivers/go/" target="_blank" rel="external">官方 Drivers主页</a> 可以找到可用的 Go 语言驱动。当前官方推荐的只有开源社区支持的 <code>mgo</code> 驱动。<a href="http://labix.org/mgo" target="_blank" rel="external">mgo 主页</a>。mgo 的 <a href="https://github.com/go-mgo/mgo" target="_blank" rel="external">GitHub 主页</a>。通过 <code>go get</code> 命令安装我们需要的两个 mgo Go 包：<br><figure class="highlight maxima"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ <span class="built_in">go</span> <span class="built_in">get</span> gopkg.<span class="keyword">in</span>/mgo.v2</div><div class="line">$ <span class="built_in">go</span> <span class="built_in">get</span> gopkg.<span class="keyword">in</span>/mgo.v2/bson</div></pre></td></tr></table></figure></p>
<p>接着来看具体如何通过 Go 语言操作 MongoDB。<br><figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> main</div><div class="line"></div><div class="line"><span class="keyword">import</span> (</div><div class="line">	<span class="string">"gopkg.in/mgo.v2"</span></div><div class="line">	<span class="string">"gopkg.in/mgo.v2/bson"</span></div><div class="line">	<span class="string">"fmt"</span></div><div class="line">)</div><div class="line"></div><div class="line"><span class="keyword">type</span> Person <span class="keyword">struct</span> &#123;</div><div class="line">	Name <span class="keyword">string</span></div><div class="line">	Phone <span class="keyword">string</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">checkErr</span><span class="params">(err error)</span></span>  &#123;</div><div class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">		<span class="built_in">panic</span>(err)</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">testMongoDB</span><span class="params">()</span></span>  &#123;</div><div class="line">	session, err := mgo.Dial(<span class="string">"localhost"</span>)</div><div class="line">	checkErr(err)</div><div class="line">	<span class="keyword">defer</span> session.Close()</div><div class="line"></div><div class="line">	session.SetMode(mgo.Monotonic, <span class="literal">true</span>)</div><div class="line">	c := session.DB(<span class="string">"people_info"</span>).C(<span class="string">"people"</span>)</div><div class="line"></div><div class="line">	err = c.Insert(&amp;Person&#123;<span class="string">"Ale"</span>, <span class="string">"+55 53 8116 9639"</span>&#125;,</div><div class="line">		&amp;Person&#123;<span class="string">"Cla"</span>, <span class="string">"+55 53 8402 8510"</span>&#125;)</div><div class="line">	checkErr(err)</div><div class="line"></div><div class="line">	result := Person&#123;&#125;</div><div class="line">	err = c.Find(bson.M&#123;<span class="string">"name"</span>: <span class="string">"Ale"</span>&#125;).One(&amp;result)</div><div class="line">	checkErr(err)</div><div class="line"></div><div class="line">	fmt.Println(<span class="string">"Phone:"</span>, result.Phone)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>  &#123;</div><div class="line">	testMongoDB()</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>操作与许多 SQL数据库的 ORM 库提供的很相似，可以直接操作对象。</p>
<h1 id="参考文档："><a href="#参考文档：" class="headerlink" title="参考文档："></a>参考文档：</h1><p><a href="http://www.cnblogs.com/2016xt/p/5517049.html" target="_blank" rel="external">Ubuntu 16.04 安装 Apache, MySQL, PHP7</a></p>
<p><a href="http://www.cnblogs.com/z-sm/p/5644165.html#autoid-2-1-0" target="_blank" rel="external">Ubuntu PostgreSQL安装和配置</a></p>
<p><a href="http://blog.csdn.net/nameoccupied/article/details/9145345" target="_blank" rel="external">postgresql 切换数据库命令</a></p>
<p><a href="http://outofmemory.cn/PostgreSQL/tutorial/PostgreSQL-select-data-library" target="_blank" rel="external">PostgreSQL选择数据库</a></p>
<p><a href="http://www.yiibai.com/html/postgresql/2013/080440.html" target="_blank" rel="external">PostgreSQL删除表</a></p>
<p><a href="http://www.cnblogs.com/stephen-liu74/archive/2012/05/18/2302639.html" target="_blank" rel="external">PostgreSQL学习手册(角色和权限)</a></p>
<p><a href="https://doc.odoo.com/6.1/zh_CN/install/linux/postgres/" target="_blank" rel="external">PostgreSQL 数据库安装与配置</a></p>
<p><a href="http://www.ttlsa.com/redis/the-reids-client-redis-cli-using/" target="_blank" rel="external">reids客户端 redis-cli用法</a></p>
</div><div class="tags"><a href="/tags/后台开发/">后台开发</a><a href="/tags/Go-语言/">Go 语言</a></div><div class="post-nav"><a href="/2017/02/28/Building_RESTful_Web_Service_With_SpringMVC/" class="pre">SpringMVC 构建 RESTful Web 服务</a><a href="/2017/02/24/Install_Tomcat8_on_Ubuntu16.04/" class="next">Ubuntu 16.04 Tomcat 8安装指南</a></div><div id="disqus_thread"></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="widget"><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="请输入关键字..."/></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-gui"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android-图形系统/">Android 图形系统</a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android开发/">Android开发</a><span class="category-list-count">26</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/C-C-开发/">C/C++开发</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java开发/">Java开发</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux内核/">Linux内核</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/live555/">live555</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/业界趣闻/">业界趣闻</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/后台开发/">后台开发</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/安全/">安全</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/网络协议/">网络协议</a><span class="category-list-count">39</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/网络调试/">网络调试</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/随想杂谈/">随想杂谈</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/音视频开发/">音视频开发</a><span class="category-list-count">3</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> 标签</i></div><div class="tagcloud"><a href="/tags/OpenGL/" style="font-size: 15px;">OpenGL</a> <a href="/tags/网络协议/" style="font-size: 15px;">网络协议</a> <a href="/tags/Android开发/" style="font-size: 15px;">Android开发</a> <a href="/tags/源码分析/" style="font-size: 15px;">源码分析</a> <a href="/tags/chromium/" style="font-size: 15px;">chromium</a> <a href="/tags/后台开发/" style="font-size: 15px;">后台开发</a> <a href="/tags/Java开发/" style="font-size: 15px;">Java开发</a> <a href="/tags/QUIC/" style="font-size: 15px;">QUIC</a> <a href="/tags/翻译/" style="font-size: 15px;">翻译</a> <a href="/tags/网络调试/" style="font-size: 15px;">网络调试</a> <a href="/tags/HTTP2/" style="font-size: 15px;">HTTP2</a> <a href="/tags/UDT/" style="font-size: 15px;">UDT</a> <a href="/tags/图形图像/" style="font-size: 15px;">图形图像</a> <a href="/tags/安全/" style="font-size: 15px;">安全</a> <a href="/tags/HTTPS/" style="font-size: 15px;">HTTPS</a> <a href="/tags/C-C-开发/" style="font-size: 15px;">C/C++开发</a> <a href="/tags/音视频开发/" style="font-size: 15px;">音视频开发</a> <a href="/tags/Linux内核/" style="font-size: 15px;">Linux内核</a> <a href="/tags/live555/" style="font-size: 15px;">live555</a> <a href="/tags/Django/" style="font-size: 15px;">Django</a> <a href="/tags/Go-语言/" style="font-size: 15px;">Go 语言</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-fei"> 归档</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">九月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">八月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">七月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">六月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">五月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">四月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">三月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">二月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">一月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">十二月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">十一月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">十月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">八月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">七月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">四月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">九月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/07/">七月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/09/">九月 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/07/">七月 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/05/">五月 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/02/">二月 2013</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/09/14/egl_init_drivers/">Android 图形驱动初始化</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/13/opengl_on_android_with_sv/">在 Android 中使用 OpenGL</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/12/android_debug_gdb/">使用 GDB 调试 Android 应用</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/11/android_emulator_dev/">Android 模拟器下载、编译及调试</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/08/live555_src_analysis_start_streaming/">live555 源码分析：播放启动</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/08/live555_src_analysis_subsession_setup/">live555 源码分析：子会话 SETUP</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/07/live555_src_analysis_subsession_sdp/">live555 源码分析：子会话 SDP 行生成</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/07/live555_src_analysis_servermediasession/">live555 源码分析：ServerMediaSession</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/06/live555_src_analysis_rtspserver_arch/">live555 源码分析：RTSPServer 组件结构</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/05/live555_src_analysis_play/">live555 源码分析： PLAY 的处理</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-you"> 友情链接</i></div><ul></ul><a href="https://developer.android.com/index.html" title="Android Developers" target="_blank">Android Developers</a><ul></ul><a href="https://source.android.com/" title="Android Open Source Project" target="_blank">Android Open Source Project</a><ul></ul><a href="http://www.vants.org/" title="蚂蚁网" target="_blank">蚂蚁网</a></div><div class="widget"><div class="widget-title"><i class="fa fa-commt"> 最近评论</i></div><script type="text/javascript" src="//wolfcstech.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=1&amp;avatar_size=32&amp;excerpt_length=20&amp;hide_mods=1"></script></div></div></div></div><a id="totop" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.2.0" async></script><div id="footer"><div class="footer-info"><p><a href="/baidusitemap.xml">网站地图</a> |<a href="/atom.xml">订阅本站</a> |<span>联系博主：<a href="mailto:hanpfei@gmail.com" target="_blank" class="fa fa-email"> </a><a href="undefined" target="_blank" class="fa fa-weibo"></a><a href="https://github.com/hanpfei" target="_blank" class="fa fa-github"> </a></span></p><p><span> Copyright &copy;<a href="/." rel="nofollow">Han Pengfei</a></span><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span><span><a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake"> Theme </a>by<a rel="nofollow" target="_blank" href="https://github.com/chaooo"> Charles.</a></span></p></div></div></div><script>var disqus_shortname = 'wolfcstech';
var disqus_identifier = '2017/02/26/一文学会Go语言数据库操作/';
var disqus_title = '一文学会Go语言数据库操作';
var disqus_url = 'https://www.wolfcstech.com/2017/02/26/一文学会Go语言数据库操作/';
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//wolfcstech.disqus.com/count.js" async></script><script type="text/javascript" src="/js/search.json.js?v=1.2.0"></script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?3c736b12c32c019fd9ff6c825b6b9b44";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();</script></body></html>