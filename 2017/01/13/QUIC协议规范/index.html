<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>QUIC协议规范 | WolfcsTech</title><link rel="stylesheet" type="text/css" href="//fonts.css.network/css?family=Source+Code+Pro"><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.2.0"><link rel="stylesheet" type="text/css" href="/css/highlight.css?v=1.2.0"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">QUIC协议规范</h1><a id="logo" href="/.">WolfcsTech</a><p class="description"></p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">QUIC协议规范</h1><div class="post-meta">Jan 13, 2017<span> | </span><span class="category"><a href="/categories/网络协议/">网络协议</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a data-thread-key="2017/01/13/QUIC协议规范/" href="/2017/01/13/QUIC协议规范/#comments" class="ds-thread-count"></a><div class="post-content"><h1 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h1><p>QUIC (Quick UDP Internet Connection，快速UDP互联网连接) 是一个新的基于UDP的多路复用和安全的传输协议，它是为HTTP/2语义而设计并专门优化的。以HTTP/2作为主要的应用协议构建，QUIC基于传输和安全领域数十年的经验而构建，并实现了使它成为有吸引力的现代通用传输协议的机制。QUIC提供了相当于HTTP/2的多路复用和流控，相当于TLS的安全性，及相当于TCP的连接语义、可靠性和拥塞控制。</p>
<a id="more"></a>
<p>QUIC完全运行于用户空间，它当前被作为Chromium浏览器的一部分发布给用户，以便于快速的部署和实验。作为基于UDP的用户空间传输协议，QUIC可以做一些由于传统的客户端和中间设备的阻碍，或旷日持久的操作系统开发和部署周期，而被证明很难部署在现有的协议中的创新。</p>
<p>QUIC的一个重要目标是通过快速的实验来获得更好的传输设计。因此，我们希望将其中的一些精华的改动迁移进TCP和TLS，后者通常都有着长得多的迭代周期。</p>
<p>这份文档描述QUIC协议标准化前的概念设计和协议规范。补充资料描述加密和传输握手[QUIC-CRYPTO]，及丢失恢复和拥塞控制[draft-iyengar-quic-loss-recovery]。其它资源，包括一份更详细的相关文档，可以在<a href="https://www.chromium.org/quic" target="_blank" rel="external">Chromium 的QUIC主页</a>找到。</p>
<p>基于早期的部署的QUIC 标准化建议为[draft-hamilton-quic-transport-protocol]，[draft-shade-quic-http2-mapping]，[draft-iyengar-quic-loss-recovery], and [draft-thomson-quic-tls]。</p>
<h1 id="术语和定义"><a href="#术语和定义" class="headerlink" title="术语和定义"></a>术语和定义</h1><p>QUIC中使用的所有整型值，包括长度、版本号和类型，都是小尾端字节序的，而不是网络字节序。QUIC不强制动态大小的帧中的类型对齐。</p>
<p>本文档中使用的一些术语定义如下。</p>
<ul>
<li>“客户端”：初始化QUIC连接的一端。</li>
<li>“服务器”：接受进入的QUIC连接的一端。</li>
<li>“端点”：连接的客户端或服务器端。</li>
<li>“流”：QUIC链接中穿过一个逻辑通道的双向字节流。</li>
<li>“连接”：两个QUIC端点之间具有一个加密上下文包含多路复用流的会话。</li>
<li>“连接ID”：一个QUIC连接的标识符。</li>
<li>“QUIC包”：一个经过良好格式化的UDP载荷，它可由QUIC的接收者解析。本文档中的QUIC包大小指UDP载荷大小。</li>
</ul>
<h1 id="QUIC概述"><a href="#QUIC概述" class="headerlink" title="QUIC概述"></a>QUIC概述</h1><p>我们现在清晰地描述QUIC的重要机制和优势。QUIC在功能上等价于TCP + TLS + HTTP/2，但基于UDP实现。QUIC相对于TCP + TLS + HTTP/2的主要优势包括</p>
<ul>
<li>连接建立延迟</li>
<li>灵活的拥塞控制</li>
<li>多路复用而不存在队首阻塞</li>
<li>认证和加密的首部和载荷</li>
<li>流和连接的流量控制</li>
<li>连接迁移</li>
</ul>
<h2 id="连接建立延迟"><a href="#连接建立延迟" class="headerlink" title="连接建立延迟"></a>连接建立延迟</h2><p>QUIC将加密和传输的握手结合在一起，减少了建立一个安全的连接所需的往返。QUIC连接通常是0-RTT的，意味着相比于TCP + TLS中发送应用数据之前需要1-3个往返的情况不同，在大多数QUIC连接中，数据可以被立即发送而无需等待服务器的相应。</p>
<p>QUIC提供了一个专门的流（流ID为1）用于执行握手，但握手协议的详细内容不在本文当的范围内，要查看当前握手协议的完整描述，请参考 <a href="http://goo.gl/jOvOQ5" target="_blank" rel="external">QUIC Crypto Handshake</a> 文档。QUIC当前的握手将被未来的TLS 1.3替代。</p>
<h2 id="灵活的拥塞控制"><a href="#灵活的拥塞控制" class="headerlink" title="灵活的拥塞控制"></a>灵活的拥塞控制</h2><p>相对于TCP，QUIC具有可插入的拥塞控制和更丰富的信令，这使得QUIC相对于TCP可以提供更丰富的信息用于拥塞控制算法。当前，默认的拥塞控制是TCP Cubic算法的重实现；我们目前在实验替代的方法。</p>
<p>更丰富的信息的一个例子是，每个包，包括原始的和重传的，携带一个新的包序列号。这使得QUIC的发送端可以区分重传包的ACKs和原始包的ACKs，这样可以避免TCP的重传的歧义性问题。QUIC ACKs也显式地携带数据包的接收与它的确认被发送之间的延迟，与单调递增的包号一起，这使得QUIC可以精确的计算往返时间（RTT）。</p>
<p>最后，QUIC的ACK帧最多支持256个ack块，因此QUIC相对于TCP（使用SACK）在重排序时更有弹性，这也使得再重排序或丢失出现时，QUIC可以追踪更多在途字节。客户端和服务器端都可以更精确的了解到哪些包对端已经接收。</p>
<h2 id="流和连接的流量控制"><a href="#流和连接的流量控制" class="headerlink" title="流和连接的流量控制"></a>流和连接的流量控制</h2><p>QUIC实现了流级和连接级的流量控制，接近于HTTP/2的流量控制。QUIC的流级流量控制像下面这样工作。QUIC接收者将每个流中接收者最多想要接收的数据的完整字节偏移发送给发送者。在发送，接收及在一个特定的流上传送数据时，接收者发送WINDOW_UPDATE帧来增大广告的流的偏移量限制，以允许对端在那个流上发送更多的数据。</p>
<p>除了每个流的流量控制，QUIC实现了连接级的流量控制来限制QUIC接收者想要为一个连接分配的总的缓冲区大小。连接的流量控制的工作方式与流的流量控制一样，但传送的字节和最大的接收偏移是所有流的总和。</p>
<p>与TCP的接收窗口自动调整类似，QUIC实现了流和连接流量控制器的流量控制积分的自动调整。如果WINDOW_UPDATE帧将限制发送者的速率，QUIC的自动调整增加发送的每个WINDOW_UPDATE帧的积分的大小，并当接收应用比较慢时限制发送者。</p>
<h2 id="多路复用"><a href="#多路复用" class="headerlink" title="多路复用"></a>多路复用</h2><p>基于TCP的HTTP/2深受TCP的队首阻塞问题的困扰。由于HTTP/2在TCP的单个字节流抽象之上多路复用许多流，一个TCP片段的丢失将导致所有后续片段的阻塞直到重传的数据到达，而封装在后续的片段中的HTTP/2流可能和丢失的片段毫无关系。</p>
<p>由于QUIC为多路复用操作而设计，携带了一个单独的流的包丢失时，通常只影响特定的流。每个流的帧在到达时可以被立即分发给那个流，因此没有丢失数据的流可以继续被重新汇集，并在应用程序中继续进行。</p>
<p>警告：QUIC当前通过HTTP/2 HPACK首部压缩来压缩一个专门的首部流的HTTP首部(3)，则在首部帧的传输中还是会有队首阻塞问题。</p>
<h2 id="认证和加密的首部和载荷"><a href="#认证和加密的首部和载荷" class="headerlink" title="认证和加密的首部和载荷"></a>认证和加密的首部和载荷</h2><p>TCP首部在网络中以明文出现，它没有认证，导致了大量的TCP注入和首部管理问题，比如接收窗口管理和序列号覆写。尽管这些问题中的一些是主动攻击，其它是一些由网络中的中间节点用来尝试透明的提升TCP性能的机制。然而，即使 “性能增强”中间设备依然有效地限制着传输协议的发展，这已经在MPTCP的设计及其后续的部署问题中观察到。</p>
<p>QUIC数据包总是认证的，而且典型地载荷是完全加密的。数据包头部不加密的部分依然会被接收者认证，以阻止任何数据包注入或第三方操作。QUIC阻止了连接被监听或中间设备的端到端通信的管理。</p>
<p>警告：PUBLIC _RESET 包复位一个当前未认证的连接。</p>
<h2 id="连接迁移"><a href="#连接迁移" class="headerlink" title="连接迁移"></a>连接迁移</h2><p>TCP连接由源地址，源端口，目标地址和目标端口的4元组标识。TCP一个广为人知的问题是，IP地址改变（比如，由WiFi网络切换到了移动网络）或端口号改变（当客户端的NAT绑定超时导致服务器看到的端口号改变）。尽管MPTCP解决了TCP的连接迁移问题，它依然被缺少中间设备和OS部署支持而困扰。</p>
<p>QUIC连接由一个64-bit连接ID标识，它由客户端随机地产生。在IP地址改变和NAT重绑定时，QUIC连接可以不断开，因为连接ID在迁移过程中保持不变。QUIC还提供了迁移的客户端的自动的加密验证，由于一个迁移的客户端继续使用相同的session key来加密和解密数据包。</p>
<p>当连接用明确的4元组标识时，比如当服务器使用一个短暂的端口给客户端发送数据包时，有一个选项来不发送连接ID以保存线上数据。</p>
<h1 id="包类型和格式"><a href="#包类型和格式" class="headerlink" title="包类型和格式"></a>包类型和格式</h1><p>QUIC具有特殊包和普通包。有两种类型特殊包：版本协商包(Version Negotiation Packets) 和 公共复位包 (Public Reset Packets)，普通包包含帧。</p>
<p>所有QUIC包的大小应该适配路径的MTU以避免IP分片。路径MTU发现是正在进行中的工作，当前的QUIC实现为IPv6使用1350字节的最大QUIC包大小，为IPv4使用1370字节。两个大小都没有IP和UDP过载。</p>
<h2 id="QUIC公共包头"><a href="#QUIC公共包头" class="headerlink" title="QUIC公共包头"></a>QUIC公共包头</h2><p>传输的所有QUIC包以一个大小介于1至51个字节之间的公共包头开始。公共包头的格式如下：</p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="bullet">--- </span>src</div><div class="line"><span class="code">     0        1        2        3        4            8</span></div><div class="line"><span class="code">+--------+</span>--------<span class="code">+--------+</span>--------<span class="code">+--------+</span>---    ---+</div><div class="line">| Public |    Connection ID (64)    ...                 | -&gt;</div><div class="line">|Flags(8)|      (optional)                              |</div><div class="line"><span class="code">+--------+</span>--------<span class="code">+--------+</span>--------<span class="code">+--------+</span>---    ---+</div><div class="line"><span class="section">     9       10       11        12   </span></div><div class="line">+--------+--------+--------+--------+</div><div class="line">|      QUIC Version (32)            | -&gt;</div><div class="line"><span class="section">|         (optional)                |                           </span></div><div class="line">+--------+--------+--------+--------+</div><div class="line"><span class="section">    13       14       15        16      17       18       19       20</span></div><div class="line">+--------+--------+--------+--------+--------+--------+--------+--------+</div><div class="line">|                        Diversification Nonce                          | -&gt;</div><div class="line"><span class="section">|                              (optional)                               |</span></div><div class="line">+--------+--------+--------+--------+--------+--------+--------+--------+</div><div class="line"><span class="section">    21       22       23        24      25       26       27       28</span></div><div class="line">+--------+--------+--------+--------+--------+--------+--------+--------+</div><div class="line">|                   Diversification Nonce Continued                     | -&gt;</div><div class="line"><span class="section">|                              (optional)                               |</span></div><div class="line">+--------+--------+--------+--------+--------+--------+--------+--------+</div><div class="line"><span class="section">    29       30       31        32      33       34       35       36</span></div><div class="line">+--------+--------+--------+--------+--------+--------+--------+--------+</div><div class="line">|                   Diversification Nonce Continued                     | -&gt;</div><div class="line"><span class="section">|                              (optional)                               |</span></div><div class="line">+--------+--------+--------+--------+--------+--------+--------+--------+</div><div class="line"><span class="section">    37       38       39        40      41       42       43       44</span></div><div class="line">+--------+--------+--------+--------+--------+--------+--------+--------+</div><div class="line">|                   Diversification Nonce Continued                     | -&gt;</div><div class="line"><span class="section">|                              (optional)                               |</span></div><div class="line">+--------+--------+--------+--------+--------+--------+--------+--------+</div><div class="line"><span class="section">    45      46       47        48       49       50</span></div><div class="line">+--------+--------+--------+--------+--------+--------+</div><div class="line">|           Packet Number (8, 16, 32, or 48)          |</div><div class="line"><span class="section">|                  (variable length)                  |</span></div><div class="line">+--------+--------+--------+--------+--------+--------+</div><div class="line">---</div></pre></td></tr></table></figure>
<p>载荷可以包含多个如下所述依赖类型的头部字节。<br>公共头部中的字段如下：</p>
<ul>
<li><strong>Public Flags</strong>：<ul>
<li>0x01 = PUBLIC_FLAG_VERSION。这个标记的解释依赖于包是由服务器还是客户端发送的。当由客户端发送时，设置它来指示头部包含一个QUIC版本(参考下面的说明)。客户端必须在所有的包中设置这个位，直到客户端收到服务器确认同意由客户端提议的版本号为止。服务器通过发送不设置该位的包来表示同意一个版本。当这个位由服务器设置时，包是一个版本协商包。版本协商将在后面做更详细地描述。</li>
<li>0x02 = PUBLIC_FLAG_RESET。设置来指示包是一个公共复位包。</li>
<li>0x04 = 指明头部中包含一个32字节的多元化现时标志。</li>
<li>0x08 = 指明包中包含完整的8字节连接ID。必须为所有的包设置这个位，直到为给定的方向协商一个不同的值 (比如，客户端可能请求包含更少字节的连接ID)。</li>
<li>0x30 处的两个位指明每个包中包含包号的低阶字节的个数。这些位只用于帧包。公共复位 和 版本协商包 (由服务器发送) 没有包号，则不使用这些位，且它们必须被设置为0。掩码这2位：<ul>
<li>0x30 指明包号占用6个字节。</li>
<li>0x20 指明包号占用4个字节。</li>
<li>0x10 指明包号占用2个字节。</li>
<li>0x00 指明包号占用1个字节。</li>
</ul>
</li>
<li>0x40 保留给多路径使用。</li>
<li>0x80 当前未使用，且必须被设置为0。</li>
</ul>
</li>
<li><strong>连接ID</strong>：这是一个由客户端选择的无符号64位静态随机数，它用作连接的标识符。由于QUIC的连接被设计为即使客户端漫游了依然保持连接状态，IP 4元组（源IP，源端口，目标IP，目标端口）可能不足以标识连接。对每个传输方向，当4元组足够用以标识连接时，连接ID可以被省略。</li>
<li><strong>QUIC版本</strong>：一个32位的不透明的标记，表示QUIC协议的版本。只有在公共标记包含 FLAG_VERSION 时才会出现（比如 public_flags &amp; FLAG_VERSION !=0）。客户端可以设置这个标记，并 <strong>正好</strong> 包含一个提议的版本，同时包含任意的数据（与那个版本一致）。当客户端提议的版本不支持时服务器可以设置这个标记，然后可以提供一个可接受的版本的列表（0或多个），但 <strong>一定不能(MUST not)</strong> 在版本信息之后包含任何数据。在最近的实验版本中版本值的示例包括 “Q025”，它对应于byte 9包含’Q”，byte 10包含 ‘0”，等等。[参考本文当末尾的不同版本变化列表。]</li>
<li><strong>包号</strong>：包号的低8，16，32，或48位，依赖于公共标记中的 FLAG_?BYTE_SEQUENCE_NUMBER 标记被设置为什么。每个普通包（与特别的公共复位包和版本协商包相反）由发送者分配包号。由某一端发送的第一个包的包号应该为1，后续每个包的包号应该比前一个包的包号大1。</li>
</ul>
<p>包号的低64位被用作加密随机数的一部分；然而，一个QUIC端点一定不能发送一个包，其包号不能用64位表示。如果QUIC端点传输了一个包号为 (2^64-1) 的包，则那个包必须包含一个 包含了QUIC_SEQUENCE_NUMBER_LIMIT_REACHED错误码的CONNECTION_CLOSE 帧，对端一定不能再传输任何其它的包了。</p>
<p>至多传输包号的低48位。要使接收者可以明确的重建包号，QUIC端点一定不能传输一个包号比接收者已传输的已知已确认最大的包号大(2^(bitlength-2)) 的包号。然热，在途包的数目不能超过 (2^46)。</p>
<p>任何截断的包号应该被推断为具有一个与对端的最大已知包号且大于它的最接近的值，其传输的包最初包含了截断的包号。包号已传送的部分匹配推断的值的最低位。</p>
<p>一个公共标记处理流程图如下：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment">--- src</span></div><div class="line"><span class="keyword">Check</span> the <span class="keyword">public</span> flags <span class="keyword">in</span> <span class="keyword">public</span> header</div><div class="line">                 |</div><div class="line">                 |</div><div class="line">                 V</div><div class="line">           +<span class="comment">--------------+</span></div><div class="line">           | <span class="keyword">Public</span> <span class="keyword">Reset</span> |    YES</div><div class="line">           | flag <span class="keyword">set</span>?    |<span class="comment">---------------&gt; Public Reset Packet</span></div><div class="line">           +<span class="comment">--------------+</span></div><div class="line">                 |</div><div class="line">                 | <span class="keyword">NO</span></div><div class="line">                 V</div><div class="line">           +<span class="comment">------------+          +-------------+</span></div><div class="line">           | <span class="keyword">Version</span>    |   YES    | Packet sent |  YES</div><div class="line">           | flag <span class="keyword">set</span>?  |<span class="comment">---------&gt;| by server?  |--------&gt; Version Negotiation</span></div><div class="line">           +<span class="comment">------------+          +-------------+               Packet</span></div><div class="line">                 |                        |</div><div class="line">                 | <span class="keyword">NO</span>                     | <span class="keyword">NO</span></div><div class="line">                 V                        V</div><div class="line">           Regular Packet         Regular Packet <span class="keyword">with</span>                               QUIC <span class="keyword">Version</span> <span class="keyword">present</span> <span class="keyword">in</span> header</div><div class="line"><span class="comment">---</span></div></pre></td></tr></table></figure></p>
<h2 id="特殊包"><a href="#特殊包" class="headerlink" title="特殊包"></a>特殊包</h2><h3 id="版本协商包"><a href="#版本协商包" class="headerlink" title="版本协商包"></a><em>版本协商包</em></h3><p>只有服务器会发送版本协商包。版本协商包以一个8位的公共标记和64位的连接ID开始。公共标记必须设置PUBLIC_FLAG_VERSION，并 指示64位的连接ID。版本协商包的其余部分是一个服务器支持的4字节版本的列表：<br><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="bullet">--- </span>src</div><div class="line"><span class="section">     0        1        2        3        4        5        6        7       8</span></div><div class="line">+--------+--------+--------+--------+--------+--------+--------+--------+--------+</div><div class="line">| Public |    Connection ID (64)                                                 | -&gt;</div><div class="line"><span class="section">|Flags(8)|                                                                       |</span></div><div class="line">+--------+--------+--------+--------+--------+--------+--------+--------+--------+</div><div class="line"><span class="code">     9       10       11        12       13      14       15       16       17</span></div><div class="line"><span class="code">+--------+</span>--------<span class="code">+--------+</span>--------<span class="code">+--------+</span>--------<span class="code">+--------+</span>--------<span class="code">+---...--+</span></div><div class="line">|      1st QUIC version supported   |     2nd QUIC version supported    |   ...</div><div class="line">|      by server (32)               |     by server (32)                |             </div><div class="line"><span class="section">+--------+--------+--------+--------+--------+--------+--------+--------+---...--+</span></div><div class="line">---</div></pre></td></tr></table></figure></p>
<h3 id="公共复位包"><a href="#公共复位包" class="headerlink" title="公共复位包"></a><em>公共复位包</em></h3><p>公共复位包以一个8位的公共标记和64位的连接ID开始。公共标记必须设置 PUBLIC_FLAG_RESET，并指示64位的连接ID。公共复位包的其余部分犹如标记PRST的一个加密握手消息那样编码（参考[QUIC-CRYPTO]）：<br><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="bullet">--- </span>src</div><div class="line"><span class="code">     0        1        2        3        4         8</span></div><div class="line"><span class="code">+--------+</span>--------<span class="code">+--------+</span>--------<span class="code">+--------+</span>--   --+</div><div class="line">| Public |    Connection ID (64)                ...  | -&gt;</div><div class="line">|Flags(8)|                                           |</div><div class="line"><span class="code">+--------+</span>--------<span class="code">+--------+</span>--------<span class="code">+--------+</span>--   --+</div><div class="line"><span class="section">     9       10       11        12       13      14       </span></div><div class="line">+--------+--------+--------+--------+--------+--------+---</div><div class="line">|      Quic Tag (32)                |  Tag value map      ... -&gt;</div><div class="line"><span class="section">|         (PRST)                    |  (variable length)                         </span></div><div class="line">+--------+--------+--------+--------+--------+--------+---</div><div class="line">---</div></pre></td></tr></table></figure></p>
<p><strong>标记值映射</strong>：标记值映射包含如下的标记值：</p>
<ul>
<li>RNON (public reset nonce proof) - 一个64位的无符号整数。必须。</li>
<li>RSEQ (rejected packet number) - 一个64位的包号。必须。</li>
<li>CADR (client address) - 发现的客户端IP地址和端口号。它当前只被用于调试目的，因而是可选的。</li>
</ul>
<p>(TODO：公共复位包应该包含认证的（目标）服务器IP/端口号。)</p>
<h2 id="普通包"><a href="#普通包" class="headerlink" title="普通包"></a>普通包</h2><p>普通包已认证且加密。公共头部已认证但未加密，从第一个帧开始的包的其余部分已加密。紧跟再公共头部之后，普通包包含AEAD（authenticated encryption and associated data）数据。这些数据在被作为内容解释之前一定要先解密。解密之后，明文由一系列的帧组成。</p>
<p>(TODO: Document the inputs to encryption and decryption and describe trial decryption.)</p>
<h3 id="帧包"><a href="#帧包" class="headerlink" title="帧包"></a><em>帧包</em></h3><p>帧包具有一个载荷，它是一系列的类型前缀帧。帧类型的格式将在本文档的后面定义，但帧包的通用格式如下：<br><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="bullet">--- </span>src</div><div class="line"><span class="code">+--------+</span>---...---<span class="code">+--------+</span>---...---+</div><div class="line">| Type   | Payload | Type   | Payload |</div><div class="line"><span class="section">+--------+---...---+--------+---...---+</span></div><div class="line">---</div></pre></td></tr></table></figure></p>
<h1 id="QUIC连接的生命"><a href="#QUIC连接的生命" class="headerlink" title="QUIC连接的生命"></a>QUIC连接的生命</h1><h2 id="连接建立"><a href="#连接建立" class="headerlink" title="连接建立"></a>连接建立</h2><p>QUIC客户端初始化一个连接。QUIC的连接建立将版本协商与加密和传输握手交织在一起以减少连接建立延迟。我们将在下面首先描述版本协商。</p>
<p>最初由客户端发向服务器的每个包必须设置版本标记，而且必须指定使用的协议版本。客户端发送的每个包必须开启版本标记，直到它从服务器收到了版本标记关闭的包。在服务器从客户端收到了第一个版本标记关闭的包之后，它必须忽略任何版本标记打开的包（可能由于延迟）。</p>
<p>当服务器收到一个含有新连接的连接ID的包，它将对比客户端的版本和它支持的版本。如果服务器可以接受客户端的版本，服务器将为连接的整个生命周期使用这个协议版本。在这种情况下，服务器发送的所有包的版本标记都是关闭的。</p>
<p>如果客户端的版本不被服务器接受，则将导致1-RTT的延迟。服务器将发送一个版本协商包给客户端。这个包将设置版本标记，并将包含服务器支持的版本的集合。</p>
<p>当客户端从服务器收到一个版本协商包，它将选择一个可接受的协议版本并使用这个版本重发所有包。这些包必须持续设置版本标记，而且必须包含新协商的协议版本。最后，客户端从服务器收到第一个普通包（比如，一个非版本协商包）表明版本协商的结束，此后客户端发送的所有后续包版本标记关闭。</p>
<p>为了避免降级攻击，客户端在第一个包中指定的协议版本，以及服务器支持的版本集合必须被包含在加密的握手数据中。客户端需要验证握手中的服务器版本列表与版本协商包中的版本列表匹配。服务器需要验证握手中的客户端版本表示一个它实际上不支持的协议版本。</p>
<p>连接建立的其余部分在握手文档中描述 [QUIC-CRYPTO]。加密握手在专门的加密流（流 ID 1）中执行。</p>
<p>在连接握手期间，握手必须协商多种传输参数。当前已定义的传输参数在本文档的后面描述。</p>
<h2 id="数据传输"><a href="#数据传输" class="headerlink" title="数据传输"></a>数据传输</h2><p>QUIC实现了连接可靠性，拥塞控制，和流量控制。QUIC流量控制与HTTP/2的流量控制很接近。QUIC可靠性和拥塞控制在一份附带文档中描述。QUIC连接为跨连接的共享拥塞控制和丢失恢复，而使用一个单独的包序列号空间。</p>
<p>QUIC连接中传输的所有数据，包括加密握手，被作为流内的数据发送，但ACKs确认QUIC包。</p>
<p>这个部分概念性地描述一个QUIC连接内数据传输的流的使用。本节提到的各种各样的帧在 帧类型和格式 一节中描述。</p>
<h3 id="QUIC流的生命"><a href="#QUIC流的生命" class="headerlink" title="QUIC流的生命"></a><em>QUIC流的生命</em></h3><p>流是独立的双向数据序列，且被切割为流帧。流可以由客户端创建，也可以由服务器创建，可以与其它流并行交错地发送数据，且可以取消。QUIC流的生命周期模型与HTTP/2 [RFC 7540] 的很接近。（QUIC流的HTTP/2使用在本文档的后面部分有更详细的描述。）</p>
<p>流创建显式地完成，通过为一个给定的流发送一个STREAM帧。为了避免流ID冲突，流 ID 必须是偶数，如果流是由服务器初始化的话，如果流由客户端初始化则必须为奇数。0不是一个有效的流 ID。流 1 被保留用来加密握手，它应该是第一个客户端初始化的流。当基于QUIC使用HTTP/2时，流 3 被保留来为其它流传输压缩的首部，以确保首部的处理和传送可靠且有序。</p>
<p>随着新流的创建，连接的每一边的 流 ID 必须单调地递增。比如 流 2 可能在 流 3 之后创建，但 流 7 一定不能在 流 9 之后创建。对端可以接收乱序的流。比如，如果服务器收到了包 10，其中包含 流 9 的帧，在它收到包含 流 7 的帧的 包 9 之前，它应该优雅地处理这种情况。</p>
<p>如果端点收到一个STREAM帧，但它不想接受流，它可以立即以一个RST_STREAM帧（稍后描述）响应。注意，然而，初始化流的端点可能也已经在那个流上发送了数据；这些数据必须被忽略。</p>
<p>一旦流创建好，它可被用于发送和接收数据。这意味着一系列的流帧可被QUIC端点在那个流上发送，直到流在那个方向上被终止。</p>
<p>QUIC连接的任何一端都可以正常地终止一个流。有三种方式可以终止流：</p>
<ol>
<li><strong>正常终止：</strong>由于流是双向的，流可以是 “half-closed（半关闭）”或”closed（关闭）”状态。当流的一边发送一个FIN位被设为ture的帧，流被认为在那个方向上是”half-closed（半关闭）”的。FIN指明这个流上打开了FIN的发送者将不会在这个流上发送更多数据了。当QUIC的两个端点都发送并接收到了FIN，则端点认为流是”closed（关闭）”状态的。尽管FIN应该随着流的最后的用户数据一起发送，但FIN位可以被流的最后的数据帧后面的空流帧发送。</li>
<li><strong>异常终止：</strong>客户端或服务器可以在任何时候为一个流发送RST_STREAM帧。RST_STREAM帧包含一个错误码用以指示失败原因（本文当的后面部分会列出错误码）。当流的发起者发送了一个RST_STREAM帧，它表示完成流失败了，而且不会有更多的数据在那个流上发送了。当RST_STREAM帧是由流的接收者发送的时，发送者，一旦接收，应该停止在那个流上发送任何数据。流接收者应该意识到发送者已经传输的数据和RST_STREAM帧接收的时间之间存在着竞态。为了确保连接级的流量控制可以被正确的实现，即使收到了一个RST_STREAM帧，发送者依然需要确保两者之一：对端收到流的FIN和所有字节或者对端收到一个RST_STREAM帧。这还意味着RST_STREAM帧的发送者需要持续以适当的WINDOW_UPDATE响应进入的那个流的STREAM_FREAME以确保发送者不让流量控制被阻塞而试图传送FIN。</li>
<li>当连接终止时流也会被终止，如在下一节描述的那样。</li>
</ol>
<h2 id="连接终止"><a href="#连接终止" class="headerlink" title="连接终止"></a>连接终止</h2><p>连接应该保持打开状态，直到他们在预协商周期的时间后变为空闲。当服务器决定终止一个空闲的连接时，它不应该通知客户端来避免唤醒移动设备的无线电模块。QUIC连接，一旦建立，可由两种方式中的一种终止：</p>
<ol>
<li><strong>显式关闭：</strong>一个端点发送一个CONNECTION_CLOSE帧给对端来初始化一个连接终止。一个端点可以在一个CONNECTION_CLOSE之前发送一个GOAWAY帧给对端来表明连接将在不久后终止。当发送GOAWAY帧时，通知对端任何活跃的流将继续被处理，但GOAWAY的发送者将不再初始化任何额外的流，且不接受任何新进入的流。在任何活跃的流的终止中，可以发送CONNECTION_CLOSE。如果一个端点在未终止的流活跃时发送了一个CONNECTION_CLOSE帧（一个或多个流还没有FIN位或RST_STREAM帧被发送或接收），则对端必须假设流是不完整的且被异常地终止。</li>
<li><strong>隐式关闭：</strong>QUIC连接默认的空闲超时时间是30秒，且是连接协商中的一个必须参数(“ICSL”)。最大值是10分钟。如果在空闲超时期间没有网络活动，连接将关闭。默认情况下将发送一个CONNECTION_CLSOE帧。当发送一个显式的关闭比较昂贵时可以启用安静关闭选项，比如移动网络必须唤醒无线电模块。</li>
</ol>
<p>一个端点还可以在连接期间的任何时间发送一个PUBLIC_RESET包来突然地终止活跃的连接。QUIC中的PUBLIC_RESET等价于TCP的RST。</p>
<h1 id="帧类型和格式"><a href="#帧类型和格式" class="headerlink" title="帧类型和格式"></a>帧类型和格式</h1><p>QUIC帧包由帧填充。它具有一个帧类型字节，它本身具有一个依赖类型的解释，后面是依赖类型的帧首部字段。所有的帧被包含在单独的QUIC包中，且没有帧可以跨越QUIC包边界。</p>
<h2 id="帧类型"><a href="#帧类型" class="headerlink" title="帧类型"></a>帧类型</h2><p>帧类型字节有两种解释，导致两种帧类型：特殊帧类型，和普通帧类型。特殊帧类型在帧类型字节中同时编码帧类型和对应的标记，而普通帧类型简单地使用帧类型字节。</p>
<p>当前定义的特殊帧类型如下：<br><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">--- src</div><div class="line">   +------------------+-----------------------------+</div><div class="line">   |<span class="string"> Type-field value </span>|<span class="string">     Control Frame-type      </span>|</div><div class="line">   +------------------+-----------------------------+</div><div class="line">   |<span class="string">     1fdooossB    </span>|<span class="string">  STREAM                     </span>|</div><div class="line">   |<span class="string">     01ntllmmB    </span>|<span class="string">  ACK                        </span>|</div><div class="line">   |<span class="string">     001xxxxxB    </span>|<span class="string">  CONGESTION_FEEDBACK        </span>|</div><div class="line">   +------------------+-----------------------------+</div><div class="line">---</div></pre></td></tr></table></figure></p>
<p>当前定义的普通帧类型如下：<br><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">--- src</div><div class="line">   +------------------+-----------------------------+</div><div class="line">   |<span class="string"> Type-field value </span>|<span class="string">     Control Frame-type      </span>|</div><div class="line">   +------------------+-----------------------------+</div><div class="line">   |<span class="string"> 00000000B (0x00) </span>|<span class="string">  PADDING                    </span>|</div><div class="line">   |<span class="string"> 00000001B (0x01) </span>|<span class="string">  RST_STREAM                 </span>|</div><div class="line">   |<span class="string"> 00000010B (0x02) </span>|<span class="string">  CONNECTION_CLOSE           </span>|</div><div class="line">   |<span class="string"> 00000011B (0x03) </span>|<span class="string">  GOAWAY                     </span>|</div><div class="line">   |<span class="string"> 00000100B (0x04) </span>|<span class="string">  WINDOW_UPDATE              </span>|</div><div class="line">   |<span class="string"> 00000101B (0x05) </span>|<span class="string">  BLOCKED                    </span>|</div><div class="line">   |<span class="string"> 00000110B (0x06) </span>|<span class="string">  STOP_WAITING               </span>|</div><div class="line">   |<span class="string"> 00000111B (0x07) </span>|<span class="string">  PING                       </span>|</div><div class="line">   +------------------+-----------------------------+</div><div class="line">---</div></pre></td></tr></table></figure></p>
<h2 id="STREAM帧"><a href="#STREAM帧" class="headerlink" title="STREAM帧"></a><strong>STREAM帧</strong></h2><p>STREAM帧同时被用于隐式地创建流和在流上发送数据，它的格式如下：<br><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="bullet">--- </span>src</div><div class="line"><span class="section">     0        1       …               SLEN</span></div><div class="line">+--------+--------+--------+--------+--------+</div><div class="line">|Type (8)| Stream ID (8, 16, 24, or 32 bits) |</div><div class="line"><span class="section">|        |    (Variable length SLEN bytes)   |</span></div><div class="line">+--------+--------+--------+--------+--------+</div><div class="line"><span class="section">  SLEN+1  SLEN+2     …                                         SLEN+OLEN   </span></div><div class="line">+--------+--------+--------+--------+--------+--------+--------+--------+</div><div class="line">|   Offset (0, 16, 24, 32, 40, 48, 56, or 64 bits) (variable length)    |</div><div class="line"><span class="section">|                    (Variable length: OLEN  bytes)                     |</span></div><div class="line">+--------+--------+--------+--------+--------+--------+--------+--------+</div><div class="line"><span class="section">  SLEN+OLEN+1   SLEN+OLEN+2</span></div><div class="line">+-------------+-------------+</div><div class="line">| Data length (0 or 16 bits)|</div><div class="line"><span class="section">|  Optional(maybe 0 bytes)  |</span></div><div class="line">+------------+--------------+</div><div class="line">---</div></pre></td></tr></table></figure></p>
<p>STREAM帧首部中的字段如下：</p>
<ul>
<li><strong>帧类型：</strong>帧类型字节是一个包含多种标记 (1fdooossB) 的8位值：<ul>
<li>最左边的位必须被设为 1 以指明这是一个STREAM帧。</li>
<li>‘f’ 位是FIN位。当被设置为 1 时，这个位表明发送者已经完成在流上的发送并希望 “half-close（半关闭）”（稍后将详细描述）。本文档的后面将更详细地描述。</li>
<li>‘d’ 位表明STREAM头部中是否包含数据长度。当设为0时，这个字段表明STREAM帧扩展至包的结尾。</li>
<li>接下来的三个’ooo’位编码Offset头部字段的长度为0，16，24，32，40，48，56，或64位长。</li>
<li>接下来的两个 ‘ss’ 位编码流 ID头部字段的长度为 8，16，24，或32位长。</li>
</ul>
</li>
<li><strong>流 ID：</strong>一个大小可变的流唯一的无符号ID。</li>
<li><strong>偏移：</strong>一个大小可变的无符号数字指定流中这块数据的字节偏移。</li>
<li><strong>数据长度：</strong>一个可选的16位无符号数字指定这个流帧中数据的长度。只有当包是 “全大小(full-sized)” 包时，才应该省略长度，来避免填充破坏的风险。</li>
</ul>
<p>一个流帧必须总是要么具有非零的数据长度，要么设置了FIN位。</p>
<h2 id="ACK帧"><a href="#ACK帧" class="headerlink" title="ACK帧"></a>ACK帧</h2><p>ACK帧被发送用以通知对端哪些包已经收到，还有哪些包依然被接收者认为丢失了（丢失包的内容可能需要被重发）。ACK帧包含1 到 256 个ack块。Ack块是确认的包的范围，与TCP的SACK块类似，但QUIC没有等价的TCP的累积ack点，由于包将以新的序列号重传。</p>
<p>要限制ACK块为还没有被对端接收的，对端周期性地发送STOP_WAITING帧，用来通知接收者停止确认小于特定序列号的包，再接收者产生”最小未确认”包数字。ACK帧的发送者这样只报告那些在接收到的最小未确认和报告的最大已发现包号之间的ACK块。建议发送者在ack中发送它已经接收到的最近最大确认包，作为stop waiting帧的最小未确认值。</p>
<p>不像TCP SACK，QUIC ACK块是不可变的，因此一旦一个包被确认了，即使它没有出现在未来的ack帧中，它也被假设已经确认。</p>
<p>作为QUIC的已废弃的熵的替代，发送者可以有意地跳过包号来为连接引入熵。如果一个未发送的包号被确认了，则发送者必须总是关闭连接，因此这种机制自动地防御了任何潜在的攻击。ack格式在表达丢失包的块上是比较高效的，因此对于接收者和发送者这还是成本比较低的，且可以根据需要有效地提供至多8 位的熵，而不是通过恒定的开销来实现8位的熵。8位是ack范围和ack格式之间可高效地表达的最大gap。</p>
<h3 id="段偏移"><a href="#段偏移" class="headerlink" title="段偏移"></a><strong>段偏移</strong></h3><p><strong>0</strong>：Ack帧的起始位置。<br><strong>T</strong>：时间戳段起始位置的字节偏移量。<br><strong>A</strong>：Ack块段起始位置的字节偏移量。<br><strong>N</strong>：最大已确认的字节长度。<br><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="bullet">--- </span>src</div><div class="line"><span class="section">     0                            1  =&gt; N                     N+1 =&gt; A(aka N + 3)</span></div><div class="line">+---------+-------------------------------------------------+--------+--------+</div><div class="line">|   Type  |                   Largest Acked                 |  Largest Acked  |</div><div class="line">|   (8)   |    (8, 16, 32, or 48 bits, determined by ll)    | Delta Time (16) |</div><div class="line"><span class="section">|01nullmm |                                                 |                 |</span></div><div class="line">+---------+-------------------------------------------------+--------+--------+</div><div class="line"><span class="code">     A             A + 1  ==&gt;  A + N</span></div><div class="line"><span class="code">+--------+</span>----------------------------------------+              </div><div class="line">| Number |             First Ack                  |</div><div class="line">|Blocks-1|           Block Length                 |</div><div class="line"><span class="section">| (opt)  |(8, 16, 32 or 48 bits, determined by mm)|</span></div><div class="line">+--------+----------------------------------------+</div><div class="line"><span class="section">  A + N + 1                A + N + 2  ==&gt;  T(aka A + 2N + 1)</span></div><div class="line">+------------+-------------------------------------------------+</div><div class="line">| Gap to next|              Ack Block Length                   |</div><div class="line">| Block (8)  |   (8, 16, 32, or 48 bits, determined by mm)     |</div><div class="line"><span class="section">| (Repeats)  |       (repeats Number Ranges times)             |</span></div><div class="line">+------------+-------------------------------------------------+</div><div class="line"><span class="code">     T        T+1             T+2                 (Repeated Num Timestamps)</span></div><div class="line"><span class="code">+----------+</span>--------<span class="code">+---------------------+</span> ...  --------<span class="code">+------------------+</span>  </div><div class="line">|   Num    | Delta  |     Time Since      |     | Delta  |       Time       |</div><div class="line">|Timestamps|Largest |    Largest Acked    |     |Largest |  Since Previous  |</div><div class="line">|   (8)    | Acked  |      (32 bits)      |     | Acked  |Timestamp(16 bits)|</div><div class="line"><span class="section">+----------+--------+---------------------+     +--------+------------------+</span></div><div class="line">---</div></pre></td></tr></table></figure></p>
<p>ACK帧中的字段如下：</p>
<ul>
<li><strong>帧类型：</strong>帧类型字节是一个8位的值，其中包含了多种标记（01nullmmB）。<ul>
<li>开始的两位必须被设置为 01，以表明这是一个ACK帧。</li>
<li>‘n’ 位表明帧是否有多于 1 个ack帧。</li>
<li>‘u’ 位未使用。</li>
<li>两个’ll’位编码最大已观察字段的长度为1，2，4，或者 6字节长。</li>
<li>两个’mm’位编码丢失包序列号差值字段的长度为 1，2，4，或者 6字节长。</li>
</ul>
</li>
<li><strong>最大已确认(Largest Acked)：</strong>一个大小可变的无符号值，表示对端已观察到的最大的包号。</li>
<li><strong>最大已确认差值时间(Largest Acked Delta Time)：</strong>一个16 位的无符号浮点数，其中11个显式的位为底数，5位的显式指数，描述了从最大已确认包收到到这个Ack帧发送之间经过的微秒数。位格式近似于以IEEE 754建模。比如，1 微秒用 0x1表示，它的指数为0，在高5位中表示，底数为1，在低 11 位中表示。当显式的指数大于0的时候，则假设底数包含一个隐式的高阶12位的1。比如，浮点值 0x800 有一个显式的指数1，同时有一个显式的底数0，但之后有一个有效的底数 4096（假设12位为1）。此外，实际的指数比显式的指数小1，值表示4096微秒。任何大于可表示范围的值限定为 0xFFFF。</li>
<li><strong>Ack 块段 (Ack Block Section)：</strong><ul>
<li><strong>块个数 (Num Blocks)</strong>：一个可选的8位无符号值描述了ack块的个数减一。只有在 ‘n’ 标记位为 1 时才有。</li>
<li><strong>Ack块长度 (Ack block length)</strong>：一个大小可变包号差值。对于第一个丢失包范围，ack块以最大已确认包开始。对于首个ack块，ack块的长度为 1 + 该值。对于后续的ack块，它是ack块的长度。对于非首个块，0值表示多于256个包丢失了。</li>
<li><strong>到下一块的间隙 (Gap to next block)</strong>：一个8位的无符号值，描述了ack块之间包的个数。</li>
</ul>
</li>
<li><strong>时间戳段 (Timestamp Section)：</strong><ul>
<li><strong>时间戳个数 (Num Timestamp)</strong>：一个8位无符号值描述了包含在这个ack帧中的时间戳的个数。在后面的timestamps中将由许多的<packet number,="" timestamp="">对。</packet></li>
<li><strong>已观察最大差值 (Delta Largest Observed)</strong>：一个8位无符号值描述了首个时间戳和最大已观察包之间包号的差值。然而，包号为最大已观察包号 减去 已观察最大差值 (delta largest observed)。</li>
<li><strong>首个时间戳 (First Timestamp)</strong>：一个32位无符号值描述自由最大已观察包号描述的包的到达的连接的开始，减去 已观察最大差值，所得到的时间差值的微秒数。</li>
<li><strong>已观察最大差值（重复）(Delta Largest Observed(Repeated))</strong>：（同上。）</li>
<li><strong>自前一个时间戳的时间（重复） (Time Since Previous Timestamp (Repeated))</strong>：一个16位的无符号值描述了与前一个时间戳的差值。它的编码格式与 Ack Delay Time相同。</li>
</ul>
</li>
</ul>
<h2 id="STOP-WAITING-帧"><a href="#STOP-WAITING-帧" class="headerlink" title="STOP_WAITING 帧"></a><strong>STOP_WAITING 帧</strong></h2><p>STOP_WAITING 帧用于通知对端，它不应该继续等待包号小于特定值的包。包号以1，2，4或6字节编码，using the same coding length as is specified for the packet number for the enclosing packet’s header (specified in the QUIC Frame Packet’s Public Flags field.) 这个帧如下:<br><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="bullet">--- </span>src</div><div class="line"><span class="section">     0        1        2        3         4       5       6  </span></div><div class="line">+--------+--------+--------+--------+--------+-------+-------+</div><div class="line">|Type (8)|   Least unacked delta (8, 16, 32, or 48 bits)     |</div><div class="line"><span class="section">|        |                       (variable length)           |</span></div><div class="line">+--------+--------+--------+--------+--------+--------+------+</div><div class="line">---</div></pre></td></tr></table></figure></p>
<p>STOP_WAITING帧中的字段如下：</p>
<ul>
<li><p><strong>帧类型：</strong>帧类型是一个8位的值，它必须被设置为0x06以表明这是一个STOP_WAITING帧。 </p>
</li>
<li><p><strong>最小未确认差值：</strong>一个可变长度的包号差值，与包首部的包号长度相同。将它从头部的包号减去以确定最小的未确认包。结果的最小未确认包是发送者依然在等待确认的包号最小的包。如果接收者丢失了任何比这个值小的包，接收者应该将那些包认做无可挽回的丢失。</p>
</li>
</ul>
<h2 id="WINDOW-UPDATE-帧"><a href="#WINDOW-UPDATE-帧" class="headerlink" title="WINDOW_UPDATE 帧"></a><strong>WINDOW_UPDATE 帧</strong></h2><p>WINDOW_UPDATE 帧用于通知对端一个端点的流量控制接收窗口的增长。流ID可以是0，表示这个WINDOW_UPDATE应用于连接级的流量控制窗口，或者 &gt; 0 表示指定的流应该增长它的流量控制窗口。帧如下：</p>
<p>指定一个完全的字节偏移量，WINDOW_UPDATE帧的接收者可以只在那个流上至多发送那个字节数。发送更多字节而违背流量控制将导致接收端关闭连接。</p>
<p>为特定流ID收到多个WINDOW_UPDATE帧时，只需要追踪最大的字节偏移即可。</p>
<p>流和会话窗口都以一个默认值16KB开始，但是这个值典型地在握手期间增长。为了做到这一点，端点应该在握手中协商 SFCW (Stream Flow Control Window) 和 CFCW (Connection/Session Flow Control Window) 参数。与每个标记关联的值应该分别是初始流窗口和初始连接窗口的字节数。</p>
<p>帧如下：<br><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="bullet">--- </span>src</div><div class="line"><span class="code">    0         1                 4        5                 12</span></div><div class="line"><span class="code">+--------+</span>--------<span class="code">+-- ... --+</span>-------<span class="code">+--------+</span>-- ... --<span class="code">+-------+</span></div><div class="line">|Type(8) |    Stream ID (32 bits)   |  Byte offset (64 bits)   | </div><div class="line"><span class="section">+--------+--------+-- ... --+-------+--------+-- ... --+-------+</span></div><div class="line">---</div></pre></td></tr></table></figure></p>
<p>WINDOW_UPDATE帧中的字段如下：</p>
<ul>
<li><p><strong>帧类型：</strong>帧类型是一个8位值，它必须被设置为0x04以表示这是一个WINDOW_UPDATE帧。</p>
</li>
<li><p><strong>流 ID：</strong>要更新流控制窗口的流的ID，或者为0来描述连接级的流控制窗口。</p>
</li>
<li><p><strong>字节偏移：</strong> 一个64位无符号整型值，表示在给定的流上可以发送的数据的完整字节偏移量。在连接级流量控制的情况下，是在当前所有打开的流上可以发送的字节的总和。</p>
</li>
</ul>
<h2 id="BLOCKED-帧"><a href="#BLOCKED-帧" class="headerlink" title="BLOCKED 帧"></a><strong>BLOCKED 帧</strong></h2><p>BLOCKED帧用于向远端指明本端点已经准备好发送数据了（且有数据要发送），但是当前被流量控制阻塞了。这是一个纯粹的信息帧，它对于调试极其有用。BLOCKED帧的接收者应该简单的丢弃它（可能在打印了一条有帮助的log消息之后）。帧如下：<br><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="bullet">--- </span>src</div><div class="line"><span class="section">     0        1        2        3         4</span></div><div class="line">+--------+--------+--------+--------+--------+</div><div class="line"><span class="section">|Type(8) |          Stream ID (32 bits)      |  </span></div><div class="line">+--------+--------+--------+--------+--------+</div><div class="line">---</div></pre></td></tr></table></figure></p>
<p>BLOCKED帧中的字段如下：</p>
<ul>
<li><p><strong>帧类型：</strong>帧类型是一个8位值，它必须被设置为0x05以表示这是一个BLOCKED帧。</p>
</li>
<li><p><strong>流 ID：</strong>一个32位的无符号数，表示流量控制阻塞的流。非零 流 ID 字段描述了被流量控制阻塞的流。当这个值为0时，流 ID字段在连接级指明连接被流量控制阻塞了。</p>
</li>
</ul>
<h2 id="CONGESTION-FEEDBACK-帧"><a href="#CONGESTION-FEEDBACK-帧" class="headerlink" title="CONGESTION_FEEDBACK 帧"></a><strong>CONGESTION_FEEDBACK 帧</strong></h2><p>The CONGESTION_FEEDBACK frame is an experimental frame currently not used. It is intended to provide extra congestion feedback information outside the scope of the standard ack frame. A CONGESTION_FEEDBACK frame must have the first three bits of the Frame Type set to 001. The last 5 bits of the Frame Type field are reserved for future use.</p>
<h2 id="PADDING-帧"><a href="#PADDING-帧" class="headerlink" title="PADDING 帧"></a><strong>PADDING 帧</strong></h2><p>The PADDING frame pads a packet with 0x00 bytes. When this frame is encountered, the rest of the packet is expected to be padding bytes. The frame contains 0x00 bytes and extends to the end of the QUIC packet. A PADDING frame only has a Frame Type field, and must have the 8-bit Frame Type field set to 0x00.</p>
<h2 id="RST-STREAM-帧"><a href="#RST-STREAM-帧" class="headerlink" title="RST_STREAM 帧"></a><strong>RST_STREAM 帧</strong></h2><p>The RST_STREAM frame allows for abnormal termination of a stream. When sent by the creator of a stream, it indicates the creator wishes to cancel the stream. When sent by the receiver of a stream, it indicates an error or that the receiver did not want to accept the stream, so the stream should be closed. The frame is as follows:<br><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="bullet">--- </span>src</div><div class="line"><span class="code">     0        1            4      5              12     8             16</span></div><div class="line"><span class="code">+-------+</span>--------<span class="code">+-- ... ----+</span>--------<span class="code">+-- ... ------+</span>-------<span class="code">+-- ... ------+</span></div><div class="line">|Type(8)| StreamID (32 bits) | Byte offset (64 bits)| Error code (32 bits)|</div><div class="line"><span class="section">+-------+--------+-- ... ----+--------+-- ... ------+-------+-- ... ------+</span></div><div class="line">---</div></pre></td></tr></table></figure></p>
<p>The fields in a RST_STREAM frame are as follows:</p>
<ul>
<li><p><strong>Frame type:</strong> The Frame Type is an 8-bit value that must be set to 0x01 specifying that this is a RST_STREAM frame.</p>
</li>
<li><p><strong>Stream ID:</strong> The 32-bit Stream ID of the stream being terminated.</p>
</li>
<li><p><strong>Byte offset:</strong> A 64-bit unsigned integer indicating the absolute byte offset of the end of data for this stream.</p>
</li>
<li><p><strong>Error code:</strong> A 32-bit QuicErrorCode which indicates why the stream is being closed. QuicErrorCodes are listed later in this document.</p>
</li>
</ul>
<h2 id="PING-帧"><a href="#PING-帧" class="headerlink" title="PING  帧"></a><strong>PING  帧</strong></h2><p>The PING frame can be used by an endpoint to verify that a peer is still alive. The PING frame contains no payload. The receiver of a PING frame simply needs to ACK the packet containing this frame. The PING frame should be used to keep a connection alive when a stream is open. The default is to do this after 15 seconds of quiescence, which is much shorter than most NATs time out. A PING frame only has a Frame Type field, and must have the 8-bit Frame Type field set to 0x07.**</p>
<h2 id="CONNECTION-CLOSE-帧"><a href="#CONNECTION-CLOSE-帧" class="headerlink" title="CONNECTION_CLOSE 帧"></a><strong>CONNECTION_CLOSE 帧</strong></h2><p>The CONNECTION_CLOSE frame allows for notification that the connection is being closed. If there are streams in flight, those streams are all implicitly closed when the connection is closed. (Ideally, a GOAWAY frame would be sent with enough time that all streams are torn down.) The frame is as follows:**<br><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="bullet">--- </span>src</div><div class="line"><span class="code">     0        1             4        5        6       7       </span></div><div class="line"><span class="code">+--------+</span>--------<span class="code">+-- ... -----+</span>--------<span class="code">+--------+</span>--------+----- ...</div><div class="line">|Type(8) | Error code (32 bits)| Reason phrase   |  Reason phrase  </div><div class="line">|        |                     | length (16 bits)|(variable length)</div><div class="line"><span class="section">+--------+--------+-- ... -----+--------+--------+--------+----- ...</span></div><div class="line">---</div></pre></td></tr></table></figure></p>
<p>The fields of a CONNECTION_CLOSE frame are as follows:</p>
<ul>
<li><p><strong>Frame Type:</strong> An 8-bit value that must be set to 0x02 specifying that this is a CONNECTION_CLOSE frame.</p>
</li>
<li><p><strong>Error Code:</strong> A 32-bit field containing the QuicErrorCode which indicates the reason for closing this connection.</p>
</li>
<li><p><strong>Reason Phrase Length:</strong> A 16-bit unsigned number specifying the length of the reason phrase. This may be zero if the sender chooses to not give details beyond the QuicErrorCode.</p>
</li>
<li><p><strong>Reason Phrase:</strong> An optional human-readable explanation for why the connection was closed.**</p>
</li>
</ul>
<h2 id="GOAWAY-帧"><a href="#GOAWAY-帧" class="headerlink" title="GOAWAY 帧"></a><strong>GOAWAY 帧</strong></h2><p>The GOAWAY frame allows for notification that the connection should stop being used, and will likely be aborted in the future. Any active streams will continue to be processed, but the sender of the GOAWAY will not initiate any additional streams, and will not accept any new streams. The frame is as follows:**<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">--- src</div><div class="line">     <span class="number">0</span>        <span class="number">1</span>             <span class="number">4</span>      <span class="number">5</span>       <span class="number">6</span>       <span class="number">7</span>      <span class="number">8</span></div><div class="line">+--------+--------+-- ... -----+-------+-------+-------+------+</div><div class="line">|Type(<span class="number">8</span>) | Error code (<span class="number">32</span> bits)| Last Good Stream ID (<span class="number">32</span> bits)| -&gt;</div><div class="line">+--------+--------+-- ... -----+-------+-------+-------+------+</div><div class="line">      <span class="number">9</span>        <span class="number">10</span>       <span class="number">11</span>  </div><div class="line">+--------+--------+--------+----- ... </div><div class="line">| Reason phrase   |  Reason phrase</div><div class="line">| length (<span class="number">16</span> bits)|(variable length)</div><div class="line">+--------+--------+--------+----- ...</div><div class="line">---</div></pre></td></tr></table></figure></p>
<p>The fields of a GOAWAY frame are as follows:</p>
<ul>
<li><p><strong>Frame type:</strong> An 8-bit value that must be set to 0x03 specifying that this is a GOAWAY frame.</p>
</li>
<li><p><strong>Error Code:</strong> A 32-bit field containing the QuicErrorCode which indicates the reason for closing this connection. </p>
</li>
<li><p><strong>Last Good Stream ID:</strong> The last Stream ID which was accepted by the sender of the GOAWAY message. If no streams were replied to, this value must be set to 0.</p>
</li>
<li><p><strong>Reason Phrase Length:</strong> A 16-bit unsigned number specifying the length of the reason phrase. This may be zero if the sender chooses to not give details beyond the error code.</p>
</li>
<li><p><strong>Reason Phrase:</strong> An optional human-readable explanation for why the connection was closed.**</p>
</li>
</ul>
<h1 id="QUIC传输参数"><a href="#QUIC传输参数" class="headerlink" title="QUIC传输参数"></a>QUIC传输参数</h1><p>The handshake is responsible for negotiating a variety of transport parameters for a QUIC connection.</p>
<h2 id="Required-Parameters"><a href="#Required-Parameters" class="headerlink" title="Required Parameters"></a><strong>Required Parameters</strong></h2><ul>
<li><p>SFCW - Stream Flow Control Window. The size in bytes of the stream level flow control window.</p>
</li>
<li><p>CFCW - Connection Flow Control Window. The size in bytes of the connection level flow control window.**</p>
</li>
</ul>
</div><div class="tags"><a href="/tags/网络协议/">网络协议</a><a href="/tags/QUIC/">QUIC</a><a href="/tags/翻译/">翻译</a></div><div class="post-nav"><a href="/2017/01/22/Chromium Android开发的Eclipse配置/" class="pre">Chromium Android开发的Eclipse配置</a><a href="/2017/01/12/使用LeakTracer检测android NDK C_C++代码中的memory leak/" class="next">使用LeakTracer检测android NDK C/C++代码中的memory leak</a></div><div data-thread-key="2017/01/13/QUIC协议规范/" data-title="QUIC协议规范" data-url="https://www.wolfcstech.com/2017/01/13/QUIC协议规范/" class="ds-share flat"><div class="ds-share-inline"><ul class="ds-share-icons-16"><li data-toggle="ds-share-icons-more"><a href="javascript:void(0);" class="ds-more">分享到:</a></li><li><a href="javascript:void(0);" data-service="weibo" class="ds-weibo">微博</a></li><li><a href="javascript:void(0);" data-service="qzone" class="ds-qzone">QQ空间</a></li><li><a href="javascript:void(0);" data-service="qqt" class="ds-qqt">腾讯微博</a></li><li><a href="javascript:void(0);" data-service="wechat" class="ds-wechat">微信</a></li></ul><div class="ds-share-icons-more"></div></div></div><div data-thread-key="2017/01/13/QUIC协议规范/" data-title="QUIC协议规范" data-url="https://www.wolfcstech.com/2017/01/13/QUIC协议规范/" data-author-key="1" class="ds-thread"></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="widget"><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="请输入关键字..."/></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-gui"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android开发/">Android开发</a><span class="category-list-count">21</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/C-C-开发/">C/C++开发</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java开发/">Java开发</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/后台开发/">后台开发</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/安全/">安全</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/网络协议/">网络协议</a><span class="category-list-count">34</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/网络调试/">网络调试</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/随想杂谈/">随想杂谈</a><span class="category-list-count">2</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> 标签</i></div><div class="tagcloud"><a href="/tags/网络调试/" style="font-size: 15px;">网络调试</a> <a href="/tags/网络协议/" style="font-size: 15px;">网络协议</a> <a href="/tags/Android开发/" style="font-size: 15px;">Android开发</a> <a href="/tags/后台开发/" style="font-size: 15px;">后台开发</a> <a href="/tags/QUIC/" style="font-size: 15px;">QUIC</a> <a href="/tags/chromium/" style="font-size: 15px;">chromium</a> <a href="/tags/翻译/" style="font-size: 15px;">翻译</a> <a href="/tags/源码分析/" style="font-size: 15px;">源码分析</a> <a href="/tags/HTTP2/" style="font-size: 15px;">HTTP2</a> <a href="/tags/Java开发/" style="font-size: 15px;">Java开发</a> <a href="/tags/OpenGL/" style="font-size: 15px;">OpenGL</a> <a href="/tags/UDT/" style="font-size: 15px;">UDT</a> <a href="/tags/安全/" style="font-size: 15px;">安全</a> <a href="/tags/HTTPS/" style="font-size: 15px;">HTTPS</a> <a href="/tags/C-C-开发/" style="font-size: 15px;">C/C++开发</a> <a href="/tags/Django/" style="font-size: 15px;">Django</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-fei"> 归档</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">二月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">一月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">十二月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">十一月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">十月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">八月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">七月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">四月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">九月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/07/">七月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/09/">九月 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/07/">七月 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/05/">五月 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/02/">二月 2013</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/02/24/Networking_optimization_study/">网络优化实践探索文章</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/02/23/OkHttp实现分析之Websocket/">OkHttp实现分析之Websocket</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/02/22/introduction_to_android_things/">Android Things介绍</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/02/21/Simpleperf_Introduction/">Simpleperf介绍</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/02/16/Wireshark源码安装/">Wireshark源码安装</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/02/09/Android平台Chromium net中的代理配置信息获取/">Android平台Chromium net中的代理配置信息获取</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/02/06/Android端打开HttpDns的正确姿势/">Android端打开HttpDns的正确姿势</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/02/05/虹桥火车站的卫生间/">虹桥火车站的卫生间</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/02/05/做自己喜欢的事/">做自己喜欢的事</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/24/QUIC及HTTP2相关资料整理/">QUIC及HTTP2相关资料整理</a></li></ul></div><div class="widget"><div class="comments-title"><i class="fa fa-commt"> 最近评论</i></div><div data-num-items="5" data-show-avatars="0" data-show-time="1" data-show-admin="0" data-excerpt-length="32" data-show-title="1" class="ds-recent-comments"></div></div></div></div></div><a id="totop" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.2.0" async></script><div id="footer"><div class="footer-info"><p><a href="/baidusitemap.xml">网站地图</a> |<a href="/atom.xml">订阅本站</a> |<span>联系博主：<a href="mailto:hanpfei@gmail.com" target="_blank" class="fa fa-email"> </a><a href="null" target="_blank" class="fa fa-weibo"></a><a href="https://github.com/hanpfei" target="_blank" class="fa fa-github"> </a></span></p><p><span> Copyright &copy;<a href="/." rel="nofollow">Han Pengfei</a></span><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span><span><a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake"> Theme </a>by<a rel="nofollow" target="_blank" href="https://github.com/chaooo"> Charles.</a></span></p></div></div></div><script>var duoshuoQuery = {short_name:'wolfcstech'};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    document.getElementsByTagName('body')[0].appendChild(ds);
})();
</script><script type="text/javascript" src="/js/search.json.js?v=1.2.0"></script></body></html>